
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>API · Node.js</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="tuzhu008">
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../../styles/website.css">
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="faq.html" />
    
    

    
        <link rel="shortcut icon" href='../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../../../assets/images/apple-touch-icon.png'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../../../assets/images/apple-touch-icon-120x120.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../../../assets/images/apple-touch-icon-180x180.png">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    关于 Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../GLOSSARY.html">
            
                <a href="../../../GLOSSARY.html">
            
                    
                    术语
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">参考文档</li>
        
        
    

    
        
        <li class="header">相关库</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Node 相关库列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../nvm/">
            
                <a href="../../nvm/">
            
                    
                    node 版本管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../request/">
            
                <a href="../../request/">
            
                    
                    request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../async/">
            
                <a href="../../async/">
            
                    
                    async
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../supervisor/">
            
                <a href="../../supervisor/">
            
                    
                    supervisior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../express/">
            
                <a href="../../express/">
            
                    
                    Express
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="../../express/docs/API.html">
            
                <a href="../../express/docs/API.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1.1" >
            
                <span>
            
                    
                    express()
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.2" >
            
                <span>
            
                    
                    Aplication
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.3" >
            
                <span>
            
                    
                    Request
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.4" >
            
                <span>
            
                    
                    Response
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.5" data-path="../../express/docs/API.html">
            
                <a href="../../express/docs/API.html#router">
            
                    
                    Router
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="../../express/middleware/">
            
                <a href="../../express/middleware/">
            
                    
                    中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.2.1" data-path="../../express/middleware/method-override/">
            
                <a href="../../express/middleware/method-override/">
            
                    
                    method-override
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.2" data-path="../../express/middleware/session/">
            
                <a href="../../express/middleware/session/">
            
                    
                    express-session
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../../connect/">
            
                <a href="../../connect/">
            
                    
                    connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../../socket.io/">
            
                <a href="../../socket.io/">
            
                    
                    socket.io
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="../../socket.io/docs/">
            
                <a href="../../socket.io/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1.1" data-path="../../socket.io/docs/API.html">
            
                <a href="../../socket.io/docs/API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8.1.2" data-path="../../socket.io/docs/emit.html">
            
                <a href="../../socket.io/docs/emit.html">
            
                    
                    emit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.8.2" data-path="../../socket.io/library/REAME.html">
            
                <a href="../../socket.io/library/REAME.html">
            
                    
                    相关库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.2.1" data-path="../../socket.io/library/engine.io/">
            
                <a href="../../socket.io/library/engine.io/">
            
                    
                    engine.io
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="../../socket.io-client/">
            
                <a href="../../socket.io-client/">
            
                    
                    socket.io-client
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.9.1" data-path="../../socket.io-client/docs/">
            
                <a href="../../socket.io-client/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.9.1.1" data-path="../../socket.io-client/docs/API.html">
            
                <a href="../../socket.io-client/docs/API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="../../node_redis/">
            
                <a href="../../node_redis/">
            
                    
                    node_redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="../../node-http-proxy/">
            
                <a href="../../node-http-proxy/">
            
                    
                    node-http-proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="../../mysql/">
            
                <a href="../../mysql/">
            
                    
                    mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="../">
            
                <a href="../">
            
                    
                    mongoose
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1" data-path="./">
            
                <a href="./">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.1" data-path="quick-start.html">
            
                <a href="quick-start.html">
            
                    
                    快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2" data-path="guide.html">
            
                <a href="guide.html">
            
                    
                    指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.1" data-path="guide.html">
            
                <a href="guide.html">
            
                    
                    schemas
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.1.1" data-path="SchemaTypes.html">
            
                <a href="SchemaTypes.html">
            
                    
                    types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.1.2" data-path="customschematypes.html">
            
                <a href="customschematypes.html">
            
                    
                    custom
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.1.3" data-path="advanced_schemas.html">
            
                <a href="advanced_schemas.html">
            
                    
                    advanced usage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.2" data-path="models.html">
            
                <a href="models.html">
            
                    
                    models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.3" data-path="documents.html">
            
                <a href="documents.html">
            
                    
                    documents
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.3.1" data-path="subdocs.html">
            
                <a href="subdocs.html">
            
                    
                    sub docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.3.2" data-path="defaults.html">
            
                <a href="defaults.html">
            
                    
                    defaults
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.4" data-path="queries.html">
            
                <a href="queries.html">
            
                    
                    queries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.5" data-path="validation.html">
            
                <a href="validation.html">
            
                    
                    validation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.6" data-path="middleware.html">
            
                <a href="middleware.html">
            
                    
                    middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.7" data-path="populate.html">
            
                <a href="populate.html">
            
                    
                    population
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.8" data-path="connections.html">
            
                <a href="connections.html">
            
                    
                    connections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.9" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                    plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.10" data-path="promises.html">
            
                <a href="promises.html">
            
                    
                    promises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.11" data-path="discriminators.html">
            
                <a href="discriminators.html">
            
                    
                    discriminators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.12" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/blob/master/CONTRIBUTING.md">
            
                    
                    contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.13" data-path="harmony.html">
            
                <a href="harmony.html">
            
                    
                    ES2015 integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.14" data-path="browser.html">
            
                <a href="browser.html">
            
                    
                    schemas in the browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.15" data-path="compatibility.html">
            
                <a href="compatibility.html">
            
                    
                    MongoDB Version Compatibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.16" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/3.6-Release-Notes">
            
                    
                    3.6 release notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.17" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/3.8-Release-Notes">
            
                    
                    3.8 release notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.18" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/4.0-Release-Notes">
            
                    
                    4.0 release notes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="3.13.1.3" data-path="API.html">
            
                <a href="API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.4" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.5" data-path="prior.html">
            
                <a href="prior.html">
            
                    
                    之前的版本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#indexjs"><b>1. </b>index.js</a></li><ul><li><span class="title-icon "></span><a href="#mongooseaggregate"><b>1.1. </b>Mongoose#Aggregate()</a></li><li><span class="title-icon "></span><a href="#mongoosecasterrortype-value-path-reason"><b>1.2. </b>Mongoose#CastError(type, value, path, [reason])</a></li><li><span class="title-icon "></span><a href="#mongoosecollection"><b>1.3. </b>Mongoose#Collection()</a></li><li><span class="title-icon "></span><a href="#mongooseconnecturis-options-optionsusemongoclient-callback"><b>1.4. </b>Mongoose#connect(uri(s), [options], [options.useMongoClient], [callback])</a></li><li><span class="title-icon "></span><a href="#mongooseconnection"><b>1.5. </b>Mongoose#Connection()</a></li><li><span class="title-icon "></span><a href="#mongoosecreateconnectionuri-options-optionsconfig-optionsconfigautoindex-optionsusemongoclient"><b>1.6. </b>Mongoose#createConnection([uri], [options], [options.config], [options.config.autoIndex], [options.useMongoClient])</a></li><li><span class="title-icon "></span><a href="#mongoosedisconnectfn"><b>1.7. </b>Mongoose#disconnect([fn])</a></li><li><span class="title-icon "></span><a href="#mongoosedocument"><b>1.8. </b>Mongoose#Document()</a></li><li><span class="title-icon "></span><a href="#mongoosedocumentprovider"><b>1.9. </b>Mongoose#DocumentProvider()</a></li><li><span class="title-icon "></span><a href="#mongooseerror"><b>1.10. </b>Mongoose#Error()</a></li><li><span class="title-icon "></span><a href="#mongoosegetkey"><b>1.11. </b>Mongoose#get(key)</a></li><li><span class="title-icon "></span><a href="#mongoosegetpromiseconstructor"><b>1.12. </b>Mongoose#getPromiseConstructor()</a></li><li><span class="title-icon "></span><a href="#mongoosemodel"><b>1.13. </b>Mongoose#Model()</a></li><li><span class="title-icon "></span><a href="#mongoosemodelnames"><b>1.14. </b>Mongoose#modelNames()</a></li><li><span class="title-icon "></span><a href="#mongoose"><b>1.15. </b>Mongoose()</a></li><li><span class="title-icon "></span><a href="#mongoosemongoose"><b>1.16. </b>Mongoose#Mongoose()</a></li><li><span class="title-icon "></span><a href="#function-object--native-code-promise"><b>1.17. </b>function Object() { [native code] }#Promise()</a></li><li><span class="title-icon "></span><a href="#mongoosepromiseprovider"><b>1.18. </b>Mongoose#PromiseProvider()</a></li><li><span class="title-icon "></span><a href="#mongoosequery"><b>1.19. </b>Mongoose#Query()</a></li><li><span class="title-icon "></span><a href="#mongooseschema"><b>1.20. </b>Mongoose#Schema()</a></li><li><span class="title-icon "></span><a href="#mongooseschematype"><b>1.21. </b>Mongoose#SchemaType()</a></li><li><span class="title-icon "></span><a href="#mongoosesetkey-value"><b>1.22. </b>Mongoose#set(key, value)</a></li><li><span class="title-icon "></span><a href="#mongoosevirtualtype"><b>1.23. </b>Mongoose#VirtualType()</a></li><li><span class="title-icon "></span><a href="#mongooseconnection_1"><b>1.24. </b>Mongoose#connection</a></li><li><span class="title-icon "></span><a href="#mongoosemquery"><b>1.25. </b>Mongoose#mquery</a></li><li><span class="title-icon "></span><a href="#mongooseschematypes"><b>1.26. </b>Mongoose#SchemaTypes</a></li><li><span class="title-icon "></span><a href="#mongoosetypes"><b>1.27. </b>Mongoose#Types</a></li><li><span class="title-icon "></span><a href="#mongooseversion"><b>1.28. </b>Mongoose#version</a></li></ul><li><span class="title-icon "></span><a href="#typesarrayjs"><b>2. </b>types/array.js</a></li><ul><li><span class="title-icon "></span><a href="#mongoosearrayshift"><b>2.1. </b>MongooseArray#$shift()</a></li><li><span class="title-icon "></span><a href="#mongoosearrayremove"><b>2.2. </b>MongooseArray#remove()</a></li><li><span class="title-icon "></span><a href="#mongoosearraypop"><b>2.3. </b>MongooseArray.$pop()</a></li><li><span class="title-icon "></span><a href="#mongoosearrayaddtosetargs"><b>2.4. </b>MongooseArray.addToSet([args...])</a></li><li><span class="title-icon "></span><a href="#mongoosearrayindexofobj"><b>2.5. </b>MongooseArray.indexOf(obj)</a></li><li><span class="title-icon "></span><a href="#mongoosearrayinspect"><b>2.6. </b>MongooseArray.inspect()</a></li><li><span class="title-icon "></span><a href="#mongoosearraynonatomicpushargs"><b>2.7. </b>MongooseArray.nonAtomicPush([args...])</a></li><li><span class="title-icon "></span><a href="#mongoosearraypop_1"><b>2.8. </b>MongooseArray.pop()</a></li><li><span class="title-icon "></span><a href="#mongoosearraypullargs"><b>2.9. </b>MongooseArray.pull([args...])</a></li><li><span class="title-icon "></span><a href="#mongoosearraypushargs"><b>2.10. </b>MongooseArray.push([args...])</a></li><li><span class="title-icon "></span><a href="#mongoosearrayset"><b>2.11. </b>MongooseArray.set()</a></li><li><span class="title-icon "></span><a href="#mongoosearrayshift_1"><b>2.12. </b>MongooseArray.shift()</a></li><li><span class="title-icon "></span><a href="#mongoosearraysort"><b>2.13. </b>MongooseArray.sort()</a></li><li><span class="title-icon "></span><a href="#mongoosearraysplice"><b>2.14. </b>MongooseArray.splice()</a></li><li><span class="title-icon "></span><a href="#mongoosearraytoobjectoptions"><b>2.15. </b>MongooseArray.toObject(options)</a></li><li><span class="title-icon "></span><a href="#mongoosearrayunshift"><b>2.16. </b>MongooseArray.unshift()</a></li></ul><li><span class="title-icon "></span><a href="#typessubdocumentjs"><b>3. </b>types/subdocument.js</a></li><ul><li><span class="title-icon "></span><a href="#subdocumentownerdocument"><b>3.1. </b>Subdocument#ownerDocument()</a></li><li><span class="title-icon "></span><a href="#subdocumentparent"><b>3.2. </b>Subdocument#parent()</a></li><li><span class="title-icon "></span><a href="#subdocumentremoveoptions-callback"><b>3.3. </b>Subdocument#remove([options], [callback])</a></li></ul><li><span class="title-icon "></span><a href="#typesembeddedjs"><b>4. </b>types/embedded.js</a></li><ul><li><span class="title-icon "></span><a href="#embeddeddocumentinspect"><b>4.1. </b>EmbeddedDocument#inspect()</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentinvalidatepath-err"><b>4.2. </b>EmbeddedDocument#invalidate(path, err)</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentownerdocument"><b>4.3. </b>EmbeddedDocument#ownerDocument()</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentparent"><b>4.4. </b>EmbeddedDocument#parent()</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentparentarray"><b>4.5. </b>EmbeddedDocument#parentArray()</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentremoveoptions-fn"><b>4.6. </b>EmbeddedDocument#remove([options], [fn])</a></li><li><span class="title-icon "></span><a href="#embeddeddocumentmarkmodifiedpath"><b>4.7. </b>EmbeddedDocument.markModified(path)</a></li></ul><li><span class="title-icon "></span><a href="#typesbufferjs"><b>5. </b>types/buffer.js</a></li><ul><li><span class="title-icon "></span><a href="#mongoosebuffercopytarget"><b>5.1. </b>MongooseBuffer.copy(target)</a></li><li><span class="title-icon "></span><a href="#mongoosebufferequalsother"><b>5.2. </b>MongooseBuffer.equals(other)</a></li><li><span class="title-icon "></span><a href="#mongoosebuffersubtypesubtype"><b>5.3. </b>MongooseBuffer.subtype(subtype)</a></li><li><span class="title-icon "></span><a href="#mongoosebuffertobson"><b>5.4. </b>MongooseBuffer.toBSON()</a></li><li><span class="title-icon "></span><a href="#mongoosebuffertoobjectsubtype"><b>5.5. </b>MongooseBuffer.toObject([subtype])</a></li><li><span class="title-icon "></span><a href="#mongoosebufferwrite"><b>5.6. </b>MongooseBuffer.write()</a></li></ul><li><span class="title-icon "></span><a href="#typesobjectidjs"><b>6. </b>types/objectid.js</a></li><ul><li><span class="title-icon "></span><a href="#objectid"><b>6.1. </b>ObjectId()</a></li></ul><li><span class="title-icon "></span><a href="#typesdecimal128js"><b>7. </b>types/decimal128.js</a></li><ul><li><span class="title-icon "></span><a href="#exports"><b>7.1. </b>exports()</a></li></ul><li><span class="title-icon "></span><a href="#typesdocumentarrayjs"><b>8. </b>types/documentarray.js</a></li><ul><li><span class="title-icon "></span><a href="#mongoosedocumentarraycreateobj"><b>8.1. </b>MongooseDocumentArray.create(obj)</a></li><li><span class="title-icon "></span><a href="#mongoosedocumentarrayidid"><b>8.2. </b>MongooseDocumentArray.id(id)</a></li><li><span class="title-icon "></span><a href="#mongoosedocumentarrayinspect"><b>8.3. </b>MongooseDocumentArray.inspect()</a></li><li><span class="title-icon "></span><a href="#mongoosedocumentarraytoobjectoptions"><b>8.4. </b>MongooseDocumentArray.toObject([options])</a></li></ul><li><span class="title-icon "></span><a href="#promisejs"><b>9. </b>promise.js</a></li><ul><li><span class="title-icon "></span><a href="#promiseaddbacklistener"><b>9.1. </b>Promise#addBack(listener)</a></li><li><span class="title-icon "></span><a href="#promiseaddcallbacklistener"><b>9.2. </b>Promise#addCallback(listener)</a></li><li><span class="title-icon "></span><a href="#promiseadderrbacklistener"><b>9.3. </b>Promise#addErrback(listener)</a></li><li><span class="title-icon "></span><a href="#promisecatchonreject"><b>9.4. </b>Promise#catch(onReject)</a></li><li><span class="title-icon "></span><a href="#promiseend"><b>9.5. </b>Promise#end()</a></li><li><span class="title-icon "></span><a href="#promiseerrorerr"><b>9.6. </b>Promise#error(err)</a></li><li><span class="title-icon "></span><a href="#promiseonevent-listener"><b>9.7. </b>Promise#on(event, listener)</a></li><li><span class="title-icon "></span><a href="#promisefn"><b>9.8. </b>Promise(fn)</a></li><li><span class="title-icon "></span><a href="#promiserejectreason"><b>9.9. </b>Promise#reject(reason)</a></li><li><span class="title-icon "></span><a href="#promiseresolveerr-val"><b>9.10. </b>Promise#resolve([err], [val])</a></li><li><span class="title-icon "></span><a href="#promisethenonfulfill-onreject"><b>9.11. </b>Promise#then(onFulFill, onReject)</a></li><li><span class="title-icon "></span><a href="#promisecompleteargs"><b>9.12. </b>Promise.complete(args)</a></li><li><span class="title-icon "></span><a href="#promisees6resolver"><b>9.13. </b>Promise.ES6(resolver)</a></li><li><span class="title-icon "></span><a href="#promisefulfillargs"><b>9.14. </b>Promise.fulfill(args)</a></li></ul><li><span class="title-icon "></span><a href="#virtualtypejs"><b>10. </b>virtualtype.js</a></li><ul><li><span class="title-icon "></span><a href="#virtualtype"><b>10.1. </b>VirtualType()</a></li><li><span class="title-icon "></span><a href="#virtualtypegetfn"><b>10.2. </b>VirtualType#get(fn)</a></li><li><span class="title-icon "></span><a href="#virtualtypesetfn"><b>10.3. </b>VirtualType#set(fn)</a></li><li><span class="title-icon "></span><a href="#virtualtypeapplygettersvalue-scope"><b>10.4. </b>VirtualType#applyGetters(value, scope)</a></li><li><span class="title-icon "></span><a href="#virtualtypeapplysettersvalue-scope"><b>10.5. </b>VirtualType#applySetters(value, scope)</a></li><li><span class="title-icon "></span><a href="#utilsjs"><b>10.6. </b>utils.js</a></li><li><span class="title-icon "></span><a href="#exportspluralization"><b>10.7. </b>exports.pluralization</a></li><li><span class="title-icon "></span><a href="#exportsuncountables"><b>10.8. </b>exports.uncountables</a></li></ul><li><span class="title-icon "></span><a href="#driversnode-mongodb-nativecollectionjs"><b>11. </b>drivers/node-mongodb-native/collection.js</a></li><ul><li><span class="title-icon "></span><a href="#function-object--native-code-format"><b>11.1. </b>function Object() { [native code] }#$format()</a></li><li><span class="title-icon "></span><a href="#function-object--native-code-print"><b>11.2. </b>function Object() { [native code] }#$print(</a></li><li><span class="title-icon "></span><a href="#nativecollectiongetindexescallback"><b>11.3. </b>NativeCollection#getIndexes(callback)</a></li></ul><li><span class="title-icon "></span><a href="#driversnode-mongodb-nativeconnectionjs"><b>12. </b>drivers/node-mongodb-native/connection.js</a></li><ul><li><span class="title-icon "></span><a href="#nativeconnectionusedbname"><b>12.1. </b>NativeConnection#useDb(name)</a></li><li><span class="title-icon "></span><a href="#nativeconnectionstates"><b>12.2. </b>NativeConnection.STATES</a></li></ul><li><span class="title-icon "></span><a href="#browserjs"><b>13. </b>browser.js</a></li><ul><li><span class="title-icon "></span><a href="#function-object--native-code-promise_1"><b>13.1. </b>function Object() { [native code] }#Promise()</a></li><li><span class="title-icon "></span><a href="#exportsdocument"><b>13.2. </b>exports.Document()</a></li><li><span class="title-icon "></span><a href="#exportserror"><b>13.3. </b>exports.Error()</a></li><li><span class="title-icon "></span><a href="#exportspromiseprovider"><b>13.4. </b>exports.PromiseProvider()</a></li><li><span class="title-icon "></span><a href="#exportsschema"><b>13.5. </b>exports.Schema()</a></li><li><span class="title-icon "></span><a href="#exportsvirtualtype"><b>13.6. </b>exports.VirtualType()</a></li><li><span class="title-icon "></span><a href="#exportsschematypes"><b>13.7. </b>exports#SchemaTypes</a></li><li><span class="title-icon "></span><a href="#exportstypes"><b>13.8. </b>exports#Types</a></li></ul><li><span class="title-icon "></span><a href="#es6promisejs"><b>14. </b>ES6Promise.js</a></li><ul><li><span class="title-icon "></span><a href="#es6promisefn"><b>14.1. </b>ES6Promise(fn)</a></li><li><span class="title-icon "></span><a href="#schemajs"><b>14.2. </b>schema.js</a></li><li><span class="title-icon "></span><a href="#schemaaddobj-prefix"><b>14.3. </b>Schema#add(obj, prefix)</a></li><li><span class="title-icon "></span><a href="#schemaclone"><b>14.4. </b>Schema#clone()</a></li><li><span class="title-icon "></span><a href="#schemaeachpathfn"><b>14.5. </b>Schema#eachPath(fn)</a></li><li><span class="title-icon "></span><a href="#schemagetkey"><b>14.6. </b>Schema#get(key)</a></li><li><span class="title-icon "></span><a href="#schemaindexfields-options-optionsexpiresnull"><b>14.7. </b>Schema#index(fields, [options], [options.expires=null])</a></li><li><span class="title-icon "></span><a href="#schemaindexes"><b>14.8. </b>Schema#indexes()</a></li><li><span class="title-icon "></span><a href="#schemamethodmethod-fn"><b>14.9. </b>Schema#method(method, [fn])</a></li><li><span class="title-icon "></span><a href="#schemapathpath-constructor"><b>14.10. </b>Schema#path(path, constructor)</a></li><li><span class="title-icon "></span><a href="#schemapathtypepath"><b>14.11. </b>Schema#pathType(path)</a></li><li><span class="title-icon "></span><a href="#schemapluginplugin-opts"><b>14.12. </b>Schema#plugin(plugin, [opts])</a></li><li><span class="title-icon "></span><a href="#schemapostmethod-fn"><b>14.13. </b>Schema#post(method, fn)</a></li><li><span class="title-icon "></span><a href="#schemapremethod-callback"><b>14.14. </b>Schema#pre(method, callback)</a></li><li><span class="title-icon "></span><a href="#schemaqueuename-args"><b>14.15. </b>Schema#queue(name, args)</a></li><li><span class="title-icon "></span><a href="#schemaremovepath"><b>14.16. </b>Schema#remove(path)</a></li><li><span class="title-icon "></span><a href="#schemarequiredpathsinvalidate"><b>14.17. </b>Schema#requiredPaths(invalidate)</a></li><li><span class="title-icon "></span><a href="#schemadefinition-options"><b>14.18. </b>Schema(definition, [options])</a></li><li><span class="title-icon "></span><a href="#schemasetkey-value"><b>14.19. </b>Schema#set(key, [value])</a></li><li><span class="title-icon "></span><a href="#schemastaticname-fn"><b>14.20. </b>Schema#static(name, [fn])</a></li><li><span class="title-icon "></span><a href="#schemavirtualname-options"><b>14.21. </b>Schema#virtual(name, [options])</a></li><li><span class="title-icon "></span><a href="#schemavirtualpathname"><b>14.22. </b>Schema#virtualpath(name)</a></li><li><span class="title-icon "></span><a href="#schemaindextypes"><b>14.23. </b>Schema.indexTypes()</a></li><li><span class="title-icon "></span><a href="#schemareserved"><b>14.24. </b>Schema.reserved</a></li><li><span class="title-icon "></span><a href="#schematypes"><b>14.25. </b>Schema.Types</a></li><li><span class="title-icon "></span><a href="#schemachildschemas"><b>14.26. </b>Schema#childSchemas</a></li><li><span class="title-icon "></span><a href="#schemaobj"><b>14.27. </b>Schema#obj</a></li></ul><li><span class="title-icon "></span><a href="#documentjs"><b>15. </b>document.js</a></li><ul><li><span class="title-icon "></span><a href="#missing-method-name"><b>15.1. </b>MISSING method name</a></li><li><span class="title-icon "></span><a href="#missing-method-name_1"><b>15.2. </b>MISSING method name</a></li><li><span class="title-icon "></span><a href="#documentignorepath"><b>15.3. </b>Document#$ignore(path)</a></li><li><span class="title-icon "></span><a href="#documentisdefaultpath"><b>15.4. </b>Document#$isDefault([path])</a></li><li><span class="title-icon "></span><a href="#documentdepopulatepath"><b>15.5. </b>Document#depopulate(path)</a></li><li><span class="title-icon "></span><a href="#documentequalsdoc"><b>15.6. </b>Document#equals(doc)</a></li><li><span class="title-icon "></span><a href="#documentexecpopulate"><b>15.7. </b>Document#execPopulate()</a></li><li><span class="title-icon "></span><a href="#documentgetpath-type"><b>15.8. </b>Document#get(path, [type])</a></li><li><span class="title-icon "></span><a href="#documentinitdoc-fn"><b>15.9. </b>Document#init(doc, fn)</a></li><li><span class="title-icon "></span><a href="#documentinspect"><b>15.10. </b>Document#inspect()</a></li><li><span class="title-icon "></span><a href="#documentinvalidatepath-errormsg-value-kind"><b>15.11. </b>Document#invalidate(path, errorMsg, value, [kind])</a></li><li><span class="title-icon "></span><a href="#documentisdirectmodifiedpath"><b>15.12. </b>Document#isDirectModified(path)</a></li><li><span class="title-icon "></span><a href="#documentisdirectselectedpath"><b>15.13. </b>Document#isDirectSelected(path)</a></li><li><span class="title-icon "></span><a href="#documentisinitpath"><b>15.14. </b>Document#isInit(path)</a></li><li><span class="title-icon "></span><a href="#documentismodifiedpath"><b>15.15. </b>Document#isModified([path])</a></li><li><span class="title-icon "></span><a href="#documentisselectedpath"><b>15.16. </b>Document#isSelected(path)</a></li><li><span class="title-icon "></span><a href="#documentmarkmodifiedpath-scope"><b>15.17. </b>Document#markModified(path, [scope])</a></li><li><span class="title-icon "></span><a href="#documentmodifiedpaths"><b>15.18. </b>Document#modifiedPaths()</a></li><li><span class="title-icon "></span><a href="#documentpopulatepath-callback"><b>15.19. </b>Document#populate([path], [callback])</a></li><li><span class="title-icon "></span><a href="#documentpopulatedpath"><b>15.20. </b>Document#populated(path)</a></li><li><span class="title-icon "></span><a href="#function-object--native-code-saveoptions-optionssafe-optionsvalidatebeforesave-fn"><b>15.21. </b>function Object() { [native code] }#save([options], [options.safe], [options.validateBeforeSave], [fn])</a></li><li><span class="title-icon "></span><a href="#path-val-type-options"><b>15.22. </b>(path, val, [type], [options])</a></li><li><span class="title-icon "></span><a href="#documenttojsonoptions"><b>15.23. </b>Document#toJSON(options)</a></li><li><span class="title-icon "></span><a href="#documenttoobjectoptions"><b>15.24. </b>Document#toObject([options])</a></li><li><span class="title-icon "></span><a href="#documenttostring"><b>15.25. </b>Document#toString()</a></li><li><span class="title-icon "></span><a href="#documentunmarkmodifiedpath"><b>15.26. </b>Document#unmarkModified(path)</a></li><li><span class="title-icon "></span><a href="#documentupdatedoc-options-callback"><b>15.27. </b>Document#update(doc, options, callback)</a></li><li><span class="title-icon "></span><a href="#documentvalidateoptional-callback"><b>15.28. </b>Document#validate(optional, callback)</a></li><li><span class="title-icon "></span><a href="#documentvalidatesyncpathstovalidate"><b>15.29. </b>Document#validateSync(pathsToValidate)</a></li><li><span class="title-icon "></span><a href="#documentmarkvalidpath"><b>15.30. </b>Document.$markValid(path)</a></li><li><span class="title-icon "></span><a href="#documenterrors"><b>15.31. </b>Document#errors</a></li><li><span class="title-icon "></span><a href="#documentid"><b>15.32. </b>Document#id</a></li><li><span class="title-icon "></span><a href="#documentisnew"><b>15.33. </b>Document#isNew</a></li><li><span class="title-icon "></span><a href="#documentschema"><b>15.34. </b>Document#schema</a></li></ul><li><span class="title-icon "></span><a href="#queryjs"><b>16. </b>query.js</a></li><ul><li><span class="title-icon "></span><a href="#querywherejs"><b>16.1. </b>Query#$where(js)</a></li><li><span class="title-icon "></span><a href="#queryallpath-val"><b>16.2. </b>Query#all([path], val)</a></li><li><span class="title-icon "></span><a href="#queryandarray"><b>16.3. </b>Query#and(array)</a></li><li><span class="title-icon "></span><a href="#querybatchsizeval"><b>16.4. </b>Query#batchSize(val)</a></li><li><span class="title-icon "></span><a href="#queryboxval-upper"><b>16.5. </b>Query#box(val, Upper)</a></li><li><span class="title-icon "></span><a href="#querycastmodel-obj"><b>16.6. </b>Query#cast(model, [obj])</a></li><li><span class="title-icon "></span><a href="#querycatchreject"><b>16.7. </b>Query#catch([reject])</a></li><li><span class="title-icon "></span><a href="#querycenter"><b>16.8. </b>Query#center()</a></li><li><span class="title-icon "></span><a href="#querycenterspherepath-val"><b>16.9. </b>Query#centerSphere([path], val)</a></li><li><span class="title-icon "></span><a href="#querycirclepath-area"><b>16.10. </b>Query#circle([path], area)</a></li><li><span class="title-icon "></span><a href="#querycollationvalue"><b>16.11. </b>Query#collation(value)</a></li><li><span class="title-icon "></span><a href="#querycommentval"><b>16.12. </b>Query#comment(val)</a></li><li><span class="title-icon "></span><a href="#querycountcriteria-callback"><b>16.13. </b>Query#count([criteria], [callback])</a></li><li><span class="title-icon "></span><a href="#querycursoroptions"><b>16.14. </b>Query#cursor([options])</a></li><li><span class="title-icon "></span><a href="#querydeletemanyfilter-callback"><b>16.15. </b>Query#deleteMany([filter], [callback])</a></li><li><span class="title-icon "></span><a href="#querydeleteonefilter-callback"><b>16.16. </b>Query#deleteOne([filter], [callback])</a></li><li><span class="title-icon "></span><a href="#querydistinctfield-criteria-callback"><b>16.17. </b>Query#distinct([field], [criteria], [callback])</a></li><li><span class="title-icon "></span><a href="#queryelemmatchpath-criteria"><b>16.18. </b>Query#elemMatch(path, criteria)</a></li><li><span class="title-icon "></span><a href="#queryequalsval"><b>16.19. </b>Query#equals(val)</a></li><li><span class="title-icon "></span><a href="#queryerrorerr"><b>16.20. </b>Query#error(err)</a></li><li><span class="title-icon "></span><a href="#queryexecoperation-callback"><b>16.21. </b>Query#exec([operation], [callback])</a></li><li><span class="title-icon "></span><a href="#queryexistspath-val"><b>16.22. </b>Query#exists([path], val)</a></li><li><span class="title-icon "></span><a href="#queryfindfilter-callback"><b>16.23. </b>Query#find([filter], [callback])</a></li><li><span class="title-icon "></span><a href="#queryfindonefilter-projection-options-callback"><b>16.24. </b>Query#findOne([filter], [projection], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#queryfindoneandremoveconditions-options-optionspassrawresult-optionsstrict-callback"><b>16.25. </b>Query#findOneAndRemove([conditions], [options], [options.passRawResult], [options.strict], [callback])</a></li><li><span class="title-icon "></span><a href="#queryfindoneandupdatequery-doc-options-optionspassrawresult-optionsstrict-optionsmultiplecasterror-callback"><b>16.26. </b>Query#findOneAndUpdate([query], [doc], [options], [options.passRawResult], [options.strict], [options.multipleCastError], [callback])</a></li><li><span class="title-icon "></span><a href="#querygeometryobject"><b>16.27. </b>Query#geometry(object)</a></li><li><span class="title-icon "></span><a href="#querygetquery"><b>16.28. </b>Query#getQuery()</a></li><li><span class="title-icon "></span><a href="#querygetupdate"><b>16.29. </b>Query#getUpdate()</a></li><li><span class="title-icon "></span><a href="#querygtpath-val"><b>16.30. </b>Query#gt([path], val)</a></li><li><span class="title-icon "></span><a href="#querygtepath-val"><b>16.31. </b>Query#gte([path], val)</a></li><li><span class="title-icon "></span><a href="#queryhintval"><b>16.32. </b>Query#hint(val)</a></li><li><span class="title-icon "></span><a href="#queryinpath-val"><b>16.33. </b>Query#in([path], val)</a></li><li><span class="title-icon "></span><a href="#queryintersectsarg"><b>16.34. </b>Query#intersects([arg])</a></li><li><span class="title-icon "></span><a href="#queryleanbool"><b>16.35. </b>Query#lean(bool)</a></li><li><span class="title-icon "></span><a href="#querylimitval"><b>16.36. </b>Query#limit(val)</a></li><li><span class="title-icon "></span><a href="#queryltpath-val"><b>16.37. </b>Query#lt([path], val)</a></li><li><span class="title-icon "></span><a href="#queryltepath-val"><b>16.38. </b>Query#lte([path], val)</a></li><li><span class="title-icon "></span><a href="#querymaxdistancepath-val"><b>16.39. </b>Query#maxDistance([path], val)</a></li><li><span class="title-icon "></span><a href="#querymaxscan"><b>16.40. </b>Query#maxscan()</a></li><li><span class="title-icon "></span><a href="#querymaxscanval"><b>16.41. </b>Query#maxScan(val)]()</a></li><li><span class="title-icon "></span><a href="#querymergesource"><b>16.42. </b>Query#merge(source)</a></li><li><span class="title-icon "></span><a href="#querymergesource_1"><b>16.43. </b>Query#merge(source)</a></li><li><span class="title-icon "></span><a href="#querymodpath-val"><b>16.44. </b>Query#mod([path], val)</a></li><li><span class="title-icon "></span><a href="#querymongooseoptionsoptions"><b>16.45. </b>Query#mongooseOptions(options)</a></li><li><span class="title-icon "></span><a href="#querynepath-val"><b>16.46. </b>Query#ne([path], val)</a></li><li><span class="title-icon "></span><a href="#querynearpath-val"><b>16.47. </b>Query#near([path], val)</a></li><li><span class="title-icon "></span><a href="#querynearsphere"><b>16.48. </b>Query#nearSphere()</a></li><li><span class="title-icon "></span><a href="#queryninpath-val"><b>16.49. </b>Query#nin([path], val)</a></li><li><span class="title-icon "></span><a href="#querynorarray"><b>16.50. </b>Query#nor(array)</a></li><li><span class="title-icon "></span><a href="#queryorarray"><b>16.51. </b>Query#or(array)</a></li><li><span class="title-icon "></span><a href="#querypolygonpath-coordinatepairs"><b>16.52. </b>Query#polygon([path], [coordinatePairs...])</a></li><li><span class="title-icon "></span><a href="#querypopulatepath-select-model-match-options"><b>16.53. </b>Query#populate(path, [select], [model], [match], [options])</a></li><li><span class="title-icon "></span><a href="#queryreadpref-tags"><b>16.54. </b>Query#read(pref, [tags])</a></li><li><span class="title-icon "></span><a href="#queryregexpath-val"><b>16.55. </b>Query#regex([path], val)</a></li><li><span class="title-icon "></span><a href="#queryremovefilter-callback"><b>16.56. </b>Query#remove([filter], [callback])</a></li><li><span class="title-icon "></span><a href="#queryreplaceonecriteria-doc-options-callback"><b>16.57. </b>Query#replaceOne([criteria], [doc], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#queryselectarg"><b>16.58. </b>Query#select(arg)</a></li><li><span class="title-icon "></span><a href="#queryselected"><b>16.59. </b>Query#selected()</a></li><li><span class="title-icon "></span><a href="#queryselectedexclusively"><b>16.60. </b>Query#selectedExclusively()</a></li><li><span class="title-icon "></span><a href="#queryselectedinclusively"><b>16.61. </b>Query#selectedInclusively()</a></li><li><span class="title-icon "></span><a href="#querysetoptionsoptions"><b>16.62. </b>Query#setOptions(options)</a></li><li><span class="title-icon "></span><a href="#querysizepath-val"><b>16.63. </b>Query#size([path], val)</a></li><li><span class="title-icon "></span><a href="#queryskipval"><b>16.64. </b>Query#skip(val)</a></li><li><span class="title-icon "></span><a href="#queryslaveokv"><b>16.65. </b>Query#slaveOk(v)</a></li><li><span class="title-icon "></span><a href="#queryslicepath-val"><b>16.66. </b>Query#slice([path], val)</a></li><li><span class="title-icon "></span><a href="#queryslicepath-val_1"><b>16.67. </b>Query#slice([path], [val])</a></li><li><span class="title-icon "></span><a href="#querysnapshot"><b>16.68. </b>Query#snapshot()</a></li><li><span class="title-icon "></span><a href="#querysortarg"><b>16.69. </b>Query#sort(arg)</a></li><li><span class="title-icon "></span><a href="#querystreamoptions"><b>16.70. </b>Query#stream([options])</a></li><li><span class="title-icon "></span><a href="#querytailablebool-opts-optsnumberofretries-optstailableretryinterval"><b>16.71. </b>Query#tailable(bool, [opts], [opts.numberOfRetries], [opts.tailableRetryInterval])</a></li><li><span class="title-icon "></span><a href="#querythenresolve-reject"><b>16.72. </b>Query#then([resolve], [reject])</a></li><li><span class="title-icon "></span><a href="#querytoconstructor"><b>16.73. </b>Query#toConstructor()</a></li><li><span class="title-icon "></span><a href="#queryupdatecriteria-doc-options-optionsmultiplecasterror-callback"><b>16.74. </b>Query#update([criteria], [doc], [options], [options.multipleCastError], [callback])</a></li><li><span class="title-icon "></span><a href="#queryupdatemanycriteria-doc-options-callback"><b>16.75. </b>Query#updateMany([criteria], [doc], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#queryupdateonecriteria-doc-options-callback"><b>16.76. </b>Query#updateOne([criteria], [doc], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#querywithin"><b>16.77. </b>Query#within()</a></li><li><span class="title-icon "></span><a href="#queryusegeowithin"><b>16.78. </b>Query#use$geoWithin</a></li></ul><li><span class="title-icon "></span><a href="#aggregatejs"><b>17. </b>aggregate.js</a></li><ul><li><span class="title-icon "></span><a href="#aggregateaddcursorflagflag-value"><b>17.1. </b>Aggregate#addCursorFlag(flag, value)</a></li><li><span class="title-icon "></span><a href="#aggregateaddfieldsarg"><b>17.2. </b>Aggregate#addFields(arg)</a></li><li><span class="title-icon "></span><a href="#aggregateops"><b>17.3. </b>Aggregate([ops])</a></li><li><span class="title-icon "></span><a href="#aggregateallowdiskusevalue-tags"><b>17.4. </b>Aggregate#allowDiskUse(value, [tags])</a></li><li><span class="title-icon "></span><a href="#aggregateappendops"><b>17.5. </b>Aggregate#append(ops)</a></li><li><span class="title-icon "></span><a href="#aggregatecollationcollation-value"><b>17.6. </b>Aggregate#collation(collation, value)</a></li><li><span class="title-icon "></span><a href="#aggregatecursoroptions-optionsbatchsize-optionsusemongooseaggcursor"><b>17.7. </b>Aggregate#cursor(options, options.batchSize, [options.useMongooseAggCursor])</a></li><li><span class="title-icon "></span><a href="#aggregateexeccallback"><b>17.8. </b>Aggregate#exec([callback])</a></li><li><span class="title-icon "></span><a href="#aggregateexplaincallback"><b>17.9. </b>Aggregate#explain(callback)</a></li><li><span class="title-icon "></span><a href="#aggregatefacetfacet"><b>17.10. </b>Aggregate#facet(facet)</a></li><li><span class="title-icon "></span><a href="#aggregategraphlookupoptions"><b>17.11. </b>Aggregate#graphLookup(options)</a></li><li><span class="title-icon "></span><a href="#aggregategrouparg"><b>17.12. </b>Aggregate#group(arg)</a></li><li><span class="title-icon "></span><a href="#aggregatelimitnum"><b>17.13. </b>Aggregate#limit(num)</a></li><li><span class="title-icon "></span><a href="#aggregatelookupoptions"><b>17.14. </b>Aggregate#lookup(options)</a></li><li><span class="title-icon "></span><a href="#aggregatematcharg"><b>17.15. </b>Aggregate#match(arg)</a></li><li><span class="title-icon "></span><a href="#aggregatemodelmodel"><b>17.16. </b>Aggregate#model(model)</a></li><li><span class="title-icon "></span><a href="#aggregatenearparameters"><b>17.17. </b>Aggregate#near(parameters)</a></li><li><span class="title-icon "></span><a href="#aggregateoptionvalue"><b>17.18. </b>Aggregate#option(value)</a></li><li><span class="title-icon "></span><a href="#aggregatepipeline"><b>17.19. </b>Aggregate#pipeline()</a></li><li><span class="title-icon "></span><a href="#aggregateprojectarg"><b>17.20. </b>Aggregate#project(arg)</a></li><li><span class="title-icon "></span><a href="#aggregatereadpref-tags"><b>17.21. </b>Aggregate#read(pref, [tags])</a></li><li><span class="title-icon "></span><a href="#aggregatesamplesize"><b>17.22. </b>Aggregate#sample(size)</a></li><li><span class="title-icon "></span><a href="#aggregateskipnum"><b>17.23. </b>Aggregate#skip(num)</a></li><li><span class="title-icon "></span><a href="#aggregatesortarg"><b>17.24. </b>Aggregate#sort(arg)</a></li><li><span class="title-icon "></span><a href="#aggregatethenresolve-reject"><b>17.25. </b>Aggregate#then([resolve], [reject])</a></li><li><span class="title-icon "></span><a href="#aggregateunwindfields"><b>17.26. </b>Aggregate#unwind(fields)</a></li></ul><li><span class="title-icon "></span><a href="#querystreamjs"><b>18. </b>querystream.js</a></li><ul><li><span class="title-icon "></span><a href="#querystreamdestroyerr"><b>18.1. </b>QueryStream#destroy([err])</a></li><li><span class="title-icon "></span><a href="#querystreampause"><b>18.2. </b>QueryStream#pause()</a></li><li><span class="title-icon "></span><a href="#querystreampipe"><b>18.3. </b>QueryStream#pipe()</a></li><li><span class="title-icon "></span><a href="#querystreamquery-options"><b>18.4. </b>QueryStream(query, [options])</a></li><li><span class="title-icon "></span><a href="#querystreamresume"><b>18.5. </b>QueryStream#resume()</a></li><li><span class="title-icon "></span><a href="#querystreampaused"><b>18.6. </b>QueryStream#paused</a></li><li><span class="title-icon "></span><a href="#querystreamreadable"><b>18.7. </b>QueryStream#readable</a></li></ul><li><span class="title-icon "></span><a href="#servicescursoreachasyncjs"><b>19. </b>services/cursor/eachAsync.js</a></li><ul><li><span class="title-icon "></span><a href="#moduleexportsnext-fn-options-callback"><b>19.1. </b>module.exports(next, fn, options, [callback])</a></li></ul><li><span class="title-icon "></span><a href="#errorindexjs"><b>20. </b>error/index.js</a></li><ul><li><span class="title-icon "></span><a href="#mongooseerrormsg"><b>20.1. </b>MongooseError(msg)</a></li><li><span class="title-icon "></span><a href="#mongooseerrordocumentnotfounderror"><b>20.2. </b>MongooseError.DocumentNotFoundError</a></li><li><span class="title-icon "></span><a href="#mongooseerrormessages"><b>20.3. </b>MongooseError.messages</a></li></ul><li><span class="title-icon "></span><a href="#errormessagesjs"><b>21. </b>error/messages.js</a></li><ul><li><span class="title-icon "></span><a href="#mongooseerrormessages_1"><b>21.1. </b>MongooseError.messages()</a></li></ul><li><span class="title-icon "></span><a href="#errorvalidationjs"><b>22. </b>error/validation.js</a></li><ul><li><span class="title-icon "></span><a href="#validationerrortostring"><b>22.1. </b>ValidationError#toString()</a></li></ul><li><span class="title-icon "></span><a href="#modeljs"><b>23. </b>model.js</a></li><ul><li><span class="title-icon "></span><a href="#modelwhereargument"><b>23.1. </b>Model#$where(argument)</a></li><li><span class="title-icon "></span><a href="#modelincrement"><b>23.2. </b>Model#increment()</a></li><li><span class="title-icon "></span><a href="#modelmodelname"><b>23.3. </b>Model#model(name)</a></li><li><span class="title-icon "></span><a href="#modeldoc"><b>23.4. </b>Model(doc)</a></li><li><span class="title-icon "></span><a href="#modelremovefn"><b>23.5. </b>Model#remove([fn])</a></li><li><span class="title-icon "></span><a href="#modelsaveoptions-optionssafe-optionsvalidatebeforesave-fn"><b>23.6. </b>Model#save([options], [options.safe], [options.validateBeforeSave], [fn])</a></li><li><span class="title-icon "></span><a href="#modelaggregate-callback"><b>23.7. </b>Model.aggregate([...], [callback])</a></li><li><span class="title-icon "></span><a href="#modelbulkwriteops-options-callback"><b>23.8. </b>Model.bulkWrite(ops, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelcountconditions-callback"><b>23.9. </b>Model.count(conditions, [callback])</a></li><li><span class="title-icon "></span><a href="#modelcreatedocs-callback"><b>23.10. </b>Model.create(doc(s), [callback])</a></li><li><span class="title-icon "></span><a href="#modelcreateindexesoptions-cb"><b>23.11. </b>Model.createIndexes([options], [cb])</a></li><li><span class="title-icon "></span><a href="#modeldeletemanyconditions-callback"><b>23.12. </b>Model.deleteMany(conditions, [callback])</a></li><li><span class="title-icon "></span><a href="#modeldeleteoneconditions-callback"><b>23.13. </b>Model.deleteOne(conditions, [callback])</a></li><li><span class="title-icon "></span><a href="#modeldiscriminatorname-schema"><b>23.14. </b>Model.discriminator(name, schema)</a></li><li><span class="title-icon "></span><a href="#modeldistinctfield-conditions-callback"><b>23.15. </b>Model.distinct(field, [conditions], [callback])</a></li><li><span class="title-icon "></span><a href="#modelensureindexesoptions-cb"><b>23.16. </b>Model.ensureIndexes([options], [cb])</a></li><li><span class="title-icon "></span><a href="#modelfindconditions-projection-options-callback"><b>23.17. </b>Model.find(conditions, [projection], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindbyidid-projection-options-callback"><b>23.18. </b>Model.findById(id, [projection], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindbyidandremoveid-options-callback"><b>23.19. </b>Model.findByIdAndRemove(id, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindbyidandupdateid-update-options-callback"><b>23.20. </b>Model.findByIdAndUpdate(id, [update], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindoneconditions-projection-options-callback"><b>23.21. </b>Model.findOne([conditions], [projection], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindoneandremoveconditions-options-callback"><b>23.22. </b>Model.findOneAndRemove(conditions, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelfindoneandupdateconditions-update-options-callback"><b>23.23. </b>Model.findOneAndUpdate([conditions], [update], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelgeoneargeojson-options-callback"><b>23.24. </b>Model.geoNear(GeoJSON, options, [callback])</a></li><li><span class="title-icon "></span><a href="#modelgeosearchconditions-options-callback"><b>23.25. </b>Model.geoSearch(conditions, options, [callback])</a></li><li><span class="title-icon "></span><a href="#modelhydrateobj"><b>23.26. </b>Model.hydrate(obj)</a></li><li><span class="title-icon "></span><a href="#modelinitcallback"><b>23.27. </b>Model.init([callback])</a></li><li><span class="title-icon "></span><a href="#modelinsertmanydocs-options-optionsordered-optionsrawresult-callback"><b>23.28. </b>Model.insertMany(doc(s), [options], [options.ordered, [options.rawResult, [callback])</a></li><li><span class="title-icon "></span><a href="#modelmapreduceo-callback"><b>23.29. </b>Model.mapReduce(o, [callback])</a></li><li><span class="title-icon "></span><a href="#modelpopulatedocs-options-callbackerrdoc"><b>23.30. </b>Model.populate(docs, options, [callback(err,doc)])</a></li><li><span class="title-icon "></span><a href="#modelremoveconditions-callback"><b>23.31. </b>Model.remove(conditions, [callback])</a></li><li><span class="title-icon "></span><a href="#modelreplaceoneconditions-doc-options-callback"><b>23.32. </b>Model.replaceOne(conditions, doc, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modeltranslatealiasesraw"><b>23.33. </b>Model.translateAliases(raw)</a></li><li><span class="title-icon "></span><a href="#modelupdateconditions-doc-options-callback"><b>23.34. </b>Model.update(conditions, doc, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelupdatemanyconditions-doc-options-callback"><b>23.35. </b>Model.updateMany(conditions, doc, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelupdateoneconditions-doc-options-callback"><b>23.36. </b>Model.updateOne(conditions, doc, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#modelwherepath-val"><b>23.37. </b>Model.where(path, [val])</a></li><li><span class="title-icon "></span><a href="#modelwhere"><b>23.38. </b>Model#$where</a></li><li><span class="title-icon "></span><a href="#modelbase"><b>23.39. </b>Model#base</a></li><li><span class="title-icon "></span><a href="#modelbasemodelname"><b>23.40. </b>Model#baseModelName</a></li><li><span class="title-icon "></span><a href="#modelcollection"><b>23.41. </b>Model#collection</a></li><li><span class="title-icon "></span><a href="#modeldb"><b>23.42. </b>Model#db</a></li><li><span class="title-icon "></span><a href="#modeldiscriminators"><b>23.43. </b>Model#discriminators</a></li><li><span class="title-icon "></span><a href="#modelmodelname_1"><b>23.44. </b>Model#modelName</a></li><li><span class="title-icon "></span><a href="#modelschema"><b>23.45. </b>Model#schema</a></li></ul><li><span class="title-icon "></span><a href="#schemaarrayjs"><b>24. </b>schema/array.js</a></li><ul><li><span class="title-icon "></span><a href="#schemaarraycheckrequiredvalue"><b>24.1. </b>SchemaArray#checkRequired(value)</a></li><li><span class="title-icon "></span><a href="#schemaarraykey-cast-options"><b>24.2. </b>SchemaArray(key, cast, options)</a></li><li><span class="title-icon "></span><a href="#schemaarrayschemaname"><b>24.3. </b>SchemaArray.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemabooleanjs"><b>25. </b>schema/boolean.js</a></li><ul><li><span class="title-icon "></span><a href="#schemabooleancheckrequiredvalue"><b>25.1. </b>SchemaBoolean#checkRequired(value)</a></li><li><span class="title-icon "></span><a href="#schemabooleanpath-options"><b>25.2. </b>SchemaBoolean(path, options)</a></li><li><span class="title-icon "></span><a href="#schemabooleanschemaname"><b>25.3. </b>SchemaBoolean.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemamixedjs"><b>26. </b>schema/mixed.js</a></li><ul><li><span class="title-icon "></span><a href="#mixedpath-options"><b>26.1. </b>Mixed(path, options)</a></li><li><span class="title-icon "></span><a href="#mixedschemaname"><b>26.2. </b>Mixed.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemaembeddedjs"><b>27. </b>schema/embedded.js</a></li><ul><li><span class="title-icon "></span><a href="#embeddeddiscriminatorname-schema"><b>27.1. </b>Embedded#discriminator(name, schema)</a></li><li><span class="title-icon "></span><a href="#embeddedschema-key-options"><b>27.2. </b>Embedded(schema, key, options)</a></li></ul><li><span class="title-icon "></span><a href="#schemabufferjs"><b>28. </b>schema/buffer.js</a></li><ul><li><span class="title-icon "></span><a href="#schemabuffercheckrequiredvalue-doc"><b>28.1. </b>SchemaBuffer#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#schemabufferkey-options"><b>28.2. </b>SchemaBuffer(key, options)</a></li><li><span class="title-icon "></span><a href="#schemabuffersubtypesubtype"><b>28.3. </b>SchemaBuffer#subtype(subtype)</a></li><li><span class="title-icon "></span><a href="#schemabufferschemaname"><b>28.4. </b>SchemaBuffer.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemaobjectidjs"><b>29. </b>schema/objectid.js</a></li><ul><li><span class="title-icon "></span><a href="#objectidautoturnon"><b>29.1. </b>ObjectId#auto(turnOn)</a></li><li><span class="title-icon "></span><a href="#objectidcheckrequiredvalue-doc"><b>29.2. </b>ObjectId#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#objectidkey-options"><b>29.3. </b>ObjectId(key, options)</a></li><li><span class="title-icon "></span><a href="#objectidschemaname"><b>29.4. </b>ObjectId.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemastringjs"><b>30. </b>schema/string.js</a></li><ul><li><span class="title-icon "></span><a href="#schemastringcheckrequiredvalue-doc"><b>30.1. </b>SchemaString#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#schemastringenumargs"><b>30.2. </b>SchemaString#enum([args...])</a></li><li><span class="title-icon "></span><a href="#schemastringlowercase"><b>30.3. </b>SchemaString#lowercase()</a></li><li><span class="title-icon "></span><a href="#schemastringmatchregexp-message"><b>30.4. </b>SchemaString#match(regExp, [message])</a></li><li><span class="title-icon "></span><a href="#schemastringmaxlengthvalue-message"><b>30.5. </b>SchemaString#maxlength(value, [message])</a></li><li><span class="title-icon "></span><a href="#schemastringminlengthvalue-message"><b>30.6. </b>SchemaString#minlength(value, [message])</a></li><li><span class="title-icon "></span><a href="#schemastringkey-options"><b>30.7. </b>SchemaString(key, options)</a></li><li><span class="title-icon "></span><a href="#schemastringtrim"><b>30.8. </b>SchemaString#trim()</a></li><li><span class="title-icon "></span><a href="#schemastringuppercase"><b>30.9. </b>SchemaString#uppercase()</a></li><li><span class="title-icon "></span><a href="#schemastringschemaname"><b>30.10. </b>SchemaString.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemadecimal128js"><b>31. </b>schema/decimal128.js</a></li><ul><li><span class="title-icon "></span><a href="#decimal128checkrequiredvalue-doc"><b>31.1. </b>Decimal128#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#decimal128key-options"><b>31.2. </b>Decimal128(key, options)</a></li><li><span class="title-icon "></span><a href="#decimal128schemaname"><b>31.3. </b>Decimal128.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemadocumentarrayjs"><b>32. </b>schema/documentarray.js</a></li><ul><li><span class="title-icon "></span><a href="#documentarraykey-schema-options"><b>32.1. </b>DocumentArray(key, schema, options)</a></li><li><span class="title-icon "></span><a href="#documentarrayschemaname"><b>32.2. </b>DocumentArray.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemadatejs"><b>33. </b>schema/date.js</a></li><ul><li><span class="title-icon "></span><a href="#schemadatecheckrequiredvalue-doc"><b>33.1. </b>SchemaDate#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#schemadateexpireswhen"><b>33.2. </b>SchemaDate#expires(when)</a></li><li><span class="title-icon "></span><a href="#schemadatemaxmaximum-message"><b>33.3. </b>SchemaDate#max(maximum, [message])</a></li><li><span class="title-icon "></span><a href="#schemadateminvalue-message"><b>33.4. </b>SchemaDate#min(value, [message])</a></li><li><span class="title-icon "></span><a href="#schemadatekey-options"><b>33.5. </b>SchemaDate(key, options)</a></li><li><span class="title-icon "></span><a href="#schemadateschemaname"><b>33.6. </b>SchemaDate.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#schemanumberjs"><b>34. </b>schema/number.js</a></li><ul><li><span class="title-icon "></span><a href="#schemanumbercheckrequiredvalue-doc"><b>34.1. </b>SchemaNumber#checkRequired(value, doc)</a></li><li><span class="title-icon "></span><a href="#schemanumbermaxmaximum-message"><b>34.2. </b>SchemaNumber#max(maximum, [message])</a></li><li><span class="title-icon "></span><a href="#schemanumberminvalue-message"><b>34.3. </b>SchemaNumber#min(value, [message])</a></li><li><span class="title-icon "></span><a href="#schemanumberkey-options"><b>34.4. </b>SchemaNumber(key, options)</a></li><li><span class="title-icon "></span><a href="#schemanumberschemaname"><b>34.5. </b>SchemaNumber.schemaName</a></li></ul><li><span class="title-icon "></span><a href="#cursorquerycursorjs"><b>35. </b>cursor/QueryCursor.js</a></li><ul><li><span class="title-icon "></span><a href="#querycursoraddcursorflagflag-value"><b>35.1. </b>QueryCursor#addCursorFlag(flag, value)</a></li><li><span class="title-icon "></span><a href="#querycursorclosecallback"><b>35.2. </b>QueryCursor#close(callback)</a></li><li><span class="title-icon "></span><a href="#querycursoreachasyncfn-options-optionsparallel-callback"><b>35.3. </b>QueryCursor#eachAsync(fn, [options], [options.parallel], [callback])</a></li><li><span class="title-icon "></span><a href="#querycursormapfn"><b>35.4. </b>QueryCursor#map(fn)</a></li><li><span class="title-icon "></span><a href="#querycursornextcallback"><b>35.5. </b>QueryCursor#next(callback)</a></li><li><span class="title-icon "></span><a href="#querycursorquery-options"><b>35.6. </b>QueryCursor(query, options)</a></li></ul><li><span class="title-icon "></span><a href="#cursoraggregationcursorjs"><b>36. </b>cursor/AggregationCursor.js</a></li><ul><li><span class="title-icon "></span><a href="#aggregationcursoraddcursorflagflag-value"><b>36.1. </b>AggregationCursor#addCursorFlag(flag, value)</a></li><li><span class="title-icon "></span><a href="#aggregationcursoragg-options"><b>36.2. </b>AggregationCursor(agg, options)</a></li><li><span class="title-icon "></span><a href="#aggregationcursorclosecallback"><b>36.3. </b>AggregationCursor#close(callback)</a></li><li><span class="title-icon "></span><a href="#aggregationcursoreachasyncfn-callback"><b>36.4. </b>AggregationCursor#eachAsync(fn, [callback])</a></li><li><span class="title-icon "></span><a href="#aggregationcursormapfn"><b>36.5. </b>AggregationCursor#map(fn)</a></li><li><span class="title-icon "></span><a href="#aggregationcursornextcallback"><b>36.6. </b>AggregationCursor#next(callback)</a></li></ul><li><span class="title-icon "></span><a href="#schematypejs"><b>37. </b>schematype.js</a></li><ul><li><span class="title-icon "></span><a href="#schematypedefaultval"><b>37.1. </b>SchemaType#default(val)</a></li><li><span class="title-icon "></span><a href="#schematypegetfn"><b>37.2. </b>SchemaType#get(fn)</a></li><li><span class="title-icon "></span><a href="#schematypeindexoptions"><b>37.3. </b>SchemaType#index(options)</a></li><li><span class="title-icon "></span><a href="#schematyperequiredrequired-optionsisrequired-optionserrorconstructor-message"><b>37.4. </b>SchemaType#required(required, [options.isRequired], [options.ErrorConstructor], [message])</a></li><li><span class="title-icon "></span><a href="#schematypepath-options-instance"><b>37.5. </b>SchemaType(path, [options], [instance])</a></li><li><span class="title-icon "></span><a href="#schematypeselectval"><b>37.6. </b>SchemaType#select(val)</a></li><li><span class="title-icon "></span><a href="#schematypesetfn"><b>37.7. </b>SchemaType#set(fn)</a></li><li><span class="title-icon "></span><a href="#schematypesparsebool"><b>37.8. </b>SchemaType#sparse(bool)</a></li><li><span class="title-icon "></span><a href="#schematypetextbool"><b>37.9. </b>SchemaType#text(bool)</a></li><li><span class="title-icon "></span><a href="#schematypeuniquebool"><b>37.10. </b>SchemaType#unique(bool)</a></li><li><span class="title-icon "></span><a href="#schematypevalidateobj-errormsg-type"><b>37.11. </b>SchemaType#validate(obj, [errorMsg], [type])</a></li></ul><li><span class="title-icon "></span><a href="#connectionjs"><b>38. </b>connection.js</a></li><ul><li><span class="title-icon "></span><a href="#connectioncloseforce-callback"><b>38.1. </b>Connection#close([force], [callback])</a></li><li><span class="title-icon "></span><a href="#connectioncollectionname-options"><b>38.2. </b>Connection#collection(name, [options])</a></li><li><span class="title-icon "></span><a href="#connectionbase"><b>38.3. </b>Connection(base)</a></li><li><span class="title-icon "></span><a href="#collection-options-callback"><b>38.4. </b>(collection, [options], [callback])</a></li><li><span class="title-icon "></span><a href="#collection-callback"><b>38.5. </b>(collection, [callback])</a></li><li><span class="title-icon "></span><a href="#callback"><b>38.6. </b>([callback])</a></li><li><span class="title-icon "></span><a href="#connectionmodelname-schema-collection"><b>38.7. </b>Connection#model(name, [schema], collection)</a></li><li><span class="title-icon "></span><a href="#connectionmodelnames"><b>38.8. </b>Connection#modelNames()</a></li><li><span class="title-icon "></span><a href="#uris-database-options-callback"><b>38.9. </b>(uris, [database], [options], [callback])</a></li><li><span class="title-icon "></span><a href="#connectioncollections"><b>38.10. </b>Connection#collections</a></li><li><span class="title-icon "></span><a href="#connectionconfig"><b>38.11. </b>Connection#config</a></li><li><span class="title-icon "></span><a href="#connectiondb"><b>38.12. </b>Connection#db</a></li><li><span class="title-icon "></span><a href="#connectionreadystate"><b>38.13. </b>Connection#readyState</a></li></ul><li><span class="title-icon "></span><a href="#collectionjs"><b>39. </b>collection.js</a></li><ul><li><span class="title-icon "></span><a href="#collectionname-conn-opts"><b>39.1. </b>Collection(name, conn, opts)</a></li><li><span class="title-icon "></span><a href="#collectioncreateindex"><b>39.2. </b>Collection#createIndex()</a></li><li><span class="title-icon "></span><a href="#collectionensureindex"><b>39.3. </b>Collection#ensureIndex()</a></li><li><span class="title-icon "></span><a href="#collectionfind"><b>39.4. </b>Collection#find()</a></li><li><span class="title-icon "></span><a href="#collectionfindandmodify"><b>39.5. </b>Collection#findAndModify()</a></li><li><span class="title-icon "></span><a href="#collectionfindone"><b>39.6. </b>Collection#findOne()</a></li><li><span class="title-icon "></span><a href="#collectiongetindexes"><b>39.7. </b>Collection#getIndexes()</a></li><li><span class="title-icon "></span><a href="#collectioninsert"><b>39.8. </b>Collection#insert()</a></li><li><span class="title-icon "></span><a href="#collectionmapreduce"><b>39.9. </b>Collection#mapReduce()</a></li><li><span class="title-icon "></span><a href="#collectionsave"><b>39.10. </b>Collection#save()</a></li><li><span class="title-icon "></span><a href="#collectionupdate"><b>39.11. </b>Collection#update()</a></li><li><span class="title-icon "></span><a href="#collectioncollectionname"><b>39.12. </b>Collection#collectionName</a></li><li><span class="title-icon "></span><a href="#collectionconn"><b>39.13. </b>Collection#conn</a></li><li><span class="title-icon "></span><a href="#collectionname"><b>39.14. </b>Collection#name</a></li></ul></ul></div><a href="#indexjs" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="indexjs"><a name="indexjs" class="anchor-navigation-ex-anchor" href="#indexjs"><i class="fa fa-link" aria-hidden="true"></i></a>1. index.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/index.js" target="_blank">index.js</a></p>
</blockquote>
<h2 id="mongooseaggregate"><a name="mongooseaggregate" class="anchor-navigation-ex-anchor" href="#mongooseaggregate"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. Mongoose#Aggregate()</h2>
<p>Mongoose &#x7684; Aggregate &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongoosecasterrortype-value-path-reason"><a name="mongoosecasterrortype-value-path-reason" class="anchor-navigation-ex-anchor" href="#mongoosecasterrortype-value-path-reason"><i class="fa fa-link" aria-hidden="true"></i></a>1.2. Mongoose#CastError(type, value, path, [reason])</h2>
<p>Mongoose &#x7684; CastError &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h5 id="&#x53C2;&#x6570;"><a name="&#x53C2;&#x6570;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;" class="plugin-anchor" href="#&#x53C2;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;:</h5>
<ul>
<li><code>type</code>     &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; The name of the type</li>
<li><code>value</code> &lt;<a href="#Any">Any</a>&gt; The value that failed to cast</li>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; The path a.b.c in the doc where this cast error occurred</li>
<li><code>[reason]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank">Error</a>&gt; The original error that was thrown</li>
</ul>
<h2 id="mongoosecollection"><a name="mongoosecollection" class="anchor-navigation-ex-anchor" href="#mongoosecollection"><i class="fa fa-link" aria-hidden="true"></i></a>1.3. Mongoose#Collection()</h2>
<p>Mongoose &#x7684; Collection &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongooseconnecturis-options-optionsusemongoclient-callback"><a name="mongooseconnecturis-options-optionsusemongoclient-callback" class="anchor-navigation-ex-anchor" href="#mongooseconnecturis-options-optionsusemongoclient-callback"><i class="fa fa-link" aria-hidden="true"></i></a>1.4. Mongoose#connect(uri(s), [options], [options.useMongoClient], [callback])</h2>
<p>&#x6253;&#x5F00;&#x9ED8;&#x8BA4;&#x7684; mongoose &#x8FDE;&#x63A5;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;"><a name="&#x53C2;&#x6570;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>uri(s)</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
<li><code>[options.useMongoClient]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; false by default, set to true to use new mongoose connection logic</li>
<li><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><mongoosethenable> pseudo-promise wrapper around this</mongoosethenable></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;"><a name="&#x53C2;&#x89C1;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Mongoose#createConnection</a></li>
</ul>
<p>&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#x53C2;&#x6570;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x4F1A;&#x88AB;&#x9002;&#x5F53;&#x5730;&#x4EE3;&#x7406;&#x5230; <a href="">Connection#open</a> &#x6216;&#x8005; <a href="">Connection#openSet</a>&#x3002;</p>
<p><em>&#x4F20;&#x9012;&#x7684;&#x9009;&#x9879;&#x4F18;&#x5148;&#x4E8E;&#x8FDE;&#x63A5;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x9009;&#x9879;&#x3002;</em></p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;"><a name="&#x793A;&#x4F8B;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://user:pass@localhost:port/database&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// replica sets &#x526F;&#x672C;&#x96C6;</span>
<span class="token keyword">var</span> uri <span class="token operator">=</span> <span class="token string">&apos;mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/mydatabase&apos;</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x4F7F;&#x7528;&#x9009;&#x9879;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x8FDE;&#x63A5;&#x5230;&#x591A;&#x4E2A; mongos</span>
<span class="token keyword">var</span> uri <span class="token operator">=</span> <span class="token string">&apos;mongodb://hostA:27501,hostB:27501&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> mongos<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x53EF;&#x9009;&#x7684;&#x56DE;&#x8C03;&#xFF0C; &#x5F53;&#x521D;&#x59CB;&#x5316;&#x8FDE;&#x63A5;&#x5B8C;&#x6210;&#x65F6;&#x88AB;&#x89E6;&#x53D1;</span>
<span class="token keyword">var</span> uri <span class="token operator">=</span> <span class="token string">&apos;mongodb://nonexistent.domain:27000&apos;</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x5982;&#x679C; error &#x662F;&#x771F;&#x503C;&#xFF0C;&#x90A3;&#x521D;&#x59CB;&#x5316;&#x8FDE;&#x63A5;&#x5931;&#x8D25;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_connect" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_connect"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_connect"><div class="panel-body">
<pre class="language-"><code class="lang-js">  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>connect <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> conn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">||</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">typeof</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span>
        arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>useMongoClient <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> conn<span class="token punctuation">.</span><span class="token function">openUri</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rgxReplSet<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">checkReplicaSetInUri</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongooseThenable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> conn<span class="token punctuation">.</span>openSet<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongooseThenable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> conn<span class="token punctuation">.</span>open<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>connect<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongooseconnection"><a name="mongooseconnection" class="anchor-navigation-ex-anchor" href="#mongooseconnection"><i class="fa fa-link" aria-hidden="true"></i></a>1.5. Mongoose#Connection()</h2>
<p>Mongoose &#x7684; <a href="">Connection</a> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongoosecreateconnectionuri-options-optionsconfig-optionsconfigautoindex-optionsusemongoclient"><a name="mongoosecreateconnectionuri-options-optionsconfig-optionsconfigautoindex-optionsusemongoclient" class="anchor-navigation-ex-anchor" href="#mongoosecreateconnectionuri-options-optionsconfig-optionsconfigautoindex-optionsusemongoclient"><i class="fa fa-link" aria-hidden="true"></i></a>1.6. Mongoose#createConnection([uri], [options], [options.config], [options.config.autoIndex], [options.useMongoClient])</h2>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Connection &#x5B9E;&#x4F8B;&#x3002;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_1"><a name="&#x53C2;&#x6570;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[uri]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; a mongodb:// URI</li>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options to pass to the driver</li>
<li><code>[options.config]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; mongoose-specific options</li>
<li><code>[options.config.autoIndex]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; set to false to disable automatic index creation for all models associated with this connection.</li>
<li><code>[options.useMongoClient]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; false by default, set to true to use new mongoose connection logic</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_1"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><connection, promise=""> the created Connection object, or promise that resolves to the connection if <code>useMongoClient</code> option specified.</connection,></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_1"><a name="&#x53C2;&#x89C1;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Connection#open</a></li>
<li><a href="">Connection#openSet</a></li>
</ul>
<p>Each connection instance maps to a single database. This method is helpful when mangaging multiple db connections.</p>
<p>If arguments are passed, they are proxied to either <a href="">Connection#open</a> or <a href="">Connection#openSet</a> appropriately. This means we can pass db, server, and replset options to the driver. Note that the safe option specified in your schema will overwrite the safe db option specified here unless you set your schemas safe option to undefined. See <a href="guide.html#safe">this</a> for more information.</p>
<p><em>Options passed take precedence over options included in connection strings.</em></p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_1"><a name="&#x793A;&#x4F8B;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// with mongodb:// URI</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://user:pass@localhost:port/database&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// and options</span>
<span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> db<span class="token punctuation">:</span> <span class="token punctuation">{</span> native_parser<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://user:pass@localhost:port/database&apos;</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// replica sets</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/database&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// and options</span>
<span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> replset<span class="token punctuation">:</span> <span class="token punctuation">{</span> strategy<span class="token punctuation">:</span> <span class="token string">&apos;ping&apos;</span><span class="token punctuation">,</span> rs_name<span class="token punctuation">:</span> <span class="token string">&apos;testSet&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://user:pass@localhost:port,anotherhost:port,yetanother:port/database&apos;</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// with [host, database_name[, port] signature</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;localhost&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;database&apos;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// and options</span>
<span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> server<span class="token punctuation">:</span> <span class="token punctuation">{</span> auto_reconnect<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token string">&apos;username&apos;</span><span class="token punctuation">,</span> pass<span class="token punctuation">:</span> <span class="token string">&apos;mypassword&apos;</span> <span class="token punctuation">}</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&apos;localhost&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;database&apos;</span><span class="token punctuation">,</span> port<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// initialize now, connect later</span>
db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&apos;localhost&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;database&apos;</span><span class="token punctuation">,</span> port<span class="token punctuation">,</span> <span class="token punctuation">[</span>opts<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_createConnection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_createConnection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_createConnection"><div class="panel-body">
<pre class="language-"><code class="lang-js">  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>createConnection <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>connections<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> rsOption <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>replset <span class="token operator">||</span> options<span class="token punctuation">.</span>replSet<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>useMongoClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> conn<span class="token punctuation">.</span><span class="token function">openUri</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rgxReplSet<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">checkReplicaSetInUri</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span>_openSetWithoutPromise<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rsOption <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span>rsOption<span class="token punctuation">.</span>replicaSet <span class="token operator">||</span> rsOption<span class="token punctuation">.</span>rs_name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span>_openSetWithoutPromise<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span>_openWithoutPromise<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> conn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>createConnection<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosedisconnectfn"><a name="mongoosedisconnectfn" class="anchor-navigation-ex-anchor" href="#mongoosedisconnectfn"><i class="fa fa-link" aria-hidden="true"></i></a>1.7. Mongoose#disconnect([fn])</h2>
<p>&#x65AD;&#x5F00;&#x6240;&#x6709;&#x8FDE;&#x63A5;&#x3002;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_2"><a name="&#x53C2;&#x6570;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[fn]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; called after all connection close.</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_2"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><mongoosethenable> pseudo-promise wrapper around this</mongoosethenable></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_disconnect" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_disconnect"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_disconnect"><div class="panel-body">
<pre class="language-"><code class="lang-js">  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>disconnect <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongooseThenable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> remaining <span class="token operator">=</span> _this<span class="token punctuation">.</span>connections<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      _this<span class="token punctuation">.</span>connections<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">--</span>remaining<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>disconnect<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosedocument"><a name="mongoosedocument" class="anchor-navigation-ex-anchor" href="#mongoosedocument"><i class="fa fa-link" aria-hidden="true"></i></a>1.8. Mongoose#Document()</h2>
<p>Mongoose &#x7684; <a href="">Document</a> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongoosedocumentprovider"><a name="mongoosedocumentprovider" class="anchor-navigation-ex-anchor" href="#mongoosedocumentprovider"><i class="fa fa-link" aria-hidden="true"></i></a>1.9. Mongoose#DocumentProvider()</h2>
<p>Mongoose &#x7684; DocumentProvider &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongooseerror"><a name="mongooseerror" class="anchor-navigation-ex-anchor" href="#mongooseerror"><i class="fa fa-link" aria-hidden="true"></i></a>1.10. Mongoose#Error()</h2>
<p><a href="">MongooseError</a> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="mongoosegetkey"><a name="mongoosegetkey" class="anchor-navigation-ex-anchor" href="#mongoosegetkey"><i class="fa fa-link" aria-hidden="true"></i></a>1.11. Mongoose#get(key)</h2>
<p>&#x83B7;&#x53D6; mongoose &#x9009;&#x9879;&#x3002;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_3"><a name="&#x53C2;&#x6570;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_2"><a name="&#x793A;&#x4F8B;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">mongoose<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;test&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns the &apos;test&apos; value</span>
</code></pre>
<h2 id="mongoosegetpromiseconstructor"><a name="mongoosegetpromiseconstructor" class="anchor-navigation-ex-anchor" href="#mongoosegetpromiseconstructor"><i class="fa fa-link" aria-hidden="true"></i></a>1.12. Mongoose#getPromiseConstructor()</h2>
<p>&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x7684; ES6 &#x6837;&#x5F0F;&#x7684; promise &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x5728; Mongoose 4.x &#x4E2D;&#xFF0C;&#x7B49;&#x4EF7;&#x4E8E; <code>mongoose.Promise.ES6</code>&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x6211;&#x4EEC;&#x53BB;&#x6389;&#x4E86; <code>.ES6</code> &#x4F4D;&#xFF0C;&#x5C31;&#x4F1A;&#x6539;&#x53D8;&#x3002;</p>
<p>Mongoose#model(name, [schema], <a href="guide.html#collection">collection</a>, [skipInit])
Defines a model or retrieves it.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_4"><a name="&#x53C2;&#x6570;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>name &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;model name or class extending Model</li>
<li>[schema] <schema></schema></li>
<li><a href="guide.html#collection">collection</a> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; name (optional, inferred from model name)</li>
<li>[skipInit] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; whether to skip initialization (defaults to false)</li>
</ul>
<p>Models defined on the mongoose instance are available to all connection created by the same mongoose instance.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_3"><a name="&#x793A;&#x4F8B;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// define an Actor model with this mongoose instance</span>
mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Actor&apos;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// create a new connection</span>
<span class="token keyword">var</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// retrieve the Actor model</span>
<span class="token keyword">var</span> Actor <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Actor&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When no collection argument is passed, Mongoose produces a collection name by passing the model name to the utils.toCollectionName method. This method pluralizes the name. If you don&apos;t like this behavior, either pass a collection name or set your schemas collection name option.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_4"><a name="&#x793A;&#x4F8B;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> collection<span class="token punctuation">:</span> <span class="token string">&apos;actor&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or</span>

schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;collection&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;actor&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or</span>

<span class="token keyword">var</span> collectionName <span class="token operator">=</span> <span class="token string">&apos;actor&apos;</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Actor&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collectionName<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_getPromiseConstructor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_getPromiseConstructor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_getPromiseConstructor"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> skipInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> model<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model <span class="token operator">=</span> name<span class="token punctuation">;</span>
    name <span class="token operator">=</span> model<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">Model</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Error</span><span class="token punctuation">(</span><span class="token string">&apos;The provided class &apos;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&apos; must extend Model&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> schema <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    collection <span class="token operator">=</span> schema<span class="token punctuation">;</span>
    schema <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>instanceOfSchema<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>schema<span class="token punctuation">.</span>instanceOfSchema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The 2nd parameter to `mongoose.model()` should be a &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;schema or a POJO&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> collection <span class="token operator">===</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    skipInit <span class="token operator">=</span> collection<span class="token punctuation">;</span>
    collection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// handle internal options from connection.model()</span>
  <span class="token keyword">var</span> options<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>skipInit <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>skipInit<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> skipInit<span class="token punctuation">;</span>
    skipInit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// look up schema for the collection.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>modelSchemas<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// cache it so we only apply plugins once</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>modelSchemas<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> schema<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>MissingSchemaError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_applyPlugins</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> sub<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// connection.model() may be passing a different schema for</span>
  <span class="token comment" spellcheck="true">// an existing model name. in this case don&apos;t read from cache.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>cache <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> schema<span class="token punctuation">.</span>instanceOfSchema <span class="token operator">&amp;&amp;</span> schema <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>OverwriteModelError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// subclass current model with alternate collection</span>
      model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
      schema <span class="token operator">=</span> model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>schema<span class="token punctuation">;</span>
      sub <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">__subclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// do not cache the sub model</span>
      <span class="token keyword">return</span> sub<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// ensure a schema exists</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelSchemas<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>MissingSchemaError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// Apply relevant &quot;global&quot; options to the schema</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&apos;pluralization&apos;</span> <span class="token keyword">in</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>pluralization <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>pluralization<span class="token punctuation">;</span>


  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    collection <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;collection&apos;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">format</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> connection <span class="token operator">=</span> options<span class="token punctuation">.</span>connection <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>connection<span class="token punctuation">;</span>
  model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>model <span class="token operator">||</span> name<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> connection<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>skipInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>cache <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>model<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosemodel"><a name="mongoosemodel" class="anchor-navigation-ex-anchor" href="#mongoosemodel"><i class="fa fa-link" aria-hidden="true"></i></a>1.13. Mongoose#Model()</h2>
<p>Mongoose <a href="">Model</a> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="mongoosemodelnames"><a name="mongoosemodelnames" class="anchor-navigation-ex-anchor" href="#mongoosemodelnames"><i class="fa fa-link" aria-hidden="true"></i></a>1.14. Mongoose#modelNames()</h2>
<p>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5728; Mongoose &#x5B9E;&#x4F8B;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x6A21;&#x578B;&#x540D;&#x79F0;&#x6570;&#x7EC4;&#x3002;</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_3"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;"><a name="&#x6CE8;&#x610F;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>&#x4E0D;&#x5305;&#x62EC;&#x4F7F;&#x7528; <code>connection.model()</code> &#x521B;&#x5EFA;&#x7684;&#x6A21;&#x578B;&#x7684;&#x540D;&#x79F0;&#x3002;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_modelNames" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_modelNames"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_modelNames"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>modelNames <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> names <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> names<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>modelNames<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoose"><a name="mongoose" class="anchor-navigation-ex-anchor" href="#mongoose"><i class="fa fa-link" aria-hidden="true"></i></a>1.15. Mongoose()</h2>
<p>Mongoose &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<p>mongoose &#x6A21;&#x5757;&#x7684;&#x5BFC;&#x51FA;&#x5BF9;&#x8C61;&#xFF08;exports&#xFF09;&#x662F;&#x8BE5;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EA;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Mongoose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>connections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>models <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modelSchemas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// default global options</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span>
    pluralization<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> conn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// default connection</span>
  conn<span class="token punctuation">.</span>models <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">;</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;plugins&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span>saveSubdocs<span class="token punctuation">,</span> <span class="token punctuation">{</span> deduplicate<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>validateBeforeSave<span class="token punctuation">,</span> <span class="token punctuation">{</span> deduplicate<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>shardingPlugin<span class="token punctuation">,</span> <span class="token punctuation">{</span> deduplicate<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosemongoose"><a name="mongoosemongoose" class="anchor-navigation-ex-anchor" href="#mongoosemongoose"><i class="fa fa-link" aria-hidden="true"></i></a>1.16. Mongoose#Mongoose()</h2>
<p>Mongoose &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<p>mongoose &#x6A21;&#x5757;&#x7684;&#x5BFC;&#x51FA;&#x5BF9;&#x8C61;&#xFF08;exports&#xFF09;&#x662F;&#x8BE5;&#x7C7B;&#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;&#x5927;&#x591A;&#x6570;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EA;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x3002;</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_5"><a name="&#x793A;&#x4F8B;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">  <span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> mongoose2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Mongoose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="mongoosepluginfn-opts"><a name="mongoosepluginfn-opts" class="anchor-navigation-ex-anchor" href="#mongoosepluginfn-opts"><i class="fa fa-link" aria-hidden="true"></i></a><a name="mongoosepluginfn-opts" class="plugin-anchor" href="#mongoosepluginfn-opts"><i class="fa fa-link" aria-hidden="true"></i></a>Mongoose#plugin(fn, [opts])</h5>
<p>&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x5728;&#x6240;&#x6709;&#x6A21;&#x5F0F;&#x4E0A;&#x6267;&#x884C;&#x7684;&#x5168;&#x5C40;&#x63D2;&#x4EF6;&#x3002;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_5"><a name="&#x53C2;&#x6570;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; plugin callback</li>
<li><code>[opts]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional options</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_4"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><mongoose> this</mongoose></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_2"><a name="&#x53C2;&#x89C1;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="plugins.html">plugins</a></li>
</ul>
<p>&#x7B49;&#x6548;&#x4E8E;&#x5728;&#x521B;&#x5EFA;&#x7684;&#x6BCF;&#x4E2A;&#x6A21;&#x5F0F;&#x4E0A;&#x8C03;&#x7528; <code>.plugin(fn)</code>&#x3002;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_Mongoose" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_Mongoose"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_Mongoose"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>plugin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fn<span class="token punctuation">,</span> opts<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="function-object--native-code-promise"><a name="function-object--native-code-promise" class="anchor-navigation-ex-anchor" href="#function-object--native-code-promise"><i class="fa fa-link" aria-hidden="true"></i></a>1.17. function Object() { [native code] }#Promise()</h2>
<p>Mongoose <a href="">Promise</a> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="mongoosepromiseprovider"><a name="mongoosepromiseprovider" class="anchor-navigation-ex-anchor" href="#mongoosepromiseprovider"><i class="fa fa-link" aria-hidden="true"></i></a>1.18. Mongoose#PromiseProvider()</h2>
<p>mongoose promises &#x7684;&#x50A8;&#x5B58;&#x5C42;</p>
<h2 id="mongoosequery"><a name="mongoosequery" class="anchor-navigation-ex-anchor" href="#mongoosequery"><i class="fa fa-link" aria-hidden="true"></i></a>1.19. Mongoose#Query()</h2>
<p>Mongoose <a href="">Query</a> &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</p>
<h2 id="mongooseschema"><a name="mongooseschema" class="anchor-navigation-ex-anchor" href="#mongooseschema"><i class="fa fa-link" aria-hidden="true"></i></a>1.20. Mongoose#Schema()</h2>
<p>Mongoose <a href="">Schema</a> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_6"><a name="&#x793A;&#x4F8B;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token keyword">var</span> CatSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="mongooseschematype"><a name="mongooseschematype" class="anchor-navigation-ex-anchor" href="#mongooseschematype"><i class="fa fa-link" aria-hidden="true"></i></a>1.21. Mongoose#SchemaType()</h2>
<p>Mongoose <a href="">SchemaType</a> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongoosesetkey-value"><a name="mongoosesetkey-value" class="anchor-navigation-ex-anchor" href="#mongoosesetkey-value"><i class="fa fa-link" aria-hidden="true"></i></a>1.22. Mongoose#set(key, value)</h2>
<p>&#x8BBE;&#x7F6E; mongoose &#x7684;&#x9009;&#x9879;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_6"><a name="&#x53C2;&#x6570;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
<li><code>value</code> <string, function,="" boolean=""></string,></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_7"><a name="&#x793A;&#x4F8B;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">mongoose<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;test&apos;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x8BBE;&#x7F6E; &apos;test&apos; &#x9009;&#x9879;&#x4E3A; `value`</span>

mongoose<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;debug&apos;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// enable logging collection methods + arguments to the console</span>

mongoose<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;debug&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>collectionName<span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// use custom function to log collection methods + arguments</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_set" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_set"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_set"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">.</span>$hasSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id=""><a name="" class="plugin-anchor" href="#"><i class="fa fa-link" aria-hidden="true"></i></a>()</h2>
<p>&#x4E3A;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF08;user-land&#xFF09;&#x66B4;&#x9732;&#x8FDE;&#x63A5;&#x72B6;&#x6001;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="__" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="__"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="__"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>STATES <span class="token operator">=</span> STATES<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosevirtualtype"><a name="mongoosevirtualtype" class="anchor-navigation-ex-anchor" href="#mongoosevirtualtype"><i class="fa fa-link" aria-hidden="true"></i></a>1.23. Mongoose#VirtualType()</h2>
<p>Mongoose <a href="">VirtualType</a> &#x6784;&#x9020;&#x51FD;&#x6570;</p>
<h2 id="mongooseconnection_1"><a name="mongooseconnection_1" class="anchor-navigation-ex-anchor" href="#mongooseconnection_1"><i class="fa fa-link" aria-hidden="true"></i></a>1.24. Mongoose#connection</h2>
<p>mongoose &#x6A21;&#x5757;&#x7684;&#x9ED8;&#x8BA4;&#x8FDE;&#x63A5;&#x3002;</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_8"><a name="&#x793A;&#x4F8B;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span>connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x8FD9;&#x662F;&#x4E3A;&#x4F7F;&#x7528; <a href=""><code>mongoose.model</code></a> &#x521B;&#x5EFA;&#x7684;&#x6BCF;&#x4E2A;&#x6A21;&#x578B;&#x6240;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x7684;&#x8FDE;&#x63A5;&#x3002;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_connection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_connection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_connection"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token template-string"><span class="token string">``</span></span><span class="token template-string"><span class="token string">`
&lt;!--endsec--&gt;

##### &#x8FD4;&#x56DE;&#x503C;&#xFF1A;

  * &lt;Connection&gt;

## Mongoose#mongo

Mongoose &#x4F7F;&#x7528;&#x7684;[&#x539F;&#x751F;&#x7684; node-mongodb &#x9A71;&#x52A8;&#x5668;](https://github.com/mongodb/node-mongodb-native)&#x3002;

&lt;!--sec data-title=&quot;&#x6E90;&#x7801;&quot; data-id=&quot;Mongoose_mongo&quot; data-show=true data-collapse=true ces--&gt;
`</span></span><span class="token template-string"><span class="token string">``</span></span>js
Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>mongo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongoosemquery"><a name="mongoosemquery" class="anchor-navigation-ex-anchor" href="#mongoosemquery"><i class="fa fa-link" aria-hidden="true"></i></a>1.25. Mongoose#mquery</h2>
<p>Mongoose &#x4F7F;&#x7528;&#x7684; <a href="https://github.com/aheckmann/mquery" target="_blank">mquery</a> &#x67E5;&#x8BE2;&#x6784;&#x5EFA;&#x5668;&#x3002;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_mquery" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_mquery"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_mquery"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>mquery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mquery&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongooseschematypes"><a name="mongooseschematypes" class="anchor-navigation-ex-anchor" href="#mongooseschematypes"><i class="fa fa-link" aria-hidden="true"></i></a>1.26. Mongoose#SchemaTypes</h2>
<p>&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684; Mongoose SchemaTypes&#x3002;</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_1"><a name="&#x6CE8;&#x610F;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>&#x7528;&#x4E8E;&#x5411;&#x540E;&#x517C;&#x5BB9;&#x7684; <code>mongoose.Schema.Types</code> &#x7684;&#x522B;&#x540D;&#x3002;</em></p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_SchemaTypes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_SchemaTypes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_SchemaTypes"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>SchemaTypes <span class="token operator">=</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_3"><a name="&#x53C2;&#x89C1;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Schema.SchemaTypes</a></li>
</ul>
<h2 id="mongoosetypes"><a name="mongoosetypes" class="anchor-navigation-ex-anchor" href="#mongoosetypes"><i class="fa fa-link" aria-hidden="true"></i></a>1.27. Mongoose#Types</h2>
<p>&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684; Mongoose Types.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_9"><a name="&#x793A;&#x4F8B;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Array<span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x7C7B;&#x578B;&#xFF1A;"><a name="&#x7C7B;&#x578B;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7C7B;&#x578B;&#xFF1A;" class="plugin-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7C7B;&#x578B;&#xFF1A;</h5>
<ul>
<li><a href="">ObjectId</a></li>
<li><a href="">Buffer</a></li>
<li><a href="">SubDocument</a></li>
<li><a href="">Array</a></li>
<li><a href="">DocumentArray</a></li>
</ul>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x66B4;&#x9732;&#x6765;&#x5BF9; <code>ObjectId</code> &#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x6784;&#x9020; <code>id</code>&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> ObjectId <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span>
<span class="token keyword">var</span> id1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_Types" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_Types"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_Types"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>Types <span class="token operator">=</span> Types<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongooseversion"><a name="mongooseversion" class="anchor-navigation-ex-anchor" href="#mongooseversion"><i class="fa fa-link" aria-hidden="true"></i></a>1.28. Mongoose#version</h2>
<p>Mongoose &#x7248;&#x672C;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mongoose_version" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mongoose_version"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mongoose_version"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mongoose<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>version <span class="token operator">=</span> pkg<span class="token punctuation">.</span>version<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h1 id="typesarrayjs"><a name="typesarrayjs" class="anchor-navigation-ex-anchor" href="#typesarrayjs"><i class="fa fa-link" aria-hidden="true"></i></a>2. types/array.js</h1>
<h2 id="mongoosearrayshift"><a name="mongoosearrayshift" class="anchor-navigation-ex-anchor" href="#mongoosearrayshift"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. MongooseArray#$shift()</h2>
<p>&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x6863; <code>save()</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x81EA;&#x52A8;&#x5730; shift &#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x6700;&#x591A;&#x4E00;&#x6B21;&#x3002;</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_4"><a name="&#x53C2;&#x89C1;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/Updating/#Updating-%24pop" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_2"><a name="&#x6CE8;&#x610F;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>Calling this mulitple times on an array before saving sends the same command as calling it once.This update is implemented using the MongoDB $pop method which enforces this restriction.</em></p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 <span class="token keyword">var</span> shifted <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shifted<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 1</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2,3]</span>

 <span class="token comment" spellcheck="true">// no affect</span>
 shifted <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2,3]</span>

 doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// we saved, now $shift works again</span>
   shifted <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>shifted <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 2</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [3]</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="mongoosearrayremove"><a name="mongoosearrayremove" class="anchor-navigation-ex-anchor" href="#mongoosearrayremove"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. MongooseArray#remove()</h2>
<p><a href="">pull</a> &#x7684;&#x522B;&#x540D;&#x3002;</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_5"><a name="&#x53C2;&#x89C1;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">MongooseArray#pull</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Updating/#Updating-%24pull" target="_blank">mongodb</a></li>
</ul>
<h2 id="mongoosearraypop"><a name="mongoosearraypop" class="anchor-navigation-ex-anchor" href="#mongoosearraypop"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. MongooseArray.$pop()</h2>
<p>&#x5728;&#x6BCF;&#x4E00;&#x4E2A;&#x6587;&#x6863; <code>save()</code> &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x81EA;&#x52A8;&#x5730; pop &#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x6700;&#x591A;&#x4E00;&#x6B21;&#x3002;</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_6"><a name="&#x53C2;&#x89C1;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/Updating/#Updating-%24pop" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_3"><a name="&#x6CE8;&#x610F;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>Calling this mulitple times on an array before saving sends the same command as calling it once.This update is implemented using the MongoDB $pop method which enforces this restriction.</em></p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

 <span class="token keyword">var</span> popped <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>popped<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 3</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1,2]</span>

 <span class="token comment" spellcheck="true">// no affect</span>
 popped <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1,2]</span>

 doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">// we saved, now $pop works again</span>
   popped <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">$pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>popped<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 2</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [1]</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="mongoosearrayaddtosetargs"><a name="mongoosearrayaddtosetargs" class="anchor-navigation-ex-anchor" href="#mongoosearrayaddtosetargs"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. MongooseArray.addToSet([args...])</h2>
<p>&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x5C06;&#x503C;&#x6DFB;&#x52A0;&#x5230;&#x6570;&#x7EC4;&#x4E2D;&#x3002;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_7"><a name="&#x53C2;&#x6570;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[args...] <t></t></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_5"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; the values that were added</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_10"><a name="&#x793A;&#x4F8B;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [2,3,4]</span>
<span class="token keyword">var</span> added <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">addToSet</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [2,3,4,5]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>added<span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// [5]</span>
</code></pre>
<h2 id="mongoosearrayindexofobj"><a name="mongoosearrayindexofobj" class="anchor-navigation-ex-anchor" href="#mongoosearrayindexofobj"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. MongooseArray.indexOf(obj)</h2>
<p>Return the index of obj or -1 if not found.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_8"><a name="&#x53C2;&#x6570;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<p>obj &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the item to look for</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_6"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><number>

</number></li>
</ul>
<h2 id="mongoosearrayinspect"><a name="mongoosearrayinspect" class="anchor-navigation-ex-anchor" href="#mongoosearrayinspect"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. MongooseArray.inspect()</h2>
<p>Helper for console.log</p>
<h2 id="mongoosearraynonatomicpushargs"><a name="mongoosearraynonatomicpushargs" class="anchor-navigation-ex-anchor" href="#mongoosearraynonatomicpushargs"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. MongooseArray.nonAtomicPush([args...])</h2>
<p>Pushes items to the array non-<a href="../../../GLOSSARY.html#atomically" class="glossary-term" title="atomicity &#x7684;&#x526F;&#x8BCD;&#x5F62;&#x5F0F;&#x3002;&#x539F;&#x5B50;&#x6027;&#x3002;&#x4E8B;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;&#x6307;&#x7684;&#x662F;&#xFF0C;&#x4E8B;&#x52A1;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x7A0B;&#x5E8F;&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x903B;&#x8F91;&#x5DE5;&#x4F5C;&#x5355;&#x4F4D;&#xFF0C;&#x5B83;&#x6240;&#x505A;&#x7684;&#x5BF9;&#x6570;&#x636E;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x8981;&#x4E48;&#x5168;&#x90E8;&#x6267;&#x884C;&#xFF0C;&#x8981;&#x4E48;&#x5B8C;&#x5168;&#x4E0D;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#x79F0;&#x4E3A;&#x539F;&#x5B50;&#x6027;&#x3002;">atomically</a>.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_9"><a name="&#x53C2;&#x6570;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[args...] <t></t></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_4"><a name="&#x6CE8;&#x610F;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified, which if saved, will store it as a $set operation, potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h2 id="mongoosearraypop_1"><a name="mongoosearraypop_1" class="anchor-navigation-ex-anchor" href="#mongoosearraypop_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. MongooseArray.pop()</h2>
<p>Wraps Array#pop with proper change tracking.</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_7"><a name="&#x53C2;&#x89C1;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">MongooseArray#$pop</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_5"><a name="&#x6CE8;&#x610F;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified which will pass the entire thing to $set potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h2 id="mongoosearraypullargs"><a name="mongoosearraypullargs" class="anchor-navigation-ex-anchor" href="#mongoosearraypullargs"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. MongooseArray.pull([args...])</h2>
<p>Pulls items from the array <a href="../../../GLOSSARY.html#atomically" class="glossary-term" title="atomicity &#x7684;&#x526F;&#x8BCD;&#x5F62;&#x5F0F;&#x3002;&#x539F;&#x5B50;&#x6027;&#x3002;&#x4E8B;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;&#x6307;&#x7684;&#x662F;&#xFF0C;&#x4E8B;&#x52A1;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x7A0B;&#x5E8F;&#x4F5C;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x903B;&#x8F91;&#x5DE5;&#x4F5C;&#x5355;&#x4F4D;&#xFF0C;&#x5B83;&#x6240;&#x505A;&#x7684;&#x5BF9;&#x6570;&#x636E;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x8981;&#x4E48;&#x5168;&#x90E8;&#x6267;&#x884C;&#xFF0C;&#x8981;&#x4E48;&#x5B8C;&#x5168;&#x4E0D;&#x6267;&#x884C;&#x3002;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#x79F0;&#x4E3A;&#x539F;&#x5B50;&#x6027;&#x3002;">atomically</a>. Equality is determined by casting
the provided value to an embedded document and comparing using</p>
<p><a href="">the Document.equals() function</a>.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_10"><a name="&#x53C2;&#x6570;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[args...] <t></t></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_8"><a name="&#x53C2;&#x89C1;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li>mongodb</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_11"><a name="&#x793A;&#x4F8B;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span>ObjectId<span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token string">&apos;someId&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string">&apos;tag 1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;tag 2&apos;</span><span class="token punctuation">)</span>
</code></pre>
<p>To remove a document from a subdocument array we may pass an object with a matching _id.</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>subdocs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token number">4815162342</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>subdocs<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token number">4815162342</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// removed</span>
</code></pre>
<p>Or we may passing the _id directly and let mongoose take care of it.</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>subdocs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token number">4815162342</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
doc<span class="token punctuation">.</span>subdocs<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token number">4815162342</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// works</span>
</code></pre>
<p>The first pull call will result in a atomic operation on the database, if pull is called repeatedly without saving the document, a $set operation is used on the complete array instead, overwriting possible changes that happened on the database in the meantime.</p>
<h2 id="mongoosearraypushargs"><a name="mongoosearraypushargs" class="anchor-navigation-ex-anchor" href="#mongoosearraypushargs"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. MongooseArray.push([args...])</h2>
<p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/push" target="_blank"><code>Array#push</code></a> with proper change tracking.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_11"><a name="&#x53C2;&#x6570;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[args...] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h2 id="mongoosearrayset"><a name="mongoosearrayset" class="anchor-navigation-ex-anchor" href="#mongoosearrayset"><i class="fa fa-link" aria-hidden="true"></i></a>2.11. MongooseArray.set()</h2>
<p>Sets the casted val at index i and marks the array modified.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_7"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; this</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_12"><a name="&#x793A;&#x4F8B;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// given documents based on the following</span>
<span class="token keyword">var</span> Doc <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Doc&apos;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> array<span class="token punctuation">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Doc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> array<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [2,3,4]</span>

doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2,5,4] // properly cast to number</span>
doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// the change is saved</span>

<span class="token comment" spellcheck="true">// VS not using array#set</span>
doc<span class="token punctuation">.</span>array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [2,&quot;5&quot;,4] // no casting</span>
doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// change is not saved</span>
</code></pre>
<h2 id="mongoosearrayshift_1"><a name="mongoosearrayshift_1" class="anchor-navigation-ex-anchor" href="#mongoosearrayshift_1"><i class="fa fa-link" aria-hidden="true"></i></a>2.12. MongooseArray.shift()</h2>
<p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/unshift" target="_blank"><code>Array#shift</code></a> with proper change tracking.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_13"><a name="&#x793A;&#x4F8B;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> res <span class="token operator">=</span> doc<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [3]</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_6"><a name="&#x6CE8;&#x610F;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified, which if saved, will store it as a $set operation, potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h2 id="mongoosearraysort"><a name="mongoosearraysort" class="anchor-navigation-ex-anchor" href="#mongoosearraysort"><i class="fa fa-link" aria-hidden="true"></i></a>2.13. MongooseArray.sort()</h2>
<p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/sort" target="_blank"><code>Array#sort</code></a> with proper change tracking.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_7"><a name="&#x6CE8;&#x610F;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified, which if saved, will store it as a $set operation, potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h2 id="mongoosearraysplice"><a name="mongoosearraysplice" class="anchor-navigation-ex-anchor" href="#mongoosearraysplice"><i class="fa fa-link" aria-hidden="true"></i></a>2.14. MongooseArray.splice()</h2>
<p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/splice" target="_blank"><code>Array#splice</code></a> with proper change tracking and casting.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_8"><a name="&#x6CE8;&#x610F;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified, which if saved, will store it as a $set operation, potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h2 id="mongoosearraytoobjectoptions"><a name="mongoosearraytoobjectoptions" class="anchor-navigation-ex-anchor" href="#mongoosearraytoobjectoptions"><i class="fa fa-link" aria-hidden="true"></i></a>2.15. MongooseArray.toObject(options)</h2>
<p>Returns a native js Array.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_12"><a name="&#x53C2;&#x6570;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>options &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_8"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</li>
</ul>
<h2 id="mongoosearrayunshift"><a name="mongoosearrayunshift" class="anchor-navigation-ex-anchor" href="#mongoosearrayunshift"><i class="fa fa-link" aria-hidden="true"></i></a>2.16. MongooseArray.unshift()</h2>
<p>Wraps <a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/unshift" target="_blank"><code>Array#unshift</code></a> with proper change tracking.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_9"><a name="&#x6CE8;&#x610F;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>marks the entire array as modified, which if saved, will store it as a $set operation, potentially overwritting any changes that happen between when you retrieved the object and when you save it.</em></p>
<h1 id="typessubdocumentjs"><a name="typessubdocumentjs" class="anchor-navigation-ex-anchor" href="#typessubdocumentjs"><i class="fa fa-link" aria-hidden="true"></i></a>3. types/subdocument.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/subdocument.js" target="_blank">types/subdocument.js</a></p>
</blockquote>
<h2 id="subdocumentownerdocument"><a name="subdocumentownerdocument" class="anchor-navigation-ex-anchor" href="#subdocumentownerdocument"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. Subdocument#ownerDocument()</h2>
<p>Returns the top level document of this sub-document.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_9"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><document>

</document></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Subdocument_ownerDocument" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Subdocument_ownerDocument"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Subdocument_ownerDocument"><div class="panel-body">
<pre class="language-"><code class="lang-js">Subdocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ownerDocument <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>$parent <span class="token operator">||</span> parent<span class="token punctuation">.</span>__parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent <span class="token operator">||</span> parent<span class="token punctuation">.</span>__parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="subdocumentparent"><a name="subdocumentparent" class="anchor-navigation-ex-anchor" href="#subdocumentparent"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. Subdocument#parent()</h2>
<p>Returns this sub-documents parent document.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Subdocument_parent" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Subdocument_parent"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Subdocument_parent"><div class="panel-body">
<pre class="language-"><code class="lang-js">Subdocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="subdocumentremoveoptions-callback"><a name="subdocumentremoveoptions-callback" class="anchor-navigation-ex-anchor" href="#subdocumentremoveoptions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. Subdocument#remove([options], [callback])</h2>
<p>Null-out this subdoc</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_13"><a name="&#x53C2;&#x6570;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[options] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
<li>[callback] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback for compatibility with Document.prototype.remove</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Subdocument_remove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Subdocument_remove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Subdocument_remove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Subdocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">registerRemoveListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// If removing entire doc, no need to remove subdoc</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options <span class="token operator">||</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>noop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$basePath<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h1 id="typesembeddedjs"><a name="typesembeddedjs" class="anchor-navigation-ex-anchor" href="#typesembeddedjs"><i class="fa fa-link" aria-hidden="true"></i></a>4. types/embedded.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/embedded.js" target="_blank">types/embedded.js</a></p>
</blockquote>
<h2 id="embeddeddocumentinspect"><a name="embeddeddocumentinspect" class="anchor-navigation-ex-anchor" href="#embeddeddocumentinspect"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. EmbeddedDocument#inspect()</h2>
<p>Helper for console.log</p>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_inspect" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_inspect"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_inspect"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>inspect <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    transform<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    virtuals<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    flattenDecimals<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentinvalidatepath-err"><a name="embeddeddocumentinvalidatepath-err" class="anchor-navigation-ex-anchor" href="#embeddeddocumentinvalidatepath-err"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. EmbeddedDocument#invalidate(path, err)</h2>
<p>Marks a path as invalid, causing validation to fail.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_14"><a name="&#x53C2;&#x6570;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the field to invalidate</li>
<li>err <string, error=""> error which states the reason path was invalid</string,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_10"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_invalidate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_invalidate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_invalidate"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>invalidate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> err<span class="token punctuation">,</span> val<span class="token punctuation">,</span> first<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>__parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>invalidate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> err<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>$isValidatorError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__index<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> index <span class="token operator">!==</span> <span class="token string">&apos;undefined&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> parentPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">.</span>_path<span class="token punctuation">;</span>
    <span class="token keyword">var</span> fullPath <span class="token operator">=</span> <span class="token punctuation">[</span>parentPath<span class="token punctuation">,</span> index<span class="token punctuation">,</span> path<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__parent<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> err<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ownerDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentownerdocument"><a name="embeddeddocumentownerdocument" class="anchor-navigation-ex-anchor" href="#embeddeddocumentownerdocument"><i class="fa fa-link" aria-hidden="true"></i></a>4.3. EmbeddedDocument#ownerDocument()</h2>
<p>Returns the top level document of this sub-document.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_11"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><document>

</document></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_ownerDocument" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_ownerDocument"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_ownerDocument"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ownerDocument <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__parent<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>__parent <span class="token operator">||</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>__parent <span class="token operator">||</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentparent"><a name="embeddeddocumentparent" class="anchor-navigation-ex-anchor" href="#embeddeddocumentparent"><i class="fa fa-link" aria-hidden="true"></i></a>4.4. EmbeddedDocument#parent()</h2>
<p>Returns this sub-documents parent document.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_parent" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_parent"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_parent"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentparentarray"><a name="embeddeddocumentparentarray" class="anchor-navigation-ex-anchor" href="#embeddeddocumentparentarray"><i class="fa fa-link" aria-hidden="true"></i></a>4.5. EmbeddedDocument#parentArray()</h2>
<p>Returns this sub-documents parent array.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_parentArray" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_parentArray"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_parentArray"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>parentArray <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentremoveoptions-fn"><a name="embeddeddocumentremoveoptions-fn" class="anchor-navigation-ex-anchor" href="#embeddeddocumentremoveoptions-fn"><i class="fa fa-link" aria-hidden="true"></i></a>4.6. EmbeddedDocument#remove([options], [fn])</h2>
<p>Removes the subdocument from its parent array.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_15"><a name="&#x53C2;&#x6570;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[options] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
<li>[fn] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_remove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_remove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_remove"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>fn <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray <span class="token operator">||</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>noop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _id<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>willRemove<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_doc<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;For your own good, Mongoose does not know &apos;</span> <span class="token operator">+</span>
          <span class="token string">&apos;how to remove an EmbeddedDocument that has no _id&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">.</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span> _id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>willRemove <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token function">registerRemoveListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddeddocumentmarkmodifiedpath"><a name="embeddeddocumentmarkmodifiedpath" class="anchor-navigation-ex-anchor" href="#embeddeddocumentmarkmodifiedpath"><i class="fa fa-link" aria-hidden="true"></i></a>4.7. EmbeddedDocument.markModified(path)</h2>
<p>Marks the embedded doc modified.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="EmbeddedDocument_markModified" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="EmbeddedDocument_markModified"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="EmbeddedDocument_markModified"><div class="panel-body">
<pre class="language-"><code class="lang-js">EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>markModified <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isNew<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Mark the WHOLE parent array as modified</span>
    <span class="token comment" spellcheck="true">// if this is a new document (i.e., we are initializing</span>
    <span class="token comment" spellcheck="true">// a document),</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">.</span><span class="token function">_markModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>__parentArray<span class="token punctuation">.</span><span class="token function">_markModified</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_16"><a name="&#x53C2;&#x6570;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the path which changed</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_14"><a name="&#x793A;&#x4F8B;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> doc <span class="token operator">=</span> blogpost<span class="token punctuation">.</span>comments<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>hexstring<span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span>mixed<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&apos;changed&apos;</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">markModified</span><span class="token punctuation">(</span><span class="token string">&apos;mixed.type&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h1 id="typesbufferjs"><a name="typesbufferjs" class="anchor-navigation-ex-anchor" href="#typesbufferjs"><i class="fa fa-link" aria-hidden="true"></i></a>5. types/buffer.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/buffer.js" target="_blank">types/buffer.js</a></p>
</blockquote>
<h2 id="mongoosebuffercopytarget"><a name="mongoosebuffercopytarget" class="anchor-navigation-ex-anchor" href="#mongoosebuffercopytarget"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. MongooseBuffer.copy(target)</h2>
<p>Copies the buffer.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_17"><a name="&#x53C2;&#x6570;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<pre class="language-"><code>* target <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Buffer</span><span class="token punctuation">&gt;</span></span>
</code></pre><h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_12"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<pre class="language-"><code>* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Number</span><span class="token punctuation">&gt;</span></span> The number of bytes copied.
</code></pre><h5 id="&#x6CE8;&#x610F;&#xFF1A;_10"><a name="&#x6CE8;&#x610F;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>Buffer#copy does not mark target as modified so you must copy from a MongooseBuffer for it to work as expected. This is a work around since copy modifies the target, not this.</em> *</p>
<h2 id="mongoosebufferequalsother"><a name="mongoosebufferequalsother" class="anchor-navigation-ex-anchor" href="#mongoosebufferequalsother"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. MongooseBuffer.equals(other)</h2>
<p>Determines if this buffer is equals to other buffer</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_18"><a name="&#x53C2;&#x6570;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>other <buffer></buffer></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_13"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h2 id="mongoosebuffersubtypesubtype"><a name="mongoosebuffersubtypesubtype" class="anchor-navigation-ex-anchor" href="#mongoosebuffersubtypesubtype"><i class="fa fa-link" aria-hidden="true"></i></a>5.3. MongooseBuffer.subtype(subtype)</h2>
<p>Sets the subtype option and marks the buffer modified.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_19"><a name="&#x53C2;&#x6570;&#xFF1A;_19" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_19"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>subtype</code> <hex></hex></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_9"><a name="&#x53C2;&#x89C1;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://bsonspec.org/#/specification" target="_blank">http://bsonspec.org/#/specification</a></li>
</ul>
<h5 id="subtypes"><a name="subtypes" class="anchor-navigation-ex-anchor" href="#subtypes"><i class="fa fa-link" aria-hidden="true"></i></a><a name="subtypes" class="plugin-anchor" href="#subtypes"><i class="fa fa-link" aria-hidden="true"></i></a>SubTypes:</h5>
<p>var bson = require(&apos;bson&apos;)
bson.BSON_BINARY_SUBTYPE_DEFAULT
bson.BSON_BINARY_SUBTYPE_FUNCTION
bson.BSON_BINARY_SUBTYPE_BYTE_ARRAY
bson.BSON_BINARY_SUBTYPE_UUID
bson.BSON_BINARY_SUBTYPE_MD5
bson.BSON_BINARY_SUBTYPE_USER_DEFINED</p>
<p>doc.buffer.subtype(bson.BSON_BINARY_SUBTYPE_UUID);</p>
<h2 id="mongoosebuffertobson"><a name="mongoosebuffertobson" class="anchor-navigation-ex-anchor" href="#mongoosebuffertobson"><i class="fa fa-link" aria-hidden="true"></i></a>5.4. MongooseBuffer.toBSON()</h2>
<p>Converts this buffer for storage in MongoDB, including subtype</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_14"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><binary>


</binary></li>
</ul>
<h2 id="mongoosebuffertoobjectsubtype"><a name="mongoosebuffertoobjectsubtype" class="anchor-navigation-ex-anchor" href="#mongoosebuffertoobjectsubtype"><i class="fa fa-link" aria-hidden="true"></i></a>5.5. MongooseBuffer.toObject([subtype])</h2>
<p>Converts this buffer to its Binary type representation.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_20"><a name="&#x53C2;&#x6570;&#xFF1A;_20" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_20"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[subtype] <hex></hex></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_15"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><binary>

</binary></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_10"><a name="&#x53C2;&#x89C1;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://bsonspec.org/#/specification" target="_blank">http://bsonspec.org/#/specification</a></li>
</ul>
<h5 id="subtypes_1"><a name="subtypes_1" class="anchor-navigation-ex-anchor" href="#subtypes_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="subtypes" class="plugin-anchor" href="#subtypes"><i class="fa fa-link" aria-hidden="true"></i></a>SubTypes:</h5>
<p>var bson = require(&apos;bson&apos;)
bson.BSON_BINARY_SUBTYPE_DEFAULT
bson.BSON_BINARY_SUBTYPE_FUNCTION
bson.BSON_BINARY_SUBTYPE_BYTE_ARRAY
bson.BSON_BINARY_SUBTYPE_UUID
bson.BSON_BINARY_SUBTYPE_MD5
bson.BSON_BINARY_SUBTYPE_USER_DEFINED</p>
<p>doc.buffer.toObject(bson.BSON_BINARY_SUBTYPE_USER_DEFINED);</p>
<h2 id="mongoosebufferwrite"><a name="mongoosebufferwrite" class="anchor-navigation-ex-anchor" href="#mongoosebufferwrite"><i class="fa fa-link" aria-hidden="true"></i></a>5.6. MongooseBuffer.write()</h2>
<p>Writes the buffer.</p>
<hr>
<h1 id="typesobjectidjs"><a name="typesobjectidjs" class="anchor-navigation-ex-anchor" href="#typesobjectidjs"><i class="fa fa-link" aria-hidden="true"></i></a>6. types/objectid.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/objectid.js" target="_blank">types/objectid.js</a></p>
</blockquote>
<h2 id="objectid"><a name="objectid" class="anchor-navigation-ex-anchor" href="#objectid"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. ObjectId()</h2>
<p>ObjectId type constructor</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_15"><a name="&#x793A;&#x4F8B;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId</span><span class="token punctuation">;</span>
</code></pre>
<hr>
<h1 id="typesdecimal128js"><a name="typesdecimal128js" class="anchor-navigation-ex-anchor" href="#typesdecimal128js"><i class="fa fa-link" aria-hidden="true"></i></a>7. types/decimal128.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/decimal128.js" target="_blank">types/decimal128.js</a></p>
</blockquote>
<h2 id="exports"><a name="exports" class="anchor-navigation-ex-anchor" href="#exports"><i class="fa fa-link" aria-hidden="true"></i></a>7.1. exports()</h2>
<p>ObjectId type constructor</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_16"><a name="&#x793A;&#x4F8B;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId</span><span class="token punctuation">;</span>
</code></pre>
<h1 id="typesdocumentarrayjs"><a name="typesdocumentarrayjs" class="anchor-navigation-ex-anchor" href="#typesdocumentarrayjs"><i class="fa fa-link" aria-hidden="true"></i></a>8. types/documentarray.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/types/documentarray.js" target="_blank">types/documentarray.js</a></p>
</blockquote>
<h2 id="mongoosedocumentarraycreateobj"><a name="mongoosedocumentarraycreateobj" class="anchor-navigation-ex-anchor" href="#mongoosedocumentarraycreateobj"><i class="fa fa-link" aria-hidden="true"></i></a>8.1. MongooseDocumentArray.create(obj)</h2>
<p>Creates a subdocument casted to this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_21"><a name="&#x53C2;&#x6570;&#xFF1A;_21" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_21"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>obj &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the value to cast to this arrays SubDocument schema</li>
</ul>
<p>This is the same subdocument constructor used for casting.</p>
<h2 id="mongoosedocumentarrayidid"><a name="mongoosedocumentarrayidid" class="anchor-navigation-ex-anchor" href="#mongoosedocumentarrayidid"><i class="fa fa-link" aria-hidden="true"></i></a>8.2. MongooseDocumentArray.id(id)</h2>
<p>Searches array items for the first document with a matching _id.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_22"><a name="&#x53C2;&#x6570;&#xFF1A;_22" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_22"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>id</code> <objectid, string,="" number,="" buffer=""></objectid,></p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_16"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
</li>
<li><p><embeddeddocument, null=""> the subdocument or null if not found.</embeddeddocument,></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_17"><a name="&#x793A;&#x4F8B;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> embeddedDoc <span class="token operator">=</span> m<span class="token punctuation">.</span>array<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>some_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="mongoosedocumentarrayinspect"><a name="mongoosedocumentarrayinspect" class="anchor-navigation-ex-anchor" href="#mongoosedocumentarrayinspect"><i class="fa fa-link" aria-hidden="true"></i></a>8.3. MongooseDocumentArray.inspect()</h2>
<p>Helper for console.log</p>
<h2 id="mongoosedocumentarraytoobjectoptions"><a name="mongoosedocumentarraytoobjectoptions" class="anchor-navigation-ex-anchor" href="#mongoosedocumentarraytoobjectoptions"><i class="fa fa-link" aria-hidden="true"></i></a>8.4. MongooseDocumentArray.toObject([options])</h2>
<p>Returns a native js Array of plain js objects</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_23"><a name="&#x53C2;&#x6570;&#xFF1A;_23" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_23"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional options to pass to each documents <code>toObject</code> method call during conversion</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_17"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_11"><a name="&#x6CE8;&#x610F;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>Each sub-document is converted to a plain object by calling its #toObject method.</em></p>
<h1 id="promisejs"><a name="promisejs" class="anchor-navigation-ex-anchor" href="#promisejs"><i class="fa fa-link" aria-hidden="true"></i></a>9. promise.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/promise.js" target="_blank">promise.js</a></p>
</blockquote>
<h2 id="promiseaddbacklistener"><a name="promiseaddbacklistener" class="anchor-navigation-ex-anchor" href="#promiseaddbacklistener"><i class="fa fa-link" aria-hidden="true"></i></a>9.1. Promise#addBack(listener)</h2>
<p>Adds a single function as a listener to both err and complete.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_24"><a name="&#x53C2;&#x6570;&#xFF1A;_24" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_24"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>listener</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_18"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> this</promise></li>
</ul>
<p>It will be executed with traditional node.js argument position when the promise is resolved.</p>
<pre class="language-"><code class="lang-js">promise<span class="token punctuation">.</span><span class="token function">addBack</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> args<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;success&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><a href="https://github.com/aheckmann/mpromise#onresolve" target="_blank">mpromise#onResolve</a> &#x7684;&#x522B;&#x540D;&#x3002;</p>
<p><em>Deprecated. Use onResolve instead.</em></p>
<h2 id="promiseaddcallbacklistener"><a name="promiseaddcallbacklistener" class="anchor-navigation-ex-anchor" href="#promiseaddcallbacklistener"><i class="fa fa-link" aria-hidden="true"></i></a>9.2. Promise#addCallback(listener)</h2>
<p>Adds a listener to the complete (success) event.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_25"><a name="&#x53C2;&#x6570;&#xFF1A;_25" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_25"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>listener &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_19"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_19" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_19"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> this</promise></li>
</ul>
<p><a href="https://github.com/aheckmann/mpromise#onfulfill" target="_blank">mpromise#onFulfill</a> &#x7684;&#x522B;&#x540D;&#x3002;</p>
<p><em>Deprecated. Use onFulfill instead.</em></p>
<h2 id="promiseadderrbacklistener"><a name="promiseadderrbacklistener" class="anchor-navigation-ex-anchor" href="#promiseadderrbacklistener"><i class="fa fa-link" aria-hidden="true"></i></a>9.3. Promise#addErrback(listener)</h2>
<p>Adds a listener to the err (rejected) event.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_26"><a name="&#x53C2;&#x6570;&#xFF1A;_26" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_26"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>listener &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_20"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_20" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_20"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><p><promise> this</promise></p>
<p><a href="https://github.com/aheckmann/mpromise#onreject" target="_blank">mpromise#onReject</a> &#x7684;&#x522B;&#x540D;&#x3002;</p>
</li>
</ul>
<p><em>Deprecated. Use onReject instead.</em></p>
<h2 id="promisecatchonreject"><a name="promisecatchonreject" class="anchor-navigation-ex-anchor" href="#promisecatchonreject"><i class="fa fa-link" aria-hidden="true"></i></a>9.4. Promise#catch(onReject)</h2>
<p>ES6-style <code>.catch()</code> shorthand</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_27"><a name="&#x53C2;&#x6570;&#xFF1A;_27" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_27"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>onReject &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_21"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_21" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_21"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>


</promise></li>
</ul>
<h2 id="promiseend"><a name="promiseend" class="anchor-navigation-ex-anchor" href="#promiseend"><i class="fa fa-link" aria-hidden="true"></i></a>9.5. Promise#end()</h2>
<p>Signifies that this promise was the last in a chain of then()s: if a handler passed to the call to then which produced this promise throws, the exception will go uncaught.</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_11"><a name="&#x53C2;&#x89C1;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/aheckmann/mpromise#end" target="_blank">mpromise#end</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_18"><a name="&#x793A;&#x4F8B;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;shucks&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">fulfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// error was caught and swallowed by the promise returned from</span>
  <span class="token comment" spellcheck="true">// p.then(). we either have to always register handlers on</span>
  <span class="token comment" spellcheck="true">// the returned promises or we can do the following...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// this time we use .end() which prevents catching thrown errors</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;shucks&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &amp;lt;--</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">fulfill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// throws &quot;shucks&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="promiseerrorerr"><a name="promiseerrorerr" class="anchor-navigation-ex-anchor" href="#promiseerrorerr"><i class="fa fa-link" aria-hidden="true"></i></a>9.6. Promise#error(err)</h2>
<p>Rejects this promise with err.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_28"><a name="&#x53C2;&#x6570;&#xFF1A;_28" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_28"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>err <error, string=""></error,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_22"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_22" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_22"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> this</promise></li>
</ul>
<p>If the promise has already been fulfilled or rejected, not action is taken.</p>
<p>Differs from <a href="">#reject</a> by first casting err to an Error if it is not instanceof Error.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Promise_error" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Promise_error"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Promise_error"><div class="panel-body">
<pre class="language-"><code class="lang-js">Promise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      err <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">inspect</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="promiseonevent-listener"><a name="promiseonevent-listener" class="anchor-navigation-ex-anchor" href="#promiseonevent-listener"><i class="fa fa-link" aria-hidden="true"></i></a>9.7. Promise#on(event, listener)</h2>
<p>Adds listener to the event.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_29"><a name="&#x53C2;&#x6570;&#xFF1A;_29" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_29"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>event</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>listener</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_23"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_23" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_23"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> this</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_12"><a name="&#x53C2;&#x89C1;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/aheckmann/mpromise#on" target="_blank">mpromise#on</a></li>
</ul>
<p>If event is either the success or failure event and the event has already been emitted, thelistener is called immediately and passed the results of the original emitted event.</p>
<h2 id="promisefn"><a name="promisefn" class="anchor-navigation-ex-anchor" href="#promisefn"><i class="fa fa-link" aria-hidden="true"></i></a>9.8. Promise(fn)</h2>
<p>Promise constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_30"><a name="&#x53C2;&#x6570;&#xFF1A;_30" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_30"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>fn &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; a function which will be called when the promise is resolved that accepts fn(err, ...){} as signature</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;"><a name="&#x7EE7;&#x627F;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/aheckmann/mpromise" target="_blank">mpromise</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;"><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<ul>
<li><p><code>err</code>: Emits when the promise is rejected</p>
</li>
<li><p><code>complete</code>: Emits when the promise is fulfilled</p>
</li>
</ul>
<p>Promises are returned from executed queries.&#x793A;&#x4F8B;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> Candy<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>DEPRECATED. Mongoose 5.0 will use native promises by default (or bluebird,
if native promises are not present) but still
support plugging in your own ES6-compatible promises library. Mongoose 5.0
will <strong>not</strong>support mpromise.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Promise" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Promise"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Promise"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  MPromise<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="promiserejectreason"><a name="promiserejectreason" class="anchor-navigation-ex-anchor" href="#promiserejectreason"><i class="fa fa-link" aria-hidden="true"></i></a>9.9. Promise#reject(reason)</h2>
<p>Rejects this promise with reason.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_31"><a name="&#x53C2;&#x6570;&#xFF1A;_31" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_31"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>reason <object, string,="" error=""></object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_24"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_24" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_24"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> this</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_13"><a name="&#x53C2;&#x89C1;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/aheckmann/mpromise#reject" target="_blank">mpromise#reject</a></li>
</ul>
<p>If the promise has already been fulfilled or rejected, not action is taken.</p>
<h2 id="promiseresolveerr-val"><a name="promiseresolveerr-val" class="anchor-navigation-ex-anchor" href="#promiseresolveerr-val"><i class="fa fa-link" aria-hidden="true"></i></a>9.10. Promise#resolve([err], [val])</h2>
<p>Resolves this promise to a rejected state if err is passed or a fulfilled state if no err is passed.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_32"><a name="&#x53C2;&#x6570;&#xFF1A;_32" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_32"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[err] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank">Error</a>&gt; error or null</li>
<li>[val] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; value to fulfill the promise with</li>
</ul>
<p>If the promise has already been fulfilled or rejected, not action is taken.</p>
<p>err will be cast to an Error if not already instanceof Error.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_12"><a name="&#x6CE8;&#x610F;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>overrides mpromise#resolve to provide error casting.</em></p>
<sec data-title="&#x6E90;&#x7801;" data-id="Promise_resolve" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Promise_resolve"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Promise_resolve"><div class="panel-body">
<pre class="language-"><code class="lang-js">Promise<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>resolve <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fulfill<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="promisethenonfulfill-onreject"><a name="promisethenonfulfill-onreject" class="anchor-navigation-ex-anchor" href="#promisethenonfulfill-onreject"><i class="fa fa-link" aria-hidden="true"></i></a>9.11. Promise#then(onFulFill, onReject)</h2>
<p>Creates a new promise and returns it. If onFulfill or onReject are passed, they are added as SUCCESS/ERROR callbacks to this promise after the nextTick.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_33"><a name="&#x53C2;&#x6570;&#xFF1A;_33" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_33"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>onFulFill</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
<li><p><code>onReject</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_25"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_25" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_25"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> newPromise</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_14"><a name="&#x53C2;&#x89C1;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/promises-aplus/promises-spec" target="_blank">promises-A+</a></li>
<li><a href="https://github.com/aheckmann/mpromise#then" target="_blank">mpromise#then</a></li>
</ul>
<p>Conforms to promises/A+ specification.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_19"><a name="&#x793A;&#x4F8B;&#xFF1A;_19" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_19"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> promise <span class="token operator">=</span> Meetups<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tags<span class="token punctuation">:</span> <span class="token string">&apos;javascript&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>meetups<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ids <span class="token operator">=</span> meetups<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> m<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> People<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> meetups<span class="token punctuation">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token punctuation">:</span> ids <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>people<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>people<span class="token punctuation">.</span>length <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Too few people!!!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Still need more people!!!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>err <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="promisecompleteargs"><a name="promisecompleteargs" class="anchor-navigation-ex-anchor" href="#promisecompleteargs"><i class="fa fa-link" aria-hidden="true"></i></a>9.12. Promise.complete(args)</h2>
<p>Fulfills this promise with passed arguments.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_34"><a name="&#x53C2;&#x6570;&#xFF1A;_34" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_34"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>args <t></t></li>
</ul>
<p><a href="https://github.com/aheckmann/mpromise#fulfill" target="_blank">mpromise#fulfill</a> &#x7684;&#x522B;&#x540D;&#x3002;</p>
<p><em>Deprecated. Use fulfill instead.</em></p>
<h2 id="promisees6resolver"><a name="promisees6resolver" class="anchor-navigation-ex-anchor" href="#promisees6resolver"><i class="fa fa-link" aria-hidden="true"></i></a>9.13. Promise.ES6(resolver)</h2>
<p>ES6-style promise constructor wrapper around mpromise.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Promise_ES6" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Promise_ES6"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Promise_ES6"><div class="panel-body">
<pre class="language-"><code class="lang-js">Promise<span class="token punctuation">.</span>ES6 <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// No try/catch for backwards compatibility</span>
  <span class="token function">resolver</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      promise<span class="token punctuation">.</span>complete<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      promise<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_35"><a name="&#x53C2;&#x6570;&#xFF1A;_35" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_35"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>resolver &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_26"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_26" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_26"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> new promise</promise></li>
</ul>
<h2 id="promisefulfillargs"><a name="promisefulfillargs" class="anchor-navigation-ex-anchor" href="#promisefulfillargs"><i class="fa fa-link" aria-hidden="true"></i></a>9.14. Promise.fulfill(args)</h2>
<p>Fulfills this promise with passed arguments.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_36"><a name="&#x53C2;&#x6570;&#xFF1A;_36" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_36"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>args <t></t></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_15"><a name="&#x53C2;&#x89C1;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/aheckmann/mpromise#fulfill" target="_blank">https://github.com/aheckmann/mpromise#fulfill</a></li>
</ul>
<hr>
<h1 id="virtualtypejs"><a name="virtualtypejs" class="anchor-navigation-ex-anchor" href="#virtualtypejs"><i class="fa fa-link" aria-hidden="true"></i></a>10. virtualtype.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/virtualtype.js" target="_blank">virtualtype.js</a></p>
</blockquote>
<h2 id="virtualtype"><a name="virtualtype" class="anchor-navigation-ex-anchor" href="#virtualtype"><i class="fa fa-link" aria-hidden="true"></i></a>10.1. VirtualType()</h2>
<p>VirtualType constructor</p>
<p>This is what mongoose uses to define virtual attributes via Schema.prototype.virtual.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_20"><a name="&#x793A;&#x4F8B;&#xFF1A;_20" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_20"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> fullname <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span><span class="token string">&apos;fullname&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fullname <span class="token keyword">instanceof</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>VirtualType</span> <span class="token comment" spellcheck="true">// true</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">VirtualType</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>setters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="virtualtypegetfn"><a name="virtualtypegetfn" class="anchor-navigation-ex-anchor" href="#virtualtypegetfn"><i class="fa fa-link" aria-hidden="true"></i></a>10.2. VirtualType#get(fn)</h2>
<p>Defines a getter.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_37"><a name="&#x53C2;&#x6570;&#xFF1A;_37" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_37"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>fn &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_27"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_27" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_27"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><virtualtype> this</virtualtype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_21"><a name="&#x793A;&#x4F8B;&#xFF1A;_21" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_21"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> virtual <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span><span class="token string">&apos;fullname&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
virtual<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>first <span class="token operator">+</span> <span class="token string">&apos; &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>last<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType_get" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType_get"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType_get"><div class="panel-body">
<pre class="language-"><code class="lang-js">VirtualType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="virtualtypesetfn"><a name="virtualtypesetfn" class="anchor-navigation-ex-anchor" href="#virtualtypesetfn"><i class="fa fa-link" aria-hidden="true"></i></a>10.3. VirtualType#set(fn)</h2>
<p>Defines a setter.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_38"><a name="&#x53C2;&#x6570;&#xFF1A;_38" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_38"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_28"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_28" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_28"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><virtualtype> this</virtualtype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_22"><a name="&#x793A;&#x4F8B;&#xFF1A;_22" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_22"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> virtual <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span><span class="token string">&apos;fullname&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
virtual<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>first <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>last <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType_set" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType_set"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType_set"><div class="panel-body">
<pre class="language-"><code class="lang-js">VirtualType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>setters<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="virtualtypeapplygettersvalue-scope"><a name="virtualtypeapplygettersvalue-scope" class="anchor-navigation-ex-anchor" href="#virtualtypeapplygettersvalue-scope"><i class="fa fa-link" aria-hidden="true"></i></a>10.4. VirtualType#applyGetters(value, scope)</h2>
<p>Applies getters to value using optional scope.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_39"><a name="&#x53C2;&#x6570;&#xFF1A;_39" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_39"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>value &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p>scope &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_29"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_29" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_29"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><t> the value after applying all getters</t></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType_applyGetters" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType_applyGetters"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType_applyGetters"><div class="panel-body">
<pre class="language-"><code class="lang-js">VirtualType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>applyGetters <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> v <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> l<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="virtualtypeapplysettersvalue-scope"><a name="virtualtypeapplysettersvalue-scope" class="anchor-navigation-ex-anchor" href="#virtualtypeapplysettersvalue-scope"><i class="fa fa-link" aria-hidden="true"></i></a>10.5. VirtualType#applySetters(value, scope)</h2>
<p>Applies setters to value using optional scope.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_40"><a name="&#x53C2;&#x6570;&#xFF1A;_40" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_40"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>scope</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_30"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_30" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_30"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><t> the value after applying all setters</t></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType_applySetters" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType_applySetters"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType_applySetters"><div class="panel-body">
<pre class="language-"><code class="lang-js">VirtualType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>applySetters <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> v <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>setters<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> l<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>setters<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h2 id="utilsjs"><a name="utilsjs" class="anchor-navigation-ex-anchor" href="#utilsjs"><i class="fa fa-link" aria-hidden="true"></i></a>10.6. utils.js</h2>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/utils.js" target="_blank">utils.js</a></p>
</blockquote>
<h2 id="exportspluralization"><a name="exportspluralization" class="anchor-navigation-ex-anchor" href="#exportspluralization"><i class="fa fa-link" aria-hidden="true"></i></a>10.7. exports.pluralization</h2>
<p>Pluralization rules.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="VirtualType_pluralization" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="VirtualType_pluralization"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="VirtualType_pluralization"><div class="panel-body">
<pre class="language-"><code class="lang-js">exports<span class="token punctuation">.</span>pluralization <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token regex">/(m)an$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1en&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(pe)rson$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ople&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(child)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ren&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/^(ox)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1en&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(ax|test)is$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1es&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(octop|vir)us$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1i&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(alias|status)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1es&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(bu)s$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ses&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(buffal|tomat|potat)o$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1oes&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/([ti])um$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1a&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/sis$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;ses&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(?:([^f])fe|([lr])f)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1$2ves&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(hive)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1s&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/([^aeiouy]|qu)y$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ies&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(x|ch|ss|sh)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1es&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(matr|vert|ind)ix|ex$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ices&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/([m|l])ouse$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ice&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(kn|w|l)ife$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1ives&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/(quiz)$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;$1zes&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/s$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;s&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/([^a-z])$/</span><span class="token punctuation">,</span> <span class="token string">&apos;$1&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token regex">/$/gi</span><span class="token punctuation">,</span> <span class="token string">&apos;s&apos;</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> rules <span class="token operator">=</span> exports<span class="token punctuation">.</span>pluralization<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<p>These rules are applied while processing the argument to toCollectionName.</p>
<h2 id="exportsuncountables"><a name="exportsuncountables" class="anchor-navigation-ex-anchor" href="#exportsuncountables"><i class="fa fa-link" aria-hidden="true"></i></a>10.8. exports.uncountables</h2>
<p>Uncountable words.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="exports_uncountables" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="exports_uncountables"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="exports_uncountables"><div class="panel-body">
<pre class="language-"><code class="lang-js">exports<span class="token punctuation">.</span>uncountables <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&apos;advice&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;energy&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;excretion&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;digestion&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;cooperation&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;health&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;justice&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;labour&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;machinery&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;equipment&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;information&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;pollution&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;sewage&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;paper&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;money&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;species&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;series&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;rain&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;rice&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;fish&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;sheep&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;moose&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;deer&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;news&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;expertise&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;status&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;media&apos;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> uncountables <span class="token operator">=</span> exports<span class="token punctuation">.</span>uncountables<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<p>These words are applied while processing the argument to toCollectionName.</p>
<hr>
<h1 id="driversnode-mongodb-nativecollectionjs"><a name="driversnode-mongodb-nativecollectionjs" class="anchor-navigation-ex-anchor" href="#driversnode-mongodb-nativecollectionjs"><i class="fa fa-link" aria-hidden="true"></i></a>11. drivers/node-mongodb-native/collection.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/drivers/node-mongodb-native/collection.js" target="_blank">drivers/node-mongodb-native/collection.js</a></p>
</blockquote>
<h2 id="function-object--native-code-format"><a name="function-object--native-code-format" class="anchor-navigation-ex-anchor" href="#function-object--native-code-format"><i class="fa fa-link" aria-hidden="true"></i></a>11.1. function Object() { [native code] }#$format()</h2>
<p>Formatter for debug print args</p>
<h2 id="function-object--native-code-print"><a name="function-object--native-code-print" class="anchor-navigation-ex-anchor" href="#function-object--native-code-print"><i class="fa fa-link" aria-hidden="true"></i></a>11.2. function Object() { [native code] }#$print(</h2>
<p>Debug print helper</p>
<h2 id="nativecollectiongetindexescallback"><a name="nativecollectiongetindexescallback" class="anchor-navigation-ex-anchor" href="#nativecollectiongetindexescallback"><i class="fa fa-link" aria-hidden="true"></i></a>11.3. NativeCollection#getIndexes(callback)</h2>
<p>Retreives information about this collections indexes.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_41"><a name="&#x53C2;&#x6570;&#xFF1A;_41" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_41"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<hr>
<h1 id="driversnode-mongodb-nativeconnectionjs"><a name="driversnode-mongodb-nativeconnectionjs" class="anchor-navigation-ex-anchor" href="#driversnode-mongodb-nativeconnectionjs"><i class="fa fa-link" aria-hidden="true"></i></a>12. drivers/node-mongodb-native/connection.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/drivers/node-mongodb-native/connection.js" target="_blank">drivers/node-mongodb-native/connection.js</a></p>
</blockquote>
<h2 id="nativeconnectionusedbname"><a name="nativeconnectionusedbname" class="anchor-navigation-ex-anchor" href="#nativeconnectionusedbname"><i class="fa fa-link" aria-hidden="true"></i></a>12.1. NativeConnection#useDb(name)</h2>
<p>Switches to a different database using the same connection pool.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_42"><a name="&#x53C2;&#x6570;&#xFF1A;_42" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_42"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; The database name</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_31"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_31" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_31"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><connection> New Connection Object</connection></li>
</ul>
<p>Returns a new connection object, with the new db.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="NativeConnection_useDb" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="NativeConnection_useDb"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="NativeConnection_useDb"><div class="panel-body">
<pre class="language-"><code class="lang-js">NativeConnection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>useDb <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// we have to manually copy all of the attributes...</span>
  <span class="token keyword">var</span> newConn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>base <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>base<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>collections <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>models <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>replica <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>replica<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>hosts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hosts<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>host<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>pass <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pass<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>_readyState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_readyState<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>_closeCalled <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_closeCalled<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>_hasOpened <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_hasOpened<span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>_listening <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// First, when we create another db object, we are not guaranteed to have a</span>
  <span class="token comment" spellcheck="true">// db object to work with. So, in the case where we have a db object and it</span>
  <span class="token comment" spellcheck="true">// is connected, we can just proceed with setting everything up. However, if</span>
  <span class="token comment" spellcheck="true">// we do not have a db or the state is not connected, then we need to wait on</span>
  <span class="token comment" spellcheck="true">// the &apos;open&apos; event of the connection before doing the rest of the setup</span>
  <span class="token comment" spellcheck="true">// the &apos;connected&apos; event is the first time we&apos;ll have access to the db object</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>db <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_readyState <span class="token operator">===</span> STATES<span class="token punctuation">.</span>connected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">wireup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&apos;connected&apos;</span><span class="token punctuation">,</span> wireup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">wireup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    newConn<span class="token punctuation">.</span>db <span class="token operator">=</span> _this<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newConn<span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// setup the events appropriately</span>
    <span class="token function">listen</span><span class="token punctuation">(</span>newConn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  newConn<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// push onto the otherDbs stack, this is used when state changes</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>otherDbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newConn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  newConn<span class="token punctuation">.</span>otherDbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> newConn<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="nativeconnectionstates"><a name="nativeconnectionstates" class="anchor-navigation-ex-anchor" href="#nativeconnectionstates"><i class="fa fa-link" aria-hidden="true"></i></a>12.2. NativeConnection.STATES</h2>
<p>Expose the possible connection states.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="NativeConnection_STATES" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="NativeConnection_STATES"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="NativeConnection_STATES"><div class="panel-body">
<pre class="language-"><code class="lang-js">NativeConnection<span class="token punctuation">.</span>STATES <span class="token operator">=</span> STATES<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="browserjs"><a name="browserjs" class="anchor-navigation-ex-anchor" href="#browserjs"><i class="fa fa-link" aria-hidden="true"></i></a>13. browser.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/browser.js" target="_blank">browser.js</a></p>
</blockquote>
<h2 id="function-object--native-code-promise_1"><a name="function-object--native-code-promise_1" class="anchor-navigation-ex-anchor" href="#function-object--native-code-promise_1"><i class="fa fa-link" aria-hidden="true"></i></a>13.1. function Object() { [native code] }#Promise()</h2>
<p>The Mongoose [Promise] constructor.</p>
<h2 id="exportsdocument"><a name="exportsdocument" class="anchor-navigation-ex-anchor" href="#exportsdocument"><i class="fa fa-link" aria-hidden="true"></i></a>13.2. exports.Document()</h2>
<p>The Mongoose browser [Document] constructor.</p>
<h2 id="exportserror"><a name="exportserror" class="anchor-navigation-ex-anchor" href="#exportserror"><i class="fa fa-link" aria-hidden="true"></i></a>13.3. exports.Error()</h2>
<p>The MongooseError constructor.</p>
<h2 id="exportspromiseprovider"><a name="exportspromiseprovider" class="anchor-navigation-ex-anchor" href="#exportspromiseprovider"><i class="fa fa-link" aria-hidden="true"></i></a>13.4. exports.PromiseProvider()</h2>
<p>Storage layer for mongoose promises</p>
<h2 id="exportsschema"><a name="exportsschema" class="anchor-navigation-ex-anchor" href="#exportsschema"><i class="fa fa-link" aria-hidden="true"></i></a>13.5. exports.Schema()</h2>
<p>The Mongoose Schema constructor</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_23"><a name="&#x793A;&#x4F8B;&#xFF1A;_23" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_23"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span>
<span class="token keyword">var</span> CatSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="exportsvirtualtype"><a name="exportsvirtualtype" class="anchor-navigation-ex-anchor" href="#exportsvirtualtype"><i class="fa fa-link" aria-hidden="true"></i></a>13.6. exports.VirtualType()</h2>
<p>The Mongoose VirtualType constructor</p>
<h2 id="exportsschematypes"><a name="exportsschematypes" class="anchor-navigation-ex-anchor" href="#exportsschematypes"><i class="fa fa-link" aria-hidden="true"></i></a>13.7. exports#SchemaTypes</h2>
<p>The various Mongoose SchemaTypes.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_13"><a name="&#x6CE8;&#x610F;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>Alias of mongoose.Schema.Types for backwards compatibility.</em></p>
<sec data-title="&#x6E90;&#x7801;" data-id="exports_SchemaTypes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="exports_SchemaTypes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="exports_SchemaTypes"><div class="panel-body">
<pre class="language-"><code class="lang-js">exports<span class="token punctuation">.</span>SchemaType <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./schematype.js&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_16"><a name="&#x53C2;&#x89C1;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Schema.SchemaTypes</a></li>
</ul>
<h2 id="exportstypes"><a name="exportstypes" class="anchor-navigation-ex-anchor" href="#exportstypes"><i class="fa fa-link" aria-hidden="true"></i></a>13.8. exports#Types</h2>
<p>The various Mongoose Types.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_24"><a name="&#x793A;&#x4F8B;&#xFF1A;_24" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_24"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Array<span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x7C7B;&#x578B;&#xFF1A;_1"><a name="&#x7C7B;&#x578B;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7C7B;&#x578B;&#xFF1A;" class="plugin-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7C7B;&#x578B;&#xFF1A;</h5>
<ul>
<li><a href="">ObjectId</a></li>
<li><a href="">Buffer</a></li>
<li><a href="">SubDocument</a></li>
<li><a href="">Array</a></li>
<li><a href="">DocumentArray</a></li>
</ul>
<p>Using this exposed access to the ObjectId type, we can construct ids on demand.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> ObjectId <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span>
<span class="token keyword">var</span> id1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="1" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="1"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="1"><div class="panel-body">
<pre class="language-"><code class="lang-js">exports<span class="token punctuation">.</span>Types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./types&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="es6promisejs"><a name="es6promisejs" class="anchor-navigation-ex-anchor" href="#es6promisejs"><i class="fa fa-link" aria-hidden="true"></i></a>14. ES6Promise.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/ES6Promise.js" target="_blank">ES6Promise.js</a></p>
</blockquote>
<h2 id="es6promisefn"><a name="es6promisefn" class="anchor-navigation-ex-anchor" href="#es6promisefn"><i class="fa fa-link" aria-hidden="true"></i></a>14.1. ES6Promise(fn)</h2>
<p>ES6 Promise wrapper constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_43"><a name="&#x53C2;&#x6570;&#xFF1A;_43" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_43"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; a function which will be called when the promise is resolved that accepts fn(err, ...){} as signature</li>
</ul>
<p>Promises are returned from executed queries.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_25"><a name="&#x793A;&#x4F8B;&#xFF1A;_25" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_25"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> Candy<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>DEPRECATED. Mongoose 5.0 will use native promises by default (or bluebird,
if native promises are not present) but still
support plugging in your own ES6-compatible promises library. Mongoose 5.0
will <strong>not</strong> support mpromise.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="2" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="2"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="2"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">ES6Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Can\&apos;t use ES6 promise with mpromise style constructor&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ES6Promise<span class="token punctuation">.</span>use <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ES6Promise<span class="token punctuation">.</span>ES6 <span class="token operator">=</span> Promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ES6Promise<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h2 id="schemajs"><a name="schemajs" class="anchor-navigation-ex-anchor" href="#schemajs"><i class="fa fa-link" aria-hidden="true"></i></a>14.2. schema.js</h2>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema.js" target="_blank">schema.js</a></p>
</blockquote>
<h2 id="schemaaddobj-prefix"><a name="schemaaddobj-prefix" class="anchor-navigation-ex-anchor" href="#schemaaddobj-prefix"><i class="fa fa-link" aria-hidden="true"></i></a>14.3. Schema#add(obj, prefix)</h2>
<p>Adds key path / schema type pairs to this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_44"><a name="&#x53C2;&#x6570;&#xFF1A;_44" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_44"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>obj &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p>prefix &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_26"><a name="&#x793A;&#x4F8B;&#xFF1A;_26" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_26"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> ToySchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">;</span>
ToySchema<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">,</span> price<span class="token punctuation">:</span> <span class="token string">&apos;number&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="3" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="3"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="3"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>add <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  prefix <span class="token operator">=</span> prefix <span class="token operator">||</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>&apos;Invalid value <span class="token keyword">for</span> schema path <span class="token template-string"><span class="token string">`&apos; + prefix + key + &apos;`</span></span>&apos;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>&apos;Invalid value <span class="token keyword">for</span> schema Array path <span class="token template-string"><span class="token string">`&apos; + prefix + key + &apos;`</span></span>&apos;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token operator">||</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey <span class="token operator">===</span> <span class="token string">&apos;type&apos;</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// nested object { last: { name: String }}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nested<span class="token punctuation">[</span>prefix <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>nested<span class="token punctuation">[</span>prefix<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> prefix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// mixed type</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nested<span class="token punctuation">[</span>prefix<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> prefix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaclone"><a name="schemaclone" class="anchor-navigation-ex-anchor" href="#schemaclone"><i class="fa fa-link" aria-hidden="true"></i></a>14.4. Schema#clone()</h2>
<p>Returns a deep copy of the schema</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_32"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_32" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_32"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schema> the cloned schema</schema></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="4" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="4"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="4"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>clone <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// Clone the call queue</span>
  <span class="token keyword">var</span> cloneOpts <span class="token operator">=</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>callQueue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callQueue<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> f<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>methods <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">,</span> cloneOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>statics <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statics<span class="token punctuation">,</span> cloneOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>query <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>query<span class="token punctuation">,</span> cloneOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>plugins <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>_indexes <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_indexes<span class="token punctuation">,</span> cloneOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  s<span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaeachpathfn"><a name="schemaeachpathfn" class="anchor-navigation-ex-anchor" href="#schemaeachpathfn"><i class="fa fa-link" aria-hidden="true"></i></a>14.5. Schema#eachPath(fn)</h2>
<p>Iterates the schemas paths similar to Array#forEach.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_45"><a name="&#x53C2;&#x6570;&#xFF1A;_45" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_45"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback function</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_33"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_33" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_33"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schema> this
The callback is passed the pathname and schemaType as arguments on each iteration.</schema></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="5" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="5"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="5"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>eachPath <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">)</span><span class="token punctuation">,</span>
      len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemagetkey"><a name="schemagetkey" class="anchor-navigation-ex-anchor" href="#schemagetkey"><i class="fa fa-link" aria-hidden="true"></i></a>14.6. Schema#get(key)</h2>
<p>Gets a schema option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_46"><a name="&#x53C2;&#x6570;&#xFF1A;_46" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_46"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; option name</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_get" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_get"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_get"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaindexfields-options-optionsexpiresnull"><a name="schemaindexfields-options-optionsexpiresnull" class="anchor-navigation-ex-anchor" href="#schemaindexfields-options-optionsexpiresnull"><i class="fa fa-link" aria-hidden="true"></i></a>14.7. Schema#index(fields, [options], [options.expires=null])</h2>
<p>Defines an index (most likely compound) for this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_47"><a name="&#x53C2;&#x6570;&#xFF1A;_47" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_47"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>fields &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p>[options] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; Options to pass to MongoDB driver&apos;s createIndex() function</p>
</li>
<li><p>[options.expires=null] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; Mongoose-specific syntactic sugar, uses ms to convert expires option into seconds for the expireAfterSeconds in the above link.</p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_27"><a name="&#x793A;&#x4F8B;&#xFF1A;_27" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_27"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span> first<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> last<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_index" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_index"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_index"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fields<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">||</span> <span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>expires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    utils<span class="token punctuation">.</span><span class="token function">expires</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fields<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaindexes"><a name="schemaindexes" class="anchor-navigation-ex-anchor" href="#schemaindexes"><i class="fa fa-link" aria-hidden="true"></i></a>14.8. Schema#indexes()</h2>
<p>Compiles indexes from fields and schema-level indexes</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_indexes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_indexes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_indexes"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token template-string"><span class="token string">``</span></span><span class="token template-string"><span class="token string">`
&lt;!--endsec--&gt;
Schema#loadClass(model)
Loads an ES6 class into a schema. Maps setters + getters, static methods, and instance methods to schema virtuals, statics, and methods.

##### &#x53C2;&#x6570;&#xFF1A;
model &amp;lt;[Function][]&amp;gt;
&lt;!--sec data-title=&quot;&#x6E90;&#x7801;&quot; data-id=&quot;6&quot; data-show=true data-collapse=true ces--&gt;
`</span></span><span class="token template-string"><span class="token string">``</span></span>js
Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>indexes <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&apos;use strict&apos;</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> schemaStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> collectIndexes <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Ignore infinitely nested schemas, if we&apos;ve already seen this schema</span>
    <span class="token comment" spellcheck="true">// along this path there must be a cycle</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schemaStack<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    schemaStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

    prefix <span class="token operator">=</span> prefix <span class="token operator">||</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> key<span class="token punctuation">,</span> path<span class="token punctuation">,</span> index<span class="token punctuation">,</span> field<span class="token punctuation">,</span> isObject<span class="token punctuation">,</span> options<span class="token punctuation">,</span> type<span class="token punctuation">;</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      path <span class="token operator">=</span> schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>path <span class="token keyword">instanceof</span> <span class="token class-name">MongooseTypes<span class="token punctuation">.</span>DocumentArray</span><span class="token punctuation">)</span> <span class="token operator">||</span> path<span class="token punctuation">.</span>$isSingleNested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>options<span class="token punctuation">.</span>excludeIndexes <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">collectIndexes</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> prefix <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        index <span class="token operator">=</span> path<span class="token punctuation">.</span>_index <span class="token operator">||</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>caster <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>caster<span class="token punctuation">.</span>_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          field <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          isObject <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
          options <span class="token operator">=</span> isObject <span class="token operator">?</span> index <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          type <span class="token operator">=</span> <span class="token keyword">typeof</span> index <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span> <span class="token operator">?</span> index <span class="token punctuation">:</span>
              isObject <span class="token operator">?</span> index<span class="token punctuation">.</span>type <span class="token punctuation">:</span>
                  <span class="token boolean">false</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">&amp;&amp;</span> <span class="token operator">~</span>Schema<span class="token punctuation">.</span>indexTypes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            field<span class="token punctuation">[</span>prefix <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span> type<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            field<span class="token punctuation">[</span>prefix <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;text&apos;</span><span class="token punctuation">;</span>
            <span class="token keyword">delete</span> options<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            field<span class="token punctuation">[</span>prefix <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">delete</span> options<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&apos;background&apos;</span> <span class="token keyword">in</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            options<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          indexes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>field<span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    schemaStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fixSubIndexPaths</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      schema<span class="token punctuation">.</span>_indexes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&apos;background&apos;</span> <span class="token keyword">in</span> index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      indexes <span class="token operator">=</span> indexes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>_indexes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">collectIndexes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> indexes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemamethodmethod-fn"><a name="schemamethodmethod-fn" class="anchor-navigation-ex-anchor" href="#schemamethodmethod-fn"><i class="fa fa-link" aria-hidden="true"></i></a>14.9. Schema#method(method, [fn])</h2>
<p>Adds an instance method to documents constructed from Models compiled from this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_48"><a name="&#x53C2;&#x6570;&#xFF1A;_48" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_48"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>method <string, object=""> name</string,></p>
</li>
<li><p>[fn] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_28"><a name="&#x793A;&#x4F8B;&#xFF1A;_28" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_28"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> kittySchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

schema<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">&apos;meow&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;meeeeeoooooooooooow&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> Kitty <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Kitty&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fizz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Kitty</span><span class="token punctuation">;</span>
fizz<span class="token punctuation">.</span><span class="token function">meow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// meeeeeooooooooooooow</span>
</code></pre>
<p>If a hash of name/fn pairs is passed as the only argument, each name/fn pair will be added as methods.</p>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    purr<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">,</span> scratch<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// later</span>
fizz<span class="token punctuation">.</span><span class="token function">purr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fizz<span class="token punctuation">.</span><span class="token function">scratch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="schema_method" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="schema_method"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="schema_method"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemapathpath-constructor"><a name="schemapathpath-constructor" class="anchor-navigation-ex-anchor" href="#schemapathpath-constructor"><i class="fa fa-link" aria-hidden="true"></i></a>14.10. Schema#path(path, constructor)</h2>
<p>Gets/sets schema paths.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_49"><a name="&#x53C2;&#x6570;&#xFF1A;_49" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_49"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
<li><code>constructor</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<p>Sets a path (if arity 2)
Gets a path (if arity 1)</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_29"><a name="&#x793A;&#x4F8B;&#xFF1A;_29" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_29"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns a SchemaType</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> Number<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// changes the schemaType of `name` to Number</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="schema_path" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="schema_path"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="schema_path"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subpaths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subpaths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// subpaths?</span>
    <span class="token keyword">return</span> <span class="token regex">/\.\d+\.?.*$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token function">getPositionalPath</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// some path names conflict with document methods</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reserved<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>&apos;<span class="token template-string"><span class="token string">`&apos; + path + &apos;`</span></span> may not be used <span class="token keyword">as</span> a schema pathname&apos;<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>warnings<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;WARN: &apos;</span> <span class="token operator">+</span> warnings<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// update the tree</span>
  <span class="token keyword">var</span> subpaths <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\./</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      last <span class="token operator">=</span> subpaths<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      branch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tree<span class="token punctuation">;</span>

  subpaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>branch<span class="token punctuation">[</span>sub<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      branch<span class="token punctuation">[</span>sub<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> branch<span class="token punctuation">[</span>sub<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> msg <span class="token operator">=</span> &apos;Cannot <span class="token keyword">set</span> nested path <span class="token template-string"><span class="token string">`&apos; + path + &apos;`</span></span><span class="token punctuation">.</span> &apos;
          <span class="token operator">+</span> &apos;Parent path <span class="token template-string"><span class="token string">`&apos;
          + subpaths.slice(0, i).concat([sub]).join(&apos;.&apos;)
          + &apos;`</span></span> already <span class="token keyword">set</span> to type &apos; <span class="token operator">+</span> branch<span class="token punctuation">[</span>sub<span class="token punctuation">]</span><span class="token punctuation">.</span>name
          <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    branch <span class="token operator">=</span> branch<span class="token punctuation">[</span>sub<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  branch<span class="token punctuation">[</span>last<span class="token punctuation">]</span> <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> Schema<span class="token punctuation">.</span><span class="token function">interpretAsType</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>$isSingleNested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">[</span>path <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span> <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">[</span>path <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span> <span class="token operator">+</span> key<span class="token punctuation">]</span> <span class="token operator">=</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>childSchemas<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      schema<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">,</span>
      model<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>caster
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>$isMongooseDocumentArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>childSchemas<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      schema<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">,</span>
      model<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>casterConstructor
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemapathtypepath"><a name="schemapathtypepath" class="anchor-navigation-ex-anchor" href="#schemapathtypepath"><i class="fa fa-link" aria-hidden="true"></i></a>14.11. Schema#pathType(path)</h2>
<p>Returns the pathType of path for this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_50"><a name="&#x53C2;&#x6570;&#xFF1A;_50" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_50"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_34"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_34" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_34"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<p>Given a path, returns whether it is a real, virtual, nested, or ad-hoc/undefined path.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_pathType" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_pathType"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_pathType"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>pathType <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&apos;real&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>virtuals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&apos;virtual&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&apos;nested&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subpaths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&apos;real&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&apos;real&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/\.\d+\.|\.\d+$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getPositionalPathType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">&apos;adhocOrUndefined&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemapluginplugin-opts"><a name="schemapluginplugin-opts" class="anchor-navigation-ex-anchor" href="#schemapluginplugin-opts"><i class="fa fa-link" aria-hidden="true"></i></a>14.12. Schema#plugin(plugin, [opts])</h2>
<p>Registers a plugin for this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_51"><a name="&#x53C2;&#x6570;&#xFF1A;_51" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_51"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>plugin</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback</p>
</li>
<li><p><code>[opts]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_17"><a name="&#x53C2;&#x89C1;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="plugins.html">plugins</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_plugin" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_plugin"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_plugin"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>plugin <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;First param to `schema.plugin()` must be a function, &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;got &quot;&apos;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&apos;&quot;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts <span class="token operator">&amp;&amp;</span>
      opts<span class="token punctuation">.</span>deduplicate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>fn <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fn<span class="token punctuation">:</span> fn<span class="token punctuation">,</span> opts<span class="token punctuation">:</span> opts <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemapostmethod-fn"><a name="schemapostmethod-fn" class="anchor-navigation-ex-anchor" href="#schemapostmethod-fn"><i class="fa fa-link" aria-hidden="true"></i></a>14.13. Schema#post(method, fn)</h2>
<p>Defines a post hook for the document</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_52"><a name="&#x53C2;&#x6570;&#xFF1A;_52" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_52"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>method</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; name of the method to hook</p>
</li>
<li><p><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_18"><a name="&#x53C2;&#x89C1;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="midlleware.md">middleware</a></p>
</li>
<li><p><a href="https://www.npmjs.com/package/hooks-fixed" target="_blank">hooks.js</a></p>
</li>
<li><p><a href="http://npmjs.org/package/kareem" target="_blank">kareem</a></p>
</li>
</ul>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;save&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;this fired after a document was saved&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

schema<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;find&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;this fired after you run a find query&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Model <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Model&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;this fires after the `post` hook&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;this fires after the post find hook&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_post" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_post"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_post"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>post <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_KAREEM_HOOK<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>post<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">// assuming that all callbacks with arity &lt; 2 are synchronous post hooks</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token string">&apos;on&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>method <span class="token operator">+</span> <span class="token string">&apos;:error&apos;</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token string">&apos;post&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// wrap original function so that the callback goes last,</span>
    <span class="token comment" spellcheck="true">// for compatibility with old code that is using synchronous post hooks</span>
    <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> next<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> <span class="token punctuation">[</span>err<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemapremethod-callback"><a name="schemapremethod-callback" class="anchor-navigation-ex-anchor" href="#schemapremethod-callback"><i class="fa fa-link" aria-hidden="true"></i></a>14.14. Schema#pre(method, callback)</h2>
<p>Defines a pre hook for the document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_53"><a name="&#x53C2;&#x6570;&#xFF1A;_53" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_53"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>method</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_19"><a name="&#x53C2;&#x89C1;&#xFF1A;_19" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_19"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3" target="_blank">hooks.js</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_30"><a name="&#x793A;&#x4F8B;&#xFF1A;_30" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_30"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> toySchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

toySchema<span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">&apos;save&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>created<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>created <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

toySchema<span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">&apos;validate&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">&apos;Woody&apos;</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;Woody&apos;</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_pre" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_pre"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_pre"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>IS_KAREEM_HOOK<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>pre<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>s<span class="token punctuation">.</span>hooks<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queue</span><span class="token punctuation">(</span><span class="token string">&apos;pre&apos;</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaqueuename-args"><a name="schemaqueuename-args" class="anchor-navigation-ex-anchor" href="#schemaqueuename-args"><i class="fa fa-link" aria-hidden="true"></i></a>14.15. Schema#queue(name, args)</h2>
<p>Adds a method call to the queue.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_54"><a name="&#x53C2;&#x6570;&#xFF1A;_54" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_54"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>name &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; name of the document method to call later</p>
</li>
<li><p>args &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; arguments to pass to the method</p>
</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_queue" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_queue"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_queue"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>name<span class="token punctuation">,</span> args<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaremovepath"><a name="schemaremovepath" class="anchor-navigation-ex-anchor" href="#schemaremovepath"><i class="fa fa-link" aria-hidden="true"></i></a>14.16. Schema#remove(path)</h2>
<p>Removes the given path (or [paths]).</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_55"><a name="&#x53C2;&#x6570;&#xFF1A;_55" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_55"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>path <string, array="">
*</string,></p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_remove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_remove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_remove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
path <span class="token operator">=</span> <span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
path<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> pieces <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> last <span class="token operator">=</span> pieces<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> branch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tree<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pieces<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      branch <span class="token operator">=</span> branch<span class="token punctuation">[</span>pieces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> branch<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
</li>
</ul>
<h2 id="schemarequiredpathsinvalidate"><a name="schemarequiredpathsinvalidate" class="anchor-navigation-ex-anchor" href="#schemarequiredpathsinvalidate"><i class="fa fa-link" aria-hidden="true"></i></a>14.17. Schema#requiredPaths(invalidate)</h2>
<p>Returns an Array of path strings that are required by this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_56"><a name="&#x53C2;&#x6570;&#xFF1A;_56" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_56"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>invalidate &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; refresh the cache</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_35"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_35" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_35"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_requiredPaths" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_requiredPaths"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_requiredPaths"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>requiredPaths <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">requiredPaths</span><span class="token punctuation">(</span>invalidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_requiredpaths <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>invalidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_requiredpaths<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> paths <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">)</span><span class="token punctuation">,</span>
      i <span class="token operator">=</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>isRequired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_requiredpaths <span class="token operator">=</span> ret<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_requiredpaths<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadefinition-options"><a name="schemadefinition-options" class="anchor-navigation-ex-anchor" href="#schemadefinition-options"><i class="fa fa-link" aria-hidden="true"></i></a>14.18. Schema(definition, [options])</h2>
<p>Schema constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_57"><a name="&#x53C2;&#x6570;&#xFF1A;_57" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_57"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>definition</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_1"><a name="&#x7EE7;&#x627F;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="http://nodejs.org/api/events.html#events_class_events_eventemitter" target="_blank">NodeJS EventEmitter</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_1"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<ul>
<li><code>init</code>: Emitted after the schema is compiled into a Model.</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_31"><a name="&#x793A;&#x4F8B;&#xFF1A;_31" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_31"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> age<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Tree <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Tree&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// setting schema options</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> autoIndex<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x9009;&#x9879;"><a name="&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<ul>
<li><a href="guide.html#autoIndex">autoIndex</a>: bool - defaults to null (which means use the connection&apos;s autoIndex option)</li>
<li><a href="guide.html#bufferCommands">bufferCommands</a>: bool - defaults to true</li>
<li><a href="guide.html#capped">capped</a>: bool - defaults to false</li>
<li><a href="guide.html#collection">collection</a>: string - no default</li>
<li><a href="guide.html#emitIndexErrors">emitIndexErrors</a>: bool - defaults to false.</li>
<li><a href="guide.html#id">id</a>: bool - defaults to true</li>
<li><a href="guide.html#_id">_id</a>: bool - defaults to true</li>
<li>[minimize][]: bool - controls document#toObject behavior when called manually - defaults to true</li>
<li><a href="guide.html#read">read</a>: string</li>
<li><a href="guide.html#safe">safe</a>: bool - defaults to true.</li>
<li><a href="guide.html#shardKey">shardKey</a>: bool - defaults to null</li>
<li><a href="guide.html#strict">strict</a>: bool - defaults to true</li>
<li><a href="guide.html#toJSON">toJSON</a> - object - no default</li>
<li><a href="guide.html#toObject">toObject</a> - object - no default</li>
<li><a href="guide.html#typeKey">typeKey</a> - string - defaults to &apos;type&apos;</li>
<li><a href="guide.html#useNestedStrict">useNestedStrict</a> - boolean - defaults to false</li>
<li><a href="guide.html#validateBeforeSave">validateBeforeSave</a> - bool - defaults to true</li>
<li><a href="guide.html#versionKey">versionKey</a>: string - defaults to &quot;__v&quot;</li>
<li><a href="guide.html#collation">collation</a>: object - defaults to null (which means use no <a href="../../../GLOSSARY.html#collation" class="glossary-term" title="wiki">collation</a>)</li>
</ul>
<p>  [minimize]:</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_14"><a name="&#x6CE8;&#x610F;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>When nesting schemas, (children in the example above), always declare the child schema first before passing it into its parent.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Schema</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Schema</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>paths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>aliases <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>subpaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>virtuals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>singleNestedPaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>nested <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>inherits <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>methods <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>statics <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>query <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>childSchemas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token punctuation">{</span>
    hooks<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Kareem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    kareemHooks<span class="token punctuation">:</span> IS_KAREEM_HOOK
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defaultOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// build paths</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// check if _id&apos;s value is a subdocument (gh-2276)</span>
  <span class="token keyword">var</span> _idSubDoc <span class="token operator">=</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>_id <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// ensure the documents get an auto _id unless disabled</span>
  <span class="token keyword">var</span> auto_id <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>paths<span class="token punctuation">[</span><span class="token string">&apos;_id&apos;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
      <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>noId <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>_id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>_idSubDoc<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>auto_id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _obj <span class="token operator">=</span> <span class="token punctuation">{</span>_id<span class="token punctuation">:</span> <span class="token punctuation">{</span>auto<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    _obj<span class="token punctuation">.</span>_id<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span> <span class="token operator">=</span> Schema<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultMiddleware<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultMiddleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>m<span class="token punctuation">.</span>kind<span class="token punctuation">]</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hook<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token operator">!</span>m<span class="token punctuation">.</span>isAsync<span class="token punctuation">,</span> m<span class="token punctuation">.</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>timestamps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupTimestamp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>timestamps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// Assign virtual properties based on alias option</span>
  <span class="token function">aliasFields</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemasetkey-value"><a name="schemasetkey-value" class="anchor-navigation-ex-anchor" href="#schemasetkey-value"><i class="fa fa-link" aria-hidden="true"></i></a>14.19. Schema#set(key, [value])</h2>
<p>Sets/gets a schema option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_58"><a name="&#x53C2;&#x6570;&#xFF1A;_58" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_58"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>key &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; option name</p>
</li>
<li><p>[value] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; if not passed, the current option value is returned</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_20"><a name="&#x53C2;&#x89C1;&#xFF1A;_20" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_20"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="guide.html">Schema</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_32"><a name="&#x793A;&#x4F8B;&#xFF1A;_32" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_32"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;strict&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;true&apos; by default</span>
schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;strict&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Sets &apos;strict&apos; to false</span>
schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;strict&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;false&apos;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_set" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_set"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_set"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> _tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&apos;read&apos;</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">readPref</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> _tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&apos;safe&apos;</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token boolean">false</span>
          <span class="token operator">?</span> <span class="token punctuation">{</span>w<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
          <span class="token punctuation">:</span> value<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&apos;timestamps&apos;</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setupTimestamp</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastaticname-fn"><a name="schemastaticname-fn" class="anchor-navigation-ex-anchor" href="#schemastaticname-fn"><i class="fa fa-link" aria-hidden="true"></i></a>14.20. Schema#static(name, [fn])</h2>
<p>Adds static &quot;class&quot; methods to Models compiled from this schema.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_59"><a name="&#x53C2;&#x6570;&#xFF1A;_59" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_59"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>name</code> <string, object=""></string,></p>
</li>
<li><p><code>[fn]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_33"><a name="&#x793A;&#x4F8B;&#xFF1A;_33" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_33"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span><span class="token string">&apos;findByName&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Drink <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Drink&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
Drink<span class="token punctuation">.</span><span class="token function">findByName</span><span class="token punctuation">(</span><span class="token string">&apos;sanpellegrino&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> drinks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If a hash of name/fn pairs is passed as the only argument, each name/fn pair will be added as statics.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_static" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_static"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_static"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">static</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>statics<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>statics<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemavirtualname-options"><a name="schemavirtualname-options" class="anchor-navigation-ex-anchor" href="#schemavirtualname-options"><i class="fa fa-link" aria-hidden="true"></i></a>14.21. Schema#virtual(name, [options])</h2>
<p>Creates a virtual type with the given name.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_60"><a name="&#x53C2;&#x6570;&#xFF1A;_60" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_60"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>name &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p>[options] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_36"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_36" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_36"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><virtualtype>


</virtualtype></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_virtual" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_virtual"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_virtual"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>virtual <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>localField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Reference virtuals require `localField` option&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>foreignField<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Reference virtuals require `foreignField` option&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">&apos;init&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mpath<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> _v <span class="token operator">=</span> mpath<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>justOne<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>_v<span class="token punctuation">)</span> <span class="token operator">?</span>
            _v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
            _v<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>_v<span class="token punctuation">)</span> <span class="token operator">?</span>
            _v <span class="token punctuation">:</span>
            _v <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>_v<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mpath<span class="token punctuation">.</span><span class="token function">unset</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> virtual <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    virtual<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">return</span> virtual<span class="token punctuation">.</span>
      <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
      <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>_v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>justOne<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>_v<span class="token punctuation">)</span> <span class="token operator">?</span>
            _v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
            _v<span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>_v<span class="token punctuation">)</span> <span class="token operator">?</span>
            _v <span class="token punctuation">:</span>
            _v <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>_v<span class="token punctuation">]</span><span class="token punctuation">;</span>

          <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$$populatedVirtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> doc <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> doc <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> virtuals <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>virtuals<span class="token punctuation">;</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pathType</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;real&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Virtual path &quot;&apos;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&apos;&quot;&apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos; conflicts with a real path in the schema&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  virtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>mem<span class="token punctuation">,</span> part<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mem<span class="token punctuation">[</span>part<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>mem<span class="token punctuation">[</span>part<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> parts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">VirtualType</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mem<span class="token punctuation">[</span>part<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> virtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemavirtualpathname"><a name="schemavirtualpathname" class="anchor-navigation-ex-anchor" href="#schemavirtualpathname"><i class="fa fa-link" aria-hidden="true"></i></a>14.22. Schema#virtualpath(name)</h2>
<p>Returns the virtual type with the given name.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_61"><a name="&#x53C2;&#x6570;&#xFF1A;_61" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_61"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>name &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_37"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_37" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_37"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><virtualtype>


</virtualtype></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_virtualpath" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_virtualpath"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_virtualpath"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>virtualpath <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>virtuals<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaindextypes"><a name="schemaindextypes" class="anchor-navigation-ex-anchor" href="#schemaindextypes"><i class="fa fa-link" aria-hidden="true"></i></a>14.23. Schema.indexTypes()</h2>
<p>The allowed index types</p>
<sec data-title="&#x6E90;&#x7801;" data-id="createConnection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="createConnection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="createConnection"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> indexTypes <span class="token operator">=</span> <span class="token string">&apos;2d 2dsphere hashed text&apos;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Schema<span class="token punctuation">,</span> <span class="token string">&apos;indexTypes&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> indexTypes<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Cannot overwrite Schema.indexTypes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemareserved"><a name="schemareserved" class="anchor-navigation-ex-anchor" href="#schemareserved"><i class="fa fa-link" aria-hidden="true"></i></a>14.24. Schema.reserved</h2>
<p>Reserved document keys.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_reserved" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_reserved"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_reserved"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>reserved <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reserved <span class="token operator">=</span> Schema<span class="token punctuation">.</span>reserved<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Core object</span>
reserved<span class="token punctuation">[</span><span class="token string">&apos;prototype&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token comment" spellcheck="true">// EventEmitter</span>
reserved<span class="token punctuation">.</span>emit <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>on <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>once <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>listeners <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>removeListener <span class="token operator">=</span>
<span class="token comment" spellcheck="true">// document properties and functions</span>
reserved<span class="token punctuation">.</span>collection <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>db <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>errors <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>init <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>isModified <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>isNew <span class="token operator">=</span>
reserved<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>modelName <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>save <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>schema <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>toObject <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>validate <span class="token operator">=</span>
reserved<span class="token punctuation">.</span>remove <span class="token operator">=</span>
<span class="token comment" spellcheck="true">// hooks.js</span>
reserved<span class="token punctuation">.</span>_pres <span class="token operator">=</span> reserved<span class="token punctuation">.</span>_posts <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<p>Keys in this object are names that are rejected in schema declarations b/c they conflict with mongoose functionality. Using these key name will throw an error.</p>
<pre class="language-"><code>on, emit, _events, db, get, set, init, isNew, errors, schema, options, modelName, collection, _pres, _posts, toObject
</code></pre><h5 id="&#x6CE8;&#x610F;&#xFF1A;_15"><a name="&#x6CE8;&#x610F;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Use of these terms as method names is permitted, but play at your own risk, as they may be existing mongoose document methods you are stomping on.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 schema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// potentially breaking</span>
</code></pre>
<h2 id="schematypes"><a name="schematypes" class="anchor-navigation-ex-anchor" href="#schematypes"><i class="fa fa-link" aria-hidden="true"></i></a>14.25. Schema.Types</h2>
<p>The various built-in Mongoose Schema Types.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_Types" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_Types"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_Types"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>Types <span class="token operator">=</span> MongooseTypes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./schema/index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_34"><a name="&#x793A;&#x4F8B;&#xFF1A;_34" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_34"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ObjectId <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x7C7B;&#x578B;&#xFF1A;_2"><a name="&#x7C7B;&#x578B;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7C7B;&#x578B;&#xFF1A;" class="plugin-anchor" href="#&#x7C7B;&#x578B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7C7B;&#x578B;&#xFF1A;</h5>
<ul>
<li><a href="">String</a></li>
<li><a href="">Number</a></li>
<li><a href="">Boolean</a> | Bool</li>
<li><a href="">Array</a></li>
<li><a href="">Buffer</a></li>
<li><a href="">Date</a></li>
<li><a href="">ObjectId</a> | Oid</li>
<li><a href="">Mixed</a></li>
</ul>
<p>Using this exposed access to the Mixed SchemaType, we can use them in our schema.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> Mixed <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Mixed<span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _user<span class="token punctuation">:</span> Mixed <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="schemachildschemas"><a name="schemachildschemas" class="anchor-navigation-ex-anchor" href="#schemachildschemas"><i class="fa fa-link" aria-hidden="true"></i></a>14.26. Schema#childSchemas</h2>
<p>Array of child schemas (from document arrays and single nested subdocs)
and their corresponding compiled models. Each element of the array is
an object with 2 properties: schema and model.</p>
<p>This property is typically only useful for plugin authors and advanced users.
You do not need to interact with this property at all to use mongoose.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_childSchemas" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_childSchemas"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_childSchemas"><div class="panel-body">
<pre class="language-"><code class="lang-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&apos;childSchemas&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaobj"><a name="schemaobj" class="anchor-navigation-ex-anchor" href="#schemaobj"><i class="fa fa-link" aria-hidden="true"></i></a>14.27. Schema#obj</h2>
<p>The original object passed to the schema constructor</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_35"><a name="&#x793A;&#x4F8B;&#xFF1A;_35" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_35"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span> b<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span>obj<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { a: String }</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Schema_obj" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Schema_obj"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Schema_obj"><div class="panel-body">
<pre class="language-"><code class="lang-js">Schema<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h1 id="documentjs"><a name="documentjs" class="anchor-navigation-ex-anchor" href="#documentjs"><i class="fa fa-link" aria-hidden="true"></i></a>15. document.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/document.js" target="_blank">document.js</a></p>
</blockquote>
<h2 id="missing-method-name"><a name="missing-method-name" class="anchor-navigation-ex-anchor" href="#missing-method-name"><i class="fa fa-link" aria-hidden="true"></i></a>15.1. MISSING method name</h2>
<p>Getter/setter, determines whether the document was removed or not.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_62"><a name="&#x53C2;&#x6570;&#xFF1A;_62" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_62"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[val] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; optional, overrides whether mongoose thinks the doc is deleted</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_38"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_38" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_38"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; whether mongoose thinks this doc is deleted.</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_36"><a name="&#x793A;&#x4F8B;&#xFF1A;_36" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_36"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  product<span class="token punctuation">.</span><span class="token function">isDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>
  product<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// no-op, doesn&apos;t send anything to the db</span>

  product<span class="token punctuation">.</span><span class="token function">isDeleted</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  product<span class="token punctuation">.</span><span class="token function">isDeleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false</span>
  product<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// will execute a remove against the db</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="MISSING_method_name" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MISSING_method_name"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MISSING_method_name"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$isDeleted <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>isDeleted<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>isDeleted <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>val<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="missing-method-name_1"><a name="missing-method-name_1" class="anchor-navigation-ex-anchor" href="#missing-method-name_1"><i class="fa fa-link" aria-hidden="true"></i></a>15.2. MISSING method name</h2>
<p>Alias for set(), used internally to avoid conflicts</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_63"><a name="&#x53C2;&#x6570;&#xFF1A;_63" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_63"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> <string, object=""> path or object of key/vals to set</string,></p>
</li>
<li><p><code>val</code> &lt;<a href="#Any">Any</a>&gt; the value to set</p>
</li>
<li><p><code>[type]</code> <schema, string,="" number,="" buffer,="" *=""> optionally specify a type for &quot;on-the-fly&quot; attributes</schema,></p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optionally specify options that modify the behavior of the set</p>
</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="MISSING_method_name2" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MISSING_method_name2"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MISSING_method_name2"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">,</span> type<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> type<span class="token punctuation">;</span>
    type <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> merge <span class="token operator">=</span> options<span class="token punctuation">.</span>merge<span class="token punctuation">;</span>
  <span class="token keyword">var</span> adhoc <span class="token operator">=</span> type <span class="token operator">&amp;&amp;</span> type <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> constructing <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> adhocs<span class="token punctuation">;</span>

  <span class="token keyword">var</span> strict <span class="token operator">=</span> <span class="token string">&apos;strict&apos;</span> <span class="token keyword">in</span> options
      <span class="token operator">?</span> options<span class="token punctuation">.</span>strict
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>strictMode<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>adhoc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    adhocs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>adhocPaths <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>adhocPaths <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adhocs<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> Schema<span class="token punctuation">.</span><span class="token function">interpretAsType</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// new Document({ key: val })</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> path <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> _ <span class="token operator">=</span> path<span class="token punctuation">;</span>
      path <span class="token operator">=</span> val<span class="token punctuation">;</span>
      val <span class="token operator">=</span> _<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> prefix <span class="token operator">=</span> val
          <span class="token operator">?</span> val <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span>
          <span class="token punctuation">:</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">instanceof</span> <span class="token class-name">Document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>$__isNested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          path <span class="token operator">=</span> path<span class="token punctuation">.</span>_doc<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> pathtype<span class="token punctuation">;</span>
      <span class="token keyword">var</span> key<span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>minimize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>retainKeyOrder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _handleIndex<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>len<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _handleIndex<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">_handleIndex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pathName <span class="token operator">=</span> prefix <span class="token operator">+</span> key<span class="token punctuation">;</span>
    pathtype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">pathType</span><span class="token punctuation">(</span>pathName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span>
        <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span>
          <span class="token comment" spellcheck="true">// need to know if plain object - no Buffer, ObjectId, ref, etc</span>
        <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token operator">||</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> pathtype <span class="token operator">!==</span> <span class="token string">&apos;virtual&apos;</span>
        <span class="token operator">&amp;&amp;</span> pathtype <span class="token operator">!==</span> <span class="token string">&apos;real&apos;</span>
        <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__path</span><span class="token punctuation">(</span>pathName<span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">MixedSchema</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>pathName<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>pathName<span class="token punctuation">]</span><span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>pathName<span class="token punctuation">]</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>ref<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> constructing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>strict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Don&apos;t overwrite defaults with undefined keys (gh-3981)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>constructing <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>pathtype <span class="token operator">===</span> <span class="token string">&apos;real&apos;</span> <span class="token operator">||</span> pathtype <span class="token operator">===</span> <span class="token string">&apos;virtual&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Check for setting single embedded schema to document (gh-3535)</span>
        <span class="token keyword">var</span> p <span class="token operator">=</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>pathName<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>paths<span class="token punctuation">[</span>pathName<span class="token punctuation">]</span><span class="token punctuation">.</span>$isSingleNested <span class="token operator">&amp;&amp;</span>
            path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> virtuals<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> transform<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> p<span class="token punctuation">,</span> constructing<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pathtype <span class="token operator">===</span> <span class="token string">&apos;nested&apos;</span> <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span>
            path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>transform<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> constructing<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>strict <span class="token operator">===</span> <span class="token string">&apos;throw&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pathtype <span class="token operator">===</span> <span class="token string">&apos;nested&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ObjectExpectedError</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StrictModeError</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>prefix <span class="token operator">+</span> key<span class="token punctuation">,</span> path<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> constructing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> pathType <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">pathType</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathType <span class="token operator">===</span> <span class="token string">&apos;nested&apos;</span> <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token operator">!</span>val<span class="token punctuation">.</span>constructor <span class="token operator">||</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>merge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cleanModifiedSubpaths</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">markModified</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cleanModifiedSubpaths</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> path<span class="token punctuation">,</span> constructing<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MongooseError<span class="token punctuation">.</span>CastError</span><span class="token punctuation">(</span><span class="token string">&apos;Object&apos;</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> schema<span class="token punctuation">;</span>
  <span class="token keyword">var</span> parts <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathType <span class="token operator">===</span> <span class="token string">&apos;adhocOrUndefined&apos;</span> <span class="token operator">&amp;&amp;</span> strict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// check for roots that are Mixed types</span>
    <span class="token keyword">var</span> mixed<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> subpath <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>subpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token keyword">instanceof</span> <span class="token class-name">MixedSchema</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// allow changes to sub paths of mixed types</span>
        mixed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment" spellcheck="true">// If path is underneath a virtual, bypass everything and just set it.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">pathType</span><span class="token punctuation">(</span>subpath<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;virtual&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mpath<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mixed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>strict <span class="token operator">===</span> <span class="token string">&apos;throw&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">StrictModeError</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pathType <span class="token operator">===</span> <span class="token string">&apos;virtual&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">virtualpath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    schema<span class="token punctuation">.</span><span class="token function">applySetters</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__path</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// gh-4578, if setting a deeply nested path that doesn&apos;t exist yet, create it</span>
  <span class="token keyword">var</span> cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_doc<span class="token punctuation">;</span>
  <span class="token keyword">var</span> curPath <span class="token operator">=</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cur <span class="token operator">=</span> cur<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    curPath <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span>curPath<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&apos;.&apos;</span> <span class="token punctuation">:</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">)</span> <span class="token operator">+</span> parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>curPath<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Hack re: gh-5800. If nested field is not selected, it probably exists</span>
      <span class="token comment" spellcheck="true">// so `MongoError: cannot use the part (nested of nested.num) to</span>
      <span class="token comment" spellcheck="true">// traverse the element ({nested: null})` is not likely. If user gets</span>
      <span class="token comment" spellcheck="true">// that error, its their fault for now. We should reconsider disallowing</span>
      <span class="token comment" spellcheck="true">// modifying not selected paths for v5.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isSelected</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unmarkModified</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> pathToMark<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// When using the $set operator the path to the field must already exist.</span>
  <span class="token comment" spellcheck="true">// Else mongodb throws: &quot;LEFT_SUBFIELD only supports Object&quot;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pathToMark <span class="token operator">=</span> path<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subpath <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirectModified</span><span class="token punctuation">(</span>subpath<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// earlier prefixes that are already</span>
            <span class="token comment" spellcheck="true">// marked as dirty have precedence</span>
          <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>subpath<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pathToMark <span class="token operator">=</span> subpath<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pathToMark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pathToMark <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// if this doc is being constructed we should not trigger getters</span>
  <span class="token keyword">var</span> priorVal <span class="token operator">=</span> constructing <span class="token operator">?</span>
    undefined <span class="token punctuation">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__set</span><span class="token punctuation">(</span>pathToMark<span class="token punctuation">,</span> path<span class="token punctuation">,</span> constructing<span class="token punctuation">,</span> parts<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> val<span class="token punctuation">,</span> priorVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> shouldSet <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// If the user is trying to set a ref path to a document with</span>
    <span class="token comment" spellcheck="true">// the correct model name, treat it as populated</span>
    <span class="token keyword">var</span> didPopulate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span>
        schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ref <span class="token operator">&amp;&amp;</span>
        val <span class="token keyword">instanceof</span> <span class="token class-name">Document</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ref <span class="token operator">===</span> val<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>modelName <span class="token operator">||</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ref <span class="token operator">===</span> val<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>baseModelName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ownerDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__fullPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
          val<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token punctuation">{</span>model<span class="token punctuation">:</span> val<span class="token punctuation">.</span>constructor<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token punctuation">{</span>model<span class="token punctuation">:</span> val<span class="token punctuation">.</span>constructor<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      didPopulate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> popOpts<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span>
        Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        schema<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>
        schema<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ref <span class="token operator">&amp;&amp;</span>
        Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Document</span> <span class="token operator">&amp;&amp;</span>
        val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>modelName <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ref <span class="token operator">===</span> val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>baseModelName <span class="token operator">||</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ref <span class="token operator">===</span> val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>modelName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        popOpts <span class="token operator">=</span> <span class="token punctuation">{</span> model<span class="token punctuation">:</span> val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ownerDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__fullPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
          val<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>_id<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> popOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        popOpts <span class="token operator">=</span> <span class="token punctuation">{</span> model<span class="token punctuation">:</span> val<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> v<span class="token punctuation">.</span>_id<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> popOpts<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      didPopulate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> setterContext <span class="token operator">=</span> constructing <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>priorDoc <span class="token operator">?</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>priorDoc <span class="token punctuation">:</span>
      <span class="token keyword">this</span><span class="token punctuation">;</span>
    val <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">applySetters</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> setterContext<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> priorVal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>didPopulate <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$markValid</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">MongooseError<span class="token punctuation">.</span>CastError</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>instance<span class="token punctuation">,</span> val<span class="token punctuation">,</span> path<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shouldSet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__set</span><span class="token punctuation">(</span>pathToMark<span class="token punctuation">,</span> path<span class="token punctuation">,</span> constructing<span class="token punctuation">,</span> parts<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> val<span class="token punctuation">,</span> priorVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">.</span>$isSingleNested <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isDirectModified</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">||</span> val <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cleanModifiedSubpaths</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentignorepath"><a name="documentignorepath" class="anchor-navigation-ex-anchor" href="#documentignorepath"><i class="fa fa-link" aria-hidden="true"></i></a>15.3. Document#$ignore(path)</h2>
<p>Don&apos;t run validation on this path or persist changes to this path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_64"><a name="&#x53C2;&#x6570;&#xFF1A;_64" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_64"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the path to ignore</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_37"><a name="&#x793A;&#x4F8B;&#xFF1A;_37" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_37"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">$ignore</span><span class="token punctuation">(</span><span class="token string">&apos;foo&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// changes to foo will not be persisted and validators won&apos;t be run</span>
</code></pre>
<h2 id="documentisdefaultpath"><a name="documentisdefaultpath" class="anchor-navigation-ex-anchor" href="#documentisdefaultpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.4. Document#$isDefault([path])</h2>
<p>Checks if a path is set to its default.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_65"><a name="&#x53C2;&#x6570;&#xFF1A;_65" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_65"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[path] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_39"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_39" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_39"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_38"><a name="&#x793A;&#x4F8B;&#xFF1A;_38" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_38"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">MyModel <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;test&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">&apos;Val &apos;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">$isDefault</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>
</code></pre>
<h2 id="documentdepopulatepath"><a name="documentdepopulatepath" class="anchor-navigation-ex-anchor" href="#documentdepopulatepath"><i class="fa fa-link" aria-hidden="true"></i></a>15.5. Document#depopulate(path)</h2>
<p>Takes a populated field and returns it to its unpopulated state.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_66"><a name="&#x53C2;&#x6570;&#xFF1A;_66" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_66"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_40"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_40" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_40"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><document> this</document></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_21"><a name="&#x53C2;&#x89C1;&#xFF1A;_21" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_21"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Document.populate</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_39"><a name="&#x793A;&#x4F8B;&#xFF1A;_39" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_39"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Dr.Seuss</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">depopulate</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>author<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;5144cf8050f071d979c118a7&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>If the path was not populated, this is a no-op.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_depopulate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_depopulate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_depopulate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>depopulate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> populatedIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>populatedIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> populatedIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentequalsdoc"><a name="documentequalsdoc" class="anchor-navigation-ex-anchor" href="#documentequalsdoc"><i class="fa fa-link" aria-hidden="true"></i></a>15.6. Document#equals(doc)</h2>
<p>Returns true if the Document stores the same data as doc.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_67"><a name="&#x53C2;&#x6570;&#xFF1A;_67" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_67"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>doc</code> <document> a document to compare</document></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_41"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_41" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_41"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<p>Documents are considered equal when they have matching _ids, unless neither
document has an _id, in which case this function falls back to using
deepEqual().</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_equals" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_equals"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_equals"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>equals <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> tid <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> docid <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">?</span> doc<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> doc<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tid <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>docid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">deepEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> tid <span class="token operator">&amp;&amp;</span> tid<span class="token punctuation">.</span>equals
      <span class="token operator">?</span> tid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>docid<span class="token punctuation">)</span>
      <span class="token punctuation">:</span> tid <span class="token operator">===</span> docid<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentexecpopulate"><a name="documentexecpopulate" class="anchor-navigation-ex-anchor" href="#documentexecpopulate"><i class="fa fa-link" aria-hidden="true"></i></a>15.7. Document#execPopulate()</h2>
<p>Explicitly executes population and returns a promise. Useful for ES2015
integration.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_42"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_42" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_42"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> promise that resolves to the document when population is done</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_22"><a name="&#x53C2;&#x89C1;&#xFF1A;_22" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_22"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Document.populate</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_40"><a name="&#x793A;&#x4F8B;&#xFF1A;_40" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_40"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> promise <span class="token operator">=</span> doc<span class="token punctuation">.</span>
  <span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;company&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">&apos;notes&apos;</span><span class="token punctuation">,</span>
    match<span class="token punctuation">:</span> <span class="token regex">/airline/</span><span class="token punctuation">,</span>
    select<span class="token punctuation">:</span> <span class="token string">&apos;text&apos;</span><span class="token punctuation">,</span>
    model<span class="token punctuation">:</span> <span class="token string">&apos;modelName&apos;</span>
    options<span class="token punctuation">:</span> opts
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">execPopulate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// summary</span>
doc<span class="token punctuation">.</span><span class="token function">execPopulate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_execPopulate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_execPopulate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_execPopulate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>execPopulate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentgetpath-type"><a name="documentgetpath-type" class="anchor-navigation-ex-anchor" href="#documentgetpath-type"><i class="fa fa-link" aria-hidden="true"></i></a>15.8. Document#get(path, [type])</h2>
<p>Returns the value of a path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_68"><a name="&#x53C2;&#x6570;&#xFF1A;_68" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_68"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p>[type] <schema, string,="" number,="" buffer,="" *=""> optionally specify a type for on-the-fly attributes</schema,></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_41"><a name="&#x793A;&#x4F8B;&#xFF1A;_41" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_41"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// path</span>
doc<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 47</span>

<span class="token comment" spellcheck="true">// dynamic casting to a string</span>
doc<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &quot;47&quot;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_get" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_get"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_get"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> adhoc<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    adhoc <span class="token operator">=</span> Schema<span class="token punctuation">.</span><span class="token function">interpretAsType</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__path</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">virtualpath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pieces <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_doc<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token keyword">instanceof</span> <span class="token class-name">VirtualType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> schema<span class="token punctuation">.</span><span class="token function">applyGetters</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> pieces<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj <span class="token operator">=</span> obj <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> obj <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span>
        <span class="token operator">?</span> undefined
        <span class="token punctuation">:</span> obj<span class="token punctuation">[</span>pieces<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>adhoc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj <span class="token operator">=</span> adhoc<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj <span class="token operator">=</span> schema<span class="token punctuation">.</span><span class="token function">applyGetters</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentinitdoc-fn"><a name="documentinitdoc-fn" class="anchor-navigation-ex-anchor" href="#documentinitdoc-fn"><i class="fa fa-link" aria-hidden="true"></i></a>15.9. Document#init(doc, fn)</h2>
<p>Initializes the document without setters or marking anything modified.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_69"><a name="&#x53C2;&#x6570;&#xFF1A;_69" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_69"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; document returned by mongo</p>
</li>
<li><p><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback</p>
</li>
</ul>
<p>Called internally after a document is returned from mongodb.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_init" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_init"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_init"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do not prefix this method with $__ since its</span>
  <span class="token comment" spellcheck="true">// used by public hooks</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> opts<span class="token punctuation">;</span>
    opts <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>isNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$init <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// handle docs with populated paths</span>
  <span class="token comment" spellcheck="true">// If doc._id is not null or undefined</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> doc<span class="token punctuation">.</span>_id <span class="token operator">!==</span> undefined <span class="token operator">&amp;&amp;</span>
    opts <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>populated <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>populated<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> opts<span class="token punctuation">.</span>populated<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> item <span class="token operator">=</span> opts<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>isVirtual<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">,</span> item<span class="token punctuation">.</span>_docs<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_doc<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;init&apos;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;init&apos;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>_id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentinspect"><a name="documentinspect" class="anchor-navigation-ex-anchor" href="#documentinspect"><i class="fa fa-link" aria-hidden="true"></i></a>15.10. Document#inspect()</h2>
<p>Helper for console.log</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_inspect" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_inspect"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_inspect"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>inspect <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> isPOJO <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span>
    utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> opts<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isPOJO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts <span class="token operator">=</span> options<span class="token punctuation">;</span>
    opts<span class="token punctuation">.</span>minimize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    opts<span class="token punctuation">.</span>retainKeyOrder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentinvalidatepath-errormsg-value-kind"><a name="documentinvalidatepath-errormsg-value-kind" class="anchor-navigation-ex-anchor" href="#documentinvalidatepath-errormsg-value-kind"><i class="fa fa-link" aria-hidden="true"></i></a>15.11. Document#invalidate(path, errorMsg, value, [kind])</h2>
<p>Marks a path as invalid, causing validation to fail.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_70"><a name="&#x53C2;&#x6570;&#xFF1A;_70" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_70"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the field to invalidate</p>
</li>
<li><p><code>errorMsg</code> <string, error=""> the error which states the reason path was invalid</string,></p>
</li>
<li><p><code>value</code> <object, string,="" number,="" t=""> optional invalid value</object,></p>
</li>
<li><p><code>[kind]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional kind property for the error</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_43"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_43" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_43"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><validationerror> the current ValidationError, with all currently invalidated paths
The errorMsg argument will become the message of the ValidationError.</validationerror></li>
</ul>
<p>The value argument (if passed) will be available through the ValidationError.value property.</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token string">&apos;size&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;must be less than 20&apos;</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

doc<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token comment" spellcheck="true">// prints</span>
  <span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">&apos;Validation failed&apos;</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">&apos;ValidationError&apos;</span><span class="token punctuation">,</span>
    errors<span class="token punctuation">:</span>
     <span class="token punctuation">{</span> size<span class="token punctuation">:</span>
        <span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">&apos;must be less than 20&apos;</span><span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> <span class="token string">&apos;ValidatorError&apos;</span><span class="token punctuation">,</span>
          path<span class="token punctuation">:</span> <span class="token string">&apos;size&apos;</span><span class="token punctuation">,</span>
          type<span class="token punctuation">:</span> <span class="token string">&apos;user defined&apos;</span><span class="token punctuation">,</span>
          value<span class="token punctuation">:</span> <span class="token number">14</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_invalidate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_invalidate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_invalidate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>invalidate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> err<span class="token punctuation">,</span> val<span class="token punctuation">,</span> kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValidationError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">.</span>errors<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err <span class="token operator">||</span> <span class="token keyword">typeof</span> err <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValidatorError</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> err<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> kind <span class="token operator">||</span> <span class="token string">&apos;user defined&apos;</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> val
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError <span class="token operator">===</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">.</span><span class="token function">addError</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentisdirectmodifiedpath"><a name="documentisdirectmodifiedpath" class="anchor-navigation-ex-anchor" href="#documentisdirectmodifiedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.12. Document#isDirectModified(path)</h2>
<p>Returns true if path was directly set and modified, else false.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_71"><a name="&#x53C2;&#x6570;&#xFF1A;_71" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_71"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_44"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_44" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_44"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_42"><a name="&#x793A;&#x4F8B;&#xFF1A;_42" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_42"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;documents.0.title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;changed&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">isDirectModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents.0.title&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
doc<span class="token punctuation">.</span><span class="token function">isDirectModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isDirectModified" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isDirectModified"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isDirectModified"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isDirectModified <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span>states<span class="token punctuation">.</span>modify<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentisdirectselectedpath"><a name="documentisdirectselectedpath" class="anchor-navigation-ex-anchor" href="#documentisdirectselectedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.13. Document#isDirectSelected(path)</h2>
<p>Checks if path was explicitly selected. If no projection, always returns
true.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_72"><a name="&#x53C2;&#x6570;&#xFF1A;_72" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_72"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_45"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_45" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_45"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_43"><a name="&#x793A;&#x4F8B;&#xFF1A;_43" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_43"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Thing<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;nested.name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   doc<span class="token punctuation">.</span><span class="token function">isDirectSelected</span><span class="token punctuation">(</span><span class="token string">&apos;nested.name&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
   doc<span class="token punctuation">.</span><span class="token function">isDirectSelected</span><span class="token punctuation">(</span><span class="token string">&apos;nested.otherName&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
   doc<span class="token punctuation">.</span><span class="token function">isDirectSelected</span><span class="token punctuation">(</span><span class="token string">&apos;nested&apos;</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isDirectSelected" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isDirectSelected"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isDirectSelected"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isDirectSelected <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">isDirectSelected</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>_id <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> paths <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">var</span> inclusive <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> cur<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> paths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// only _id was selected.</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cur <span class="token operator">=</span> paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDefiningProjection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      inclusive <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>inclusive <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> inclusive<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">!</span>inclusive<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentisinitpath"><a name="documentisinitpath" class="anchor-navigation-ex-anchor" href="#documentisinitpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.14. Document#isInit(path)</h2>
<p>Checks if path was initialized.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_73"><a name="&#x53C2;&#x6570;&#xFF1A;_73" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_73"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_46"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_46" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_46"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isInit" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isInit"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isInit"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isInit <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span>states<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentismodifiedpath"><a name="documentismodifiedpath" class="anchor-navigation-ex-anchor" href="#documentismodifiedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.15. Document#isModified([path])</h2>
<p>Returns true if this document was modified, else false.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_74"><a name="&#x53C2;&#x6570;&#xFF1A;_74" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_74"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_47"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_47" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_47"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<p>If path is given, checks if a path or any full path containing path as part of its path chain has been modified.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_44"><a name="&#x793A;&#x4F8B;&#xFF1A;_44" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_44"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;documents.0.title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;changed&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment" spellcheck="true">// true</span>
doc<span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents&apos;</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// true</span>
doc<span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents.0.title&apos;</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// true</span>
doc<span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents otherProp&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
doc<span class="token punctuation">.</span><span class="token function">isDirectModified</span><span class="token punctuation">(</span><span class="token string">&apos;documents&apos;</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// false</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isModified" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isModified"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isModified"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isModified <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>paths<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      paths <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> modified <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">modifiedPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> directModifiedPaths <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span>states<span class="token punctuation">.</span>modify<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> isModifiedChild <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">~</span>modified<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> isModifiedChild <span class="token operator">||</span> paths<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> directModifiedPaths<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mod <span class="token operator">===</span> path <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>mod <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token string">&apos;modify&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentisselectedpath"><a name="documentisselectedpath" class="anchor-navigation-ex-anchor" href="#documentisselectedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.16. Document#isSelected(path)</h2>
<p>Checks if path was selected in the source query which initialized this document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_75"><a name="&#x53C2;&#x6570;&#xFF1A;_75" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_75"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_48"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_48" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_48"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_45"><a name="&#x793A;&#x4F8B;&#xFF1A;_45" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_45"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Thing<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   doc<span class="token punctuation">.</span><span class="token function">isSelected</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
   doc<span class="token punctuation">.</span><span class="token function">isSelected</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isSelected" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isSelected"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isSelected"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isSelected <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">isSelected</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>_id <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> paths <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">var</span> inclusive <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> cur<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> paths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// only _id was selected.</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cur <span class="token operator">=</span> paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDefiningProjection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      inclusive <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>inclusive <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> inclusive<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    i <span class="token operator">=</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">var</span> pathDot <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cur <span class="token operator">=</span> paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">===</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>pathDot<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> inclusive <span class="token operator">||</span> cur <span class="token operator">!==</span> pathDot<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>pathDot<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>cur <span class="token operator">+</span> <span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> inclusive<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">!</span>inclusive<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentmarkmodifiedpath-scope"><a name="documentmarkmodifiedpath-scope" class="anchor-navigation-ex-anchor" href="#documentmarkmodifiedpath-scope"><i class="fa fa-link" aria-hidden="true"></i></a>15.17. Document#markModified(path, [scope])</h2>
<p>Marks the path as having pending changes to write to the db.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_76"><a name="&#x53C2;&#x6570;&#xFF1A;_76" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_76"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the path to mark modified</p>
</li>
<li><p><code>[scope]</code> <document> the scope to run validators with</document></p>
</li>
</ul>
<p>Very helpful when using Mixed types.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_46"><a name="&#x793A;&#x4F8B;&#xFF1A;_46" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_46"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>mixed<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&apos;changed&apos;</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">markModified</span><span class="token punctuation">(</span><span class="token string">&apos;mixed.type&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// changes to mixed.type are now persisted</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_markModified" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_markModified"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_markModified"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>markModified <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> scope<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>scope <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>ownerDocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>pathsToScopes<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> scope<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentmodifiedpaths"><a name="documentmodifiedpaths" class="anchor-navigation-ex-anchor" href="#documentmodifiedpaths"><i class="fa fa-link" aria-hidden="true"></i></a>15.18. Document#modifiedPaths()</h2>
<p>Returns the list of paths that have been modified.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_49"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_49" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_49"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;
*<sec data-title="&#x6E90;&#x7801;" data-id="Document_modifiedPaths" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_modifiedPaths"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_modifiedPaths"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>modifiedPaths <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> directModifiedPaths <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span>states<span class="token punctuation">.</span>modify<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> directModifiedPaths<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> parts <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>chains<span class="token punctuation">,</span> part<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> chains<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>part<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&apos;.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
</li>
</ul>
<h2 id="documentpopulatepath-callback"><a name="documentpopulatepath-callback" class="anchor-navigation-ex-anchor" href="#documentpopulatepath-callback"><i class="fa fa-link" aria-hidden="true"></i></a>15.19. Document#populate([path], [callback])</h2>
<p>Populates document references, executing the callback when complete.
If you want to use promises instead, use this function with
execPopulate()</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_77"><a name="&#x53C2;&#x6570;&#xFF1A;_77" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_77"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> <string, object=""> The path to populate or an options object</string,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; When passed, population is invoked</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_50"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_50" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_50"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><document> this</document></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_23"><a name="&#x53C2;&#x89C1;&#xFF1A;_23" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_23"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.populate</a></p>
</li>
<li><p><a href="">Document.execPopulate</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_47"><a name="&#x793A;&#x4F8B;&#xFF1A;_47" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_47"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc
<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;company&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token string">&apos;notes&apos;</span><span class="token punctuation">,</span>
  match<span class="token punctuation">:</span> <span class="token regex">/airline/</span><span class="token punctuation">,</span>
  select<span class="token punctuation">:</span> <span class="token string">&apos;text&apos;</span><span class="token punctuation">,</span>
  model<span class="token punctuation">:</span> <span class="token string">&apos;modelName&apos;</span>
  options<span class="token punctuation">:</span> opts
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">assert</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>_id <span class="token operator">===</span> user<span class="token punctuation">.</span>_id<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// the document itself is passed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// summary</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>                   <span class="token comment" spellcheck="true">// not executed</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// not executed</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>         <span class="token comment" spellcheck="true">// executed</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// executed</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// executed</span>
doc<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execPopulate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executed, returns promise</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_16"><a name="&#x6CE8;&#x610F;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Population does not occur unless a callback is passed or you explicitly
call execPopulate().
Passing the same path a second time will overwrite the previous path options.
See <a href="">Model.populate()</a> for explaination of options.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_populate_" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_populate_"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_populate_"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>depopulate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> path<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> populatedIds <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>populatedIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> populatedIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentpopulatedpath"><a name="documentpopulatedpath" class="anchor-navigation-ex-anchor" href="#documentpopulatedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.20. Document#populated(path)</h2>
<p>Gets _id(s) used during population of the given path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_78"><a name="&#x53C2;&#x6570;&#xFF1A;_78" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_78"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_51"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_51" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_51"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><array, objectid,="" number,="" buffer,="" string,="" undefined="">

</array,></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_48"><a name="&#x793A;&#x4F8B;&#xFF1A;_48" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_48"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name<span class="token punctuation">)</span>         <span class="token comment" spellcheck="true">// Dr.Seuss</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">populated</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &apos;5144cf8050f071d979c118a7&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>If the path was not populated, undefined is returned.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_populated" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_populated"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_populated"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>populated <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// val and options are internal</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> val <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> undefined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// internal</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> undefined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>populated<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>value<span class="token punctuation">:</span> val<span class="token punctuation">,</span> options<span class="token punctuation">:</span> options<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="function-object--native-code-saveoptions-optionssafe-optionsvalidatebeforesave-fn"><a name="function-object--native-code-saveoptions-optionssafe-optionsvalidatebeforesave-fn" class="anchor-navigation-ex-anchor" href="#function-object--native-code-saveoptions-optionssafe-optionsvalidatebeforesave-fn"><i class="fa fa-link" aria-hidden="true"></i></a>15.21. function Object() { [native code] }#save([options], [options.safe], [options.validateBeforeSave], [fn])</h2>
<p>Saves this document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_79"><a name="&#x53C2;&#x6570;&#xFF1A;_79" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_79"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options optional options</p>
</li>
<li><p><code>[options.safe]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; overrides schema&apos;s safe option</p>
</li>
<li><p><code>[options.validateBeforeSave]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; set to false to save without validating.</p>
</li>
<li><p><code>[fn]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_52"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_52" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_52"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> Promise</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_24"><a name="&#x53C2;&#x89C1;&#xFF1A;_24" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_24"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="middleware.html">middleware</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_49"><a name="&#x793A;&#x4F8B;&#xFF1A;_49" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_49"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span>sold <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> product<span class="token punctuation">,</span> numAffected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>  *
The callback will receive three parameters</p>
<ul>
<li>err if an error occurred</li>
<li>product which is the saved product</li>
<li>numAffected will be 1 when the document was successfully persisted to MongoDB, otherwise 0. Unless you tweak mongoose&apos;s internals, you don&apos;t need to worry about checking this parameter for errors - checking err is sufficient to make sure your document was properly saved.</li>
</ul>
<p>As an extra measure of flow control, save will return a Promise.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_50"><a name="&#x793A;&#x4F8B;&#xFF1A;_50" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_50"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>For legacy reasons, mongoose stores object keys in reverse order on initial
save. That is, { a: 1, b: 2 } will be saved as { b: 2, a: 1 } in
MongoDB. To override this behavior, set
<a href="http://mongoosejs.com/docs/api.html#document_Document-toObject" target="_blank">the toObject.retainKeyOrder option</a>
to true on your schema.</p>
<h2 id="path-val-type-options"><a name="path-val-type-options" class="anchor-navigation-ex-anchor" href="#path-val-type-options"><i class="fa fa-link" aria-hidden="true"></i></a>15.22. (path, val, [type], [options])</h2>
<p>Sets the value of a path, or many paths.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_80"><a name="&#x53C2;&#x6570;&#xFF1A;_80" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_80"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> <string, object=""> path or object of key/vals to set</string,></p>
</li>
<li><p><code>val</code> &lt;<a href="#Any">Any</a>&gt; the value to set</p>
</li>
<li><p><code>[type]</code> <schema, string,="" number,="" buffer,="" *=""> optionally specify a type for &quot;on-the-fly&quot; attributes</schema,></p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optionally specify options that modify the behavior of the set</p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_51"><a name="&#x793A;&#x4F8B;&#xFF1A;_51" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_51"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// path, value</span>
doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// object</span>
doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path  <span class="token punctuation">:</span> value
  <span class="token punctuation">,</span> path2 <span class="token punctuation">:</span> <span class="token punctuation">{</span>
       path  <span class="token punctuation">:</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// on-the-fly cast to number</span>
doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> Number<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// on-the-fly cast to string</span>
doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> String<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// changing strict mode behavior</span>
doc<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">{</span> strict<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="8" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="8"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="8"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">=</span> Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documenttojsonoptions"><a name="documenttojsonoptions" class="anchor-navigation-ex-anchor" href="#documenttojsonoptions"><i class="fa fa-link" aria-hidden="true"></i></a>15.23. Document#toJSON(options)</h2>
<p>The return value of this method is used in calls to JSON.stringify(doc).</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_81"><a name="&#x53C2;&#x6570;&#xFF1A;_81" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_81"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_53"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_53" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_53"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_25"><a name="&#x53C2;&#x89C1;&#xFF1A;_25" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_25"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Document#toObject</a></li>
</ul>
<p>This method accepts the same options as <a href="">Document#toObject</a>. To apply the options to every document of your schema by default, set your <a href="">schemas</a> toJSON option to the same argument.</p>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;toJSON&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> virtuals<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>See <a href="guide.html#toJSON">schema options</a> for details.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_toJSON" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_toJSON"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_toJSON"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toJSON <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toObject</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documenttoobjectoptions"><a name="documenttoobjectoptions" class="anchor-navigation-ex-anchor" href="#documenttoobjectoptions"><i class="fa fa-link" aria-hidden="true"></i></a>15.24. Document#toObject([options])</h2>
<p>Converts this document into a plain javascript object, ready for storage in MongoDB.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_82"><a name="&#x53C2;&#x6570;&#xFF1A;_82" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_82"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_54"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_54" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_54"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; js object</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_26"><a name="&#x53C2;&#x89C1;&#xFF1A;_26" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_26"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongodb.github.com/node-mongodb-native/api-bson-generated/binary.html" target="_blank">mongodb.Binary</a></li>
</ul>
<p>Buffers are converted to instances of <a href="http://mongodb.github.com/node-mongodb-native/api-bson-generated/binary.html" target="_blank">mongodb.Binary</a> for proper storage.</p>
<h5 id="&#x9009;&#x9879;&#xFF1A;"><a name="&#x9009;&#x9879;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;&#xFF1A;</h5>
<ul>
<li><code>getters</code> apply all getters (path and virtual getters)</li>
<li><code>virtuals</code> apply virtual getters (can override getters option)</li>
<li><code>minimize</code> remove empty objects (defaults to true)</li>
<li><code>transform</code> a transform function to apply to the resulting document before returning</li>
<li><code>depopulate</code> depopulate any populated paths, replacing them with their original refs (defaults to false)</li>
<li><code>versionKey</code> whether to include the version key (defaults to true)</li>
<li><code>retainKeyOrder</code> keep the order of object keys. If this is set to true, Object.keys(new Doc({ a: 1, b: 2}).toObject()) will always produce [&apos;a&apos;, &apos;b&apos;] (defaults to false)</li>
</ul>
<h5 id="gettersvirtuals"><a name="gettersvirtuals" class="anchor-navigation-ex-anchor" href="#gettersvirtuals"><i class="fa fa-link" aria-hidden="true"></i></a><a name="gettersvirtuals" class="plugin-anchor" href="#gettersvirtuals"><i class="fa fa-link" aria-hidden="true"></i></a>Getters/Virtuals</h5>
<p>Example of only applying path getters</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getters<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> virtuals<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Example of only applying virtual getters</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> virtuals<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Example of applying both path and virtual getters</p>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> getters<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>To apply these options to every document of your schema by default, set your schemas toObject option to the same argument.</p>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;toObject&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> virtuals<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="transform"><a name="transform" class="anchor-navigation-ex-anchor" href="#transform"><i class="fa fa-link" aria-hidden="true"></i></a><a name="transform" class="plugin-anchor" href="#transform"><i class="fa fa-link" aria-hidden="true"></i></a>Transform</h5>
<p>We may need to perform a transformation of the resulting object based on some criteria, say to remove some sensitive information or return a custom object. In this case we set the optional transform function.</p>
<p>Transform functions receive three arguments</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<ul>
<li>doc The mongoose document which is being converted</li>
<li>ret The plain object representation which has been converted</li>
<li>options The options in use (either schema options or the options passed inline)</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_52"><a name="&#x793A;&#x4F8B;&#xFF1A;_52" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_52"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// specify the transform schema option</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">)</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// remove the _id of every document before returning the result</span>
  <span class="token keyword">delete</span> ret<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// without the transformation in the schema</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { _id: &apos;anId&apos;, name: &apos;Wreck-it Ralph&apos; }</span>

<span class="token comment" spellcheck="true">// with the transformation</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { name: &apos;Wreck-it Ralph&apos; }</span>
</code></pre>
<p>With transformations we can do a lot more than remove properties. We can even return completely new customized objects:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">)</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> movie<span class="token punctuation">:</span> ret<span class="token punctuation">.</span>name <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// without the transformation in the schema</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { _id: &apos;anId&apos;, name: &apos;Wreck-it Ralph&apos; }</span>

<span class="token comment" spellcheck="true">// with the transformation</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { movie: &apos;Wreck-it Ralph&apos; }</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_17"><a name="&#x6CE8;&#x610F;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>if a transform function returns undefined, the return value will be ignored.</em></p>
<p>Transformations may also be applied inline, overridding any transform set in the options:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> xform <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> inline<span class="token punctuation">:</span> ret<span class="token punctuation">.</span>name<span class="token punctuation">,</span> custom<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// pass the transform as an inline option</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token punctuation">:</span> xform <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { inline: &apos;Wreck-it Ralph&apos;, custom: true }</span>
</code></pre>
<p>If you want to skip transformations, use transform: false:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">)</span> schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">.</span>hide <span class="token operator">=</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>toObject<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>hide<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>hide<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> ret<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Doc</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token string">&apos;anId&apos;</span><span class="token punctuation">,</span> secret<span class="token punctuation">:</span> <span class="token number">47</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Wreck-it Ralph&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token comment" spellcheck="true">// { secret: 47, name: &apos;Wreck-it Ralph&apos; }</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hide<span class="token punctuation">:</span> <span class="token string">&apos;secret _id&apos;</span><span class="token punctuation">,</span> transform<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// { _id: &apos;anId&apos;, secret: 47, name: &apos;Wreck-it Ralph&apos; }</span>
doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hide<span class="token punctuation">:</span> <span class="token string">&apos;secret _id&apos;</span><span class="token punctuation">,</span> transform<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { name: &apos;Wreck-it Ralph&apos; }</span>
</code></pre>
<p>Transforms are applied only to the document and are not applied to sub-documents.</p>
<p>Transforms, like all of these options, are also available for toJSON.</p>
<p>See <a href="guide.html#toObject">schema options</a> for some more details.</p>
<p>During save, no custom options are applied to the document before being sent to the database.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_toObject" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_toObject"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_toObject"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toObject <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$toObject</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documenttostring"><a name="documenttostring" class="anchor-navigation-ex-anchor" href="#documenttostring"><i class="fa fa-link" aria-hidden="true"></i></a>15.25. Document#toString()</h2>
<p>Helper for console.log</p>
<h2 id="documentunmarkmodifiedpath"><a name="documentunmarkmodifiedpath" class="anchor-navigation-ex-anchor" href="#documentunmarkmodifiedpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.26. Document#unmarkModified(path)</h2>
<p>Clears the modified state on the specified path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_83"><a name="&#x53C2;&#x6570;&#xFF1A;_83" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_83"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the path to unmark modified</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_53"><a name="&#x793A;&#x4F8B;&#xFF1A;_53" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_53"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&apos;bar&apos;</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">unmarkModified</span><span class="token punctuation">(</span><span class="token string">&apos;foo&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// changes to foo will not be persisted</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_unmarkModified" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_unmarkModified"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_unmarkModified"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>unmarkModified <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>activePaths<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>pathsToScopes<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentupdatedoc-options-callback"><a name="documentupdatedoc-options-callback" class="anchor-navigation-ex-anchor" href="#documentupdatedoc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>15.27. Document#update(doc, options, callback)</h2>
<p>Sends an update command with this document _id as the query selector.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_84"><a name="&#x53C2;&#x6570;&#xFF1A;_84" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_84"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_55"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_55" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_55"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_27"><a name="&#x53C2;&#x89C1;&#xFF1A;_27" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_27"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Model.update</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_54"><a name="&#x793A;&#x4F8B;&#xFF1A;_54" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_54"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">weirdCar<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$inc<span class="token punctuation">:</span> <span class="token punctuation">{</span>wheels<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> w<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
Valid options<span class="token punctuation">:</span>
same <span class="token keyword">as</span> <span class="token keyword">in</span> Model<span class="token punctuation">.</span>update
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_update" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_update"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_update"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>update<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentvalidateoptional-callback"><a name="documentvalidateoptional-callback" class="anchor-navigation-ex-anchor" href="#documentvalidateoptional-callback"><i class="fa fa-link" aria-hidden="true"></i></a>15.28. Document#validate(optional, callback)</h2>
<p>Executes registered validation rules for this document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_85"><a name="&#x53C2;&#x6570;&#xFF1A;_85" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_85"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>optional</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options internal options</p>
</li>
<li><p><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback called after validation completes, passing an error if one occurred</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_56"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_56" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_56"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> Promise</promise></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_18"><a name="&#x6CE8;&#x610F;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>This method is called pre save and if a validation rule is violated, save is aborted and the error is returned to your callback.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_55"><a name="&#x793A;&#x4F8B;&#xFF1A;_55" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_55"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">doc<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token comment" spellcheck="true">// validation passed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_validate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_validate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_validate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>validate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__validate</span><span class="token punctuation">(</span>callback <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentvalidatesyncpathstovalidate"><a name="documentvalidatesyncpathstovalidate" class="anchor-navigation-ex-anchor" href="#documentvalidatesyncpathstovalidate"><i class="fa fa-link" aria-hidden="true"></i></a>15.29. Document#validateSync(pathsToValidate)</h2>
<p>Executes registered validation rules (skipping asynchronous validators) for this document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_86"><a name="&#x53C2;&#x6570;&#xFF1A;_86" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_86"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>pathsToValidate</code> <array, string=""> only validate the given paths</array,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_57"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_57" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_57"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><mongooseerror, undefined=""> MongooseError if there are errors during validation, or undefined if there is no error.</mongooseerror,></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_19"><a name="&#x6CE8;&#x610F;&#xFF1A;_19" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_19"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>This method is useful if you need synchronous validation.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_56"><a name="&#x793A;&#x4F8B;&#xFF1A;_56" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_56"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> err <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">validateSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">handleError</span><span class="token punctuation">(</span> err <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// validation passed</span>
<span class="token punctuation">}</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_validateSync" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_validateSync"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_validateSync"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>validateSync <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>pathsToValidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pathsToValidate <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pathsToValidate <span class="token operator">=</span> pathsToValidate<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&apos; &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// only validate required fields when necessary</span>
  <span class="token keyword">var</span> paths <span class="token operator">=</span> <span class="token function">_getPathsToValidate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathsToValidate <span class="token operator">&amp;&amp;</span> pathsToValidate<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>pathsToValidate<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paths<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    paths <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> validating <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  paths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>validating<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    validating<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> p <span class="token operator">=</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_this<span class="token punctuation">.</span><span class="token function">$isValid</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> val <span class="token operator">=</span> _this<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">doValidateSync</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _this<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> err<span class="token punctuation">,</span> undefined<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> err <span class="token operator">=</span> _this<span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError<span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span>$__<span class="token punctuation">.</span>validationError <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;validate&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;validate&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Make sure cast errors persist</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>errors<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">MongooseError<span class="token punctuation">.</span>CastError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _this<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> err<span class="token punctuation">.</span>errors<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentmarkvalidpath"><a name="documentmarkvalidpath" class="anchor-navigation-ex-anchor" href="#documentmarkvalidpath"><i class="fa fa-link" aria-hidden="true"></i></a>15.30. Document.$markValid(path)</h2>
<p>Marks a path as valid, removing existing validation errors.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_87"><a name="&#x53C2;&#x6570;&#xFF1A;_87" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_87"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>path &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the field to mark as valid</li>
</ul>
<h2 id="documenterrors"><a name="documenterrors" class="anchor-navigation-ex-anchor" href="#documenterrors"><i class="fa fa-link" aria-hidden="true"></i></a>15.31. Document#errors</h2>
<p>Hash containing current validation errors.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_errors" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_errors"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_errors"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>errors<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentid"><a name="documentid" class="anchor-navigation-ex-anchor" href="#documentid"><i class="fa fa-link" aria-hidden="true"></i></a>15.32. Document#id</h2>
<p>The string version of this documents _id.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_20"><a name="&#x6CE8;&#x610F;&#xFF1A;_20" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_20"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>This getter exists on all documents by default. The getter can be disabled by setting the id <a href="http://mongoosejs.com/docs/guide.html#id" target="_blank">option</a> of its Schema to false at construction time.</p>
<p>new Schema({ name: String }, { id: false });
<sec data-title="&#x6E90;&#x7801;" data-id="Document_id" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_id"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_id"><div class="panel-body"></div></div></div></sec></p>
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>

<h5 id="&#x53C2;&#x89C1;&#xFF1A;_28"><a name="&#x53C2;&#x89C1;&#xFF1A;_28" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_28"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="guide.html#options">Schema options</a></li>
</ul>
<h2 id="documentisnew"><a name="documentisnew" class="anchor-navigation-ex-anchor" href="#documentisnew"><i class="fa fa-link" aria-hidden="true"></i></a>15.33. Document#isNew</h2>
<p>Boolean flag specifying if the document is new.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_isNew" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_isNew"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_isNew"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isNew<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentschema"><a name="documentschema" class="anchor-navigation-ex-anchor" href="#documentschema"><i class="fa fa-link" aria-hidden="true"></i></a>15.34. Document#schema</h2>
<p>The documents schema.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Document_schema" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Document_schema"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Document_schema"><div class="panel-body">
<pre class="language-"><code class="lang-js">Document<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>schema<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="queryjs"><a name="queryjs" class="anchor-navigation-ex-anchor" href="#queryjs"><i class="fa fa-link" aria-hidden="true"></i></a>16. query.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/query.js" target="_blank">query.js</a></p>
</blockquote>
<h2 id="querywherejs"><a name="querywherejs" class="anchor-navigation-ex-anchor" href="#querywherejs"><i class="fa fa-link" aria-hidden="true"></i></a>16.1. Query#$where(js)</h2>
<p>Specifies a javascript function or expression to pass to MongoDBs query system.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_88"><a name="&#x53C2;&#x6570;&#xFF1A;_88" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_88"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>js</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;javascript string or function</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_58"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_58" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_58"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_29"><a name="&#x53C2;&#x89C1;&#xFF1A;_29" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_29"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/where/" target="_blank">$where</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_57"><a name="&#x793A;&#x4F8B;&#xFF1A;_57" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_57"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">$where</span><span class="token punctuation">(</span><span class="token string">&apos;this.comments.length === 10 || this.name.length === 5&apos;</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or</span>

query<span class="token punctuation">.</span><span class="token function">$where</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>comments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">10</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_21"><a name="&#x6CE8;&#x610F;&#xFF1A;_21" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_21"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Only use $where when you have a condition that cannot be met using other MongoDB operators like $lt.
<strong>Be sure to read about all of <a href="http://docs.mongodb.org/manual/reference/operator/where/" target="_blank">its caveats</a> before using.</strong></p>
<h2 id="queryallpath-val"><a name="queryallpath-val" class="anchor-navigation-ex-anchor" href="#queryallpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.2. Query#all([path], val)</h2>
<p>Specifies an $all query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_89"><a name="&#x53C2;&#x6570;&#xFF1A;_89" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_89"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_30"><a name="&#x53C2;&#x89C1;&#xFF1A;_30" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_30"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/all/" target="_blank">$all</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="queryandarray"><a name="queryandarray" class="anchor-navigation-ex-anchor" href="#queryandarray"><i class="fa fa-link" aria-hidden="true"></i></a>16.3. Query#and(array)</h2>
<p>Specifies arguments for a $and condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_90"><a name="&#x53C2;&#x6570;&#xFF1A;_90" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_90"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>array</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; array of conditions</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_59"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_59" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_59"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_31"><a name="&#x53C2;&#x89C1;&#xFF1A;_31" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_31"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/and/" target="_blank">$and</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_58"><a name="&#x793A;&#x4F8B;&#xFF1A;_58" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_58"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;green&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> <span class="token string">&apos;ok&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querybatchsizeval"><a name="querybatchsizeval" class="anchor-navigation-ex-anchor" href="#querybatchsizeval"><i class="fa fa-link" aria-hidden="true"></i></a>16.4. Query#batchSize(val)</h2>
<p>Specifies the batchSize option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_91"><a name="&#x53C2;&#x6570;&#xFF1A;_91" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_91"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> <number></number></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_32"><a name="&#x53C2;&#x89C1;&#xFF1A;_32" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_32"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/method/cursor.batchSize/" target="_blank">batchSize</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_59"><a name="&#x793A;&#x4F8B;&#xFF1A;_59" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_59"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">batchSize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_22"><a name="&#x6CE8;&#x610F;&#xFF1A;_22" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_22"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="queryboxval-upper"><a name="queryboxval-upper" class="anchor-navigation-ex-anchor" href="#queryboxval-upper"><i class="fa fa-link" aria-hidden="true"></i></a>16.5. Query#box(val, Upper)</h2>
<p>Specifies a $box condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_92"><a name="&#x53C2;&#x6570;&#xFF1A;_92" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_92"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>Upper</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; Right Coords</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_60"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_60" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_60"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_33"><a name="&#x53C2;&#x89C1;&#xFF1A;_33" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_33"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/box/" target="_blank">$box</a></p>
</li>
<li><p><a href="http://mongoosejs.com/docs/api.html#query_Query-within" target="_blank">within() Query#within</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_60"><a name="&#x793A;&#x4F8B;&#xFF1A;_60" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_60"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> lowerLeft <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">40.73083</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">73.99756</span><span class="token punctuation">]</span>
<span class="token keyword">var</span> upperRight<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">40.741404</span><span class="token punctuation">,</span>  <span class="token operator">-</span><span class="token number">73.988135</span><span class="token punctuation">]</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">box</span><span class="token punctuation">(</span>lowerLeft<span class="token punctuation">,</span> upperRight<span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">box</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ll <span class="token punctuation">:</span> lowerLeft<span class="token punctuation">,</span> ur <span class="token punctuation">:</span> upperRight <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querycastmodel-obj"><a name="querycastmodel-obj" class="anchor-navigation-ex-anchor" href="#querycastmodel-obj"><i class="fa fa-link" aria-hidden="true"></i></a>16.6. Query#cast(model, [obj])</h2>
<p>Casts this query to the schema of model</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_93"><a name="&#x53C2;&#x6570;&#xFF1A;_93" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_93"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>model</code> <model></model></p>
</li>
<li><p><code>[obj]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_61"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_61" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_61"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_23"><a name="&#x6CE8;&#x610F;&#xFF1A;_23" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_23"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>If obj is present, it is cast instead of this query.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_cast" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_cast"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_cast"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>cast <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj <span class="token operator">||</span> <span class="token punctuation">(</span>obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">cast</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      upsert<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>upsert<span class="token punctuation">,</span>
      strict<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> <span class="token string">&apos;strict&apos;</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>strict <span class="token punctuation">:</span>
        <span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>strict<span class="token punctuation">)</span><span class="token punctuation">,</span>
      strictQuery<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>strictQuery<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>strictQuery<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// CastError, assign model</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> err<span class="token punctuation">.</span>setModel <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      err<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querycatchreject"><a name="querycatchreject" class="anchor-navigation-ex-anchor" href="#querycatchreject"><i class="fa fa-link" aria-hidden="true"></i></a>16.7. Query#catch([reject])</h2>
<p>Executes the query returning a Promise which will be
resolved with either the doc(s) or rejected with the error.
Like .then(), but only takes a rejection handler.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_94"><a name="&#x53C2;&#x6570;&#xFF1A;_94" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_94"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>[reject] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_62"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_62" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_62"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_catch" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_catch"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_catch"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">catch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querycenter"><a name="querycenter" class="anchor-navigation-ex-anchor" href="#querycenter"><i class="fa fa-link" aria-hidden="true"></i></a>16.8. Query#center()</h2>
<p>DEPRECATED Alias for <a href="">circle</a></p>
<p><strong>Deprecated.</strong> Use <a href="">circle</a> instead.</p>
<h2 id="querycenterspherepath-val"><a name="querycenterspherepath-val" class="anchor-navigation-ex-anchor" href="#querycenterspherepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.9. Query#centerSphere([path], val)</h2>
<p>DEPRECATED Specifies a $centerSphere condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_95"><a name="&#x53C2;&#x6570;&#xFF1A;_95" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_95"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<pre class="language-"><code>* `[path]` <span class="token entity" title="&lt;">&amp;lt;</span>[String][]<span class="token entity" title="&gt;">&amp;gt;</span>

* `val` <span class="token entity" title="&lt;">&amp;lt;</span>[Object][]<span class="token entity" title="&gt;">&amp;gt;</span>
</code></pre><h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_63"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_63" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_63"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<pre class="language-"><code>* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Query</span><span class="token punctuation">&gt;</span></span> this
</code></pre><h5 id="&#x53C2;&#x89C1;&#xFF1A;_34"><a name="&#x53C2;&#x89C1;&#xFF1A;_34" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_34"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<pre class="language-"><code>* http://www.mongodb.org/display/DOCS/Geospatial+Indexing

* [$centerSphere](http://docs.mongodb.org/manual/reference/operator/centerSphere/)
</code></pre><p><strong>Deprecated.</strong> Use <a href="">circle</a> instead.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_61"><a name="&#x793A;&#x4F8B;&#xFF1A;_61" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_61"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code>var area = { center: [50, 50], radius: 10 };
query.where(&apos;loc&apos;).within().centerSphere(area);
</code></pre><sec data-title="&#x6E90;&#x7801;" data-id="Query_centerSphere" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_centerSphere"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_centerSphere"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> area <span class="token operator">=</span> <span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">centerSphere</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querycirclepath-area"><a name="querycirclepath-area" class="anchor-navigation-ex-anchor" href="#querycirclepath-area"><i class="fa fa-link" aria-hidden="true"></i></a>16.10. Query#circle([path], area)</h2>
<p>Specifies a $center or $centerSphere condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_96"><a name="&#x53C2;&#x6570;&#xFF1A;_96" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_96"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>area</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_64"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_64" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_64"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_35"><a name="&#x53C2;&#x89C1;&#xFF1A;_35" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_35"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/center/" target="_blank">$center</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/centerSphere/" target="_blank">$centerSphere</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/geoWithin/" target="_blank">$geoWithin</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_62"><a name="&#x793A;&#x4F8B;&#xFF1A;_62" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_62"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> area <span class="token operator">=</span> <span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// alternatively</span>
query<span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// spherical calculations</span>
<span class="token keyword">var</span> area <span class="token operator">=</span> <span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> spherical<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// alternatively</span>
query<span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>New in 3.7.0</p>
<h2 id="querycollationvalue"><a name="querycollationvalue" class="anchor-navigation-ex-anchor" href="#querycollationvalue"><i class="fa fa-link" aria-hidden="true"></i></a>16.11. Query#collation(value)</h2>
<p>Adds a <a href="../../../GLOSSARY.html#collation" class="glossary-term" title="wiki">collation</a> to this op (MongoDB 3.4 and up)</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_97"><a name="&#x53C2;&#x6570;&#xFF1A;_97" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_97"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_65"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_65" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_65"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_36"><a name="&#x53C2;&#x89C1;&#xFF1A;_36" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_36"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/cursor.collation/#cursor.collation" target="_blank">MongoDB</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_collation" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_collation"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_collation"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collation <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querycommentval"><a name="querycommentval" class="anchor-navigation-ex-anchor" href="#querycommentval"><i class="fa fa-link" aria-hidden="true"></i></a>16.12. Query#comment(val)</h2>
<p>Specifies the comment option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_98"><a name="&#x53C2;&#x6570;&#xFF1A;_98" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_98"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> <number></number></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_37"><a name="&#x53C2;&#x89C1;&#xFF1A;_37" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_37"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/comment/" target="_blank">comment</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_63"><a name="&#x793A;&#x4F8B;&#xFF1A;_63" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_63"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span><span class="token string">&apos;login query&apos;</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_24"><a name="&#x6CE8;&#x610F;&#xFF1A;_24" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_24"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="querycountcriteria-callback"><a name="querycountcriteria-callback" class="anchor-navigation-ex-anchor" href="#querycountcriteria-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.13. Query#count([criteria], [callback])</h2>
<p>Specifying this query as a count query.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_99"><a name="&#x53C2;&#x6570;&#xFF1A;_99" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_99"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[criteria]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; mongodb selector</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, count)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_66"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_66" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_66"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_38"><a name="&#x53C2;&#x89C1;&#xFF1A;_38" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_38"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/method/db.collection.count/" target="_blank">count</a></li>
</ul>
<p>Passing a callback executes the query.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>count()</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_64"><a name="&#x793A;&#x4F8B;&#xFF1A;_64" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_64"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> countQuery <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&apos;color&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;black&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

query<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;black&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;black&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;color&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;black&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;there are %d kittens&apos;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_count" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_count"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_count"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>mquery<span class="token punctuation">.</span><span class="token function">canMerge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>op <span class="token operator">=</span> <span class="token string">&apos;count&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_count</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querycursoroptions"><a name="querycursoroptions" class="anchor-navigation-ex-anchor" href="#querycursoroptions"><i class="fa fa-link" aria-hidden="true"></i></a>16.14. Query#cursor([options])</h2>
<p>Returns a wrapper around a <a href="http://mongodb.github.io/node-mongodb-native/2.1/api/Cursor.html" target="_blank">mongodb driver cursor</a>.
A QueryCursor exposes a <a href="https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/" target="_blank">Streams3</a>-compatible
interface, as well as a .next() function.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_100"><a name="&#x53C2;&#x6570;&#xFF1A;_100" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_100"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_67"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_67" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_67"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><querycursor>

</querycursor></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_39"><a name="&#x53C2;&#x89C1;&#xFF1A;_39" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_39"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">QueryCursor</a></li>
</ul>
<p>The <code>.cursor()</code> function triggers pre find hooks, but not post find hooks.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_65"><a name="&#x793A;&#x4F8B;&#xFF1A;_65" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_65"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// There are 2 ways to use a cursor. First, as a stream:</span>
Thing<span class="token punctuation">.</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;end&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Done!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Or you can use `.next()` to manually get the next doc in the stream.</span>
<span class="token comment" spellcheck="true">// `.next()` returns a promise, so you can use promises or callbacks.</span>
<span class="token keyword">var</span> cursor <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Because `.next()` returns a promise, you can use co</span>
<span class="token comment" spellcheck="true">// to easily iterate through all documents without loading them</span>
<span class="token comment" spellcheck="true">// all into memory.</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cursor <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> doc <span class="token operator">=</span> <span class="token keyword">yield</span> cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> doc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> doc <span class="token operator">=</span> <span class="token keyword">yield</span> cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;"><a name="&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x7684;&#x9009;&#x9879;&#xFF1A;</h5>
<ul>
<li><code>transform</code>: optional function which accepts a mongoose document. The return value of the function will be emitted on data and returned by .next().</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_cursor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_cursor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_cursor"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">cursor</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_applyPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_fields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_castFields</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> fields<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_fieldsForExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryCursor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_markError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryCursor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// the rest of these are basically to support older Mongoose syntax with mquery</span>
</code></pre>
</div></div></div></sec>
<h2 id="querydeletemanyfilter-callback"><a name="querydeletemanyfilter-callback" class="anchor-navigation-ex-anchor" href="#querydeletemanyfilter-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.15. Query#deleteMany([filter], [callback])</h2>
<p>Declare and/or execute this query as a deleteMany() operation. Works like
remove, except it deletes every document that matches criteria in the
collection, regardless of the value of single.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_101"><a name="&#x53C2;&#x6570;&#xFF1A;_101" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_101"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[filter]</code> <object, query=""> mongodb selector</object,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_68"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_68" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_68"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_40"><a name="&#x53C2;&#x89C1;&#xFF1A;_40" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_40"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.remove/" target="_blank">remove</a></p>
</li>
</ul>
<p>This function does not trigger any middleware</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_66"><a name="&#x793A;&#x4F8B;&#xFF1A;_66" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_66"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/Stark/</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
Character<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/Stark/</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_deleteMany" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_deleteMany"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_deleteMany"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>deleteMany <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> filter <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> filter<span class="token punctuation">;</span>
    filter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  filter <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">prepareDiscriminatorCriteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>deleteMany<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_deleteMany<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querydeleteonefilter-callback"><a name="querydeleteonefilter-callback" class="anchor-navigation-ex-anchor" href="#querydeleteonefilter-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.16. Query#deleteOne([filter], [callback])</h2>
<p>Declare and/or execute this query as a deleteOne() operation. Works like
remove, except it deletes at most one document regardless of the single
option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_102"><a name="&#x53C2;&#x6570;&#xFF1A;_102" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_102"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[filter]</code> <object, query=""> mongodb selector</object,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_69"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_69" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_69"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_41"><a name="&#x53C2;&#x89C1;&#xFF1A;_41" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_41"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.remove/" target="_blank">remove</a></p>
</li>
</ul>
<p>This function does not trigger any middleware.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_67"><a name="&#x793A;&#x4F8B;&#xFF1A;_67" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_67"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
Character<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_deleteOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_deleteOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_deleteOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>deleteOne <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> filter <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> filter<span class="token punctuation">;</span>
    filter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  filter <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">prepareDiscriminatorCriteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>deleteOne<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_deleteOne<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querydistinctfield-criteria-callback"><a name="querydistinctfield-criteria-callback" class="anchor-navigation-ex-anchor" href="#querydistinctfield-criteria-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.17. Query#distinct([field], [criteria], [callback])</h2>
<p>Declares or executes a distict() operation.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_103"><a name="&#x53C2;&#x6570;&#xFF1A;_103" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_103"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[field]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>[criteria]</code> <object, query=""></object,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, arr)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_70"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_70" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_70"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_42"><a name="&#x53C2;&#x89C1;&#xFF1A;_42" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_42"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/method/db.collection.distinct/" target="_blank">distinct</a></li>
</ul>
<p>Passing a <code>callback</code> executes the query.</p>
<p>This function does not trigger any middleware.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_68"><a name="&#x793A;&#x4F8B;&#xFF1A;_68" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_68"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> conditions<span class="token punctuation">)</span>
<span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span>
<span class="token function">distinct</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
<span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_distinct" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_distinct"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_distinct"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>distinct <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
      conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> field <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">=</span> field<span class="token punctuation">;</span>
      field <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
      conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  conditions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>mquery<span class="token punctuation">.</span><span class="token function">canMerge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>distinct<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> field<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryelemmatchpath-criteria"><a name="queryelemmatchpath-criteria" class="anchor-navigation-ex-anchor" href="#queryelemmatchpath-criteria"><i class="fa fa-link" aria-hidden="true"></i></a>16.18. Query#elemMatch(path, criteria)</h2>
<p>Specifies an $elemMatch condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_104"><a name="&#x53C2;&#x6570;&#xFF1A;_104" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_104"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> <string, object,="" function=""></string,></p>
</li>
<li><p><code>criteria</code> <object, function=""></object,></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_71"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_71" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_71"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_43"><a name="&#x53C2;&#x89C1;&#xFF1A;_43" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_43"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/elemMatch/" target="_blank">$elemMatch</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_69"><a name="&#x793A;&#x4F8B;&#xFF1A;_69" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_69"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">elemMatch</span><span class="token punctuation">(</span><span class="token string">&apos;comment&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> author<span class="token punctuation">:</span> <span class="token string">&apos;autobot&apos;</span><span class="token punctuation">,</span> votes<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gte<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;comment&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">elemMatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token punctuation">:</span> <span class="token string">&apos;autobot&apos;</span><span class="token punctuation">,</span> votes<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gte<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">elemMatch</span><span class="token punctuation">(</span><span class="token string">&apos;comment&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;author&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&apos;autobot&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;votes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;comment&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">elemMatch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token punctuation">:</span> <span class="token string">&apos;autobot&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;votes&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryequalsval"><a name="queryequalsval" class="anchor-navigation-ex-anchor" href="#queryequalsval"><i class="fa fa-link" aria-hidden="true"></i></a>16.19. Query#equals(val)</h2>
<p>Specifies the complementary comparison value for paths specified with where()</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_105"><a name="&#x53C2;&#x6570;&#xFF1A;_105" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_105"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_72"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_72" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_72"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_70"><a name="&#x793A;&#x4F8B;&#xFF1A;_70" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_70"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">User<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">// is the same as</span>

User<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="queryerrorerr"><a name="queryerrorerr" class="anchor-navigation-ex-anchor" href="#queryerrorerr"><i class="fa fa-link" aria-hidden="true"></i></a>16.20. Query#error(err)</h2>
<p>Gets/sets the error flag on this query. If this flag is not null or
undefined, the <code>exec()</code> promise will reject without executing.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_106"><a name="&#x53C2;&#x6570;&#xFF1A;_106" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_106"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>err</code> <error, null=""> if set, exec() will fail fast before sending the query to MongoDB</error,></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_71"><a name="&#x793A;&#x4F8B;&#xFF1A;_71" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_71"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Get current error value</span>
<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Unset the current error</span>
<span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;test&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// `exec()` will resolve with test</span>
Schema<span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">&apos;find&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Not allowed to query without setting userId&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Note that query casting runs <strong>after</strong> hooks, so cast errors will override
custom errors.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_72"><a name="&#x793A;&#x4F8B;&#xFF1A;_72" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_72"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> TestSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> num<span class="token punctuation">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> TestModel <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Test&apos;</span><span class="token punctuation">,</span> TestSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
TestModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> num<span class="token punctuation">:</span> <span class="token string">&apos;not a number&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;woops&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// `error` will be a cast error because `num` failed to cast</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_error" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_error"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_error"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_error <span class="token operator">=</span> err<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryexecoperation-callback"><a name="queryexecoperation-callback" class="anchor-navigation-ex-anchor" href="#queryexecoperation-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.21. Query#exec([operation], [callback])</h2>
<p>&#x6267;&#x884C;&#x67E5;&#x8BE2;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_107"><a name="&#x53C2;&#x6570;&#xFF1A;_107" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_107"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[operation]</code> <string, function=""></string,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params depend on the function being called</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_73"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_73" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_73"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
  <promise>

<h5 id="&#x793A;&#x4F8B;&#xFF1A;_73"><a name="&#x793A;&#x4F8B;&#xFF1A;_73" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_73"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> promise <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&apos;find&apos;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_exec" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_exec"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_exec"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>exec <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">exec</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> op <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> op<span class="token punctuation">;</span>
    op <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> op <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>op <span class="token operator">=</span> op<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _results<span class="token punctuation">;</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_this<span class="token punctuation">.</span>op<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _this<span class="token punctuation">[</span>_this<span class="token punctuation">.</span>op<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      _results <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
      <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> _results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
      <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// If we made it here, we must have an error in the callback re:</span>
        <span class="token comment" spellcheck="true">// gh-4500, so we need to emit.</span>
        <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _this<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryexistspath-val"><a name="queryexistspath-val" class="anchor-navigation-ex-anchor" href="#queryexistspath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.22. Query#exists([path], val)</h2>
<p>Specifies an $exists condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_108"><a name="&#x53C2;&#x6570;&#xFF1A;_108" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_108"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_74"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_74" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_74"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_44"><a name="&#x53C2;&#x89C1;&#xFF1A;_44" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_44"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/exists/" target="_blank">$exists</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_74"><a name="&#x793A;&#x4F8B;&#xFF1A;_74" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_74"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">
<span class="token comment" spellcheck="true">// { name: { $exists: true }}</span>
Thing<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Thing<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// { name: { $exists: false }}</span>
Thing<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="queryfindfilter-callback"><a name="queryfindfilter-callback" class="anchor-navigation-ex-anchor" href="#queryfindfilter-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.23. Query#find([filter], [callback])</h2>
<p>&#x67E5;&#x627E;&#x6587;&#x6863;</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_109"><a name="&#x53C2;&#x6570;&#xFF1A;_109" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_109"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>[filter] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; mongodb selector</p>
</li>
<li><p>[callback] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_75"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_75" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_75"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<p>  <query> this</query></p>
<p>When no callback is passed, the query is not executed. When the query is executed, the result will be an array of documents.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_75"><a name="&#x793A;&#x4F8B;&#xFF1A;_75" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_75"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Los Pollos Hermanos&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_find" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_find"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_find"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>find <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  conditions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>mquery<span class="token punctuation">.</span><span class="token function">canMerge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">prepareDiscriminatorCriteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>conditions <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObjectParameterError</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> <span class="token string">&apos;filter&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;find&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// if we don&apos;t have a callback, then just return the query object</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>find<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_find</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryfindonefilter-projection-options-callback"><a name="queryfindonefilter-projection-options-callback" class="anchor-navigation-ex-anchor" href="#queryfindonefilter-projection-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.24. Query#findOne([filter], [projection], [options], [callback])</h2>
<p>Declares the query a findOne operation. When executed, the first found document is passed to the callback.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_110"><a name="&#x53C2;&#x6570;&#xFF1A;_110" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_110"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[filter]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; mongodb selector</p>
</li>
<li><p><code>[projection]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional fields to return</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; see setOptions()</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, document)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_76"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_76" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_76"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_45"><a name="&#x53C2;&#x89C1;&#xFF1A;_45" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_45"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.findOne/" target="_blank">findOne</a></p>
</li>
<li><p><a href="">Query.select</a></p>
</li>
</ul>
<p>Passing a callback executes the query. The result of the query is a single document.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_25"><a name="&#x6CE8;&#x610F;&#xFF1A;_25" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_25"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>conditions is optional, and if conditions is null or undefined, mongoose will send an empty findOne command to MongoDB, which will return an arbitrary document. If you&apos;re querying by _id, use Model.findById() instead.</em></p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOne()</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_76"><a name="&#x793A;&#x4F8B;&#xFF1A;_76" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_76"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query  <span class="token operator">=</span> Kitten<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;white&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> kitten<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>kitten<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// doc may be null if no document matched</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_findOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_findOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_findOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>findOne <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> projection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> projection <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> projection<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// make sure we don&apos;t send in the whole Document to merge()</span>
  conditions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>op <span class="token operator">=</span> <span class="token string">&apos;findOne&apos;</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>projection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>mquery<span class="token punctuation">.</span><span class="token function">canMerge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">prepareDiscriminatorCriteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>conditions <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObjectParameterError</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> <span class="token string">&apos;filter&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;findOne&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// already merged in the conditions, don&apos;t need to send them in.</span>
    <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>findOne<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_findOne</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryfindoneandremoveconditions-options-optionspassrawresult-optionsstrict-callback"><a name="queryfindoneandremoveconditions-options-optionspassrawresult-optionsstrict-callback" class="anchor-navigation-ex-anchor" href="#queryfindoneandremoveconditions-options-optionspassrawresult-optionsstrict-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.25. Query#findOneAndRemove([conditions], [options], [options.passRawResult], [options.strict], [callback])</h2>
<p>Issues a mongodb findAndModify remove command.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_111"><a name="&#x53C2;&#x6570;&#xFF1A;_111" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_111"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[conditions]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options.passRawResult]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; if true, passes the raw result from the MongoDB driver as the third callback parameter</p>
</li>
<li><p><code>[options.strict]</code> <boolean, string=""> overwrites the schema&apos;s strict mode option</boolean,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, document)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_77"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_77" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_77"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_46"><a name="&#x53C2;&#x89C1;&#xFF1A;_46" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_46"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></li>
</ul>
<p>Finds a matching document, removes it, passing the found document (if any) to the callback. Executes immediately if callback is passed.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOneAndRemove()</li>
</ul>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;</h5>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
</ul>
<h5 id="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;"><a name="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;" class="anchor-navigation-ex-anchor" href="#&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;" class="plugin-anchor" href="#&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// error: any errors that occurred</span>
  <span class="token comment" spellcheck="true">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
  <span class="token comment" spellcheck="true">// result: [raw result from the MongoDB driver](http://mongodb.github.io/node-mongodb-native/2.0/api/Collection.html#findAndModify)</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_77"><a name="&#x793A;&#x4F8B;&#xFF1A;_77" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_77"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// return Query</span>
A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<h2 id="queryfindoneandupdatequery-doc-options-optionspassrawresult-optionsstrict-optionsmultiplecasterror-callback"><a name="queryfindoneandupdatequery-doc-options-optionspassrawresult-optionsstrict-optionsmultiplecasterror-callback" class="anchor-navigation-ex-anchor" href="#queryfindoneandupdatequery-doc-options-optionspassrawresult-optionsstrict-optionsmultiplecasterror-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.26. Query#findOneAndUpdate([query], [doc], [options], [options.passRawResult], [options.strict], [options.multipleCastError], [callback])</h2>
<p>Issues a mongodb <a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">findAndModify</a> update command.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_112"><a name="&#x53C2;&#x6570;&#xFF1A;_112" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_112"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[query]</code> <object, query=""></object,></p>
</li>
<li><p><code>[doc]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options.passRawResult]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; if true, passes the <a href="http://mongodb.github.io/node-mongodb-native/2.0/api/Collection.html#findAndModify" target="_blank">raw result from the MongoDB driver as the third callback parameter</a></p>
</li>
<li><p><code>[options.strict]</code> <boolean, string=""> overwrites the schema&apos;s <a href="guide.html#strict">strict mode option</a></boolean,></p>
</li>
<li><p><code>[options.multipleCastError]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, doc), unless passRawResult is used, in which case params are (error, doc, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_78"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_78" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_78"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_47"><a name="&#x53C2;&#x89C1;&#xFF1A;_47" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_47"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
</ul>
<p>Finds a matching document, updates it according to the update arg, passing any options, and returns the found document (if any) to the callback. The query executes immediately if callback is passed.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOneAndUpdate()</li>
</ul>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;_1"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;_1" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;</h5>
<ul>
<li><code>new</code>: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)</li>
<li><code>upsert</code>: bool - creates the object if it doesn&apos;t exist. defaults to false.</li>
<li><code>fields</code>: {Object|String} - Field selection. Equivalent to .select(fields).findOneAndUpdate()</li>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>runValidators</code>: if true, runs update validators on this command. Update validators validate the update operation against the model&apos;s schema.</li>
<li><code>setDefaultsOnInsert</code>: if this and upsert are true, mongoose will apply the defaults specified in the model&apos;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on MongoDB&apos;s $setOnInsert operator.</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
<li><code>context</code> (string) if set to &apos;query&apos; and runValidators is on, this will refer to the query in custom validator functions that update validation runs. Does nothing if runValidators is false.</li>
<li><code>runSettersOnQuery</code>: bool - if true, run all setters defined on the associated model&apos;s schema for all fields defined in the query and the update.</li>
</ul>
<h5 id="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;_1"><a name="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;_1" class="anchor-navigation-ex-anchor" href="#&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;" class="plugin-anchor" href="#&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B7E;&#x540D;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// error: any errors that occurred</span>
  <span class="token comment" spellcheck="true">// doc: the document before updates are applied if `new: false`, or after updates if `new = true`</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_78"><a name="&#x793A;&#x4F8B;&#xFF1A;_78" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_78"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// returns Query</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>             <span class="token comment" spellcheck="true">// returns Query</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span>                       <span class="token comment" spellcheck="true">// returns Query</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>                     <span class="token comment" spellcheck="true">// executes</span>
query<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<h2 id="querygeometryobject"><a name="querygeometryobject" class="anchor-navigation-ex-anchor" href="#querygeometryobject"><i class="fa fa-link" aria-hidden="true"></i></a>16.27. Query#geometry(object)</h2>
<p>Specifies a $geometry condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_113"><a name="&#x53C2;&#x6570;&#xFF1A;_113" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_113"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>object</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; Must contain a type property which is a String and a coordinates property which is an Array. See the examples.</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_79"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_79" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_79"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_48"><a name="&#x53C2;&#x89C1;&#xFF1A;_48" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_48"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/geometry/" target="_blank">$geometry</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/release-notes/2.4/#new-geospatial-indexes-with-geojson-and-improved-spherical-geometry" target="_blank">http://docs.mongodb.org/manual/release-notes/2.4/#new-geospatial-indexes-with-geojson-and-improved-spherical-geometry</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_79"><a name="&#x793A;&#x4F8B;&#xFF1A;_79" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_79"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">
<span class="token keyword">var</span> polyA <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;Polygon&apos;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> polyA <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or</span>
<span class="token keyword">var</span> polyB <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;LineString&apos;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> polyB <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or</span>
<span class="token keyword">var</span> polyC <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">]</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;Point&apos;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> polyC <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;Point&apos;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> polyC <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>The argument is assigned to the most recent path passed to where().</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_26"><a name="&#x6CE8;&#x610F;&#xFF1A;_26" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_26"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>geometry() must come after either intersects() or within().</p>
<p>The object argument must contain type and coordinates properties.</p>
<ul>
<li>type {String}</li>
<li>coordinates {Array}</li>
</ul>
<h2 id="querygetquery"><a name="querygetquery" class="anchor-navigation-ex-anchor" href="#querygetquery"><i class="fa fa-link" aria-hidden="true"></i></a>16.28. Query#getQuery()</h2>
<p>Returns the current query conditions as a JSON object.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_80"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_80" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_80"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; current query conditions</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_80"><a name="&#x793A;&#x4F8B;&#xFF1A;_80" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_80"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;b&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { a: 1, b: { $gt: 2 } }</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_getQuery" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_getQuery"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_getQuery"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getQuery <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_conditions<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querygetupdate"><a name="querygetupdate" class="anchor-navigation-ex-anchor" href="#querygetupdate"><i class="fa fa-link" aria-hidden="true"></i></a>16.29. Query#getUpdate()</h2>
<p>Returns the current update operations as a JSON object.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_81"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_81" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_81"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; current update operations</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_81"><a name="&#x793A;&#x4F8B;&#xFF1A;_81" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_81"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">getUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { $set: { a: 5 } }</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_getUpdate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_getUpdate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_getUpdate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getUpdate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_update<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querygtpath-val"><a name="querygtpath-val" class="anchor-navigation-ex-anchor" href="#querygtpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.30. Query#gt([path], val)</h2>
<p>Specifies a $gt query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_114"><a name="&#x53C2;&#x6570;&#xFF1A;_114" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_114"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_49"><a name="&#x53C2;&#x89C1;&#xFF1A;_49" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_49"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/gt/" target="_blank">$gt</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_82"><a name="&#x793A;&#x4F8B;&#xFF1A;_82" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_82"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or</span>
Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querygtepath-val"><a name="querygtepath-val" class="anchor-navigation-ex-anchor" href="#querygtepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.31. Query#gte([path], val)</h2>
<p>Specifies a $gte query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_115"><a name="&#x53C2;&#x6570;&#xFF1A;_115" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_115"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_50"><a name="&#x53C2;&#x89C1;&#xFF1A;_50" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_50"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/gte/" target="_blank">$gte</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="queryhintval"><a name="queryhintval" class="anchor-navigation-ex-anchor" href="#queryhintval"><i class="fa fa-link" aria-hidden="true"></i></a>16.32. Query#hint(val)</h2>
<p>Sets query hints.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_116"><a name="&#x53C2;&#x6570;&#xFF1A;_116" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_116"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; a hint object</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_82"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_82" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_82"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_51"><a name="&#x53C2;&#x89C1;&#xFF1A;_51" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_51"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/hint/" target="_blank">$hint</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_83"><a name="&#x793A;&#x4F8B;&#xFF1A;_83" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_83"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">hint</span><span class="token punctuation">(</span><span class="token punctuation">{</span> indexA<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> indexB<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_27"><a name="&#x6CE8;&#x610F;&#xFF1A;_27" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_27"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="queryinpath-val"><a name="queryinpath-val" class="anchor-navigation-ex-anchor" href="#queryinpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.33. Query#in([path], val)</h2>
<p>Specifies an $in query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_117"><a name="&#x53C2;&#x6570;&#xFF1A;_117" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_117"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_52"><a name="&#x53C2;&#x89C1;&#xFF1A;_52" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_52"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<p>  <a href="http://docs.mongodb.org/manual/reference/operator/in/" target="_blank">$in</a></p>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="queryintersectsarg"><a name="queryintersectsarg" class="anchor-navigation-ex-anchor" href="#queryintersectsarg"><i class="fa fa-link" aria-hidden="true"></i></a>16.34. Query#intersects([arg])</h2>
<p>Declares an intersects query for geometry().</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_118"><a name="&#x53C2;&#x6570;&#xFF1A;_118" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_118"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[arg]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_83"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_83" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_83"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_53"><a name="&#x53C2;&#x89C1;&#xFF1A;_53" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_53"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/geometry/" target="_blank">$geometry</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/geoIntersects/" target="_blank">geoIntersects</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_84"><a name="&#x793A;&#x4F8B;&#xFF1A;_84" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_84"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&apos;LineString&apos;</span>
  <span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">180.0</span><span class="token punctuation">,</span> <span class="token number">11.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">&apos;LineString&apos;</span>
  <span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">180.0</span><span class="token punctuation">,</span> <span class="token number">11.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_28"><a name="&#x6CE8;&#x610F;&#xFF1A;_28" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_28"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><strong>MUST</strong> be used after where().</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_29"><a name="&#x6CE8;&#x610F;&#xFF1A;_29" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_29"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>In Mongoose 3.7, intersects changed from a getter to a function. If you need the old syntax, use this.</p>
<h2 id="queryleanbool"><a name="queryleanbool" class="anchor-navigation-ex-anchor" href="#queryleanbool"><i class="fa fa-link" aria-hidden="true"></i></a>16.35. Query#lean(bool)</h2>
<p>Sets the lean option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_119"><a name="&#x53C2;&#x6570;&#xFF1A;_119" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_119"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>bool</code> <boolean, object=""> defaults to true</boolean,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_84"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_84" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_84"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<p>Documents returned from queries with the lean option enabled are plain javascript objects, not MongooseDocuments. They have no save method, getters/setters or other Mongoose magic applied.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_85"><a name="&#x793A;&#x4F8B;&#xFF1A;_85" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_85"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  docs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Document</span> <span class="token comment" spellcheck="true">// false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This is a <a href="https://groups.google.com/forum/#!topic/mongoose-orm/u2_DzDydcnA/discussion" target="_blank">great</a> option in high-performance read-only scenarios, especially when combined with stream.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_lean" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_lean"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_lean"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lean <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">.</span>lean <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> v <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querylimitval"><a name="querylimitval" class="anchor-navigation-ex-anchor" href="#querylimitval"><i class="fa fa-link" aria-hidden="true"></i></a>16.36. Query#limit(val)</h2>
<p>Specifies the maximum number of documents the query will return.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_120"><a name="&#x53C2;&#x6570;&#xFF1A;_120" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_120"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>val <number></number></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_86"><a name="&#x793A;&#x4F8B;&#xFF1A;_86" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_86"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_30"><a name="&#x6CE8;&#x610F;&#xFF1A;_30" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_30"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="queryltpath-val"><a name="queryltpath-val" class="anchor-navigation-ex-anchor" href="#queryltpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.37. Query#lt([path], val)</h2>
<p>Specifies a $lt query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_121"><a name="&#x53C2;&#x6570;&#xFF1A;_121" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_121"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_54"><a name="&#x53C2;&#x89C1;&#xFF1A;_54" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_54"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/lt/" target="_blank">$lt</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="queryltepath-val"><a name="queryltepath-val" class="anchor-navigation-ex-anchor" href="#queryltepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.38. Query#lte([path], val)</h2>
<p>Specifies a $lte query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_122"><a name="&#x53C2;&#x6570;&#xFF1A;_122" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_122"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_55"><a name="&#x53C2;&#x89C1;&#xFF1A;_55" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_55"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/lte/" target="_blank">$lte</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="querymaxdistancepath-val"><a name="querymaxdistancepath-val" class="anchor-navigation-ex-anchor" href="#querymaxdistancepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.39. Query#maxDistance([path], val)</h2>
<p>Specifies a $maxDistance query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_123"><a name="&#x53C2;&#x6570;&#xFF1A;_123" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_123"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_56"><a name="&#x53C2;&#x89C1;&#xFF1A;_56" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_56"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/maxDistance/" target="_blank">$maxDistance</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="querymaxscan"><a name="querymaxscan" class="anchor-navigation-ex-anchor" href="#querymaxscan"><i class="fa fa-link" aria-hidden="true"></i></a>16.40. Query#maxscan()</h2>
<p>DEPRECATED Alias of maxScan</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_57"><a name="&#x53C2;&#x89C1;&#xFF1A;_57" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_57"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/api.html#query_Query-maxScan" target="_blank">maxScan</a></li>
</ul>
<h2 id="querymaxscanval"><a name="querymaxscanval" class="anchor-navigation-ex-anchor" href="#querymaxscanval"><i class="fa fa-link" aria-hidden="true"></i></a>16.41. Query#maxScan(val)]()</h2>
<p>Specifies the maxScan option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_124"><a name="&#x53C2;&#x6570;&#xFF1A;_124" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_124"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> <number></number></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_58"><a name="&#x53C2;&#x89C1;&#xFF1A;_58" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_58"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/maxScan/" target="_blank">maxScan</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_87"><a name="&#x793A;&#x4F8B;&#xFF1A;_87" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_87"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">maxScan</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_31"><a name="&#x6CE8;&#x610F;&#xFF1A;_31" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_31"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="querymergesource"><a name="querymergesource" class="anchor-navigation-ex-anchor" href="#querymergesource"><i class="fa fa-link" aria-hidden="true"></i></a>16.42. Query#merge(source)</h2>
<p>Merges another Query or conditions object into this one.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_125"><a name="&#x53C2;&#x6570;&#xFF1A;_125" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_125"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>source</code> <query, object=""></query,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_85"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_85" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_85"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<p>When a Query is passed, conditions, field selection and options are merged.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_merge" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_merge"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_merge"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>merge <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>retainKeyOrder<span class="token punctuation">,</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// if source has a feature, apply it to ourselves</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>_conditions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      utils<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_conditions<span class="token punctuation">,</span> source<span class="token punctuation">.</span>_conditions<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>_fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_fields <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_fields <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      utils<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_fields<span class="token punctuation">,</span> source<span class="token punctuation">.</span>_fields<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      utils<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> source<span class="token punctuation">.</span>options<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>_update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_update <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_update <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      utils<span class="token punctuation">.</span><span class="token function">mergeClone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_update<span class="token punctuation">,</span> source<span class="token punctuation">.</span>_update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span>_distinct<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_distinct <span class="token operator">=</span> source<span class="token punctuation">.</span>_distinct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// plain object</span>
  utils<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_conditions<span class="token punctuation">,</span> source<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querymergesource_1"><a name="querymergesource_1" class="anchor-navigation-ex-anchor" href="#querymergesource_1"><i class="fa fa-link" aria-hidden="true"></i></a>16.43. Query#merge(source)</h2>
<p>Merges another Query or conditions object into this one.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_126"><a name="&#x53C2;&#x6570;&#xFF1A;_126" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_126"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>source</code> <query, object=""></query,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_86"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_86" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_86"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<p>When a Query is passed, conditions, field selection and options are merged.</p>
<p>New in 3.7.0</p>
<h2 id="querymodpath-val"><a name="querymodpath-val" class="anchor-navigation-ex-anchor" href="#querymodpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.44. Query#mod([path], val)</h2>
<p>Specifies a $mod condition, filters documents for documents whose
path property is a number that is equal to remainder modulo divisor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_127"><a name="&#x53C2;&#x6570;&#xFF1A;_127" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_127"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; must be of length 2, first element is divisor, 2nd element is remainder.</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_87"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_87" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_87"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_59"><a name="&#x53C2;&#x89C1;&#xFF1A;_59" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_59"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/mod/" target="_blank">$mod</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_88"><a name="&#x793A;&#x4F8B;&#xFF1A;_88" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_88"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// All find products whose inventory is odd</span>
Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token string">&apos;inventory&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;inventory&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// This syntax is a little strange, but supported.</span>
Product<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;inventory&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="querymongooseoptionsoptions"><a name="querymongooseoptionsoptions" class="anchor-navigation-ex-anchor" href="#querymongooseoptionsoptions"><i class="fa fa-link" aria-hidden="true"></i></a>16.45. Query#mongooseOptions(options)</h2>
<p>Getter/setter around the current mongoose-specific options for this query
(populate, lean, etc.)</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_128"><a name="&#x53C2;&#x6570;&#xFF1A;_128" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_128"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; if specified, overwrites the current options<sec data-title="&#x6E90;&#x7801;" data-id="Query_mongooseOptions" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_mongooseOptions"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_mongooseOptions"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>mongooseOptions <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions <span class="token operator">=</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
</li>
</ul>
<h2 id="querynepath-val"><a name="querynepath-val" class="anchor-navigation-ex-anchor" href="#querynepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.46. Query#ne([path], val)</h2>
<p>Specifies a $ne query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_129"><a name="&#x53C2;&#x6570;&#xFF1A;_129" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_129"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_60"><a name="&#x53C2;&#x89C1;&#xFF1A;_60" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_60"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/ne/" target="_blank">$ne</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="querynearpath-val"><a name="querynearpath-val" class="anchor-navigation-ex-anchor" href="#querynearpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.47. Query#near([path], val)</h2>
<p>Specifies a $near or $nearSphere condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_130"><a name="&#x53C2;&#x6570;&#xFF1A;_130" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_130"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_88"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_88" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_88"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_61"><a name="&#x53C2;&#x89C1;&#xFF1A;_61" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_61"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/near/" target="_blank">$near</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/nearSphere/" target="_blank">$nearSphere</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/maxDistance/" target="_blank">$maxDistance</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a></p>
</li>
</ul>
<p>These operators return documents sorted by distance.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_89"><a name="&#x793A;&#x4F8B;&#xFF1A;_89" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_89"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxDistance<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxDistance<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> spherical<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxDistance<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="querynearsphere"><a name="querynearsphere" class="anchor-navigation-ex-anchor" href="#querynearsphere"><i class="fa fa-link" aria-hidden="true"></i></a>16.48. Query#nearSphere()</h2>
<p>DEPRECATED Specifies a $nearSphere condition</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_62"><a name="&#x53C2;&#x89C1;&#xFF1A;_62" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_62"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">near()</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/operator/near/" target="_blank">$near</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/operator/nearSphere/" target="_blank">$nearSphere</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/operator/maxDistance/" target="_blank">$maxDistance</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_90"><a name="&#x793A;&#x4F8B;&#xFF1A;_90" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_90"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nearSphere</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxDistance<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>Deprecated</strong>. Use query.near() instead with the spherical option set to true.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_91"><a name="&#x793A;&#x4F8B;&#xFF1A;_91" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_91"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spherical<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_nearSphere" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_nearSphere"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_nearSphere"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>nearSphere <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">.</span>nearSphere <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>near<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryninpath-val"><a name="queryninpath-val" class="anchor-navigation-ex-anchor" href="#queryninpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.49. Query#nin([path], val)</h2>
<p>Specifies an $nin query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_131"><a name="&#x53C2;&#x6570;&#xFF1A;_131" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_131"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_63"><a name="&#x53C2;&#x89C1;&#xFF1A;_63" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_63"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/nin/" target="_blank">$nin</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="querynorarray"><a name="querynorarray" class="anchor-navigation-ex-anchor" href="#querynorarray"><i class="fa fa-link" aria-hidden="true"></i></a>16.50. Query#nor(array)</h2>
<p>Specifies arguments for a $nor condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_132"><a name="&#x53C2;&#x6570;&#xFF1A;_132" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_132"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>array</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; array of conditions</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_89"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_89" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_89"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_64"><a name="&#x53C2;&#x89C1;&#xFF1A;_64" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_64"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/nor/" target="_blank">$nor</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_92"><a name="&#x793A;&#x4F8B;&#xFF1A;_92" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_92"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">nor</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;green&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> <span class="token string">&apos;ok&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryorarray"><a name="queryorarray" class="anchor-navigation-ex-anchor" href="#queryorarray"><i class="fa fa-link" aria-hidden="true"></i></a>16.51. Query#or(array)</h2>
<p>Specifies arguments for an $or condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_133"><a name="&#x53C2;&#x6570;&#xFF1A;_133" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_133"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>array</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; array of conditions</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_90"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_90" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_90"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_65"><a name="&#x53C2;&#x89C1;&#xFF1A;_65" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_65"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/or/" target="_blank">$or</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_93"><a name="&#x793A;&#x4F8B;&#xFF1A;_93" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_93"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;red&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token punctuation">:</span> <span class="token string">&apos;emergency&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querypolygonpath-coordinatepairs"><a name="querypolygonpath-coordinatepairs" class="anchor-navigation-ex-anchor" href="#querypolygonpath-coordinatepairs"><i class="fa fa-link" aria-hidden="true"></i></a>16.52. Query#polygon([path], [coordinatePairs...])</h2>
<p>Specifies a $polygon condition</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_134"><a name="&#x53C2;&#x6570;&#xFF1A;_134" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_134"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> <string, array=""></string,></p>
</li>
<li><p><code>[coordinatePairs...]</code> <array, object=""></array,></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_91"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_91" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_91"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_66"><a name="&#x53C2;&#x89C1;&#xFF1A;_66" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_66"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/polygon/" target="_blank">$polygon</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">http://www.mongodb.org/display/DOCS/Geospatial+Indexing</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_94"><a name="&#x793A;&#x4F8B;&#xFF1A;_94" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_94"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">polygon</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">polygon</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querypopulatepath-select-model-match-options"><a name="querypopulatepath-select-model-match-options" class="anchor-navigation-ex-anchor" href="#querypopulatepath-select-model-match-options"><i class="fa fa-link" aria-hidden="true"></i></a>16.53. Query#populate(path, [select], [model], [match], [options])</h2>
<p>Specifies paths which should be populated with other documents.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_135"><a name="&#x53C2;&#x6570;&#xFF1A;_135" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_135"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> <object, string=""> either the path to populate or an object specifying all parameters</object,></p>
</li>
<li><p><code>[select]</code> <object, string=""> Field selection for the population query</object,></p>
</li>
<li><p><code>[model]</code> <model> The model you wish to use for population. If not specified, populate will look up the model by the name in the Schema&apos;s ref field.</model></p>
</li>
<li><p><code>[match]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; Conditions for the population query</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; Options for the population query (sort, etc)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_92"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_92" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_92"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_67"><a name="&#x53C2;&#x89C1;&#xFF1A;_67" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_67"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="populate.html">population</a></p>
</li>
<li><p><a href="">Query#select</a></p>
</li>
<li><p><a href="">Model.populate</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_95"><a name="&#x793A;&#x4F8B;&#xFF1A;_95" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_95"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Kitten<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;owner&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> kitten<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>kitten<span class="token punctuation">.</span>owner<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Max</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Kitten<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">&apos;owner&apos;</span>
  <span class="token punctuation">,</span> select<span class="token punctuation">:</span> <span class="token string">&apos;name&apos;</span>
  <span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">&apos;black&apos;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">{</span> sort<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> kittens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>kittens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>owner<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Zoopa</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// alternatively</span>
Kitten<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&apos;owner&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>sort<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> kittens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>kittens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>owner<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// Zoopa</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Paths are populated after the query executes and a response is received. A separate query is then executed for each path specified for population. After a response for each query has also been returned, the results are passed to the callback.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_populate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_populate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_populate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>populate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> i<span class="token punctuation">;</span>

  <span class="token keyword">var</span> res <span class="token operator">=</span> utils<span class="token punctuation">.</span>populate<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Propagate readPreference from parent query, unless one already specified</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>options <span class="token operator">||</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>options <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>populate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>populate <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> pop <span class="token operator">=</span> opts<span class="token punctuation">.</span>populate<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> path <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pop<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> pop<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>populate <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>populate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>populate <span class="token operator">=</span> pop<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>populate<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>populate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pop<span class="token punctuation">[</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryreadpref-tags"><a name="queryreadpref-tags" class="anchor-navigation-ex-anchor" href="#queryreadpref-tags"><i class="fa fa-link" aria-hidden="true"></i></a>16.54. Query#read(pref, [tags])</h2>
<p>Determines the MongoDB nodes from which to read.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_136"><a name="&#x53C2;&#x6570;&#xFF1A;_136" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_136"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>pref</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; one of the listed preference options or aliases</p>
</li>
<li><p><code>[tags]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; optional tags for this query</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_93"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_93" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_93"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_68"><a name="&#x53C2;&#x89C1;&#xFF1A;_68" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_68"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/applications/replication/#read-preference" target="_blank">mongodb</a></p>
</li>
<li><p><a href="http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html#read-preferences" target="_blank">driver</a></p>
</li>
</ul>
<h5 id="&#x5F15;&#x7528;"><a name="&#x5F15;&#x7528;" class="anchor-navigation-ex-anchor" href="#&#x5F15;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x5F15;&#x7528;" class="plugin-anchor" href="#&#x5F15;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5F15;&#x7528;:</h5>
<pre class="language-"><code>primary - (default) Read from primary only. Operations will produce an error if primary is unavailable. Cannot be combined with tags.
secondary            Read from secondary if available, otherwise error.
primaryPreferred     Read from primary if available, otherwise a secondary.
secondaryPreferred   Read from a secondary if available, otherwise read from the primary.
nearest              All operations read from among the nearest candidates, but unlike other modes, this option will include both the primary and all secondaries in the random selection.
</code></pre><p>&#x522B;&#x540D;&#xFF1A;</p>
<pre class="language-"><code>p   primary
pp  primaryPreferred
s   secondary
sp  secondaryPreferred
n   nearest
</code></pre><h5 id="&#x793A;&#x4F8B;&#xFF1A;_96"><a name="&#x793A;&#x4F8B;&#xFF1A;_96" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_96"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;primary&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;p&apos;</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// same as primary</span>

<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;primaryPreferred&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;pp&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// same as primaryPreferred</span>

<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;secondary&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;s&apos;</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// same as secondary</span>

<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;secondaryPreferred&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;sp&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// same as secondaryPreferred</span>

<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;nearest&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;n&apos;</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// same as nearest</span>

<span class="token comment" spellcheck="true">// read from secondaries with matching tags</span>
<span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;s&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> dc<span class="token punctuation">:</span><span class="token string">&apos;sf&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span> dc<span class="token punctuation">:</span><span class="token string">&apos;ma&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>Read more about how to use read preferrences here and here.</p>
<h2 id="queryregexpath-val"><a name="queryregexpath-val" class="anchor-navigation-ex-anchor" href="#queryregexpath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.55. Query#regex([path], val)</h2>
<p>Specifies a $regex query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_137"><a name="&#x53C2;&#x6570;&#xFF1A;_137" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_137"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <string, regexp=""></string,></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_69"><a name="&#x53C2;&#x89C1;&#xFF1A;_69" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_69"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/regex/" target="_blank">$regex</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h2 id="queryremovefilter-callback"><a name="queryremovefilter-callback" class="anchor-navigation-ex-anchor" href="#queryremovefilter-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.56. Query#remove([filter], [callback])</h2>
<p>Declare and/or execute this query as a remove() operation.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_138"><a name="&#x53C2;&#x6570;&#xFF1A;_138" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_138"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[filter]</code> <object, query=""> mongodb selector</object,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_94"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_94" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_94"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_70"><a name="&#x53C2;&#x89C1;&#xFF1A;_70" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_70"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.remove/" target="_blank">remove</a></p>
</li>
</ul>
<p>This function does not trigger any middleware</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_97"><a name="&#x793A;&#x4F8B;&#xFF1A;_97" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_97"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> artist<span class="token punctuation">:</span> <span class="token string">&apos;Anne Murray&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_32"><a name="&#x6CE8;&#x610F;&#xFF1A;_32" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_32"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>The operation is only executed when a callback is passed. To force execution without a callback, you must first call remove() and then execute it by using the exec() method.</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// not executed</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Anne Murray&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// executed</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Anne Murray&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Anne Murray&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// executed without a callback</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// summary</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>conds<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// executes</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>conds<span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_remove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_remove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_remove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> filter <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> filter<span class="token punctuation">;</span>
    filter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  filter <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">prepareDiscriminatorCriteria</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>remove<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_remove</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryreplaceonecriteria-doc-options-callback"><a name="queryreplaceonecriteria-doc-options-callback" class="anchor-navigation-ex-anchor" href="#queryreplaceonecriteria-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.57. Query#replaceOne([criteria], [doc], [options], [callback])</h2>
<p>Declare and/or execute this query as a replaceOne() operation. Same as
update(), except MongoDB will replace the existing document and will
not accept any atomic operators ($set, etc.)</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_139"><a name="&#x53C2;&#x6570;&#xFF1A;_139" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_139"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[criteria]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[doc]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the update command</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_95"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_95" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_95"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_71"><a name="&#x53C2;&#x89C1;&#xFF1A;_71" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_71"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongoosejs.com/docs/api.html#model_Model.update" target="_blank">Model.update</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.update/" target="_blank">update</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_33"><a name="&#x6CE8;&#x610F;&#xFF1A;_33" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_33"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>replaceOne will not fire update middleware. Use pre(&apos;replaceOne&apos;)
and post(&apos;replaceOne&apos;) instead.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>replaceOne()</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_replaceOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_replaceOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_replaceOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>replaceOne <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(conditions, doc, callback)</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> doc <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(doc, callback);</span>
    callback <span class="token operator">=</span> doc<span class="token punctuation">;</span>
    doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(callback)</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    doc <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>doc <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(doc)</span>
    doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    callback <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryselectarg"><a name="queryselectarg" class="anchor-navigation-ex-anchor" href="#queryselectarg"><i class="fa fa-link" aria-hidden="true"></i></a>16.58. Query#select(arg)</h2>
<p>Specifies which document fields to include or exclude (also known as the query &quot;projection&quot;)</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_140"><a name="&#x53C2;&#x6570;&#xFF1A;_140" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_140"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> <object, string=""></object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_96"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_96" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_96"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_72"><a name="&#x53C2;&#x89C1;&#xFF1A;_72" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_72"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<p>When using string syntax, prefixing a path with - will flag that path as excluded. When a path does not have the - prefix, it is included. Lastly, if a path is prefixed with +, it forces inclusion of the path, which is useful for paths excluded at the <a href="http://mongoosejs.com/docs/api.html#schematype_SchemaType-select" target="_blank">schema level</a>.</p>
<p>A projection must be either inclusive or exclusive. In other words, you must
either list the fields to include (which excludes all others), or list the fields
to exclude (which implies all other fields are included). The <a href="https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/#suppress-id-field" target="_blank">_id field is the only exception because MongoDB includes it by default.</a></p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_98"><a name="&#x793A;&#x4F8B;&#xFF1A;_98" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_98"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// include a and b, exclude other fields</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;a b&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// exclude c and d, include other fields</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;-c -d&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or you may use object notation, useful when</span>
<span class="token comment" spellcheck="true">// you have keys already prefixed with a &quot;-&quot;</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> c<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> d<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// force inclusion of field excluded at schema level</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;+path&apos;</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryselected"><a name="queryselected" class="anchor-navigation-ex-anchor" href="#queryselected"><i class="fa fa-link" aria-hidden="true"></i></a>16.59. Query#selected()</h2>
<p>Determines if field selection has been made.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_97"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_97" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_97"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h2 id="queryselectedexclusively"><a name="queryselectedexclusively" class="anchor-navigation-ex-anchor" href="#queryselectedexclusively"><i class="fa fa-link" aria-hidden="true"></i></a>16.60. Query#selectedExclusively()</h2>
<p>Determines if exclusive field selection has been made.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_98"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_98" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_98"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">selectedExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;-name&apos;</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">selectedExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
query<span class="token punctuation">.</span><span class="token function">selectedInclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
</code></pre>
<h2 id="queryselectedinclusively"><a name="queryselectedinclusively" class="anchor-navigation-ex-anchor" href="#queryselectedinclusively"><i class="fa fa-link" aria-hidden="true"></i></a>16.61. Query#selectedInclusively()</h2>
<p>Determines if inclusive field selection has been made.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_99"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_99" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_99"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">selectedInclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// false</span>
query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">selectedInclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
</code></pre>
<h2 id="querysetoptionsoptions"><a name="querysetoptionsoptions" class="anchor-navigation-ex-anchor" href="#querysetoptionsoptions"><i class="fa fa-link" aria-hidden="true"></i></a>16.62. Query#setOptions(options)</h2>
<p>Sets query options. Some options only make sense for certain operations.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_141"><a name="&#x53C2;&#x6570;&#xFF1A;_141" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_141"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x9009;&#x9879;&#xFF1A;_1"><a name="&#x9009;&#x9879;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;&#xFF1A;</h5>
<p>The following options are only for find():</p>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/Tailable+Cursors" target="_blank">tailable</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bsort(" target="_blank">sort</a>%7D%7D)</li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Blimit%28%29%7D%7D" target="_blank">limit</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bskip%28%29%7D%7D" target="_blank">skip</a></li>
<li><a href="https://docs.mongodb.org/v3.2/reference/operator/meta/maxScan/#metaOp._S_maxScan" target="_blank">maxscan</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7BbatchSize%28%29%7D%7D" target="_blank">batchSize</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%24comment" target="_blank">comment</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%7B%7Bsnapshot%28%29%7D%7D" target="_blank">snapshot</a></li>
<li><a href="http://docs.mongodb.org/manual/applications/replication/#read-preference" target="_blank">readPreference</a></li>
<li><a href="http://www.mongodb.org/display/DOCS/Advanced+Queries#AdvancedQueries-%24hint" target="_blank">hint</a></li>
</ul>
<p>The following options are only for update(), updateOne(), updateMany(), replaceOne(), and findOneAndUpdate():</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.update/" target="_blank">upsert</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.update/" target="_blank">writeConcern</a></li>
</ul>
<p>The following options are only for find(), findOne(), findById(), and findOneAndUpdate():</p>
<ul>
<li><a href="http://mongoosejs.com/docs/api.html#query_Query-lean" target="_blank">lean</a></li>
</ul>
<p><strong>The following options are for all operations</strong></p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/collation/" target="_blank">collation</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_setOptions" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_setOptions"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_setOptions"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setOptions <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> overwrite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// overwrite is only for internal use</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>overwrite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ensure that _mongooseOptions &amp; options are two different objects</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions <span class="token operator">=</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&apos;populate&apos;</span> <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>populate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> populate <span class="token operator">=</span> options<span class="token punctuation">.</span>populate<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> options<span class="token punctuation">.</span>populate<span class="token punctuation">;</span>
    <span class="token keyword">var</span> _numPopulate <span class="token operator">=</span> populate<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _numPopulate<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>populate<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>setOptions<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querysizepath-val"><a name="querysizepath-val" class="anchor-navigation-ex-anchor" href="#querysizepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.63. Query#size([path], val)</h2>
<p>Specifies a $size query condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_142"><a name="&#x53C2;&#x6570;&#xFF1A;_142" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_142"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number></number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_73"><a name="&#x53C2;&#x89C1;&#xFF1A;_73" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_73"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/size/" target="_blank">$size</a></li>
</ul>
<p>When called with one argument, the most recent path passed to where() is used.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_99"><a name="&#x793A;&#x4F8B;&#xFF1A;_99" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_99"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">MyModel<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;tags&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">assert</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;documents with 0 tags&apos;</span><span class="token punctuation">,</span> docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryskipval"><a name="queryskipval" class="anchor-navigation-ex-anchor" href="#queryskipval"><i class="fa fa-link" aria-hidden="true"></i></a>16.64. Query#skip(val)</h2>
<p>Specifies the number of documents to skip.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_143"><a name="&#x53C2;&#x6570;&#xFF1A;_143" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_143"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> <number></number></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_74"><a name="&#x53C2;&#x89C1;&#xFF1A;_74" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_74"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/method/cursor.skip/" target="_blank">cursor.skip</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_100"><a name="&#x793A;&#x4F8B;&#xFF1A;_100" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_100"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_34"><a name="&#x6CE8;&#x610F;&#xFF1A;_34" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_34"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="queryslaveokv"><a name="queryslaveokv" class="anchor-navigation-ex-anchor" href="#queryslaveokv"><i class="fa fa-link" aria-hidden="true"></i></a>16.65. Query#slaveOk(v)</h2>
<p>DEPRECATED Sets the slaveOk option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_144"><a name="&#x53C2;&#x6570;&#xFF1A;_144" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_144"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>v</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; defaults to true</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_100"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_100" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_100"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_75"><a name="&#x53C2;&#x89C1;&#xFF1A;_75" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_75"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/applications/replication/#read-preference" target="_blank">mongodb</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/rs.slaveOk/" target="_blank">slaveOk</a></p>
</li>
<li><p><a href="">read()</a></p>
</li>
</ul>
<p>Deprecated in MongoDB 2.2 in favor of read preferences.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_101"><a name="&#x793A;&#x4F8B;&#xFF1A;_101" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_101"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">slaveOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
query<span class="token punctuation">.</span><span class="token function">slaveOk</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">slaveOk</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryslicepath-val"><a name="queryslicepath-val" class="anchor-navigation-ex-anchor" href="#queryslicepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>16.66. Query#slice([path], val)</h2>
<p>Specifies a $slice projection for an array.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_145"><a name="&#x53C2;&#x6570;&#xFF1A;_145" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_145"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>val</code> <number> number/range of elements to slice</number></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_101"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_101" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_101"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_76"><a name="&#x53C2;&#x89C1;&#xFF1A;_76" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_76"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://www.mongodb.org/display/DOCS/Retrieving+a+Subset+of+Fields#RetrievingaSubsetofFields-RetrievingaSubrangeofArrayElements" target="_blank">mongodb</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/projection/slice/#prj._S_slice" target="_blank">$slice</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_102"><a name="&#x793A;&#x4F8B;&#xFF1A;_102" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_102"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token string">&apos;comments&apos;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token string">&apos;comments&apos;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token string">&apos;comments&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;comments&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;comments&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="queryslicepath-val_1"><a name="queryslicepath-val_1" class="anchor-navigation-ex-anchor" href="#queryslicepath-val_1"><i class="fa fa-link" aria-hidden="true"></i></a>16.67. Query#slice([path], [val])</h2>
<p>Specifies a path for use with chaining.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_146"><a name="&#x53C2;&#x6570;&#xFF1A;_146" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_146"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[path]</code> <string, object=""></string,></p>
</li>
<li><p><code>[val]</code> <t></t></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_102"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_102" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_102"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_103"><a name="&#x793A;&#x4F8B;&#xFF1A;_103" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_103"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// instead of writing:</span>
User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gte<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> $lte<span class="token punctuation">:</span> <span class="token number">65</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// we can instead write:</span>
User<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// passing query conditions is permitted</span>
User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;vonderful&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// chaining</span>
User
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token regex">/^vonderful/i</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;friends&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<h2 id="querysnapshot"><a name="querysnapshot" class="anchor-navigation-ex-anchor" href="#querysnapshot"><i class="fa fa-link" aria-hidden="true"></i></a>16.68. Query#snapshot()</h2>
<p>Specifies this query as a snapshot query.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_103"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_103" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_103"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_77"><a name="&#x53C2;&#x89C1;&#xFF1A;_77" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_77"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/operator/snapshot/" target="_blank">snapshot</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_104"><a name="&#x793A;&#x4F8B;&#xFF1A;_104" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_104"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
query<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_35"><a name="&#x6CE8;&#x610F;&#xFF1A;_35" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_35"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<h2 id="querysortarg"><a name="querysortarg" class="anchor-navigation-ex-anchor" href="#querysortarg"><i class="fa fa-link" aria-hidden="true"></i></a>16.69. Query#sort(arg)</h2>
<p>Sets the sort order</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_147"><a name="&#x53C2;&#x6570;&#xFF1A;_147" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_147"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> <object, string=""></object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_104"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_104" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_104"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_78"><a name="&#x53C2;&#x89C1;&#xFF1A;_78" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_78"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/method/cursor.sort/" target="_blank">cursor.sort</a></li>
</ul>
<p>If an object is passed, values allowed are asc, desc, ascending, descending, 1, and -1.</p>
<p>If a string is passed, it must be a space delimited list of path names. The
sort order of each path is ascending unless the path name is prefixed with -
which will be treated as descending.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_105"><a name="&#x793A;&#x4F8B;&#xFF1A;_105" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_105"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// sort by &quot;field&quot; ascending and &quot;test&quot; descending</span>
query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> field<span class="token punctuation">:</span> <span class="token string">&apos;asc&apos;</span><span class="token punctuation">,</span> test<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// equivalent</span>
query<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&apos;field -test&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_36"><a name="&#x6CE8;&#x610F;&#xFF1A;_36" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_36"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_sort" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_sort"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_sort"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sort <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;sort() only takes 1 Argument&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>sort<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreamoptions"><a name="querystreamoptions" class="anchor-navigation-ex-anchor" href="#querystreamoptions"><i class="fa fa-link" aria-hidden="true"></i></a>16.70. Query#stream([options])</h2>
<p>Returns a Node.js 0.8 style read stream interface.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_148"><a name="&#x53C2;&#x6570;&#xFF1A;_148" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_148"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_105"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_105" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_105"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><querystream>

</querystream></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_79"><a name="&#x53C2;&#x89C1;&#xFF1A;_79" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_79"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">QueryStream</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_106"><a name="&#x793A;&#x4F8B;&#xFF1A;_106" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_106"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// follows the nodejs 0.8 stream api</span>
Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// manual streaming</span>
<span class="token keyword">var</span> stream <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something with the mongoose document</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// handle the error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;close&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// the stream is closed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;_2"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;_2" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;</h5>
<ul>
<li><code>transform</code>: optional function which accepts a mongoose document. The return value of the function will be emitted on data.</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_107"><a name="&#x793A;&#x4F8B;&#xFF1A;_107" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_107"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// JSON.stringify all documents before emitting</span>
<span class="token keyword">var</span> stream <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span>stringify <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_stream" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_stream"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_stream"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>stream <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">stream</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_applyPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_fields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_castFields</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_castConditions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryStream</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>stream <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">deprecate</span><span class="token punctuation">(</span>Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>stream<span class="token punctuation">,</span> <span class="token string">&apos;Mongoose: &apos;</span> <span class="token operator">+</span>
  <span class="token string">&apos;Query.prototype.stream() is deprecated in mongoose &gt;= 4.5.0, &apos;</span> <span class="token operator">+</span>
  <span class="token string">&apos;use Query.prototype.cursor() instead&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querytailablebool-opts-optsnumberofretries-optstailableretryinterval"><a name="querytailablebool-opts-optsnumberofretries-optstailableretryinterval" class="anchor-navigation-ex-anchor" href="#querytailablebool-opts-optsnumberofretries-optstailableretryinterval"><i class="fa fa-link" aria-hidden="true"></i></a>16.71. Query#tailable(bool, [opts], [opts.numberOfRetries], [opts.tailableRetryInterval])</h2>
<p>Sets the tailable option (for use with capped collections).</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_149"><a name="&#x53C2;&#x6570;&#xFF1A;_149" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_149"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>bool</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; defaults to true</p>
</li>
<li><p><code>[opts]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options to set</p>
</li>
<li><p><code>[opts.numberOfRetries]</code> <number> if cursor is exhausted, retry this many times before giving up</number></p>
</li>
<li><p><code>[opts.tailableRetryInterval]</code> <number> if cursor is exhausted, wait this many milliseconds before
retrying</number></p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_80"><a name="&#x53C2;&#x89C1;&#xFF1A;_80" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_80"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/tutorial/create-tailable-cursor/" target="_blank">tailable</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_108"><a name="&#x793A;&#x4F8B;&#xFF1A;_108" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_108"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">tailable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// true</span>
query<span class="token punctuation">.</span><span class="token function">tailable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">tailable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_37"><a name="&#x6CE8;&#x610F;&#xFF1A;_37" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_37"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Cannot be used with distinct()</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_tailable" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_tailable"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_tailable"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>tailable <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// we need to support the tailable({ awaitdata : true }) as well as the</span>
  <span class="token comment" spellcheck="true">// tailable(true, {awaitdata :true}) syntax that mquery does not support</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts <span class="token operator">=</span> val<span class="token punctuation">;</span>
    val <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> opts <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&apos;awaitdata&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// For backwards compatibility</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>opts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> opts<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Query<span class="token punctuation">.</span>base<span class="token punctuation">.</span>tailable<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querythenresolve-reject"><a name="querythenresolve-reject" class="anchor-navigation-ex-anchor" href="#querythenresolve-reject"><i class="fa fa-link" aria-hidden="true"></i></a>16.72. Query#then([resolve], [reject])</h2>
<p>Executes the query returning a Promise which will be
resolved with either the doc(s) or rejected with the error.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_150"><a name="&#x53C2;&#x6570;&#xFF1A;_150" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_150"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[resolve]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
<li><p><code>[reject]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_106"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_106" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_106"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_then" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_then"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_then"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>then <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querytoconstructor"><a name="querytoconstructor" class="anchor-navigation-ex-anchor" href="#querytoconstructor"><i class="fa fa-link" aria-hidden="true"></i></a>16.73. Query#toConstructor()</h2>
<p>Converts this query to a customized, reusable query constructor with all arguments and options retained.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_107"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_107" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_107"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> subclass-of-Query</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_109"><a name="&#x793A;&#x4F8B;&#xFF1A;_109" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_109"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Create a query for adventure movies and read from the primary</span>
<span class="token comment" spellcheck="true">// node in the replica-set unless it is down, in which case we&apos;ll</span>
<span class="token comment" spellcheck="true">// read from a secondary node.</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> Movie<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> tags<span class="token punctuation">:</span> <span class="token string">&apos;adventure&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;primaryPreferred&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// create a custom Query constructor based off these settings</span>
<span class="token keyword">var</span> Adventure <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">toConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Adventure is now a subclass of mongoose.Query and works the same way but with the</span>
<span class="token comment" spellcheck="true">// default query parameters and options set.</span>
<span class="token function">Adventure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// further narrow down our query results while still using the previous settings</span>
<span class="token function">Adventure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^Life/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// since Adventure is a stand-alone constructor we can also add our own</span>
<span class="token comment" spellcheck="true">// helper methods and getters without impacting global queries</span>
Adventure<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>startsWith <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&apos;^&apos;</span> <span class="token operator">+</span> prefix<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Adventure<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&apos;highlyRated&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rating<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gt<span class="token punctuation">:</span> <span class="token number">4.5</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Adventure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>highlyRated<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&apos;Life&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<p>New in 3.7.3</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_toConstructor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_toConstructor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_toConstructor"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toConstructor <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">toConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">;</span>
  <span class="token keyword">var</span> coll <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongooseCollection<span class="token punctuation">;</span>

  <span class="token keyword">var</span> CustomQuery <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">CustomQuery</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomQuery</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Query<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> criteria<span class="token punctuation">,</span> options <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">,</span> model<span class="token punctuation">,</span> coll<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>CustomQuery<span class="token punctuation">,</span> Query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// set inherited defaults</span>
  <span class="token keyword">var</span> p <span class="token operator">=</span> CustomQuery<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

  p<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  p<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  p<span class="token punctuation">.</span>op <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>op<span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_conditions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_conditions<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_fields <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_fields<span class="token punctuation">)</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_update <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_update<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    flattenDecimals<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_path <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_path<span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_distinct <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_distinct<span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_collection <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_collection<span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>_mongooseOptions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_mongooseOptions<span class="token punctuation">;</span>

  <span class="token keyword">return</span> CustomQuery<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryupdatecriteria-doc-options-optionsmultiplecasterror-callback"><a name="queryupdatecriteria-doc-options-optionsmultiplecasterror-callback" class="anchor-navigation-ex-anchor" href="#queryupdatecriteria-doc-options-optionsmultiplecasterror-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.74. Query#update([criteria], [doc], [options], [options.multipleCastError], [callback])</h2>
<p>Declare and/or execute this query as an update() operation.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_151"><a name="&#x53C2;&#x6570;&#xFF1A;_151" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_151"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[criteria]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[doc]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the update command</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options.multipleCastError]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; by default, mongoose only returns the first error that occurred in casting the query. Turn on this option to aggregate all the cast errors.</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional, params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_108"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_108" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_108"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_81"><a name="&#x53C2;&#x89C1;&#xFF1A;_81" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_81"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.update</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.update/" target="_blank">update</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
</ul>
<p>All paths passed that are not $atomic operations will become $set ops.</p>
<p>This function triggers the following middleware</p>
<ul>
<li>update()</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_110"><a name="&#x793A;&#x4F8B;&#xFF1A;_110" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_110"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;words&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// becomes</span>

Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;words&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;_3"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;_3" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;:</h5>
<ul>
<li><code>safe</code> (boolean) safe mode (defaults to value set in schema (true))</li>
<li><code>upsert</code> (boolean) whether to create the doc if it doesn&apos;t match (false)</li>
<li><code>multi</code> (boolean) whether multiple documents should be updated (false)</li>
<li><code>runValidators</code>: if true, runs update validators on this command. Update validators validate the update operation against the model&apos;s schema.</li>
<li><code>setDefaultsOnInsert</code>: if this and upsert are true, mongoose will apply the defaults specified in the model&apos;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on MongoDB&apos;s $setOnInsert operator.</li>
<li><code>strict</code> (boolean) overrides the strict option for this update</li>
<li><code>overwrite</code> (boolean) disables update-only mode, allowing you to overwrite the doc (false)</li>
<li><code>context</code> (string) if set to &apos;query&apos; and runValidators is on, this will refer to the query in custom validator functions that update validation runs. Does nothing if runValidators is false.</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_38"><a name="&#x6CE8;&#x610F;&#xFF1A;_38" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_38"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Passing an empty object {} as the doc will result in a no-op unless the overwrite option is passed. Without the overwrite option set, the update operation will be ignored and the callback executed without sending the command to MongoDB so as to prevent accidently overwritting documents in the collection.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_39"><a name="&#x6CE8;&#x610F;&#xFF1A;_39" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_39"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>The operation is only executed when a callback is passed. To force execution without a callback, we must first call update() and then execute it by using the exec() method.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> q <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;bob&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// not executed</span>

q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;bob&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// executed</span>

<span class="token comment" spellcheck="true">// keys that are not $atomic ops become $set.</span>
<span class="token comment" spellcheck="true">// this executes the same command as the previous example.</span>
q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;bob&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// overwriting with empty docs</span>
<span class="token keyword">var</span> q <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// executes</span>

<span class="token comment" spellcheck="true">// multi update with overwrite to empty doc</span>
<span class="token keyword">var</span> q <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> multi<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
q<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// executed</span>

<span class="token comment" spellcheck="true">// multi updates</span>
Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^match/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> multi<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// more multi updates</span>
Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span> multi<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// single update by default</span>
Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;address@example.com&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $inc<span class="token punctuation">:</span> <span class="token punctuation">{</span> counter<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre>
<p>API &#x603B;&#x7ED3;</p>
<pre class="language-"><code class="lang-js"><span class="token function">update</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
<span class="token function">update</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token function">update</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
<span class="token function">update</span><span class="token punctuation">(</span>criteria<span class="token punctuation">,</span> doc<span class="token punctuation">)</span>
<span class="token function">update</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
<span class="token function">update</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span>
<span class="token function">update</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
<span class="token function">update</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_update" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_update"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_update"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(conditions, doc, callback)</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> doc <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(doc, callback);</span>
    callback <span class="token operator">=</span> doc<span class="token punctuation">;</span>
    doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(callback)</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    doc <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>doc <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// .update(doc)</span>
    doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    callback <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;update&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="queryupdatemanycriteria-doc-options-callback"><a name="queryupdatemanycriteria-doc-options-callback" class="anchor-navigation-ex-anchor" href="#queryupdatemanycriteria-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.75. Query#updateMany([criteria], [doc], [options], [callback])</h2>
<p>Declare and/or execute this query as an updateMany() operation. Same as
update(), except MongoDB will update all documents that match
criteria (as opposed to just the first one) regardless of the value of
the multi option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_152"><a name="&#x53C2;&#x6570;&#xFF1A;_152" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_152"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[criteria]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[doc]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the update command</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_109"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_109" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_109"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_82"><a name="&#x53C2;&#x89C1;&#xFF1A;_82" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_82"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.update</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.update/" target="_blank">update</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_40"><a name="&#x6CE8;&#x610F;&#xFF1A;_40" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_40"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p> updateMany will not fire update middleware. Use pre(&apos;updateMany&apos;)
and post(&apos;updateMany&apos;) instead.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li><p>updateMany()</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_updateMany" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_updateMany"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_updateMany"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>updateMany <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(conditions, doc, callback)</span>
callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> doc <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(doc, callback);</span>
callback <span class="token operator">=</span> doc<span class="token punctuation">;</span>
doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(callback)</span>
callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
doc <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>doc <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(doc)</span>
doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
callback <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;updateMany&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
</li>
</ul>
<h2 id="queryupdateonecriteria-doc-options-callback"><a name="queryupdateonecriteria-doc-options-callback" class="anchor-navigation-ex-anchor" href="#queryupdateonecriteria-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>16.76. Query#updateOne([criteria], [doc], [options], [callback])</h2>
<p>Declare and/or execute this query as an updateOne() operation. Same as
update(), except MongoDB will update only the first document that
matches criteria regardless of the value of the multi option.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_153"><a name="&#x53C2;&#x6570;&#xFF1A;_153" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_153"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[criteria]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[doc]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the update command</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; params are (error, writeOpResult)</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_110"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_110" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_110"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_83"><a name="&#x53C2;&#x89C1;&#xFF1A;_83" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_83"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.update</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/method/db.collection.update/" target="_blank">update</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~WriteOpResult" target="_blank">writeOpResult</a></p>
</li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_41"><a name="&#x6CE8;&#x610F;&#xFF1A;_41" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_41"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p> updateOne will not fire update middleware. Use pre(&apos;updateOne&apos;)
and post(&apos;updateOne&apos;) instead.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li><p>updateOne()</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_updateOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_updateOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_updateOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>updateOne <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(conditions, doc, callback)</span>
callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> doc <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(doc, callback);</span>
callback <span class="token operator">=</span> doc<span class="token punctuation">;</span>
doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(callback)</span>
callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
doc <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>doc <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">// .update(doc)</span>
doc <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
callback <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;updateOne&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
</li>
</ul>
<h2 id="querywithin"><a name="querywithin" class="anchor-navigation-ex-anchor" href="#querywithin"><i class="fa fa-link" aria-hidden="true"></i></a>16.77. Query#within()</h2>
<p>Defines a $within or $geoWithin argument for geo-spatial queries.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_111"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_111" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_111"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query> this</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_84"><a name="&#x53C2;&#x89C1;&#xFF1A;_84" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_84"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/polygon/" target="_blank">$polygon</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/box/" target="_blank">$box</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/geometry/" target="_blank">$geometry</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/center/" target="_blank">$center</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/reference/operator/centerSphere/" target="_blank">$centerSphere</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_111"><a name="&#x793A;&#x4F8B;&#xFF1A;_111" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_111"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">box</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">geometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">{</span> center<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> radius<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> spherical<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">{</span> box<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">40.73</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">73.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">40.7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">73.988</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">{</span> polygon<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// polygon</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// box</span>
query<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;loc&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;LineString&apos;</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// geometry</span>
</code></pre>
<p><strong>MUST</strong> be used after where().</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_42"><a name="&#x6CE8;&#x610F;&#xFF1A;_42" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_42"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>As of Mongoose 3.7, $geoWithin is always used for queries. To change this behavior, see Query.use$geoWithin.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_43"><a name="&#x6CE8;&#x610F;&#xFF1A;_43" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_43"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>In Mongoose 3.7, within changed from a getter to a function. If you need the old syntax, use this.</p>
<h2 id="queryusegeowithin"><a name="queryusegeowithin" class="anchor-navigation-ex-anchor" href="#queryusegeowithin"><i class="fa fa-link" aria-hidden="true"></i></a>16.78. Query#use$geoWithin</h2>
<p>Flag to opt out of using $geoWithin.</p>
<pre class="language-"><code class="lang-js">mongoose<span class="token punctuation">.</span>Query<span class="token punctuation">.</span>use$geoWithin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre>
<p>MongoDB 2.4 deprecated the use of $within, replacing it with $geoWithin. Mongoose uses $geoWithin by default (which is 100% backward compatible with $within). If you are running an older version of MongoDB, set this flag to false so your within() queries continue to work.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Query_use_geoWithin" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Query_use_geoWithin"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Query_use_geoWithin"><div class="panel-body">
<pre class="language-"><code class="lang-js">Query<span class="token punctuation">.</span>use$geoWithin <span class="token operator">=</span> mquery<span class="token punctuation">.</span>use$geoWithin<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_85"><a name="&#x53C2;&#x89C1;&#xFF1A;_85" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_85"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<p><a href="http://docs.mongodb.org/manual/reference/operator/geoWithin/" target="_blank">http://docs.mongodb.org/manual/reference/operator/geoWithin/</a></p>
<hr>
<h1 id="aggregatejs"><a name="aggregatejs" class="anchor-navigation-ex-anchor" href="#aggregatejs"><i class="fa fa-link" aria-hidden="true"></i></a>17. aggregate.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/aggregate.js" target="_blank">aggregate.js</a></p>
</blockquote>
<h2 id="aggregateaddcursorflagflag-value"><a name="aggregateaddcursorflagflag-value" class="anchor-navigation-ex-anchor" href="#aggregateaddcursorflagflag-value"><i class="fa fa-link" aria-hidden="true"></i></a>17.1. Aggregate#addCursorFlag(flag, value)</h2>
<p>Adds a cursor flag</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_154"><a name="&#x53C2;&#x6570;&#xFF1A;_154" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_154"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>flag &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p>value &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_86"><a name="&#x53C2;&#x89C1;&#xFF1A;_86" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_86"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Cursor.html#addCursorFlag" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_112"><a name="&#x793A;&#x4F8B;&#xFF1A;_112" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_112"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCursorFlag</span><span class="token punctuation">(</span><span class="token string">&apos;noCursorTimeout&apos;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_addCursorFlag" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_addCursorFlag"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_addCursorFlag"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addCursorFlag <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>flag<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateaddfieldsarg"><a name="aggregateaddfieldsarg" class="anchor-navigation-ex-anchor" href="#aggregateaddfieldsarg"><i class="fa fa-link" aria-hidden="true"></i></a>17.2. Aggregate#addFields(arg)</h2>
<p>Appends a new $addFields operator to this aggregate pipeline.
Requires MongoDB v3.4+ to work</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_155"><a name="&#x53C2;&#x6570;&#xFF1A;_155" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_155"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; field specification</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_112"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_112" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_112"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_87"><a name="&#x53C2;&#x89C1;&#xFF1A;_87" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_87"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/" target="_blank">$addFields</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_113"><a name="&#x793A;&#x4F8B;&#xFF1A;_113" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_113"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// adding new fields based on existing fields</span>
aggregate<span class="token punctuation">.</span><span class="token function">addFields</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    newField<span class="token punctuation">:</span> <span class="token string">&apos;$b.nested&apos;</span>
  <span class="token punctuation">,</span> plusTen<span class="token punctuation">:</span> <span class="token punctuation">{</span> $add<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;$val&apos;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
  <span class="token punctuation">,</span> sub<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       name<span class="token punctuation">:</span> <span class="token string">&apos;$a&apos;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// etc</span>
aggregate<span class="token punctuation">.</span><span class="token function">addFields</span><span class="token punctuation">(</span><span class="token punctuation">{</span> salary_k<span class="token punctuation">:</span> <span class="token punctuation">{</span> $divide<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;$salary&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_addFields" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_addFields"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_addFields"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>addFields <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>util<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid addFields() argument. Must be an object&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$addFields<span class="token punctuation">:</span> fields<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateops"><a name="aggregateops" class="anchor-navigation-ex-anchor" href="#aggregateops"><i class="fa fa-link" aria-hidden="true"></i></a>17.3. Aggregate([ops])</h2>
<p>Aggregate constructor used for building aggregation pipelines.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_156"><a name="&#x53C2;&#x6570;&#xFF1A;_156" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_156"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[ops]</code> <object, array=""> aggregation operator(s) or operator array</object,></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_88"><a name="&#x53C2;&#x89C1;&#xFF1A;_88" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_88"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/applications/aggregation/" target="_blank">MongoDB</a></p>
</li>
<li><p><a href="http://mongodb.github.com/node-mongodb-native/api-generated/collection.html#aggregate" target="_blank">driver</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_114"><a name="&#x793A;&#x4F8B;&#xFF1A;_114" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_114"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $project<span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $project<span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $skip<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> $project<span class="token punctuation">:</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $skip<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Returned when calling Model.aggregate().</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_115"><a name="&#x793A;&#x4F8B;&#xFF1A;_115" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_115"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model
<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $match<span class="token punctuation">:</span> <span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">21</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">unwind</span><span class="token punctuation">(</span><span class="token string">&apos;tags&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_44"><a name="&#x6CE8;&#x610F;&#xFF1A;_44" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_44"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<ul>
<li>The documents returned are plain javascript objects, not mongoose documents (since any shape of document can be returned).</li>
<li>Requires MongoDB &gt;= 2.1</li>
<li>Mongoose does not cast pipeline stages. new Aggregate({ $match: { _id: &apos;00000000000000000000000a&apos; } }); will not work unless _id is a string in the database. Use new Aggregate({ $match: { _id: mongoose.Types.ObjectId(&apos;00000000000000000000000a&apos;) } }); instead.</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="aggregate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="aggregate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="aggregate"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_model <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> util<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>append<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>append<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateallowdiskusevalue-tags"><a name="aggregateallowdiskusevalue-tags" class="anchor-navigation-ex-anchor" href="#aggregateallowdiskusevalue-tags"><i class="fa fa-link" aria-hidden="true"></i></a>17.4. Aggregate#allowDiskUse(value, [tags])</h2>
<p>Sets the allowDiskUse option for the aggregation query (ignored for &lt; 2.6.0)</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_157"><a name="&#x53C2;&#x6570;&#xFF1A;_157" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_157"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; Should tell server it can use hard drive to store data during aggregation.</p>
</li>
<li><p><code>[tags]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; optional tags for this query</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_89"><a name="&#x53C2;&#x89C1;&#xFF1A;_89" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_89"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/command/aggregate/" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_116"><a name="&#x793A;&#x4F8B;&#xFF1A;_116" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_116"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">allowDiskUse</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_allowDiskUse" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_allowDiskUse"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_allowDiskUse"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>allowDiskUse <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>allowDiskUse <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateappendops"><a name="aggregateappendops" class="anchor-navigation-ex-anchor" href="#aggregateappendops"><i class="fa fa-link" aria-hidden="true"></i></a>17.5. Aggregate#append(ops)</h2>
<p>Appends new operators to this aggregate pipeline</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_158"><a name="&#x53C2;&#x6570;&#xFF1A;_158" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_158"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>ops</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; operator(s) to append</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_113"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_113" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_113"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_117"><a name="&#x793A;&#x4F8B;&#xFF1A;_117" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_117"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $project<span class="token punctuation">:</span> <span class="token punctuation">{</span> field<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $limit<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or pass an array</span>
<span class="token keyword">var</span> pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> $match<span class="token punctuation">:</span> <span class="token punctuation">{</span> daw<span class="token punctuation">:</span> <span class="token string">&apos;Logic Audio X&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
aggregate<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_append" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_append"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_append"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>append <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> util<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span>isOperator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Arguments must be aggregate pipeline operators&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_pipeline <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pipeline<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatecollationcollation-value"><a name="aggregatecollationcollation-value" class="anchor-navigation-ex-anchor" href="#aggregatecollationcollation-value"><i class="fa fa-link" aria-hidden="true"></i></a>17.6. Aggregate#collation(collation, value)</h2>
<p>Adds a <a href="../../../GLOSSARY.html#collation" class="glossary-term" title="wiki">collation</a></p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_159"><a name="&#x53C2;&#x6570;&#xFF1A;_159" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_159"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>collation</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options</p>
</li>
<li><p><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_90"><a name="&#x53C2;&#x89C1;&#xFF1A;_90" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_90"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#aggregate" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_118"><a name="&#x793A;&#x4F8B;&#xFF1A;_118" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_118"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<p>Model.aggregate(..).<a href="../../../GLOSSARY.html#collation" class="glossary-term" title="wiki">collation</a>({ locale: &apos;en_US&apos;, strength: 1 }).exec();
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_collation" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_collation"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_collation"><div class="panel-body"></div></div></div></sec></p>
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collation <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>collation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation <span class="token operator">=</span> collation<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>

<h2 id="aggregatecursoroptions-optionsbatchsize-optionsusemongooseaggcursor"><a name="aggregatecursoroptions-optionsbatchsize-optionsusemongooseaggcursor" class="anchor-navigation-ex-anchor" href="#aggregatecursoroptions-optionsbatchsize-optionsusemongooseaggcursor"><i class="fa fa-link" aria-hidden="true"></i></a>17.7. Aggregate#cursor(options, options.batchSize, [options.useMongooseAggCursor])</h2>
<p>Sets the cursor option option for the aggregation query (ignored for &lt; 2.6.0).
Note the different syntax below: .exec() returns a cursor object, and no callback
is necessary.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_160"><a name="&#x53C2;&#x6570;&#xFF1A;_160" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_160"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>options.batchSize</code> <number> set the cursor batch size</number></p>
</li>
<li><p><code>[options.useMongooseAggCursor]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; use experimental mongoose-specific aggregation cursor (for eachAsync() and other query cursor semantics)</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_91"><a name="&#x53C2;&#x89C1;&#xFF1A;_91" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_91"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/2.0/api/AggregationCursor.html" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_119"><a name="&#x793A;&#x4F8B;&#xFF1A;_119" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_119"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> cursor <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> batchSize<span class="token punctuation">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// use doc</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_cursor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_cursor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_cursor"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>cursor <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateexeccallback"><a name="aggregateexeccallback" class="anchor-navigation-ex-anchor" href="#aggregateexeccallback"><i class="fa fa-link" aria-hidden="true"></i></a>17.8. Aggregate#exec([callback])</h2>
<p>Executes the aggregate pipeline on the currently bound Model.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_161"><a name="&#x53C2;&#x6570;&#xFF1A;_161" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_161"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_114"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_114" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_114"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_92"><a name="&#x53C2;&#x89C1;&#xFF1A;_92" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_92"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Promise</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_120"><a name="&#x793A;&#x4F8B;&#xFF1A;_120" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_120"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Because a promise is returned, the `callback` is optional.</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> aggregate<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_exec" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_exec"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_exec"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>exec <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Aggregate not bound to any Model&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_model<span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> options <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> pipeline <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pipeline<span class="token punctuation">;</span>
  <span class="token keyword">var</span> collection <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_model<span class="token punctuation">.</span>collection<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> options<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>collection<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> cursor <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">decorateCursor</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        collection<span class="token punctuation">.</span>emitter<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&apos;queue&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> cursor <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">decorateCursor</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>useMongooseAggCursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> options<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>useMongooseAggCursor<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AggregationCursor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> cursor <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">decorateCursor</span><span class="token punctuation">(</span>cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cursor<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pipeline<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Aggregate has empty pipeline&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">prepareDiscriminatorPipeline</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>

    model<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">execPre</span><span class="token punctuation">(</span><span class="token string">&apos;aggregate&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> _opts <span class="token operator">=</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> error <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> model<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">execPost</span><span class="token punctuation">(</span><span class="token string">&apos;aggregate&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _opts<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      collection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> _opts <span class="token operator">=</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> error <span class="token punctuation">}</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">execPost</span><span class="token punctuation">(</span><span class="token string">&apos;aggregate&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">,</span> <span class="token punctuation">[</span>result<span class="token punctuation">]</span><span class="token punctuation">,</span> _opts<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateexplaincallback"><a name="aggregateexplaincallback" class="anchor-navigation-ex-anchor" href="#aggregateexplaincallback"><i class="fa fa-link" aria-hidden="true"></i></a>17.9. Aggregate#explain(callback)</h2>
<p>Execute the aggregation with explain</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_162"><a name="&#x53C2;&#x6570;&#xFF1A;_162" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_162"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_115"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_115" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_115"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_121"><a name="&#x793A;&#x4F8B;&#xFF1A;_121" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_121"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_explain" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_explain"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_explain"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>explain <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_this<span class="token punctuation">.</span>_pipeline<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Aggregate has empty pipeline&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">prepareDiscriminatorPipeline</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>

    _this<span class="token punctuation">.</span>_model
        <span class="token punctuation">.</span>collection
        <span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>_pipeline<span class="token punctuation">,</span> _this<span class="token punctuation">.</span>options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatefacetfacet"><a name="aggregatefacetfacet" class="anchor-navigation-ex-anchor" href="#aggregatefacetfacet"><i class="fa fa-link" aria-hidden="true"></i></a>17.10. Aggregate#facet(facet)</h2>
<p>Combines multiple aggregation pipelines.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_163"><a name="&#x53C2;&#x6570;&#xFF1A;_163" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_163"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>facet</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_116"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_116" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_116"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate> this</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_93"><a name="&#x53C2;&#x89C1;&#xFF1A;_93" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_93"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.com/v3.4/reference/operator/aggregation/facet/" target="_blank">$facet</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_122"><a name="&#x793A;&#x4F8B;&#xFF1A;_122" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_122"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">facet</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   books<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> groupBy<span class="token punctuation">:</span> <span class="token string">&apos;$author&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   price<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> $bucketAuto<span class="token punctuation">:</span> <span class="token punctuation">{</span> groupBy<span class="token punctuation">:</span> <span class="token string">&apos;$price&apos;</span><span class="token punctuation">,</span> buckets<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>// Output: { books: [...], price: [{...}, {...}] }
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_facet" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_facet"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_facet"><div class="panel-body"></div></div></div></sec></p>
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>facet <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$facet<span class="token punctuation">:</span> options<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>

<h2 id="aggregategraphlookupoptions"><a name="aggregategraphlookupoptions" class="anchor-navigation-ex-anchor" href="#aggregategraphlookupoptions"><i class="fa fa-link" aria-hidden="true"></i></a>17.11. Aggregate#graphLookup(options)</h2>
<p>Appends new custom $graphLookup operator(s) to this aggregate pipeline, performing a recursive search on a collection.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_164"><a name="&#x53C2;&#x6570;&#xFF1A;_164" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_164"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; to $graphLookup as described in the above link</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_117"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_117" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_117"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_94"><a name="&#x53C2;&#x89C1;&#xFF1A;_94" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_94"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/#pipe._S_graphLookup" target="_blank">$graphLookup</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_45"><a name="&#x6CE8;&#x610F;&#xFF1A;_45" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_45"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p> that graphLookup can only consume at most 100MB of memory, and does not allow disk use even if { allowDiskUse: true } is specified.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_123"><a name="&#x793A;&#x4F8B;&#xFF1A;_123" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_123"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Suppose we have a collection of courses, where a document might look like `{ _id: 0, name: &apos;Calculus&apos;, prerequisite: &apos;Trigonometry&apos;}` and `{ _id: 0, name: &apos;Trigonometry&apos;, prerequisite: &apos;Algebra&apos; }`</span>
 aggregate<span class="token punctuation">.</span><span class="token function">graphLookup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">&apos;courses&apos;</span><span class="token punctuation">,</span> startWith<span class="token punctuation">:</span> <span class="token string">&apos;$prerequisite&apos;</span><span class="token punctuation">,</span> connectFromField<span class="token punctuation">:</span> <span class="token string">&apos;prerequisite&apos;</span><span class="token punctuation">,</span> connectToField<span class="token punctuation">:</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">&apos;prerequisites&apos;</span><span class="token punctuation">,</span> maxDepth<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// this will recursively search the &apos;courses&apos; collection up to 3 prerequisites</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_graphLooku" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_graphLooku"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_graphLooku"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>graphLookup <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> cloneOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid graphLookup() argument. Must be an object.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    utils<span class="token punctuation">.</span><span class="token function">mergeClone</span><span class="token punctuation">(</span>cloneOptions<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> startWith <span class="token operator">=</span> cloneOptions<span class="token punctuation">.</span>startWith<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>startWith <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> startWith <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cloneOptions<span class="token punctuation">.</span>startWith <span class="token operator">=</span> cloneOptions<span class="token punctuation">.</span>startWith<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;$&apos;</span> <span class="token operator">?</span>
        cloneOptions<span class="token punctuation">.</span>startWith <span class="token punctuation">:</span>
        <span class="token string">&apos;$&apos;</span> <span class="token operator">+</span> cloneOptions<span class="token punctuation">.</span>startWith<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $graphLookup<span class="token punctuation">:</span> cloneOptions <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregategrouparg"><a name="aggregategrouparg" class="anchor-navigation-ex-anchor" href="#aggregategrouparg"><i class="fa fa-link" aria-hidden="true"></i></a>17.12. Aggregate#group(arg)</h2>
<p>Appends a new custom $group operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_165"><a name="&#x53C2;&#x6570;&#xFF1A;_165" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_165"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; $group operator contents</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_118"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_118" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_118"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_95"><a name="&#x53C2;&#x89C1;&#xFF1A;_95" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_95"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/group/" target="_blank">$group</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_124"><a name="&#x793A;&#x4F8B;&#xFF1A;_124" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_124"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token string">&quot;$department&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregatelimitnum"><a name="aggregatelimitnum" class="anchor-navigation-ex-anchor" href="#aggregatelimitnum"><i class="fa fa-link" aria-hidden="true"></i></a>17.13. Aggregate#limit(num)</h2>
<p>Appends a new $limit operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_166"><a name="&#x53C2;&#x6570;&#xFF1A;_166" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_166"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>num</code> <number> maximum number of records to pass to the next stage</number></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_119"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_119" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_119"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_96"><a name="&#x53C2;&#x89C1;&#xFF1A;_96" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_96"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/limit/" target="_blank">$limit</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_125"><a name="&#x793A;&#x4F8B;&#xFF1A;_125" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_125"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregatelookupoptions"><a name="aggregatelookupoptions" class="anchor-navigation-ex-anchor" href="#aggregatelookupoptions"><i class="fa fa-link" aria-hidden="true"></i></a>17.14. Aggregate#lookup(options)</h2>
<p>Appends new custom $lookup operator(s) to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_167"><a name="&#x53C2;&#x6570;&#xFF1A;_167" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_167"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; to $lookup as described in the above link</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_120"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_120" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_120"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_97"><a name="&#x53C2;&#x89C1;&#xFF1A;_97" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_97"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.org/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank">$lookup</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_126"><a name="&#x793A;&#x4F8B;&#xFF1A;_126" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_126"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">&apos;users&apos;</span><span class="token punctuation">,</span> localField<span class="token punctuation">:</span> <span class="token string">&apos;userId&apos;</span><span class="token punctuation">,</span> foreignField<span class="token punctuation">:</span> <span class="token string">&apos;_id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">&apos;users&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_lookup" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_lookup"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_lookup"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lookup <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$lookup<span class="token punctuation">:</span> options<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatematcharg"><a name="aggregatematcharg" class="anchor-navigation-ex-anchor" href="#aggregatematcharg"><i class="fa fa-link" aria-hidden="true"></i></a>17.15. Aggregate#match(arg)</h2>
<p>Appends a new custom $match operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_168"><a name="&#x53C2;&#x6570;&#xFF1A;_168" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_168"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; $match operator contents</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_121"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_121" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_121"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_98"><a name="&#x53C2;&#x89C1;&#xFF1A;_98" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_98"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/match/" target="_blank">$match</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_127"><a name="&#x793A;&#x4F8B;&#xFF1A;_127" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_127"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token punctuation">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;sales&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;engineering&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregatemodelmodel"><a name="aggregatemodelmodel" class="anchor-navigation-ex-anchor" href="#aggregatemodelmodel"><i class="fa fa-link" aria-hidden="true"></i></a>17.16. Aggregate#model(model)</h2>
<p>Binds this aggregate to a model.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_169"><a name="&#x53C2;&#x6570;&#xFF1A;_169" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_169"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>model</code> <model> the model to which the aggregate is to be bound</model></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_122"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_122" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_122"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_model" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_model"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_model"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_model <span class="token operator">=</span> model<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
        model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>read <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>readPreference <span class="token operator">=</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>read<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
        model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation <span class="token operator">=</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>collation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatenearparameters"><a name="aggregatenearparameters" class="anchor-navigation-ex-anchor" href="#aggregatenearparameters"><i class="fa fa-link" aria-hidden="true"></i></a>17.17. Aggregate#near(parameters)</h2>
<p>Appends a new $geoNear operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_170"><a name="&#x53C2;&#x6570;&#xFF1A;_170" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_170"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>parameters</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_123"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_123" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_123"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_99"><a name="&#x53C2;&#x89C1;&#xFF1A;_99" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_99"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/geoNear/" target="_blank">$geoNear</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_46"><a name="&#x6CE8;&#x610F;&#xFF1A;_46" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_46"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><strong>MUST</strong> be used as the first operator in the pipeline.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_128"><a name="&#x793A;&#x4F8B;&#xFF1A;_128" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_128"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">near</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  near<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">40.724</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">73.997</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  distanceField<span class="token punctuation">:</span> <span class="token string">&quot;dist.calculated&quot;</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// required</span>
  maxDistance<span class="token punctuation">:</span> <span class="token number">0.008</span><span class="token punctuation">,</span>
  query<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;public&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  includeLocs<span class="token punctuation">:</span> <span class="token string">&quot;dist.location&quot;</span><span class="token punctuation">,</span>
  uniqueDocs<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  num<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregateoptionvalue"><a name="aggregateoptionvalue" class="anchor-navigation-ex-anchor" href="#aggregateoptionvalue"><i class="fa fa-link" aria-hidden="true"></i></a>17.18. Aggregate#option(value)</h2>
<p>Lets you set arbitrary options, for middleware or plugins.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_171"><a name="&#x53C2;&#x6570;&#xFF1A;_171" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_171"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; keys to merge into current options</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_124"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_124" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_124"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate> this</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_100"><a name="&#x53C2;&#x89C1;&#xFF1A;_100" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_100"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/command/aggregate/" target="_blank">mongodb</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_129"><a name="&#x793A;&#x4F8B;&#xFF1A;_129" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_129"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> agg <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token punctuation">{</span> allowDiskUse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Set the `allowDiskUse` option</span>
agg<span class="token punctuation">.</span>options<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// `{ allowDiskUse: true }`</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_option" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_option"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_option"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>option <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatepipeline"><a name="aggregatepipeline" class="anchor-navigation-ex-anchor" href="#aggregatepipeline"><i class="fa fa-link" aria-hidden="true"></i></a>17.19. Aggregate#pipeline()</h2>
<p>Returns the current pipeline</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_125"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_125" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_125"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_130"><a name="&#x793A;&#x4F8B;&#xFF1A;_130" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_130"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">MyModel<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token punctuation">{</span> test<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [{ $match: { test: 1 } }]</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_pipeline" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_pipeline"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_pipeline"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>pipeline <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pipeline<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateprojectarg"><a name="aggregateprojectarg" class="anchor-navigation-ex-anchor" href="#aggregateprojectarg"><i class="fa fa-link" aria-hidden="true"></i></a>17.20. Aggregate#project(arg)</h2>
<p>Appends a new $project operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_172"><a name="&#x53C2;&#x6570;&#xFF1A;_172" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_172"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> <object, string=""> field specification</object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_126"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_126" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_126"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_101"><a name="&#x53C2;&#x89C1;&#xFF1A;_101" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_101"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/project/" target="_blank">projection</a></li>
</ul>
<p>Mongoose query selection syntax is also supported.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_131"><a name="&#x793A;&#x4F8B;&#xFF1A;_131" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_131"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// include a, include b, exclude _id</span>
aggregate<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token string">&quot;a b -_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or you may use object notation, useful when</span>
<span class="token comment" spellcheck="true">// you have keys already prefixed with a &quot;-&quot;</span>
aggregate<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// reshaping documents</span>
aggregate<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    newField<span class="token punctuation">:</span> <span class="token string">&apos;$b.nested&apos;</span>
  <span class="token punctuation">,</span> plusTen<span class="token punctuation">:</span> <span class="token punctuation">{</span> $add<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;$val&apos;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
  <span class="token punctuation">,</span> sub<span class="token punctuation">:</span> <span class="token punctuation">{</span>
       name<span class="token punctuation">:</span> <span class="token string">&apos;$a&apos;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// etc</span>
aggregate<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">{</span> salary_k<span class="token punctuation">:</span> <span class="token punctuation">{</span> $divide<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;$salary&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_project" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_project"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_project"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>project <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>util<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">var</span> include <span class="token operator">=</span> field<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;-&apos;</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>include <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        field <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      fields<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> include<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid project() argument. Must be string or object&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$project<span class="token punctuation">:</span> fields<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatereadpref-tags"><a name="aggregatereadpref-tags" class="anchor-navigation-ex-anchor" href="#aggregatereadpref-tags"><i class="fa fa-link" aria-hidden="true"></i></a>17.21. Aggregate#read(pref, [tags])</h2>
<p>Sets the readPreference option for the aggregation query.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_173"><a name="&#x53C2;&#x6570;&#xFF1A;_173" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_173"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>pref</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; one of the listed preference options or their aliases</p>
</li>
<li><p><code>[tags]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt; optional tags for this query</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_102"><a name="&#x53C2;&#x89C1;&#xFF1A;_102" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_102"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/applications/replication/#read-preference" target="_blank">mongodb</a></p>
</li>
<li><p><a href="http://mongodb.github.com/node-mongodb-native/driver-articles/anintroductionto1_1and2_2.html#read-preferences" target="_blank">driver</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_132"><a name="&#x793A;&#x4F8B;&#xFF1A;_132" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_132"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">&apos;primaryPreferred&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_read" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_read"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_read"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>read <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>pref<span class="token punctuation">,</span> tags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  read<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> pref<span class="token punctuation">,</span> tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatesamplesize"><a name="aggregatesamplesize" class="anchor-navigation-ex-anchor" href="#aggregatesamplesize"><i class="fa fa-link" aria-hidden="true"></i></a>17.22. Aggregate#sample(size)</h2>
<p>Appepnds new custom $sample operator(s) to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_174"><a name="&#x53C2;&#x6570;&#xFF1A;_174" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_174"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>size</code> <number> number of random documents to pick</number></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_127"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_127" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_127"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_103"><a name="&#x53C2;&#x89C1;&#xFF1A;_103" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_103"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://docs.mongodb.org/manual/reference/operator/aggregation/sample/#pipe._S_sample" target="_blank">$sample</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_133"><a name="&#x793A;&#x4F8B;&#xFF1A;_133" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_133"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Add a pipeline that picks 3 random documents</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_sample" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_sample"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_sample"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sample <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$sample<span class="token punctuation">:</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> size<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateskipnum"><a name="aggregateskipnum" class="anchor-navigation-ex-anchor" href="#aggregateskipnum"><i class="fa fa-link" aria-hidden="true"></i></a>17.23. Aggregate#skip(num)</h2>
<p>Appends a new $skip operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_175"><a name="&#x53C2;&#x6570;&#xFF1A;_175" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_175"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>num</code> <number> number of records to skip before next stage</number></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_128"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_128" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_128"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_104"><a name="&#x53C2;&#x89C1;&#xFF1A;_104" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_104"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/skip/" target="_blank">$skip</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_134"><a name="&#x793A;&#x4F8B;&#xFF1A;_134" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_134"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregatesortarg"><a name="aggregatesortarg" class="anchor-navigation-ex-anchor" href="#aggregatesortarg"><i class="fa fa-link" aria-hidden="true"></i></a>17.24. Aggregate#sort(arg)</h2>
<p>Appends a new $sort operator to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_176"><a name="&#x53C2;&#x6570;&#xFF1A;_176" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_176"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>arg</code> <object, string=""></object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_129"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_129" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_129"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate> this</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_105"><a name="&#x53C2;&#x89C1;&#xFF1A;_105" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_105"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/sort/" target="_blank">$sort</a></li>
</ul>
<p>If an object is passed, values allowed are asc, desc, ascending, descending, 1, and -1.</p>
<p>If a string is passed, it must be a space delimited list of path names. The sort order of each path is ascending unless the path name is prefixed with - which will be treated as descending.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_135"><a name="&#x793A;&#x4F8B;&#xFF1A;_135" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_135"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// these are equivalent</span>
aggregate<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> field<span class="token punctuation">:</span> <span class="token string">&apos;asc&apos;</span><span class="token punctuation">,</span> test<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
aggregate<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">&apos;field -test&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_sort" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_sort"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_sort"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sort <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// TODO refactor to reuse the query builder logic</span>

  <span class="token keyword">var</span> sort <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> desc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;desc&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;descending&apos;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// If sorting by text score, skip coercing into 1/-1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">.</span>$meta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sort<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      sort<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> desc<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>arg<span class="token punctuation">[</span>field<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arg<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>field<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">var</span> ascend <span class="token operator">=</span> field<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;-&apos;</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>ascend <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        field <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      sort<span class="token punctuation">[</span>field<span class="token punctuation">]</span> <span class="token operator">=</span> ascend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid sort() argument. Must be a string or object.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$sort<span class="token punctuation">:</span> sort<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregatethenresolve-reject"><a name="aggregatethenresolve-reject" class="anchor-navigation-ex-anchor" href="#aggregatethenresolve-reject"><i class="fa fa-link" aria-hidden="true"></i></a>17.25. Aggregate#then([resolve], [reject])</h2>
<p>Provides promise for aggregate.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_177"><a name="&#x53C2;&#x6570;&#xFF1A;_177" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_177"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[resolve]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; successCallback</p>
</li>
<li><p><code>[reject]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; errorCallback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_130"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_130" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_130"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_106"><a name="&#x53C2;&#x89C1;&#xFF1A;_106" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_106"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Promise</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_136"><a name="&#x793A;&#x4F8B;&#xFF1A;_136" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_136"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>successCallback<span class="token punctuation">,</span> errorCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_then" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_then"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_then"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>then <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregateunwindfields"><a name="aggregateunwindfields" class="anchor-navigation-ex-anchor" href="#aggregateunwindfields"><i class="fa fa-link" aria-hidden="true"></i></a>17.26. Aggregate#unwind(fields)</h2>
<p>Appends new custom $unwind operator(s) to this aggregate pipeline.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_178"><a name="&#x53C2;&#x6570;&#xFF1A;_178" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_178"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fields</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the field(s) to unwind</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_131"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_131" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_131"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate>

</aggregate></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_107"><a name="&#x53C2;&#x89C1;&#xFF1A;_107" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_107"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://docs.mongodb.org/manual/reference/aggregation/unwind/" target="_blank">$unwind</a></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_47"><a name="&#x6CE8;&#x610F;&#xFF1A;_47" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_47"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>that the $unwind operator requires the path name to start with &apos;$&apos;.
Mongoose will prepend &apos;$&apos; if the specified field doesn&apos;t start &apos;$&apos;.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_137"><a name="&#x793A;&#x4F8B;&#xFF1A;_137" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_137"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">aggregate<span class="token punctuation">.</span><span class="token function">unwind</span><span class="token punctuation">(</span><span class="token string">&quot;tags&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
aggregate<span class="token punctuation">.</span><span class="token function">unwind</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Aggregate_unwind" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Aggregate_unwind"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Aggregate_unwind"><div class="panel-body">
<pre class="language-"><code class="lang-js">Aggregate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>unwind <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arg <span class="token operator">=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $unwind<span class="token punctuation">:</span> arg <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        $unwind<span class="token punctuation">:</span> <span class="token punctuation">(</span>arg <span class="token operator">&amp;&amp;</span> arg<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;$&apos;</span><span class="token punctuation">)</span> <span class="token operator">?</span> arg <span class="token punctuation">:</span> <span class="token string">&apos;$&apos;</span> <span class="token operator">+</span> arg
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid arg &quot;&apos;</span> <span class="token operator">+</span> arg <span class="token operator">+</span> <span class="token string">&apos;&quot; to unwind(), &apos;</span> <span class="token operator">+</span>
        <span class="token string">&apos;must be string or object&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>append<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="querystreamjs"><a name="querystreamjs" class="anchor-navigation-ex-anchor" href="#querystreamjs"><i class="fa fa-link" aria-hidden="true"></i></a>18. querystream.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/querystream.js" target="_blank">querystream.js</a></p>
</blockquote>
<h2 id="querystreamdestroyerr"><a name="querystreamdestroyerr" class="anchor-navigation-ex-anchor" href="#querystreamdestroyerr"><i class="fa fa-link" aria-hidden="true"></i></a>18.1. QueryStream#destroy([err])</h2>
<p>Destroys the stream, closing the underlying cursor, which emits the close event. No more events will be emitted after the close event.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_179"><a name="&#x53C2;&#x6570;&#xFF1A;_179" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_179"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[err]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank">Error</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream_destroy" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream_destroy"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream_destroy"><div class="panel-body">
<pre class="language-"><code class="lang-js">QueryStream<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>destroy <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_destroyed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_destroyed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>readable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;close&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreampause"><a name="querystreampause" class="anchor-navigation-ex-anchor" href="#querystreampause"><i class="fa fa-link" aria-hidden="true"></i></a>18.2. QueryStream#pause()</h2>
<p>Pauses this stream.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream_pause" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream_pause"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream_pause"><div class="panel-body">
<pre class="language-"><code class="lang-js">QueryStream<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>pause <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreampipe"><a name="querystreampipe" class="anchor-navigation-ex-anchor" href="#querystreampipe"><i class="fa fa-link" aria-hidden="true"></i></a>18.3. QueryStream#pipe()</h2>
<p>Pipes this query stream into another stream. This method is inherited from NodeJS Streams.</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_108"><a name="&#x53C2;&#x89C1;&#xFF1A;_108" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_108"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://nodejs.org/api/stream.html" target="_blank">NodeJS</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_138"><a name="&#x793A;&#x4F8B;&#xFF1A;_138" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_138"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">query<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="querystreamquery-options"><a name="querystreamquery-options" class="anchor-navigation-ex-anchor" href="#querystreamquery-options"><i class="fa fa-link" aria-hidden="true"></i></a>18.4. QueryStream(query, [options])</h2>
<p>Provides a Node.js 0.8 style ReadStream interface for Queries.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_180"><a name="&#x53C2;&#x6570;&#xFF1A;_180" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_180"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>query</code> <query></query></p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_2"><a name="&#x7EE7;&#x627F;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="http://nodejs.org/docs/v0.8.21/api/stream.html#stream_readable_stream" target="_blank">NodeJS Stream</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_2"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<ul>
<li><p><code>data</code>: emits a single Mongoose document</p>
</li>
<li><p><code>error</code>: emits when an error occurs during streaming. This will emit before the close event.</p>
</li>
<li><p><code>close</code>: emits when the stream reaches the end of the cursor or an error occurs, or the stream is manually destroyed. After this event, no more events are emitted.</p>
</li>
</ul>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> stream <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// do something with the mongoose document</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// handle the error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;close&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// the stream is closed</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The stream interface allows us to simply &quot;plug-in&quot; to other Node.js 0.8 style write streams.</p>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;created&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>twoWeeksAgo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;</h5>
<ul>
<li><code>transform</code>: optional function which accepts a mongoose document. The return value of the function will be emitted on data.</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_139"><a name="&#x793A;&#x4F8B;&#xFF1A;_139" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_139"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// JSON.stringify all documents before emitting</span>
<span class="token keyword">var</span> stream <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">{</span> transform<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span>stringify <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_48"><a name="&#x6CE8;&#x610F;&#xFF1A;_48" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_48"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>plugging into an HTTP response will <em>not</em> work out of the box. Those streams expect only strings or buffers to be emitted, so first formatting our documents as strings/buffers is necessary.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_49"><a name="&#x6CE8;&#x610F;&#xFF1A;_49" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_49"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>these streams are Node.js 0.8 style read streams which differ from Node.js 0.10 style. Node.js 0.10 streams are not well tested yet and are not guaranteed to work.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">QueryStream</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Stream<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>query <span class="token operator">=</span> query<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>readable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_destroyed <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_fields <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_buffer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_inline <span class="token operator">=</span> T_INIT<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_transform <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>transform <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span>
      <span class="token operator">?</span> options<span class="token punctuation">.</span>transform
      <span class="token punctuation">:</span> K<span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// give time to hook up events</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this<span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreamresume"><a name="querystreamresume" class="anchor-navigation-ex-anchor" href="#querystreamresume"><i class="fa fa-link" aria-hidden="true"></i></a>18.5. QueryStream#resume()</h2>
<p>Resumes this stream.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream_resume" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream_resume"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream_resume"><div class="panel-body">
<pre class="language-"><code class="lang-js">QueryStream<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>resume <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// cannot start if not initialized</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// are we within the trampoline?</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>T_INIT <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_inline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_running<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// outside QueryStream control, need manual restart</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreampaused"><a name="querystreampaused" class="anchor-navigation-ex-anchor" href="#querystreampaused"><i class="fa fa-link" aria-hidden="true"></i></a>18.6. QueryStream#paused</h2>
<p>Flag stating whether or not this stream is paused.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream_paused" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream_paused"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream_paused"><div class="panel-body">
<pre class="language-"><code class="lang-js">QueryStream<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>paused<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// trampoline flags</span>
<span class="token keyword">var</span> T_INIT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> T_IDLE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> T_CONT <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="querystreamreadable"><a name="querystreamreadable" class="anchor-navigation-ex-anchor" href="#querystreamreadable"><i class="fa fa-link" aria-hidden="true"></i></a>18.7. QueryStream#readable</h2>
<p>Flag stating whether or not this stream is readable.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryStream_readable" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryStream_readable"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryStream_readable"><div class="panel-body">
<pre class="language-"><code class="lang-js">QueryStream<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>readable<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="servicescursoreachasyncjs"><a name="servicescursoreachasyncjs" class="anchor-navigation-ex-anchor" href="#servicescursoreachasyncjs"><i class="fa fa-link" aria-hidden="true"></i></a>19. services/cursor/eachAsync.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/services/cursor/eachAsync.js" target="_blank">services/cursor/eachAsync.js</a></p>
</blockquote>
<h2 id="moduleexportsnext-fn-options-callback"><a name="moduleexportsnext-fn-options-callback" class="anchor-navigation-ex-anchor" href="#moduleexportsnext-fn-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>19.1. module.exports(next, fn, options, [callback])</h2>
<p>Execute fn for every document in the cursor. If fn returns a promise,
will wait for the promise to resolve before iterating on to the next one.
Returns a promise that resolves when done.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_181"><a name="&#x53C2;&#x6570;&#xFF1A;_181" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_181"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>next</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; the thunk to call to get the next document</p>
</li>
<li><p><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; executed when all docs have been processed</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_132"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_132" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_132"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>


</promise></li>
</ul>
<hr>
<h1 id="errorindexjs"><a name="errorindexjs" class="anchor-navigation-ex-anchor" href="#errorindexjs"><i class="fa fa-link" aria-hidden="true"></i></a>20. error/index.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/error/index.js" target="_blank">error/index.js</a></p>
</blockquote>
<h2 id="mongooseerrormsg"><a name="mongooseerrormsg" class="anchor-navigation-ex-anchor" href="#mongooseerrormsg"><i class="fa fa-link" aria-hidden="true"></i></a>20.1. MongooseError(msg)</h2>
<p>MongooseError constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_182"><a name="&#x53C2;&#x6570;&#xFF1A;_182" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_182"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>msg</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; Error message</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_3"><a name="&#x7EE7;&#x627F;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Error" target="_blank">Error</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="MongooseError" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MongooseError"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MongooseError"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">MongooseError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Error<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Error<span class="token punctuation">.</span>captureStackTrace<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Error<span class="token punctuation">.</span><span class="token function">captureStackTrace</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>stack<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> msg<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;MongooseError&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongooseerrordocumentnotfounderror"><a name="mongooseerrordocumentnotfounderror" class="anchor-navigation-ex-anchor" href="#mongooseerrordocumentnotfounderror"><i class="fa fa-link" aria-hidden="true"></i></a>20.2. MongooseError.DocumentNotFoundError</h2>
<p>This error will be called when save() fails because the underlying
document was not found. The constructor takes one parameter, the
conditions that mongoose passed to update() when trying to update
the document.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="MongooseError_DocumentNotFoundError" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MongooseError_DocumentNotFoundError"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MongooseError_DocumentNotFoundError"><div class="panel-body">
<pre class="language-"><code class="lang-js">MongooseError<span class="token punctuation">.</span>DocumentNotFoundError <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./notFound&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="mongooseerrormessages"><a name="mongooseerrormessages" class="anchor-navigation-ex-anchor" href="#mongooseerrormessages"><i class="fa fa-link" aria-hidden="true"></i></a>20.3. MongooseError.messages</h2>
<p>The default built-in validator error messages.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="MongooseError_messages" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MongooseError_messages"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MongooseError_messages"><div class="panel-body">
<pre class="language-"><code class="lang-js">MongooseError<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./messages&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// backward compat</span>
MongooseError<span class="token punctuation">.</span>Messages <span class="token operator">=</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_109"><a name="&#x53C2;&#x89C1;&#xFF1A;_109" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_109"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Error.messages</a></li>
</ul>
<hr>
<h1 id="errormessagesjs"><a name="errormessagesjs" class="anchor-navigation-ex-anchor" href="#errormessagesjs"><i class="fa fa-link" aria-hidden="true"></i></a>21. error/messages.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/error/messages.js" target="_blank">error/messages.js</a></p>
</blockquote>
<h2 id="mongooseerrormessages_1"><a name="mongooseerrormessages_1" class="anchor-navigation-ex-anchor" href="#mongooseerrormessages_1"><i class="fa fa-link" aria-hidden="true"></i></a>21.1. MongooseError.messages()</h2>
<p>The default built-in validator error messages. These may be customized.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="MongooseError_messages_" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="MongooseError_messages_"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="MongooseError_messages_"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> msg <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

msg<span class="token punctuation">.</span>DocumentNotFoundError <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

msg<span class="token punctuation">.</span>general <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>general<span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">=</span> <span class="token string">&apos;Validator failed for path `{PATH}` with value `{VALUE}`&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>general<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` is required.&apos;</span><span class="token punctuation">;</span>

msg<span class="token punctuation">.</span>Number <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>Number<span class="token punctuation">.</span>min <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` ({VALUE}) is less than minimum allowed value ({MIN}).&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>Number<span class="token punctuation">.</span>max <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` ({VALUE}) is more than maximum allowed value ({MAX}).&apos;</span><span class="token punctuation">;</span>

msg<span class="token punctuation">.</span>Date <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>min <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` ({VALUE}) is before minimum allowed value ({MIN}).&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>max <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` ({VALUE}) is after maximum allowed value ({MAX}).&apos;</span><span class="token punctuation">;</span>

msg<span class="token punctuation">.</span>String <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>String<span class="token punctuation">.</span><span class="token keyword">enum</span> <span class="token operator">=</span> <span class="token string">&apos;`{VALUE}` is not a valid enum value for path `{PATH}`.&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>String<span class="token punctuation">.</span>match <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` is invalid ({VALUE}).&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>String<span class="token punctuation">.</span>minlength <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` (`{VALUE}`) is shorter than the minimum allowed length ({MINLENGTH}).&apos;</span><span class="token punctuation">;</span>
msg<span class="token punctuation">.</span>String<span class="token punctuation">.</span>maxlength <span class="token operator">=</span> <span class="token string">&apos;Path `{PATH}` (`{VALUE}`) is longer than the maximum allowed length ({MAXLENGTH}).&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// customize within each schema or globally like so</span>
<span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>String<span class="token punctuation">.</span><span class="token keyword">enum</span>  <span class="token operator">=</span> <span class="token string">&quot;Your custom message for {PATH}.&quot;</span><span class="token punctuation">;</span>
</code></pre>
<p>As you might have noticed, error messages support basic templating</p>
<ul>
<li><code>{PATH}</code> is replaced with the invalid document path</li>
<li><code>{VALUE}</code> is replaced with the invalid value</li>
<li><code>{TYPE}</code> is replaced with the validator type such as &quot;regexp&quot;, &quot;min&quot;, or &quot;user defined&quot;</li>
<li><code>{MIN}</code> is replaced with the declared min value for the Number.min validator</li>
<li><code>{MAX}</code> is replaced with the declared max value for the Number.max validator</li>
</ul>
<p>Click the &quot;show code&quot; link below to see all defaults.</p>
<hr>
<h1 id="errorvalidationjs"><a name="errorvalidationjs" class="anchor-navigation-ex-anchor" href="#errorvalidationjs"><i class="fa fa-link" aria-hidden="true"></i></a>22. error/validation.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/error/validation.js" target="_blank">error/validation.js</a></p>
</blockquote>
<h2 id="validationerrortostring"><a name="validationerrortostring" class="anchor-navigation-ex-anchor" href="#validationerrortostring"><i class="fa fa-link" aria-hidden="true"></i></a>22.1. ValidationError#toString()</h2>
<p>Console.log helper</p>
<sec data-title="&#x6E90;&#x7801;" data-id="ValidationError_toString" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="ValidationError_toString"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="ValidationError_toString"><div class="panel-body">
<pre class="language-"><code class="lang-js">ValidationError<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&apos;: &apos;</span> <span class="token operator">+</span> <span class="token function">_generateMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="modeljs"><a name="modeljs" class="anchor-navigation-ex-anchor" href="#modeljs"><i class="fa fa-link" aria-hidden="true"></i></a>23. model.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/model.js" target="_blank">model.js</a></p>
</blockquote>
<h2 id="modelwhereargument"><a name="modelwhereargument" class="anchor-navigation-ex-anchor" href="#modelwhereargument"><i class="fa fa-link" aria-hidden="true"></i></a>23.1. Model#$where(argument)</h2>
<p>Creates a Query and specifies a $where condition.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_183"><a name="&#x53C2;&#x6570;&#xFF1A;_183" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_183"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>argument</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;is a javascript string or anonymous function</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_133"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_133" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_133"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_110"><a name="&#x53C2;&#x89C1;&#xFF1A;_110" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_110"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/api.html#query_Query-%24where" target="_blank">Query.$where</a></li>
</ul>
<p>Sometimes you need to query for things in mongodb using a JavaScript expression. You can do so via find({ $where: javascript }), or you can use the mongoose shortcut method $where via a Query chain or from your mongoose Model.</p>
<pre class="language-"><code class="lang-js">Blog<span class="token punctuation">.</span><span class="token function">$where</span><span class="token punctuation">(</span><span class="token string">&apos;this.username.indexOf(&quot;val&quot;) !== -1&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelincrement"><a name="modelincrement" class="anchor-navigation-ex-anchor" href="#modelincrement"><i class="fa fa-link" aria-hidden="true"></i></a>23.2. Model#increment()</h2>
<p>Signal that we desire an increment of this documents version.</p>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_111"><a name="&#x53C2;&#x89C1;&#xFF1A;_111" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_111"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">versionKeys</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_140"><a name="&#x793A;&#x4F8B;&#xFF1A;_140" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_140"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  doc<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_increment" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_increment"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_increment"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>increment <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>version <span class="token operator">=</span> VERSION_ALL<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelmodelname"><a name="modelmodelname" class="anchor-navigation-ex-anchor" href="#modelmodelname"><i class="fa fa-link" aria-hidden="true"></i></a>23.3. Model#model(name)</h2>
<p>Returns another Model instance.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_184"><a name="&#x53C2;&#x6570;&#xFF1A;_184" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_184"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>name &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; model name</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_141"><a name="&#x793A;&#x4F8B;&#xFF1A;_141" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_141"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tank</span><span class="token punctuation">;</span>
doc<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_model" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_model"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_model"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">model</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modeldoc"><a name="modeldoc" class="anchor-navigation-ex-anchor" href="#modeldoc"><i class="fa fa-link" aria-hidden="true"></i></a>23.4. Model(doc)</h2>
<p>Model constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_185"><a name="&#x53C2;&#x6570;&#xFF1A;_185" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_185"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; values with which to create the document</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_4"><a name="&#x7EE7;&#x627F;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">Document</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_3"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_3" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<ul>
<li><p><code>error</code>: If listening to this event, &apos;error&apos; is emitted when a document was saved without passing a callback and an error occurred. If not listening, the event bubbles to the connection used to create this Model.</p>
</li>
<li><p><code>index</code>: Emitted after Model#ensureIndexes completes. If an error occurred it is passed with the event.</p>
</li>
<li><p><code>index-single-start</code>: Emitted when an individual index starts within Model#ensureIndexes. The fields and options being used to build the index are also passed with the event.</p>
</li>
<li><p><code>index-single-done</code>: Emitted when an individual index finishes within Model#ensureIndexes. If an error occurred it is passed with the event. The fields, options, and index name are also passed.</p>
</li>
</ul>
<p>Provides the interface to MongoDB collections as well as creates document instances.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Model</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> skipId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fields <span class="token keyword">instanceof</span> <span class="token class-name">Schema</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&apos;2nd argument to `Model` must be a POJO or string, &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;**not** a schema. Make sure you\&apos;re calling `mongoose.model()`, not &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;`mongoose.Model()`.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Document<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> doc<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> skipId<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelremovefn"><a name="modelremovefn" class="anchor-navigation-ex-anchor" href="#modelremovefn"><i class="fa fa-link" aria-hidden="true"></i></a>23.5. Model#remove([fn])</h2>
<p>Removes this document from the db.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_186"><a name="&#x53C2;&#x6570;&#xFF1A;_186" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_186"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[fn]</code> <function(err, product)=""> optional callback</function(err,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_134"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_134" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_134"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> Promise</promise></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_142"><a name="&#x793A;&#x4F8B;&#xFF1A;_142" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_142"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Product<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span>_id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>As an extra measure of flow control, remove will return a Promise (bound to fn if passed) so it could be chained, or hooked to recive errors</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_143"><a name="&#x793A;&#x4F8B;&#xFF1A;_143" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_143"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_remove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_remove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_remove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>removing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>removing<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">fn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>isDeleted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>removing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> where <span class="token operator">=</span> _this<span class="token punctuation">.</span><span class="token function">$__where</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>where <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>safe <span class="token operator">&amp;&amp;</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>safe <span class="token operator">=</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>where<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _this<span class="token punctuation">.</span>$__<span class="token punctuation">.</span>isDeleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;remove&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;remove&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      _this<span class="token punctuation">.</span>$__<span class="token punctuation">.</span>isDeleted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fn <span class="token operator">&amp;&amp;</span> <span class="token function">fn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>removing<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelsaveoptions-optionssafe-optionsvalidatebeforesave-fn"><a name="modelsaveoptions-optionssafe-optionsvalidatebeforesave-fn" class="anchor-navigation-ex-anchor" href="#modelsaveoptions-optionssafe-optionsvalidatebeforesave-fn"><i class="fa fa-link" aria-hidden="true"></i></a>23.6. Model#save([options], [options.safe], [options.validateBeforeSave], [fn])</h2>
<p>Saves this document.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_187"><a name="&#x53C2;&#x6570;&#xFF1A;_187" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_187"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; options optional options</p>
</li>
<li><p><code>[options.safe]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; overrides schema&apos;s safe option</p>
</li>
<li><p><code>[options.validateBeforeSave]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; set to false to save without validating.</p>
</li>
<li><p><code>[fn]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_135"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_135" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_135"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> Promise</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_112"><a name="&#x53C2;&#x89C1;&#xFF1A;_112" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_112"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="middleware.html">middleware</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_144"><a name="&#x793A;&#x4F8B;&#xFF1A;_144" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_144"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span>sold <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
product<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> product<span class="token punctuation">,</span> numAffected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>The callback will receive three parameters</p>
<ul>
<li><code>err</code> if an error occurred</li>
<li><code>product</code> which is the saved product</li>
<li><code>numAffected</code> will be 1 when the document was successfully persisted to MongoDB, otherwise 0. Unless you tweak mongoose&apos;s internals, you don&apos;t need to worry about checking this parameter for errors - checking err is sufficient to make sure your document was properly saved.</li>
</ul>
<p>As an extra measure of flow control, save will return a Promise.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_145"><a name="&#x793A;&#x4F8B;&#xFF1A;_145" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_145"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">product<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>For legacy reasons, mongoose stores object keys in reverse order on initial
save. That is, { a: 1, b: 2 } will be saved as { b: 2, a: 1 } in
MongoDB. To override this behavior, set
<a href="http://mongoosejs.com/docs/api.html#document_Document-toObject" target="_blank">the toObject.retainKeyOrder option</a>
to true on your schema.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_save" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_save"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_save"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>save <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__save</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelaggregate-callback"><a name="modelaggregate-callback" class="anchor-navigation-ex-anchor" href="#modelaggregate-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.7. Model.aggregate([...], [callback])</h2>
<p>Performs <a href="">aggregations</a> on the models collection.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_aggregate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_aggregate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_aggregate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>aggregate <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
      aggregate<span class="token punctuation">,</span>
      callback<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> util<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    aggregate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    aggregate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Aggregate</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  aggregate<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">&apos;undefined&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> aggregate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  aggregate<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_188"><a name="&#x53C2;&#x6570;&#xFF1A;_188" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_188"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[...]</code> <object, array=""> aggregation pipeline operator(s) or operator array</object,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_136"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_136" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_136"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregate, promise="">

</aggregate,></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_113"><a name="&#x53C2;&#x89C1;&#xFF1A;_113" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_113"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongoosejs.com/docs/api.html#aggregate_Aggregate" target="_blank">Aggregate</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/applications/aggregation/" target="_blank">MongoDB</a></p>
</li>
</ul>
<p>If a callback is passed, the aggregate is executed and a Promise is returned. If a callback is not passed, the aggregate itself is returned.</p>
<p>This function does not trigger any middleware.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_146"><a name="&#x793A;&#x4F8B;&#xFF1A;_146" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_146"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Find the max balance of all accounts</span>
Users<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> $group<span class="token punctuation">:</span> <span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> maxBalance<span class="token punctuation">:</span> <span class="token punctuation">{</span> $max<span class="token punctuation">:</span> <span class="token string">&apos;$balance&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> $project<span class="token punctuation">:</span> <span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> maxBalance<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [ { maxBalance: 98000 } ]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Or use the aggregation pipeline builder.</span>
Users<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> maxBalance<span class="token punctuation">:</span> <span class="token punctuation">{</span> $max<span class="token punctuation">:</span> <span class="token string">&apos;$balance&apos;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;-id maxBalance&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [ { maxBalance: 98 } ]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_50"><a name="&#x6CE8;&#x610F;&#xFF1A;_50" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_50"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<ul>
<li>Arguments are not cast to the model&apos;s schema because $project operators allow redefining the &quot;shape&quot; of the documents at any stage of the pipeline, which may leave documents in an incompatible format.</li>
<li>The documents returned are plain javascript objects, not mongoose documents (since any shape of document can be returned).</li>
<li>Requires MongoDB &gt;= 2.1</li>
</ul>
<h2 id="modelbulkwriteops-options-callback"><a name="modelbulkwriteops-options-callback" class="anchor-navigation-ex-anchor" href="#modelbulkwriteops-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.8. Model.bulkWrite(ops, [options], [callback])</h2>
<p>Sends multiple insertOne, updateOne, updateMany, replaceOne,
deleteOne, and/or deleteMany operations to the MongoDB server in one
command. This is faster than sending multiple independent operations (like)
if you use create()) because with bulkWrite() there is only one round
trip to MongoDB.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_bulkWrite" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_bulkWrite"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_bulkWrite"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>bulkWrite <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>ops<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> validations <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;insertOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        op<span class="token punctuation">[</span><span class="token string">&apos;insertOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;document&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;insertOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;document&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        op<span class="token punctuation">[</span><span class="token string">&apos;insertOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;document&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;updateOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      op <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token string">&apos;updateOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">castUpdate</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            _this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>strict<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span>setDefaultsOnInsert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setDefaultsOnInsert</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
              setDefaultsOnInsert<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              upsert<span class="token punctuation">:</span> op<span class="token punctuation">.</span>upsert
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;updateMany&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      op <span class="token operator">=</span> op<span class="token punctuation">[</span><span class="token string">&apos;updateMany&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">castUpdate</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            strict<span class="token punctuation">:</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>strict<span class="token punctuation">,</span>
            overwrite<span class="token punctuation">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">.</span>setDefaultsOnInsert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setDefaultsOnInsert</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span> op<span class="token punctuation">[</span><span class="token string">&apos;update&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
              setDefaultsOnInsert<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              upsert<span class="token punctuation">:</span> op<span class="token punctuation">.</span>upsert
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span>
            op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// set `skipId`, otherwise we get &quot;_id field cannot be changed&quot;</span>
        op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;replacement&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span>
          <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;replacement&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        op<span class="token punctuation">[</span><span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;replacement&apos;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;deleteOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;deleteOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span>
            op<span class="token punctuation">[</span><span class="token string">&apos;deleteOne&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>op<span class="token punctuation">[</span><span class="token string">&apos;deleteMany&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          op<span class="token punctuation">[</span><span class="token string">&apos;deleteMany&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">,</span>
            op<span class="token punctuation">[</span><span class="token string">&apos;deleteMany&apos;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&apos;filter&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid op passed to `bulkWrite()`&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">parallel</span><span class="token punctuation">(</span>validations<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">bulkWrite</span><span class="token punctuation">(</span>ops<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_189"><a name="&#x53C2;&#x6570;&#xFF1A;_189" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_189"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>ops</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback <code>function(error, bulkWriteOpResult) {}</code></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_137"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_137" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_137"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise> resolves to a <code>BulkWriteOpResult</code> if the operation succeeds</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_114"><a name="&#x53C2;&#x89C1;&#xFF1A;_114" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_114"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~BulkWriteOpResult" target="_blank">writeOpResult</a></li>
</ul>
<p>Mongoose will perform casting on all operations you provide.</p>
<p>This function does not trigger any middleware, not save() nor update().
If you need to trigger
save() middleware for every document use <a href="">create()</a> instead.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_147"><a name="&#x793A;&#x4F8B;&#xFF1A;_147" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_147"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">bulkWrite</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    insertOne<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span><span class="token punctuation">,</span>
        title<span class="token punctuation">:</span> <span class="token string">&apos;Warden of the North&apos;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    updateOne<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      filter<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment" spellcheck="true">// If you were using the MongoDB driver directly, you&apos;d need to do</span>
      <span class="token comment" spellcheck="true">// `update: { $set: { title: ... } }` but mongoose adds $set for</span>
      <span class="token comment" spellcheck="true">// you.</span>
      update<span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token string">&apos;Hand of the King&apos;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    deleteOne<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">{</span>
        filter<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelcountconditions-callback"><a name="modelcountconditions-callback" class="anchor-navigation-ex-anchor" href="#modelcountconditions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.9. Model.count(conditions, [callback])</h2>
<p>Counts number of matching documents in a database collection.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_coun" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_coun"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_coun"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">count</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_190"><a name="&#x53C2;&#x6570;&#xFF1A;_190" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_190"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_138"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_138" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_138"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_148"><a name="&#x793A;&#x4F8B;&#xFF1A;_148" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_148"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Adventure<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;jungle&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;there are %d jungle adventures&apos;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelcreatedocs-callback"><a name="modelcreatedocs-callback" class="anchor-navigation-ex-anchor" href="#modelcreatedocs-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.10. Model.create(doc(s), [callback])</h2>
<p>Shortcut for saving one or more documents to the database.
MyModel.create(docs) does new MyModel(doc).save() for every doc in
docs.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_creat" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_creat"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_creat"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>create <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args<span class="token punctuation">;</span>
  <span class="token keyword">var</span> cb<span class="token punctuation">;</span>
  <span class="token keyword">var</span> discriminatorKey <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>discriminatorKey<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    args <span class="token operator">=</span> doc<span class="token punctuation">;</span>
    cb <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> last <span class="token operator">=</span> arguments<span class="token punctuation">[</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Handle falsy callbacks re: #5061</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> last <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span> <span class="token operator">||</span> <span class="token operator">!</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb <span class="token operator">=</span> last<span class="token punctuation">;</span>
      args <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      args <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cb <span class="token operator">&amp;&amp;</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> toExecute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> firstError<span class="token punctuation">;</span>
    args<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      toExecute<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> Model <span class="token operator">=</span> _this<span class="token punctuation">.</span>discriminators <span class="token operator">&amp;&amp;</span> doc<span class="token punctuation">[</span>discriminatorKey<span class="token punctuation">]</span> <span class="token operator">?</span>
          _this<span class="token punctuation">.</span>discriminators<span class="token punctuation">[</span>doc<span class="token punctuation">[</span>discriminatorKey<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>
          _this<span class="token punctuation">;</span>
        <span class="token keyword">var</span> toSave <span class="token operator">=</span> doc<span class="token punctuation">;</span>
        <span class="token keyword">var</span> callbackWrapper <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              firstError <span class="token operator">=</span> error<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> doc<span class="token punctuation">:</span> doc <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>toSave <span class="token keyword">instanceof</span> <span class="token class-name">Model</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            toSave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span>toSave<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">callbackWrapper</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// Hack to avoid getting a promise because of</span>
        <span class="token comment" spellcheck="true">// $__registerHooksFromSchema</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>toSave<span class="token punctuation">.</span>$__original_save<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          toSave<span class="token punctuation">.</span><span class="token function">$__original_save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callbackWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          toSave<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callbackWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">parallel</span><span class="token punctuation">(</span>toExecute<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> savedDocs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> len <span class="token operator">=</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          savedDocs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>firstError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">cb</span><span class="token punctuation">(</span>firstError<span class="token punctuation">,</span> savedDocs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>firstError<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>doc <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>savedDocs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cb <span class="token operator">&amp;&amp;</span> cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> savedDocs<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        resolve<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> savedDocs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          cb<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>savedDocs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_191"><a name="&#x53C2;&#x6570;&#xFF1A;_191" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_191"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>doc(s)</code> <array, object,="" *=""></array,></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_139"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_139" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_139"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>save()</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_149"><a name="&#x793A;&#x4F8B;&#xFF1A;_149" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_149"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// pass individual docs</span>
Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;jelly bean&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;snickers&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> jellybean<span class="token punctuation">,</span> snickers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// pass an array</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;jelly bean&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;snickers&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> candies<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ...</span>

  <span class="token keyword">var</span> jellybean <span class="token operator">=</span> candies<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> snickers <span class="token operator">=</span> candies<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// callback is optional; use the returned promise if you like:</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> Candy<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;jawbreaker&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>jawbreaker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="modelcreateindexesoptions-cb"><a name="modelcreateindexesoptions-cb" class="anchor-navigation-ex-anchor" href="#modelcreateindexesoptions-cb"><i class="fa fa-link" aria-hidden="true"></i></a>23.11. Model.createIndexes([options], [cb])</h2>
<p>Similar to ensureIndexes(), except for it uses the createIndex
function. The ensureIndex() function checks to see if an index with that
name already exists, and, if not, does not attempt to create the index.
createIndex() bypasses this check.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_createIndexes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_createIndexes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_createIndexes"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>createIndexes <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">createIndexes</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  options<span class="token punctuation">.</span>createIndex <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ensureIndexes</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_ensureIndexes</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> indexes <span class="token operator">=</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">indexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> done <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>emitIndexErrors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      model<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    model<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>indexes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment" spellcheck="true">// Indexes are created one-by-one to support how MongoDB &lt; 2.4 deals</span>
  <span class="token comment" spellcheck="true">// with background indexes.</span>

  <span class="token keyword">var</span> indexSingleDone <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> options<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;index-single-done&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> options<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> indexSingleStart <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fields<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;index-single-start&apos;</span><span class="token punctuation">,</span> fields<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> create <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>_automatic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>autoIndex <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">||</span>
          <span class="token punctuation">(</span>model<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>autoIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> model<span class="token punctuation">.</span>db<span class="token punctuation">.</span>config<span class="token punctuation">.</span>autoIndex <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> index <span class="token operator">=</span> indexes<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>index<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> indexFields <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> indexOptions <span class="token operator">=</span> index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">_handleSafe</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">indexSingleStart</span><span class="token punctuation">(</span>indexFields<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> methodName <span class="token operator">=</span> options<span class="token punctuation">.</span>createIndex <span class="token operator">?</span> <span class="token string">&apos;createIndex&apos;</span> <span class="token punctuation">:</span> <span class="token string">&apos;ensureIndex&apos;</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span>collection<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">(</span>indexFields<span class="token punctuation">,</span> indexOptions<span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">indexSingleDone</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> indexFields<span class="token punctuation">,</span> indexOptions<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// If buffering is off, do this manually.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>_automatic <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>model<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      model<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">addQueue</span><span class="token punctuation">(</span>create<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_handleSafe</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>safe <span class="token operator">===</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>w <span class="token operator">=</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>
      <span class="token keyword">delete</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>safe <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>w <span class="token operator">=</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">.</span>w<span class="token punctuation">;</span>
      options<span class="token punctuation">.</span>j <span class="token operator">=</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">.</span>j<span class="token punctuation">;</span>
      options<span class="token punctuation">.</span>wtimeout <span class="token operator">=</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">.</span>wtimeout<span class="token punctuation">;</span>
      <span class="token keyword">delete</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_192"><a name="&#x53C2;&#x6570;&#xFF1A;_192" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_192"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[options]</code>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; internal options</p>
</li>
<li><p><code>[cb]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_140"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_140" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_140"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>



</promise></li>
</ul>
<h2 id="modeldeletemanyconditions-callback"><a name="modeldeletemanyconditions-callback" class="anchor-navigation-ex-anchor" href="#modeldeletemanyconditions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.12. Model.deleteMany(conditions, [callback])</h2>
<p>Deletes all of the documents that match conditions from the collection.
Behaves like remove(), but deletes all documents that match conditions
regardless of the single option.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_deleteMany" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_deleteMany"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_deleteMany"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>deleteMany <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">deleteMany</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_193"><a name="&#x53C2;&#x6570;&#xFF1A;_193" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_193"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_141"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_141" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_141"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_150"><a name="&#x793A;&#x4F8B;&#xFF1A;_150" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_150"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/Stark/</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_51"><a name="&#x6CE8;&#x610F;&#xFF1A;_51" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_51"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Like <code>Model.remove()</code>, this function does not trigger pre(&apos;remove&apos;) or post(&apos;remove&apos;) hooks.</p>
<h2 id="modeldeleteoneconditions-callback"><a name="modeldeleteoneconditions-callback" class="anchor-navigation-ex-anchor" href="#modeldeleteoneconditions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.13. Model.deleteOne(conditions, [callback])</h2>
<p>Deletes the first document that matches conditions from the collection.
Behaves like remove(), but deletes at most one document regardless of the
single option.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_deleteOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_deleteOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_deleteOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>deleteOne <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">deleteOne</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_194"><a name="&#x53C2;&#x6570;&#xFF1A;_194" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_194"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_142"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_142" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_142"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_151"><a name="&#x793A;&#x4F8B;&#xFF1A;_151" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_151"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_52"><a name="&#x6CE8;&#x610F;&#xFF1A;_52" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_52"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Like <code>Model.remove()</code>, this function does not trigger pre(&apos;remove&apos;) or post(&apos;remove&apos;) hooks.</p>
<h2 id="modeldiscriminatorname-schema"><a name="modeldiscriminatorname-schema" class="anchor-navigation-ex-anchor" href="#modeldiscriminatorname-schema"><i class="fa fa-link" aria-hidden="true"></i></a>23.14. Model.discriminator(name, schema)</h2>
<p>Adds a discriminator type.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_discriminator" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_discriminator"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_discriminator"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>discriminator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> model<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model <span class="token operator">=</span> name<span class="token punctuation">;</span>
    name <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">Model</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The provided class &apos;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&apos; must extend Model&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  schema <span class="token operator">=</span> <span class="token function">discriminator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">OverwriteModelError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  schema<span class="token punctuation">.</span>$isRootDiscriminator <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>model <span class="token operator">||</span> name<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>discriminators<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>
  <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>discriminators<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  d<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">&apos;baseModelName&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName<span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    writable<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// apply methods and statics</span>
  <span class="token function">applyMethods</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">applyStatics</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Model (class) features</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_195"><a name="&#x53C2;&#x6570;&#xFF1A;_195" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_195"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; discriminator model name</p>
</li>
<li><p><code>schema</code> <schema> discriminator model schema</schema></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_152"><a name="&#x793A;&#x4F8B;&#xFF1A;_152" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_152"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">BaseSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Schema<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    createdAt<span class="token punctuation">:</span> Date
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>BaseSchema<span class="token punctuation">,</span> Schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> PersonSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseSchema</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> BossSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BaseSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Person <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Person&apos;</span><span class="token punctuation">,</span> PersonSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Boss <span class="token operator">=</span> Person<span class="token punctuation">.</span><span class="token function">discriminator</span><span class="token punctuation">(</span><span class="token string">&apos;Boss&apos;</span><span class="token punctuation">,</span> BossSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modeldistinctfield-conditions-callback"><a name="modeldistinctfield-conditions-callback" class="anchor-navigation-ex-anchor" href="#modeldistinctfield-conditions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.15. Model.distinct(field, [conditions], [callback])</h2>
<p>Creates a Query for a distinct operation.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_distinct" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_distinct"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_distinct"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>distinct <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_196"><a name="&#x53C2;&#x6570;&#xFF1A;_196" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_196"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>field</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>[conditions]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_143"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_143" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_143"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<p>Passing a callback immediately executes the query.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_153"><a name="&#x793A;&#x4F8B;&#xFF1A;_153" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_153"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Link<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">&apos;url&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> clicks<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gt<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">assert</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;unique urls with more than 100 clicks&apos;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> query <span class="token operator">=</span> Link<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token string">&apos;url&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelensureindexesoptions-cb"><a name="modelensureindexesoptions-cb" class="anchor-navigation-ex-anchor" href="#modelensureindexesoptions-cb"><i class="fa fa-link" aria-hidden="true"></i></a>23.16. Model.ensureIndexes([options], [cb])</h2>
<p>Sends createIndex commands to mongo for each index declared in the schema.
The createIndex commands are sent in series.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_ensureIndexes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_ensureIndexes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_ensureIndexes"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>ensureIndexes <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">ensureIndexes</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>__noPromise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_ensureIndexes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_ensureIndexes</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_197"><a name="&#x53C2;&#x6570;&#xFF1A;_197" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_197"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; internal options</p>
</li>
<li><p><code>[cb]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_144"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_144" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_144"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_154"><a name="&#x793A;&#x4F8B;&#xFF1A;_154" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_154"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Event<span class="token punctuation">.</span><span class="token function">ensureIndexes</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>After completion, an index event is emitted on this Model passing an error if one occurred.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_155"><a name="&#x793A;&#x4F8B;&#xFF1A;_155" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_155"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> eventSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> thing<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Event <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Event&apos;</span><span class="token punctuation">,</span> eventSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

Event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// error occurred during index creation</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_53"><a name="&#x6CE8;&#x610F;&#xFF1A;_53" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_53"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>It is not recommended that you run this in production. Index creation may impact database performance depending on your load. Use with caution.</p>
<h2 id="modelfindconditions-projection-options-callback"><a name="modelfindconditions-projection-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindconditions-projection-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.17. Model.find(conditions, [projection], [options], [callback])</h2>
<p>Finds documents</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_find" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_find"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_find"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>find <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> projection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> projection <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> projection<span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>discriminatorMapping <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>discriminatorMapping<span class="token punctuation">.</span>isRoot <span class="token operator">&amp;&amp;</span>
      mq<span class="token punctuation">.</span><span class="token function">selectedInclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Need to select discriminator key because original schema doesn&apos;t have it</span>
    mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>discriminatorKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_198"><a name="&#x53C2;&#x6570;&#xFF1A;_198" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_198"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[projection]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional fields to return (<a href="http://bit.ly/1HotzBo" target="_blank">http://bit.ly/1HotzBo</a>)</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_145"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_145" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_145"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_115"><a name="&#x53C2;&#x89C1;&#xFF1A;_115" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_115"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://mongoosejs.com/docs/api.html#query_Query-select" target="_blank">field selection</a></p>
</li>
<li><p><a href="http://mongoosejs.com/docs/api.html#promise-js" target="_blank">promise</a></p>
</li>
</ul>
<p>The conditions are cast to their respective SchemaTypes before the command is sent.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_156"><a name="&#x793A;&#x4F8B;&#xFF1A;_156" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_156"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// named john and at least 18</span>
MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;john&apos;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// executes immediately, passing results to callback</span>
MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;john&apos;</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gte<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// name LIKE john and only selecting the &quot;name&quot; and &quot;friends&quot; fields, executing immediately</span>
MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/john/i</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;name friends&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// passing options</span>
MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/john/i</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skip<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// passing options and executing immediately</span>
MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/john/i</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skip<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// executing a query explicitly</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/john/i</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skip<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// using the promise returned from executing a query</span>
<span class="token keyword">var</span> query <span class="token operator">=</span> MyModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/john/i</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skip<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">addBack</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelfindbyidid-projection-options-callback"><a name="modelfindbyidid-projection-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindbyidid-projection-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.18. Model.findById(id, [projection], [options], [callback])</h2>
<p>Finds a single document by its _id field. findById(id) is almost*
equivalent to findOne({ _id: id }). If you want to query by a document&apos;s
_id, use findById() instead of findOne().</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findById" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findById"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findById"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findById <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> projection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> id <span class="token operator">===</span> <span class="token string">&apos;undefined&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    id <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_199"><a name="&#x53C2;&#x6570;&#xFF1A;_199" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_199"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>id</code> <object, string,="" number=""> value of <code>_id</code> to query by</object,></p>
</li>
<li><p><code>[projection]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional fields to return (<a href="http://bit.ly/1HotzBo" target="_blank">http://bit.ly/1HotzBo</a>)</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_146"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_146" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_146"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_116"><a name="&#x53C2;&#x89C1;&#xFF1A;_116" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_116"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">field selection</a></p>
</li>
<li><p><a href="">lean queries</a></p>
</li>
</ul>
<p>The id is cast based on the Schema before sending the command.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOne()</li>
</ul>
<ul>
<li>Except for how it treats undefined. If you use findOne(), you&apos;ll see
that findOne(undefined) and findOne({ _id: undefined }) are equivalent
to findOne({}) and return arbitrary documents. However, mongoose
translates findById(undefined) into findOne({ _id: null }).</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_157"><a name="&#x793A;&#x4F8B;&#xFF1A;_157" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_157"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// find adventure by id and execute immediately</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// select only the adventures name and length</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&apos;name length&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&apos;name length&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// include all properties except for `length`</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&apos;-length&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// passing options (in this case return the raw js objects, not mongoose documents by passing `lean`</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelfindbyidandremoveid-options-callback"><a name="modelfindbyidandremoveid-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindbyidandremoveid-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.19. Model.findByIdAndRemove(id, [options], [callback])</h2>
<p>Issue a mongodb findAndModify remove command by a document&apos;s _id field. findByIdAndRemove(id, ...) is equivalent to findOneAndRemove({ _id: id }, ...).</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findByIdAndRemove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findByIdAndRemove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findByIdAndRemove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findByIdAndRemove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> id <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> &apos;Model<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> First argument must not be a <span class="token keyword">function</span><span class="token punctuation">.</span>

&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
&apos;<span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_200"><a name="&#x53C2;&#x6570;&#xFF1A;_200" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_200"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>id</code> <object, number,="" string=""> value of <code>_id</code> to query by</object,></p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_147"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_147" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_147"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_117"><a name="&#x53C2;&#x89C1;&#xFF1A;_117" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_117"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.findOneAndRemove</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></p>
</li>
</ul>
<p>Finds a matching document, removes it, passing the found document (if any) to the callback.</p>
<p>Executes immediately if callback is passed, else a Query object is returned.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOneAndRemove()</li>
</ul>
<h5 id="&#x9009;&#x9879;&#xFF1A;_2"><a name="&#x9009;&#x9879;&#xFF1A;_2" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;&#xFF1A;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;&#xFF1A;</h5>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>select</code>: sets the document fields to return</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
<li><code>strict</code>: overwrites the schema&apos;s strict mode option for this update</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_158"><a name="&#x793A;&#x4F8B;&#xFF1A;_158" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_158"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">A<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// return Query</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<h2 id="modelfindbyidandupdateid-update-options-callback"><a name="modelfindbyidandupdateid-update-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindbyidandupdateid-update-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.20. Model.findByIdAndUpdate(id, [update], [options], [callback])</h2>
<p>Issues a mongodb findAndModify update command by a document&apos;s _id field.
findByIdAndUpdate(id, ...) is equivalent to findOneAndUpdate({ _id: id }, ...).</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findByIdAndUpdate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findByIdAndUpdate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findByIdAndUpdate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findByIdAndUpdate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> id <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> msg <span class="token operator">=</span> &apos;Model<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> First argument must not be a <span class="token keyword">function</span><span class="token punctuation">.</span>

&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
&apos;<span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> undefined<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// if a model is passed in instead of an id</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token keyword">instanceof</span> <span class="token class-name">Document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    id <span class="token operator">=</span> id<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>findOneAndUpdate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>_id<span class="token punctuation">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_201"><a name="&#x53C2;&#x6570;&#xFF1A;_201" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_201"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>id</code> <object, number,="" string=""> value of <code>_id</code> to query by</object,></p>
</li>
<li><p><code>[update]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_148"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_148" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_148"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<query>

<h5 id="&#x53C2;&#x89C1;&#xFF1A;_118"><a name="&#x53C2;&#x89C1;&#xFF1A;_118" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_118"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Model.findOneAndUpdate</a></p>
</li>
<li><p><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></p>
</li>
</ul>
<p>Finds a matching document, updates it according to the update arg,
passing any options, and returns the found document (if any) to the
callback. The query executes immediately if callback is passed else a
Query object is returned.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOneAndUpdate()</li>
</ul>
<h5 id="&#x9009;&#x9879;_1"><a name="&#x9009;&#x9879;_1" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<ul>
<li><code>new</code>: bool - true to return the modified document rather than the original. defaults to false</li>
<li><code>upsert</code>: bool - creates the object if it doesn&apos;t exist. defaults to false.</li>
<li><code>runValidators</code>: if true, runs update validators on this command. Update validators validate the update operation against the model&apos;s schema.</li>
<li><code>setDefaultsOnInsert</code>: if this and upsert are true, mongoose will apply the defaults specified in the model&apos;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on MongoDB&apos;s $setOnInsert operator.</li>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>select</code>: sets the document fields to return</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
<li><code>strict</code>: overwrites the schema&apos;s strict mode option for this update</li>
<li><code>runSettersOnQuery</code>: bool - if true, run all setters defined on the associated model&apos;s schema for all fields defined in the query and the update.<h5 id="&#x793A;&#x4F8B;&#xFF1A;_159"><a name="&#x793A;&#x4F8B;&#xFF1A;_159" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_159"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
</li>
</ul>
<pre class="language-"><code class="lang-js">A<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> update<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> update<span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_54"><a name="&#x6CE8;&#x610F;&#xFF1A;_54" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_54"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>All top level update keys which are not atomic operation names are treated as set operations:</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_160"><a name="&#x793A;&#x4F8B;&#xFF1A;_160" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_160"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// is sent as</span>
Model<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre>
<p>This helps prevent accidentally overwriting your document with { name: &apos;jason bourne&apos; }.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_55"><a name="&#x6CE8;&#x610F;&#xFF1A;_55" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_55"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Values are cast to their appropriate types when using the findAndModify helpers.
However, the below are not executed by default.</p>
<ul>
<li>defaults. Use the setDefaultsOnInsert option to override.</li>
<li>setters. Use the runSettersOnQuery option to override.</li>
</ul>
<p>findAndModify helpers support limited validation. You can
enable these by setting the runValidators options,
respectively.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
  doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;jason bourne&apos;</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelfindoneconditions-projection-options-callback"><a name="modelfindoneconditions-projection-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindoneconditions-projection-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.21. Model.findOne([conditions], [projection], [options], [callback])</h2>
<p>Finds one document.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findOne <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">findOne</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> projection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> projection <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> projection<span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    projection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>discriminatorMapping <span class="token operator">&amp;&amp;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>discriminatorMapping<span class="token punctuation">.</span>isRoot <span class="token operator">&amp;&amp;</span>
      mq<span class="token punctuation">.</span><span class="token function">selectedInclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>discriminatorKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_202"><a name="&#x53C2;&#x6570;&#xFF1A;_202" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_202"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[conditions]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
<li><p><code>[projection]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional fields to return (<a href="http://bit.ly/1HotzBo" target="_blank">http://bit.ly/1HotzBo</a>)</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_149"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_149" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_149"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_119"><a name="&#x53C2;&#x89C1;&#xFF1A;_119" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_119"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">field selection</a></p>
</li>
<li><p><a href="">lean queries</a></p>
</li>
</ul>
<p>The conditions are cast to their respective SchemaTypes before the command is sent.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_56"><a name="&#x6CE8;&#x610F;&#xFF1A;_56" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_56"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p> conditions is optional, and if conditions is null or undefined,
mongoose will send an empty findOne command to MongoDB, which will return
an arbitrary document. If you&apos;re querying by _id, use findById() instead.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_161"><a name="&#x793A;&#x4F8B;&#xFF1A;_161" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_161"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// find one iphone adventures - iphone adventures??</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// select only the adventures name</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> adventure<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// specify options, in this case lean</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// same as above</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// chaining findOne queries (same as above)</span>
Adventure<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;iphone&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelfindoneandremoveconditions-options-callback"><a name="modelfindoneandremoveconditions-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindoneandremoveconditions-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.22. Model.findOneAndRemove(conditions, [options], [callback])</h2>
<p>Issue a mongodb findAndModify remove command.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findOneAndRemove" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findOneAndRemove"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findOneAndRemove"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findOneAndRemove <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> &apos;Model<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> First argument must not be a <span class="token keyword">function</span><span class="token punctuation">.</span>

&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span>
&apos;
        <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
&apos;<span class="token punctuation">;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> fields<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fields <span class="token operator">=</span> options<span class="token punctuation">.</span>select<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>select <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_203"><a name="&#x53C2;&#x6570;&#xFF1A;_203" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_203"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_150"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_150" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_150"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_120"><a name="&#x53C2;&#x89C1;&#xFF1A;_120" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_120"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></li>
</ul>
<p>Finds a matching document, removes it, passing the found document (if any) to the callback.</p>
<p>Executes immediately if callback is passed else a Query object is returned.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>findOneAndRemove()</li>
</ul>
<h5 id="&#x9009;&#x9879;_2"><a name="&#x9009;&#x9879;_2" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;_2"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<ul>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>select</code>: sets the document fields to return</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
<li><code>strict</code>: overwrites the schema&apos;s strict mode option for this update</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_162"><a name="&#x793A;&#x4F8B;&#xFF1A;_162" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_162"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">A<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// return Query</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<p>Values are cast to their appropriate types when using the findAndModify helpers.
However, the below are not executed by default.</p>
<ul>
<li>defaults. Use the setDefaultsOnInsert option to override.</li>
<li>setters. Use the runSettersOnQuery option to override.</li>
</ul>
<p>findAndModify helpers support limited validation. You can
enable these by setting the runValidators options,
respectively.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
  doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;jason bourne&apos;</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelfindoneandupdateconditions-update-options-callback"><a name="modelfindoneandupdateconditions-update-options-callback" class="anchor-navigation-ex-anchor" href="#modelfindoneandupdateconditions-update-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.23. Model.findOneAndUpdate([conditions], [update], [options], [callback])</h2>
<p>Issues a mongodb findAndModify update command.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_findOneAndUpdate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_findOneAndUpdate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_findOneAndUpdate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>findOneAndUpdate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> msg <span class="token operator">=</span> &apos;Model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> First argument must not be a <span class="token keyword">function</span><span class="token punctuation">.</span>

&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span>
&apos;
          <span class="token operator">+</span> <span class="token string">&apos;  &apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modelName <span class="token operator">+</span> &apos;<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
&apos;<span class="token punctuation">;</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    update <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> fields<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fields <span class="token operator">=</span> options<span class="token punctuation">.</span>fields<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  update <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>update<span class="token punctuation">,</span> <span class="token punctuation">{</span>depopulate<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _isNested<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionKey <span class="token operator">&amp;&amp;</span> options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>upsert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>overwrite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      update<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">.</span>$setOnInsert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        update<span class="token punctuation">.</span>$setOnInsert <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      update<span class="token punctuation">.</span>$setOnInsert<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mq<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_204"><a name="&#x53C2;&#x6570;&#xFF1A;_204" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_204"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>[conditions]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[update]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_151"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_151" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_151"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_121"><a name="&#x53C2;&#x89C1;&#xFF1A;_121" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_121"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/findAndModify+Command" target="_blank">mongodb</a></li>
</ul>
<p>Finds a matching document, updates it according to the update arg, passing any options, and returns the found document (if any) to the callback. The query executes immediately if callback is passed else a Query object is returned.</p>
<h5 id="&#x9009;&#x9879;_3"><a name="&#x9009;&#x9879;_3" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;_3"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<ul>
<li><code>new</code>: bool - if true, return the modified document rather than the original. defaults to false (changed in 4.0)</li>
<li><code>upsert</code>: bool - creates the object if it doesn&apos;t exist. defaults to false.</li>
<li><code>fields</code>: {Object|String} - Field selection. Equivalent to .select(fields).findOneAndUpdate()</li>
<li><code>maxTimeMS</code>: puts a time limit on the query - requires mongodb &gt;= 2.6.0</li>
<li><code>sort</code>: if multiple docs are found by the conditions, sets the sort order to choose which doc to update</li>
<li><code>runValidators</code>: if true, runs update validators on this command. Update validators validate the update operation against the model&apos;s schema.</li>
<li><code>setDefaultsOnInsert</code>: if this and upsert are true, mongoose will apply the defaults specified in the model&apos;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on MongoDB&apos;s $setOnInsert operator.</li>
<li><code>passRawResult</code>: if true, passes the raw result from the MongoDB driver as the third callback parameter</li>
<li><code>strict</code>: overwrites the schema&apos;s strict mode option for this update</li>
<li><code>runSettersOnQuery</code>: bool - if true, run all setters defined on the associated model&apos;s schema for all fields defined in the query and the update.</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_163"><a name="&#x793A;&#x4F8B;&#xFF1A;_163" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_163"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">A<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// executes</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> update<span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">// returns Query</span>
A<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment" spellcheck="true">// returns Query</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_57"><a name="&#x6CE8;&#x610F;&#xFF1A;_57" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_57"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>All top level update keys which are not atomic operation names are treated as set operations:</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_164"><a name="&#x793A;&#x4F8B;&#xFF1A;_164" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_164"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;borne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// is sent as</span>
Model<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre>
<p>This helps prevent accidentally overwriting your document with { name: &apos;jason bourne&apos; }.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_58"><a name="&#x6CE8;&#x610F;&#xFF1A;_58" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_58"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Values are cast to their appropriate types when using the findAndModify helpers.
However, the below are not executed by default.</p>
<ul>
<li>defaults. Use the setDefaultsOnInsert option to override.</li>
<li>setters. Use the runSettersOnQuery option to override.</li>
</ul>
<p>findAndModify helpers support limited validation. You can
enable these by setting the runValidators options,
respectively.</p>
<p>If you need full-fledged validation, use the traditional approach of first
retrieving the document.</p>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
  doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;jason bourne&apos;</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelgeoneargeojson-options-callback"><a name="modelgeoneargeojson-options-callback" class="anchor-navigation-ex-anchor" href="#modelgeoneargeojson-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.24. Model.geoNear(GeoJSON, options, [callback])</h2>
<p>geoNear support for Mongoose</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_geoNear" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_geoNear"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_geoNear"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>geoNear <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>near<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>near<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Must pass a near option to geoNear&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> x<span class="token punctuation">;</span>
  <span class="token keyword">var</span> y<span class="token punctuation">;</span>
  <span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> handler <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>lean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> count <span class="token operator">=</span> res<span class="token punctuation">.</span>results<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// if there are no results, fulfill the promise now</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> errSeen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

      <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>errSeen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          errSeen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">--</span>count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>results<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> temp <span class="token operator">=</span> res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>query <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>query <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>query<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">cast</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>near<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>near<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;If using legacy coordinates, must be an array &apos;</span> <span class="token operator">+</span>
            <span class="token string">&apos;of size 2 for geoNear&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      x <span class="token operator">=</span> near<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      y <span class="token operator">=</span> near<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">geoNear</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> options<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>near<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">&apos;Point&apos;</span> <span class="token operator">||</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>near<span class="token punctuation">.</span>coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Must pass either a legacy coordinate array or &apos;</span> <span class="token operator">+</span>
            <span class="token string">&apos;GeoJSON Point to geoNear&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">geoNear</span><span class="token punctuation">(</span>near<span class="token punctuation">,</span> options<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_205"><a name="&#x53C2;&#x6570;&#xFF1A;_205" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_205"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>GeoJSON</code> <object, array=""> point or legacy coordinate pair [x,y] to search near</object,></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; for the query</p>
</li>
<li><p>[callback] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback for the query</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_152"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_152" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_152"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_122"><a name="&#x53C2;&#x89C1;&#xFF1A;_122" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_122"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/core/2dsphere/" target="_blank">http://docs.mongodb.org/manual/core/2dsphere/</a></p>
</li>
<li><p><a href="http://mongodb.github.io/node-mongodb-native/api-generated/collection.html?highlight=geonear#geoNear" target="_blank">http://mongodb.github.io/node-mongodb-native/api-generated/collection.html?highlight=geonear#geoNear</a></p>
</li>
</ul>
<p>This function does not trigger any middleware. In particular, this
bypasses find() middleware.</p>
<h5 id="&#x9009;&#x9879;_4"><a name="&#x9009;&#x9879;_4" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<p>lean {Boolean} return the raw object
All options supported by the driver are also supported</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_165"><a name="&#x793A;&#x4F8B;&#xFF1A;_165" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_165"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Legacy point</span>
Model<span class="token punctuation">.</span><span class="token function">geoNear</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxDistance <span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> spherical <span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">,</span> stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// geoJson</span>
<span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token punctuation">{</span> type <span class="token punctuation">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span> coordinates <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Model<span class="token punctuation">.</span><span class="token function">geoNear</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> <span class="token punctuation">{</span> maxDistance <span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> spherical <span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">,</span> stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelgeosearchconditions-options-callback"><a name="modelgeosearchconditions-options-callback" class="anchor-navigation-ex-anchor" href="#modelgeosearchconditions-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.25. Model.geoSearch(conditions, options, [callback])</h2>
<p>Implements $geoSearch functionality for Mongoose</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_geoSearch" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_geoSearch"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_geoSearch"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>geoSearch <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> error<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>conditions <span class="token operator">===</span> undefined <span class="token operator">||</span> <span class="token operator">!</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>conditions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Must pass conditions to geoSearch&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>near<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Must specify the near option in geoSearch&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>near<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;near option must be an array [x, y]&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// send the conditions in the options object</span>
    options<span class="token punctuation">.</span>search <span class="token operator">=</span> conditions<span class="token punctuation">;</span>

    _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">geoHaystackSearch</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>near<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>near<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// have to deal with driver problem. Should be fixed in a soon-ish release</span>
      <span class="token comment" spellcheck="true">// (7/8/2013)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> count <span class="token operator">=</span> res<span class="token punctuation">.</span>results<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>lean <span class="token operator">||</span> count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> errSeen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

      <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>errSeen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">--</span>count <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>errSeen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>results<span class="token punctuation">,</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>results<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> temp <span class="token operator">=</span> res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span>results<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_206"><a name="&#x53C2;&#x6570;&#xFF1A;_206" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_206"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; an object that specifies the match condition (required)</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; for the geoSearch, some (near, maxDistance) are required</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_153"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_153" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_153"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_123"><a name="&#x53C2;&#x89C1;&#xFF1A;_123" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_123"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="http://docs.mongodb.org/manual/reference/command/geoSearch/" target="_blank">http://docs.mongodb.org/manual/reference/command/geoSearch/</a></p>
</li>
<li><p><a href="http://docs.mongodb.org/manual/core/geohaystack/" target="_blank">http://docs.mongodb.org/manual/core/geohaystack/</a></p>
</li>
</ul>
<p>This function does not trigger any middleware</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_166"><a name="&#x793A;&#x4F8B;&#xFF1A;_166" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_166"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> near<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> maxDistance<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Locations<span class="token punctuation">.</span><span class="token function">geoSearch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">:</span> <span class="token string">&quot;house&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x9009;&#x9879;_5"><a name="&#x9009;&#x9879;_5" class="anchor-navigation-ex-anchor" href="#&#x9009;&#x9879;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x9009;&#x9879;" class="plugin-anchor" href="#&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x9009;&#x9879;:</h5>
<ul>
<li><code>near</code> {Array} x,y point to search for</li>
<li><code>maxDistance</code> {Number} the maximum distance from the point near that a result can be</li>
<li><code>limit</code> {Number} The maximum number of results to return</li>
<li><code>lean</code> {Boolean} return the raw object instead of the Mongoose Model</li>
</ul>
<h2 id="modelhydrateobj"><a name="modelhydrateobj" class="anchor-navigation-ex-anchor" href="#modelhydrateobj"><i class="fa fa-link" aria-hidden="true"></i></a>23.26. Model.hydrate(obj)</h2>
<p>Shortcut for creating a new Document from existing raw data, pre-saved in the DB.
The document returned has no paths marked as modified initially.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_hydrate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_hydrate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_hydrate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>hydrate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./queryhelpers&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  model<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> model<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_207"><a name="&#x53C2;&#x6570;&#xFF1A;_207" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_207"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>obj</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_154"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_154" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_154"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><document>

</document></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_167"><a name="&#x793A;&#x4F8B;&#xFF1A;_167" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_167"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// hydrate previous data into a Mongoose document</span>
<span class="token keyword">var</span> mongooseCandy <span class="token operator">=</span> Candy<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> <span class="token string">&apos;54108337212ffb6d459f854c&apos;</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">&apos;jelly bean&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelinitcallback"><a name="modelinitcallback" class="anchor-navigation-ex-anchor" href="#modelinitcallback"><i class="fa fa-link" aria-hidden="true"></i></a>23.27. Model.init([callback])</h2>
<p>Performs any async initialization of this model against MongoDB. Currently,
this function is only responsible for building <a href="https://docs.mongodb.com/manual/indexes/" target="_blank">indexes</a>,
unless <a href="">autoIndex</a> is turned off.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_init" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_init"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_init"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;init&apos;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$init<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$init<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$init <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>autoIndex<span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>autoIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _this<span class="token punctuation">.</span>db<span class="token punctuation">.</span>config<span class="token punctuation">.</span>autoIndex<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _this<span class="token punctuation">.</span><span class="token function">ensureIndexes</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _automatic<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> _this<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$init<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_208"><a name="&#x53C2;&#x6570;&#xFF1A;_208" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_208"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<p>This function is called automatically, so you don&apos;t need to call it.
This function is also idempotent, so you may call it to get back a promise
that will resolve when your indexes are finished building as an alternative
to MyModel.on(&apos;index&apos;)</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_168"><a name="&#x793A;&#x4F8B;&#xFF1A;_168" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_168"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> eventSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> thing<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// This calls `Event.init()` implicitly, so you don&apos;t need to call</span>
<span class="token comment" spellcheck="true">// `Event.init()` on your own.</span>
<span class="token keyword">var</span> Event <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Event&apos;</span><span class="token punctuation">,</span> eventSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

Event<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>Event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// You can also use `Event.on(&apos;index&apos;)` if you prefer event emitters</span>
  <span class="token comment" spellcheck="true">// over promises.</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Indexes are done building!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelinsertmanydocs-options-optionsordered-optionsrawresult-callback"><a name="modelinsertmanydocs-options-optionsordered-optionsrawresult-callback" class="anchor-navigation-ex-anchor" href="#modelinsertmanydocs-options-optionsordered-optionsrawresult-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.28. Model.insertMany(doc(s), [options], [options.ordered, [options.rawResult, [callback])</h2>
<p>Shortcut for validating an array of documents and inserting them into
MongoDB if they&apos;re all valid. This function is faster than .create()
because it only sends one operation to the server, rather than one for each
document.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_insertMany" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_insertMany"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_insertMany"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>insertMany <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  callback <span class="token operator">=</span> callback <span class="token operator">||</span> utils<span class="token punctuation">.</span>noop<span class="token punctuation">;</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> limit <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&apos;limit&apos;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> rawResult <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&apos;rawResult&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ordered <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token string">&apos;ordered&apos;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arr <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> toExecute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> validationErrors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    toExecute<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_this</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      doc<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __noPromise<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// Option `ordered` signals that insert should be continued after reaching</span>
          <span class="token comment" spellcheck="true">// a failing insert. Therefore we delegate &quot;null&quot;, meaning the validation</span>
          <span class="token comment" spellcheck="true">// failed. It&apos;s up to the next function to filter out all failed models</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>ordered <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            validationErrors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">parallelLimit</span><span class="token punctuation">(</span>toExecute<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// We filter all failed pre-validations by removing nulls</span>
    <span class="token keyword">var</span> docAttributes <span class="token operator">=</span> docs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> doc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Quickly escape while there aren&apos;t any valid docAttributes</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>docAttributes<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> docObjects <span class="token operator">=</span> docAttributes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        doc<span class="token punctuation">[</span>doc<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>versionKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>initializeTimestamps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">initializeTimestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>INSERT_MANY_CONVERT_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>INSERT_MANY_CONVERT_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>docObjects<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> docAttributes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        docAttributes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        docAttributes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        docAttributes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rawResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ordered <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">// Decorate with mongoose validation errors in case of unordered,</span>
          <span class="token comment" spellcheck="true">// because then still do `insertMany()`</span>
          res<span class="token punctuation">.</span>mongoose <span class="token operator">=</span> <span class="token punctuation">{</span>
            validationErrors<span class="token punctuation">:</span> validationErrors
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> docAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_209"><a name="&#x53C2;&#x6570;&#xFF1A;_209" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_209"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<p>doc(s) <array, object,="" *=""></array,></p>
<ul>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; see the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#insertMany" target="_blank">mongodb driver options</a></p>
</li>
<li><p><code>[options.ordered <span class="token entity" title="&lt;">&amp;lt;</span>[Boolean][]<span class="token entity" title="&gt;">&amp;gt;</span> = true]</code> if true, will fail fast on the first error encountered. If false, will insert all the documents it can and report errors later. An <code>insertMany()</code> with <code>ordered = false</code> is called an &quot;unordered&quot; <code>insertMany()</code>.</p>
</li>
<li><p><code>[options.rawResult <span class="token entity" title="&lt;">&amp;lt;</span>[Boolean][]<span class="token entity" title="&gt;">&amp;gt;</span> = false]</code> if false, the returned promise resolves to the documents that passed mongoose document validation. If <code>false</code>, will return the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#~insertWriteOpCallback" target="_blank">raw result from the MongoDB driver</a> with a <code>mongoose</code> property that contains <code>validationErrors</code> if this is an unordered <code>insertMany</code>.</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_155"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_155" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_155"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<p>Mongoose always validates each document before sending insertMany
to MongoDB. So if one document has a validation error, no documents will
be saved, unless you set
<a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#error-handling" target="_blank">the ordered option to false.</a></p>
<p>This function does <strong>not</strong> trigger save middleware.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>insertMany()</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_169"><a name="&#x793A;&#x4F8B;&#xFF1A;_169" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_169"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Star Wars&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;The Empire Strikes Back&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Movies<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="modelmapreduceo-callback"><a name="modelmapreduceo-callback" class="anchor-navigation-ex-anchor" href="#modelmapreduceo-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.29. Model.mapReduce(o, [callback])</h2>
<p>Executes a mapReduce command.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_mapReduce" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_mapReduce"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_mapReduce"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>mapReduce <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">mapReduce</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> resolveToObject <span class="token operator">=</span> o<span class="token punctuation">.</span>resolveToObject<span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Model<span class="token punctuation">.</span>mapReduce<span class="token punctuation">.</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>noId<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> noVirtualId<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> strict<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      Model<span class="token punctuation">.</span>mapReduce<span class="token punctuation">.</span>schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>o<span class="token punctuation">.</span>out<span class="token punctuation">)</span> o<span class="token punctuation">.</span>out <span class="token operator">=</span> <span class="token punctuation">{</span>inline<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>verbose <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> o<span class="token punctuation">.</span>verbose <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    o<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>reduce <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>reduce<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">_this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
      q<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span>
      o<span class="token punctuation">.</span>query <span class="token operator">=</span> q<span class="token punctuation">.</span>_conditions<span class="token punctuation">;</span>
      q <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _this<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> o<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">.</span>findOne <span class="token operator">&amp;&amp;</span> ret<span class="token punctuation">.</span>mapReduce<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// returned a collection, convert to Model</span>
        <span class="token keyword">var</span> model <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>
            <span class="token string">&apos;_mapreduce_&apos;</span> <span class="token operator">+</span> ret<span class="token punctuation">.</span>collectionName
            <span class="token punctuation">,</span> Model<span class="token punctuation">.</span>mapReduce<span class="token punctuation">.</span>schema
            <span class="token punctuation">,</span> ret<span class="token punctuation">.</span>collectionName
            <span class="token punctuation">,</span> _this<span class="token punctuation">.</span>db
            <span class="token punctuation">,</span> _this<span class="token punctuation">.</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>

        model<span class="token punctuation">.</span>_mapreduce <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> model<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resolveToObject <span class="token operator">?</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          model<span class="token punctuation">:</span> model<span class="token punctuation">,</span>
          stats<span class="token punctuation">:</span> stats
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> ret<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resolveToObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> model<span class="token punctuation">:</span> ret<span class="token punctuation">,</span> stats<span class="token punctuation">:</span> stats <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_210"><a name="&#x53C2;&#x6570;&#xFF1A;_210" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_210"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>o</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; an object specifying map-reduce options</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional callback</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_156"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_156" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_156"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_124"><a name="&#x53C2;&#x89C1;&#xFF1A;_124" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_124"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://www.mongodb.org/display/DOCS/MapReduce" target="_blank">http://www.mongodb.org/display/DOCS/MapReduce</a></li>
</ul>
<p>o is an object specifying all mapReduce options as well as the map and reduce functions. All options are delegated to the driver implementation. See node-mongodb-native mapReduce() documentation for more detail about options.</p>
<p>This function does <strong>not</strong> trigger any middleware.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_170"><a name="&#x793A;&#x4F8B;&#xFF1A;_170" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_170"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
o<span class="token punctuation">.</span>reduce <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> vals<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> vals<span class="token punctuation">.</span>length <span class="token punctuation">}</span>
User<span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x5176;&#x4ED6;&#x9009;&#x9879;"><a name="&#x5176;&#x4ED6;&#x9009;&#x9879;" class="anchor-navigation-ex-anchor" href="#&#x5176;&#x4ED6;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x5176;&#x4ED6;&#x9009;&#x9879;" class="plugin-anchor" href="#&#x5176;&#x4ED6;&#x9009;&#x9879;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5176;&#x4ED6;&#x9009;&#x9879;:</h5>
<ul>
<li><code>query</code> {Object} query filter object.</li>
<li><code>sort</code> {Object} sort input objects using this key</li>
<li><code>limit</code> {Number} max number of documents</li>
<li><code>keeptemp</code> {Boolean, default:false} keep temporary data</li>
<li><code>finalize</code> {Function} finalize function</li>
<li><code>scope</code> {Object} scope variables exposed to map/reduce/finalize during execution</li>
<li><code>jsMode</code> {Boolean, default:false} it is possible to make the execution stay in JS. Provided in MongoDB &gt; 2.0.X</li>
<li><code>verbose</code> {Boolean, default:false} provide statistics on job execution time.</li>
<li><code>readPreference</code> {String}</li>
<li><code>out*</code> {Object, default: {inline:1}} sets the output target for the map reduce job.
out &#x9009;&#x9879;:<ul>
<li><code>{inline:1}</code> the results are returned in an array</li>
<li><code>{replace: &apos;collectionName&apos;}</code> add the results to collectionName: the results replace the collection</li>
<li><code>{reduce: &apos;collectionName&apos;}</code> add the results to collectionName: if dups are detected, uses the reducer / finalize functions</li>
<li><code>{merge: &apos;collectionName&apos;}</code> add the results to collectionName: if dups exist the new docs overwrite the old</li>
</ul>
</li>
</ul>
<p>If options.out is set to replace, merge, or reduce, a Model instance is returned that can be used for further querying. Queries run against this model are all executed with the lean option; meaning only the js object is returned and no Mongoose magic is applied (getters, setters, etc).</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_171"><a name="&#x793A;&#x4F8B;&#xFF1A;_171" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_171"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">emit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
o<span class="token punctuation">.</span>reduce <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> vals<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> vals<span class="token punctuation">.</span>length <span class="token punctuation">}</span>
o<span class="token punctuation">.</span>out <span class="token operator">=</span> <span class="token punctuation">{</span> replace<span class="token punctuation">:</span> <span class="token string">&apos;createdCollectionNameForResults&apos;</span> <span class="token punctuation">}</span>
o<span class="token punctuation">.</span>verbose <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> model<span class="token punctuation">,</span> stats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;map reduce took %d ms&apos;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>processtime<span class="token punctuation">)</span>
  model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;value&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// `mapReduce()` returns a promise. However, ES6 promises can only</span>
<span class="token comment" spellcheck="true">// resolve to exactly one value,</span>
o<span class="token punctuation">.</span>resolveToObject <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">mapReduce</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> res<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
  <span class="token keyword">var</span> stats <span class="token operator">=</span> res<span class="token punctuation">.</span>stats<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;map reduce took %d ms&apos;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span>processtime<span class="token punctuation">)</span>
  <span class="token keyword">return</span> model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;value&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="modelpopulatedocs-options-callbackerrdoc"><a name="modelpopulatedocs-options-callbackerrdoc" class="anchor-navigation-ex-anchor" href="#modelpopulatedocs-options-callbackerrdoc"><i class="fa fa-link" aria-hidden="true"></i></a>23.30. Model.populate(docs, options, [callback(err,doc)])</h2>
<p>Populates document references.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_populate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_populate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_populate"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>populate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>docs<span class="token punctuation">,</span> paths<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// normalized paths</span>
  <span class="token keyword">var</span> noPromise <span class="token operator">=</span> paths <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>paths<span class="token punctuation">.</span>__noPromise<span class="token punctuation">;</span>
  paths <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>paths<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// data that should persist across subPopulate calls</span>
  <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>noPromise<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_populate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> docs<span class="token punctuation">,</span> paths<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_populate</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> docs<span class="token punctuation">,</span> paths<span class="token punctuation">,</span> cache<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> docs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_211"><a name="&#x53C2;&#x6570;&#xFF1A;_211" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_211"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>docs</code> <document, array=""> Either a single document or array of documents to populate.</document,></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; A hash of key/val (path, options) used for population.</p>
</li>
<li><p><code>[callback(err,doc)]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; Optional callback, executed upon completion. Receives <code>err</code> and the <code>doc(s)</code>.</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_157"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_157" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_157"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<p>&#x53EF;&#x7528;&#x9009;&#x9879;:</p>
<ul>
<li><code>path</code>: space delimited path(s) to populate</li>
<li><code>select</code>: optional fields to select</li>
<li><code>match</code>: optional query conditions to match</li>
<li><code>model</code>: optional name of the model to use for population</li>
<li><code>options</code>: optional query options like sort, limit, etc</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_172"><a name="&#x793A;&#x4F8B;&#xFF1A;_172" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_172"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// populates a single object</span>
User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;company&apos;</span><span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> select<span class="token punctuation">:</span> <span class="token string">&apos;name&apos;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;notes&apos;</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">{</span> limit<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> <span class="token string">&apos;override&apos;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>

  User<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// populates an array of objects</span>
User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>match<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;company&apos;</span><span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> select<span class="token punctuation">:</span> <span class="token string">&apos;name&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>

  <span class="token keyword">var</span> promise <span class="token operator">=</span> User<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// imagine a Weapon model exists with two saved documents:</span>
<span class="token comment" spellcheck="true">//   { _id: 389, name: &apos;whip&apos; }</span>
<span class="token comment" spellcheck="true">//   { _id: 8921, name: &apos;boomerang&apos; }</span>
<span class="token comment" spellcheck="true">// and this schema:</span>
<span class="token comment" spellcheck="true">// new Schema({</span>
<span class="token comment" spellcheck="true">//   name: String,</span>
<span class="token comment" spellcheck="true">//   weapon: { type: ObjectId, ref: &apos;Weapon&apos; }</span>
<span class="token comment" spellcheck="true">// });</span>

<span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Indiana Jones&apos;</span><span class="token punctuation">,</span> weapon<span class="token punctuation">:</span> <span class="token number">389</span> <span class="token punctuation">}</span>
Weapon<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;weapon&apos;</span><span class="token punctuation">,</span> model<span class="token punctuation">:</span> <span class="token string">&apos;Weapon&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>weapon<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// whip</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// populate many plain objects</span>
<span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Indiana Jones&apos;</span><span class="token punctuation">,</span> weapon<span class="token punctuation">:</span> <span class="token number">389</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
users<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Batman&apos;</span><span class="token punctuation">,</span> weapon<span class="token punctuation">:</span> <span class="token number">8921</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
Weapon<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span>users<span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;weapon&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  users<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;%s uses a %s&apos;</span><span class="token punctuation">,</span> users<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user<span class="token punctuation">.</span>weapon<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">// Indiana Jones uses a whip</span>
    <span class="token comment" spellcheck="true">// Batman uses a boomerang</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Note that we didn&apos;t need to specify the Weapon model because</span>
<span class="token comment" spellcheck="true">// it is in the schema&apos;s ref</span>
</code></pre>
<h2 id="modelremoveconditions-callback"><a name="modelremoveconditions-callback" class="anchor-navigation-ex-anchor" href="#modelremoveconditions-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.31. Model.remove(conditions, [callback])</h2>
<p>Removes all documents that match conditions from the collection.
To remove just the first document that matches conditions, set the single
option to true.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_remove_" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_remove_"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_remove_"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>remove <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> conditions <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> conditions<span class="token punctuation">;</span>
    conditions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$wrapCallback</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> mq<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_212"><a name="&#x53C2;&#x6570;&#xFF1A;_212" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_212"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_158"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_158" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_158"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_173"><a name="&#x793A;&#x4F8B;&#xFF1A;_173" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_173"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_59"><a name="&#x6CE8;&#x610F;&#xFF1A;_59" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_59"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>This method sends a remove command directly to MongoDB, no Mongoose documents
are involved. Because no Mongoose documents are involved, no middleware
(hooks) are executed.</p>
<h2 id="modelreplaceoneconditions-doc-options-callback"><a name="modelreplaceoneconditions-doc-options-callback" class="anchor-navigation-ex-anchor" href="#modelreplaceoneconditions-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.32. Model.replaceOne(conditions, doc, [options], [callback])</h2>
<p>Same as update(), except MongoDB replace the existing document with the
given document (no atomic operators like $set).</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_replaceOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_replaceOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_replaceOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>replaceOne <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">replaceOne</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;replaceOne&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_213"><a name="&#x53C2;&#x6570;&#xFF1A;_213" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_213"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_159"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_159" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_159"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>replaceOne()</li>
</ul>
<h2 id="modeltranslatealiasesraw"><a name="modeltranslatealiasesraw" class="anchor-navigation-ex-anchor" href="#modeltranslatealiasesraw"><i class="fa fa-link" aria-hidden="true"></i></a>23.33. Model.translateAliases(raw)</h2>
<p>Translate any aliases fields/conditions so the final query or document object is pure</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_translateAliases" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_translateAliases"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_translateAliases"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>translateAliases <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">translateAliases</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> aliases <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>aliases<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fields <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Fields is an object (query conditions or document fields)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>aliases<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fields<span class="token punctuation">[</span>aliases<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> fields<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> fields<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> fields<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Don&apos;t know typeof fields</span>
    <span class="token keyword">return</span> fields<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_214"><a name="&#x53C2;&#x6570;&#xFF1A;_214" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_214"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>raw</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; fields/conditions that may contain aliased keys</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_160"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_160" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_160"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; the translated &apos;pure&apos; fields/conditions</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_174"><a name="&#x793A;&#x4F8B;&#xFF1A;_174" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_174"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">Character
  <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>Character<span class="token punctuation">.</span><span class="token function">translateAliases</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&apos;&#x540D;&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;Eddard Stark&apos;</span> <span class="token comment" spellcheck="true">// Alias for &apos;name&apos;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> characters<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_60"><a name="&#x6CE8;&#x610F;&#xFF1A;_60" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_60"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Only translate arguments of object type anything else is returned raw</p>
<h2 id="modelupdateconditions-doc-options-callback"><a name="modelupdateconditions-doc-options-callback" class="anchor-navigation-ex-anchor" href="#modelupdateconditions-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.34. Model.update(conditions, doc, [options], [callback])</h2>
<p>Updates one document in the database without returning it.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_update" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_update"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_update"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;update&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_215"><a name="&#x53C2;&#x6570;&#xFF1A;_215" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_215"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<p>conditions &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
<p>doc &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
<p>[options] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
<pre class="language-"><code>* `[callback]` <span class="token entity" title="&lt;">&amp;lt;</span>[Function][]<span class="token entity" title="&gt;">&amp;gt;</span>
</code></pre><h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_161"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_161" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_161"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<pre class="language-"><code>* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Query</span><span class="token punctuation">&gt;</span></span>
</code></pre><h5 id="&#x53C2;&#x89C1;&#xFF1A;_125"><a name="&#x53C2;&#x89C1;&#xFF1A;_125" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_125"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<pre class="language-"><code>* `strict`

* `response`
</code></pre><p><strong>This function triggers the following middleware</strong></p>
<pre class="language-"><code>* update()
</code></pre><h5 id="&#x793A;&#x4F8B;&#xFF1A;_175"><a name="&#x793A;&#x4F8B;&#xFF1A;_175" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_175"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">MyModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token punctuation">:</span> <span class="token punctuation">{</span> $gt<span class="token punctuation">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> oldEnough<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyModel<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> ferret<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> multi<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> raw<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;The raw response from Mongo was &apos;</span><span class="token punctuation">,</span> raw<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;_1"><a name="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;_1" class="anchor-navigation-ex-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;_1"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;" class="plugin-anchor" href="#&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53EF;&#x7528;&#x9009;&#x9879;&#xFF1A;</h5>
<ul>
<li><code>safe</code> (boolean) safe mode (defaults to value set in schema (true))</li>
<li><code>upsert</code> (boolean) whether to create the doc if it doesn&apos;t match (false)</li>
<li><code>multi</code> (boolean) whether multiple documents should be updated (false)</li>
<li><code>runValidators</code>: if true, runs update validators on this command. Update validators validate the update operation against the model&apos;s schema.</li>
<li><code>setDefaultsOnInsert</code>: if this and upsert are true, mongoose will apply the defaults specified in the model&apos;s schema if a new document is created. This option only works on MongoDB &gt;= 2.4 because it relies on MongoDB&apos;s $setOnInsert operator.</li>
<li><code>strict</code> (boolean) overrides the strict option for this update</li>
<li><code>overwrite</code> (boolean) disables update-only mode, allowing you to overwrite the doc (false)</li>
</ul>
<p>All update values are cast to their appropriate SchemaTypes before being sent.</p>
<p>The callback function receives (err, rawResponse).</p>
<ul>
<li>err is the error if any occurred</li>
<li>rawResponse is the full response from Mongo
*<h5 id="&#x6CE8;&#x610F;&#xFF1A;_61"><a name="&#x6CE8;&#x610F;&#xFF1A;_61" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_61"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
</li>
</ul>
<p>All top level keys which are not atomic operation names are treated as set operations:</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_176"><a name="&#x793A;&#x4F8B;&#xFF1A;_176" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_176"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;borne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// is sent as</span>
Model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;jason bourne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// if overwrite option is false. If overwrite is true, sent without the $set wrapper.</span>
</code></pre>
<p>This helps prevent accidentally overwriting all documents in your collection with { name: &apos;jason bourne&apos; }.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_62"><a name="&#x6CE8;&#x610F;&#xFF1A;_62" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_62"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Be careful to not use an existing model instance for the update clause (this won&apos;t work and can cause weird behavior like infinite loops). Also, ensure that the update clause does not have an _id property, which causes Mongo to return a &quot;Mod on _id not allowed&quot; error.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_63"><a name="&#x6CE8;&#x610F;&#xFF1A;_63" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_63"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>To update documents without waiting for a response from MongoDB, do not pass a callback, then call exec on the returned Query:</p>
<pre class="language-"><code class="lang-js">Comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token punctuation">:</span> id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">&apos;changed&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_64"><a name="&#x6CE8;&#x610F;&#xFF1A;_64" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_64"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Although values are casted to their appropriate types when using update, the following are not applied:</p>
<ul>
<li>defaults</li>
<li>setters</li>
<li>validators</li>
<li>middleware
If you need those features, use the traditional approach of first retrieving the document.</li>
</ul>
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;borne&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>
  doc<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;jason bourne&apos;</span><span class="token punctuation">;</span>
  doc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="modelupdatemanyconditions-doc-options-callback"><a name="modelupdatemanyconditions-doc-options-callback" class="anchor-navigation-ex-anchor" href="#modelupdatemanyconditions-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.35. Model.updateMany(conditions, doc, [options], [callback])</h2>
<p>Same as update(), except MongoDB will update all documents that match
criteria (as opposed to just the first one) regardless of the value of
the multi option.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_updateMany" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_updateMany"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_updateMany"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>updateMany <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">updateMany</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;updateMany&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_216"><a name="&#x53C2;&#x6570;&#xFF1A;_216" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_216"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_162"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_162" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_162"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_65"><a name="&#x6CE8;&#x610F;&#xFF1A;_65" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_65"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>updateMany will not fire update middleware. Use pre(&apos;updateMany&apos;)
and post(&apos;updateMany&apos;) instead.</p>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>updateMany()</li>
</ul>
<h2 id="modelupdateoneconditions-doc-options-callback"><a name="modelupdateoneconditions-doc-options-callback" class="anchor-navigation-ex-anchor" href="#modelupdateoneconditions-doc-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>23.36. Model.updateOne(conditions, doc, [options], [callback])</h2>
<p>Same as update(), except MongoDB will update only the first document that
matches criteria regardless of the value of the multi option.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_updateOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_updateOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_updateOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>updateOne <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">updateOne</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;updateOne&apos;</span><span class="token punctuation">,</span> conditions<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_217"><a name="&#x53C2;&#x6570;&#xFF1A;_217" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_217"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>conditions</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>doc</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional see <a href="http://mongoosejs.com/docs/api.html#query_Query-setOptions" target="_blank"><code>Query.prototype.setOptions()</code></a></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_163"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_163" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_163"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<p><strong>This function triggers the following middleware</strong></p>
<ul>
<li>updateOne()</li>
</ul>
<h2 id="modelwherepath-val"><a name="modelwherepath-val" class="anchor-navigation-ex-anchor" href="#modelwherepath-val"><i class="fa fa-link" aria-hidden="true"></i></a>23.37. Model.where(path, [val])</h2>
<p>Creates a Query, applies the passed conditions, and returns the Query.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_where_" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_where_"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_where_"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>where <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">where</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">void</span> val<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// eslint</span>
  <span class="token comment" spellcheck="true">// get the mongodb collection object</span>
  <span class="token keyword">var</span> mq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> mq<span class="token punctuation">.</span>where<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>mq<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_218"><a name="&#x53C2;&#x6570;&#xFF1A;_218" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_218"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>[val]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional value</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_164"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_164" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_164"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><query>

</query></li>
</ul>
<p>For example, instead of writing:</p>
<pre class="language-"><code class="lang-js">User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span> <span class="token punctuation">{</span>$gte<span class="token punctuation">:</span> <span class="token number">21</span><span class="token punctuation">,</span> $lte<span class="token punctuation">:</span> <span class="token number">65</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>we can instead write:</p>
<pre class="language-"><code class="lang-js">User<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Since the Query class also supports where you can continue chaining</p>
<pre class="language-"><code class="lang-js">User
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;age&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token regex">/^b/i</span><span class="token punctuation">)</span>
<span class="token operator">...</span> etc
</code></pre>
<h2 id="modelwhere"><a name="modelwhere" class="anchor-navigation-ex-anchor" href="#modelwhere"><i class="fa fa-link" aria-hidden="true"></i></a>23.38. Model#$where</h2>
<p>Additional properties to attach to the query when calling save() and
isNew is false.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_where" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_where"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_where"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$where<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelbase"><a name="modelbase" class="anchor-navigation-ex-anchor" href="#modelbase"><i class="fa fa-link" aria-hidden="true"></i></a>23.39. Model#base</h2>
<p>Base Mongoose instance the model uses.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_base" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_base"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_base"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>base<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelbasemodelname"><a name="modelbasemodelname" class="anchor-navigation-ex-anchor" href="#modelbasemodelname"><i class="fa fa-link" aria-hidden="true"></i></a>23.40. Model#baseModelName</h2>
<p>If this is a discriminator model, baseModelName is the name of
the base model.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_baseModelName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_baseModelName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_baseModelName"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>baseModelName<span class="token punctuation">;</span>

Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$__handleSave <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> i<span class="token punctuation">;</span>
  <span class="token keyword">var</span> keys<span class="token punctuation">;</span>
  <span class="token keyword">var</span> len<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>safe <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>safe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>safe <span class="token operator">===</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>safe <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> safe <span class="token operator">=</span> options<span class="token punctuation">.</span>safe <span class="token operator">?</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>safe<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> options<span class="token punctuation">.</span>safe<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isNew<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// send entire doc</span>
    <span class="token keyword">var</span> toObjectOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    toObjectOptions<span class="token punctuation">.</span>retainKeyOrder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>schema<span class="token punctuation">.</span>options<span class="token punctuation">.</span>retainKeyOrder<span class="token punctuation">;</span>
    toObjectOptions<span class="token punctuation">.</span>depopulate <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    toObjectOptions<span class="token punctuation">.</span>_skipDepopulateTopLevel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    toObjectOptions<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    toObjectOptions<span class="token punctuation">.</span>flattenDecimals <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toObject</span><span class="token punctuation">(</span>toObjectOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>obj <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_id <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// documents must have an _id else mongoose won&apos;t know</span>
      <span class="token comment" spellcheck="true">// what to update later if more changes are made. the user</span>
      <span class="token comment" spellcheck="true">// wouldn&apos;t know what _id was generated by mongodb either</span>
      <span class="token comment" spellcheck="true">// nor would the ObjectId generated my mongodb necessarily</span>
      <span class="token comment" spellcheck="true">// match the schema definition.</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;document must have an _id before saving&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__version</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> safe<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _this<span class="token punctuation">.</span>isNew <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>isNew <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Make it possible to retry the insert</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>inserting <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Make sure we don&apos;t treat it as a new object on error,</span>
    <span class="token comment" spellcheck="true">// since it already exists</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$__<span class="token punctuation">.</span>inserting <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> delta <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__delta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> where <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__where</span><span class="token punctuation">(</span>delta<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>where <span class="token keyword">instanceof</span> <span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>where<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$where<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$where<span class="token punctuation">)</span><span class="token punctuation">;</span>
        len <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          where<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$where<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>where<span class="token punctuation">,</span> delta<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> safe<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ret<span class="token punctuation">.</span>$where <span class="token operator">=</span> where<span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$__reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;isNew&apos;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelcollection"><a name="modelcollection" class="anchor-navigation-ex-anchor" href="#modelcollection"><i class="fa fa-link" aria-hidden="true"></i></a>23.41. Model#collection</h2>
<p>Collection the model uses.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_collection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_collection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_collection"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collection<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modeldb"><a name="modeldb" class="anchor-navigation-ex-anchor" href="#modeldb"><i class="fa fa-link" aria-hidden="true"></i></a>23.42. Model#db</h2>
<p>Connection the model uses.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_db" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_db"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_db"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>db<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modeldiscriminators"><a name="modeldiscriminators" class="anchor-navigation-ex-anchor" href="#modeldiscriminators"><i class="fa fa-link" aria-hidden="true"></i></a>23.43. Model#discriminators</h2>
<p>Registered discriminators for this model.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_discriminators" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_discriminators"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_discriminators"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>discriminators<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelmodelname_1"><a name="modelmodelname_1" class="anchor-navigation-ex-anchor" href="#modelmodelname_1"><i class="fa fa-link" aria-hidden="true"></i></a>23.44. Model#modelName</h2>
<p>The name of the model</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_modelName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_modelName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_modelName"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>modelName<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="modelschema"><a name="modelschema" class="anchor-navigation-ex-anchor" href="#modelschema"><i class="fa fa-link" aria-hidden="true"></i></a>23.45. Model#schema</h2>
<p>Schema the model uses.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Model_schema" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Model_schema"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Model_schema"><div class="panel-body">
<pre class="language-"><code class="lang-js">Model<span class="token punctuation">.</span>schema<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemaarrayjs"><a name="schemaarrayjs" class="anchor-navigation-ex-anchor" href="#schemaarrayjs"><i class="fa fa-link" aria-hidden="true"></i></a>24. schema/array.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/array.js" target="_blank">schema/array.js</a></p>
</blockquote>
<h2 id="schemaarraycheckrequiredvalue"><a name="schemaarraycheckrequiredvalue" class="anchor-navigation-ex-anchor" href="#schemaarraycheckrequiredvalue"><i class="fa fa-link" aria-hidden="true"></i></a>24.1. SchemaArray#checkRequired(value)</h2>
<p>Check if the given value satisfies a required validator. The given value
must be not null nor undefined, and have a positive length.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_219"><a name="&#x53C2;&#x6570;&#xFF1A;_219" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_219"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>value</code> &lt;<a href="#Any">Any</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_165"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_165" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_165"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaArray_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaArray_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaArray_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaArray<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaarraykey-cast-options"><a name="schemaarraykey-cast-options" class="anchor-navigation-ex-anchor" href="#schemaarraykey-cast-options"><i class="fa fa-link" aria-hidden="true"></i></a>24.2. SchemaArray(key, cast, options)</h2>
<p>Array SchemaType constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_220"><a name="&#x53C2;&#x6570;&#xFF1A;_220" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_220"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>cast</code> <schematype></schematype></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_5"><a name="&#x7EE7;&#x627F;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaArray" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaArray"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaArray"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaArray</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> cast<span class="token punctuation">,</span> options<span class="token punctuation">,</span> schemaOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> typeKey <span class="token operator">=</span> <span class="token string">&apos;type&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schemaOptions <span class="token operator">&amp;&amp;</span> schemaOptions<span class="token punctuation">.</span>typeKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    typeKey <span class="token operator">=</span> schemaOptions<span class="token punctuation">.</span>typeKey<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>cast<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> castOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>cast<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cast<span class="token punctuation">[</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// support { type: Woot }</span>
        castOptions <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// do not alter user arguments</span>
        <span class="token keyword">delete</span> castOptions<span class="token punctuation">[</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cast <span class="token operator">=</span> cast<span class="token punctuation">[</span>typeKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cast <span class="token operator">=</span> Mixed<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// support { type: &apos;String&apos; }</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">typeof</span> cast <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span>
        <span class="token operator">?</span> cast
        <span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>cast<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> caster <span class="token operator">=</span> name <span class="token keyword">in</span> Types
        <span class="token operator">?</span> Types<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
        <span class="token punctuation">:</span> cast<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>casterConstructor <span class="token operator">=</span> caster<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> caster <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>caster<span class="token punctuation">.</span>$isArraySubdocument<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>caster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">caster</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> castOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>caster <span class="token operator">=</span> caster<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>caster <span class="token keyword">instanceof</span> <span class="token class-name">EmbeddedDoc</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>caster<span class="token punctuation">.</span>path <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$isMongooseArray <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Array&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> defaultArr<span class="token punctuation">;</span>
  <span class="token keyword">var</span> fn<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    defaultArr <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue<span class="token punctuation">;</span>
    fn <span class="token operator">=</span> <span class="token keyword">typeof</span> defaultArr <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&apos;defaultValue&apos;</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr <span class="token operator">=</span> <span class="token function">defaultArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultArr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>defaultArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment" spellcheck="true">// Leave it up to `cast()` to convert the array</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemaarrayschemaname"><a name="schemaarrayschemaname" class="anchor-navigation-ex-anchor" href="#schemaarrayschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>24.3. SchemaArray.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaArray_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaArray_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaArray_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaArray<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Array&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemabooleanjs"><a name="schemabooleanjs" class="anchor-navigation-ex-anchor" href="#schemabooleanjs"><i class="fa fa-link" aria-hidden="true"></i></a>25. schema/boolean.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/boolean.js" target="_blank">schema/boolean.js</a></p>
</blockquote>
<h2 id="schemabooleancheckrequiredvalue"><a name="schemabooleancheckrequiredvalue" class="anchor-navigation-ex-anchor" href="#schemabooleancheckrequiredvalue"><i class="fa fa-link" aria-hidden="true"></i></a>25.1. SchemaBoolean#checkRequired(value)</h2>
<p>Check if the given value satisfies a required validator. For a boolean
to satisfy a required validator, it must be strictly equal to true or to
false.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_221"><a name="&#x53C2;&#x6570;&#xFF1A;_221" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_221"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>value</code> &lt;<a href="#Any">Any</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_166"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_166" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_166"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBoolean_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBoolean_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBoolean_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaBoolean<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemabooleanpath-options"><a name="schemabooleanpath-options" class="anchor-navigation-ex-anchor" href="#schemabooleanpath-options"><i class="fa fa-link" aria-hidden="true"></i></a>25.2. SchemaBoolean(path, options)</h2>
<p>Boolean SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_222"><a name="&#x53C2;&#x6570;&#xFF1A;_222" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_222"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_6"><a name="&#x7EE7;&#x627F;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBoolean" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBoolean"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBoolean"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaBoolean</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Boolean&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemabooleanschemaname"><a name="schemabooleanschemaname" class="anchor-navigation-ex-anchor" href="#schemabooleanschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>25.3. SchemaBoolean.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBoolean_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBoolean_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBoolean_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaBoolean<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Boolean&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemamixedjs"><a name="schemamixedjs" class="anchor-navigation-ex-anchor" href="#schemamixedjs"><i class="fa fa-link" aria-hidden="true"></i></a>26. schema/mixed.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/mixed.js" target="_blank">schema/mixed.js</a></p>
</blockquote>
<h2 id="mixedpath-options"><a name="mixedpath-options" class="anchor-navigation-ex-anchor" href="#mixedpath-options"><i class="fa fa-link" aria-hidden="true"></i></a>26.1. Mixed(path, options)</h2>
<p>Mixed SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_223"><a name="&#x53C2;&#x6570;&#xFF1A;_223" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_223"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_7"><a name="&#x7EE7;&#x627F;&#xFF1A;_7" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_7"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Mixed" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mixed"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mixed"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Mixed</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> def <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> def<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// make sure empty array defaults are handled</span>
      options<span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">=</span> Array<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">.</span>shared <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// prevent odd &quot;shared&quot; objects between documents</span>
      options<span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Mixed&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="mixedschemaname"><a name="mixedschemaname" class="anchor-navigation-ex-anchor" href="#mixedschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>26.2. Mixed.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Mixed_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Mixed_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Mixed_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">Mixed<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Mixed&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemaembeddedjs"><a name="schemaembeddedjs" class="anchor-navigation-ex-anchor" href="#schemaembeddedjs"><i class="fa fa-link" aria-hidden="true"></i></a>27. schema/embedded.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/embedded.js" target="_blank">schema/embedded.js</a></p>
</blockquote>
<h2 id="embeddeddiscriminatorname-schema"><a name="embeddeddiscriminatorname-schema" class="anchor-navigation-ex-anchor" href="#embeddeddiscriminatorname-schema"><i class="fa fa-link" aria-hidden="true"></i></a>27.1. Embedded#discriminator(name, schema)</h2>
<p>Adds a discriminator to this property</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_224"><a name="&#x53C2;&#x6570;&#xFF1A;_224" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_224"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>schema</code> <schema> fields to add to the schema for instances of this sub-class</schema></p>
</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Embedded_discriminator" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Embedded_discriminator"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Embedded_discriminator"><div class="panel-body">
<pre class="language-"><code class="lang-js">Embedded<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>discriminator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">discriminator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>caster<span class="token punctuation">,</span> name<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>caster<span class="token punctuation">.</span>discriminators<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">_createConstructor</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>caster<span class="token punctuation">.</span>discriminators<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="embeddedschema-key-options"><a name="embeddedschema-key-options" class="anchor-navigation-ex-anchor" href="#embeddedschema-key-options"><i class="fa fa-link" aria-hidden="true"></i></a>27.2. Embedded(schema, key, options)</h2>
<p>Sub-schema schematype constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_225"><a name="&#x53C2;&#x6570;&#xFF1A;_225" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_225"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>schema</code> <schema></schema></p>
</li>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_8"><a name="&#x7EE7;&#x627F;&#xFF1A;_8" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_8"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Embedded" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Embedded"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Embedded"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Embedded</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> path<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>caster <span class="token operator">=</span> <span class="token function">_createConstructor</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>caster<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$basePath <span class="token operator">=</span> path<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>schema <span class="token operator">=</span> schema<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$isSingleNested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Embedded&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemabufferjs"><a name="schemabufferjs" class="anchor-navigation-ex-anchor" href="#schemabufferjs"><i class="fa fa-link" aria-hidden="true"></i></a>28. schema/buffer.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/buffer.js" target="_blank">schema/buffer.js</a></p>
</blockquote>
<h2 id="schemabuffercheckrequiredvalue-doc"><a name="schemabuffercheckrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#schemabuffercheckrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>28.1. SchemaBuffer#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies a required validator. To satisfy a
required validator, a buffer must not be null or undefined and have
non-zero length.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_226"><a name="&#x53C2;&#x6570;&#xFF1A;_226" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_226"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_167"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_167" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_167"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<p>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBuffer_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBuffer_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBuffer_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaBuffer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>SchemaType<span class="token punctuation">.</span><span class="token function">_isRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemabufferkey-options"><a name="schemabufferkey-options" class="anchor-navigation-ex-anchor" href="#schemabufferkey-options"><i class="fa fa-link" aria-hidden="true"></i></a>28.2. SchemaBuffer(key, options)</h2>
<p>Buffer SchemaType constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_227"><a name="&#x53C2;&#x6570;&#xFF1A;_227" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_227"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_9"><a name="&#x7EE7;&#x627F;&#xFF1A;_9" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_9"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBuffer" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBuffer"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBuffer"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaBuffer</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Buffer&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemabuffersubtypesubtype"><a name="schemabuffersubtypesubtype" class="anchor-navigation-ex-anchor" href="#schemabuffersubtypesubtype"><i class="fa fa-link" aria-hidden="true"></i></a>28.3. SchemaBuffer#subtype(subtype)</h2>
<p>Sets the default subtype
for this buffer. You can find a list of allowed subtypes here.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_228"><a name="&#x53C2;&#x6570;&#xFF1A;_228" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_228"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>subtype</code> <number> the default subtype</number></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_168"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_168" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_168"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_177"><a name="&#x793A;&#x4F8B;&#xFF1A;_177" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_177"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uuid<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Buffer<span class="token punctuation">,</span> subtype<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> uuid<span class="token punctuation">:</span> <span class="token string">&apos;test string&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span>uuid<span class="token punctuation">.</span>_subtype<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 4</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBuffer_subtype" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBuffer_subtype"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBuffer_subtype"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaBuffer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>subtype <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>subtype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>subtype <span class="token operator">=</span> subtype<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemabufferschemaname"><a name="schemabufferschemaname" class="anchor-navigation-ex-anchor" href="#schemabufferschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>28.4. SchemaBuffer.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaBuffer_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaBuffer_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaBuffer_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaBuffer<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Buffer&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemaobjectidjs"><a name="schemaobjectidjs" class="anchor-navigation-ex-anchor" href="#schemaobjectidjs"><i class="fa fa-link" aria-hidden="true"></i></a>29. schema/objectid.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/objectid.js" target="_blank">schema/objectid.js</a></p>
</blockquote>
<h2 id="objectidautoturnon"><a name="objectidautoturnon" class="anchor-navigation-ex-anchor" href="#objectidautoturnon"><i class="fa fa-link" aria-hidden="true"></i></a>29.1. ObjectId#auto(turnOn)</h2>
<p>Adds an auto-generated ObjectId default if turnOn is true.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_229"><a name="&#x53C2;&#x6570;&#xFF1A;_229" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_229"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>turnOn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; auto generated ObjectId defaults</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_169"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_169" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_169"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="ObjectId_auto" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="ObjectId_auto"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="ObjectId_auto"><div class="panel-body">
<pre class="language-"><code class="lang-js">ObjectId<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>auto <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>turnOn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>turnOn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>defaultId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>resetId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="objectidcheckrequiredvalue-doc"><a name="objectidcheckrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#objectidcheckrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>29.2. ObjectId#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies a required validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_230"><a name="&#x53C2;&#x6570;&#xFF1A;_230" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_230"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_170"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_170" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_170"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="ObjectId_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="ObjectId_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="ObjectId_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">ObjectId<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>SchemaType<span class="token punctuation">.</span><span class="token function">_isRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value <span class="token keyword">instanceof</span> <span class="token class-name">oid</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="objectidkey-options"><a name="objectidkey-options" class="anchor-navigation-ex-anchor" href="#objectidkey-options"><i class="fa fa-link" aria-hidden="true"></i></a>29.3. ObjectId(key, options)</h2>
<p>ObjectId SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_231"><a name="&#x53C2;&#x6570;&#xFF1A;_231" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_231"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_10"><a name="&#x7EE7;&#x627F;&#xFF1A;_10" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_10"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li>SchemaType</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="ObjectId" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="ObjectId"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="ObjectId"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> isKeyHexStr <span class="token operator">=</span> <span class="token keyword">typeof</span> key <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">24</span> <span class="token operator">&amp;&amp;</span> <span class="token regex">/^a-f0-9$/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> suppressWarning <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>suppressWarning<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>isKeyHexStr <span class="token operator">||</span> <span class="token keyword">typeof</span> key <span class="token operator">===</span> <span class="token string">&apos;undefined&apos;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>suppressWarning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose: To create a new ObjectId please try &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;`Mongoose.Types.ObjectId` instead of using &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;`Mongoose.Schema.ObjectId`. Set the `suppressWarning` option if &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;you\&apos;re trying to create a hex char path in your schema.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;ObjectID&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="objectidschemaname"><a name="objectidschemaname" class="anchor-navigation-ex-anchor" href="#objectidschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>29.4. ObjectId.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="ObjectId_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="ObjectId_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="ObjectId_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">ObjectId<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;ObjectId&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemastringjs"><a name="schemastringjs" class="anchor-navigation-ex-anchor" href="#schemastringjs"><i class="fa fa-link" aria-hidden="true"></i></a>30. schema/string.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/string.js" target="_blank">schema/string.js</a></p>
</blockquote>
<h2 id="schemastringcheckrequiredvalue-doc"><a name="schemastringcheckrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#schemastringcheckrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>30.1. SchemaString#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies the required validator. The value is
considered valid if it is a string (that is, not null or undefined) and
has positive length. The required validator will fail for empty
strings.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_232"><a name="&#x53C2;&#x6570;&#xFF1A;_232" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_232"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_171"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_171" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_171"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>SchemaType<span class="token punctuation">.</span><span class="token function">_isRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringenumargs"><a name="schemastringenumargs" class="anchor-navigation-ex-anchor" href="#schemastringenumargs"><i class="fa fa-link" aria-hidden="true"></i></a>30.2. SchemaString#enum([args...])</h2>
<p>Adds an enum validator</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_233"><a name="&#x53C2;&#x6570;&#xFF1A;_233" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_233"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>[args...]</code> <string, object=""> enumeration values</string,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_172"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_172" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_172"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_126"><a name="&#x53C2;&#x89C1;&#xFF1A;_126" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_126"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_178"><a name="&#x793A;&#x4F8B;&#xFF1A;_178" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_178"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> states <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;opening&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;open&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;closing&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;closed&apos;</span><span class="token punctuation">]</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token punctuation">:</span> states <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token string">&apos;invalid&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: `invalid` is not a valid enum value for path `state`.</span>
  m<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&apos;open&apos;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or with custom error messages</span>
<span class="token keyword">var</span> <span class="token keyword">enum</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  values<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&apos;opening&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;open&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;closing&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;closed&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  message<span class="token punctuation">:</span> <span class="token string">&apos;enum validator failed for path `{PATH}` with value `{VALUE}`&apos;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token string">&apos;invalid&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: enum validator failed for path `state` with value `invalid`</span>
  m<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">&apos;open&apos;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_enum" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_enum"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_enum"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">enum</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>enumValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enumValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>enumValidator <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">||</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> values<span class="token punctuation">;</span>
  <span class="token keyword">var</span> errorMessage<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    values <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    errorMessage <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    values <span class="token operator">=</span> arguments<span class="token punctuation">;</span>
    errorMessage <span class="token operator">=</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>String<span class="token punctuation">.</span><span class="token keyword">enum</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> values<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>undefined <span class="token operator">!==</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>enumValues<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> vals <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enumValues<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>enumValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> undefined <span class="token operator">===</span> v <span class="token operator">||</span> <span class="token operator">~</span>vals<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>enumValidator<span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> errorMessage<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">&apos;enum&apos;</span><span class="token punctuation">,</span>
    enumValues<span class="token punctuation">:</span> vals
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringlowercase"><a name="schemastringlowercase" class="anchor-navigation-ex-anchor" href="#schemastringlowercase"><i class="fa fa-link" aria-hidden="true"></i></a>30.3. SchemaString#lowercase()</h2>
<p>Adds a lowercase setter.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_173"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_173" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_173"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_179"><a name="&#x793A;&#x4F8B;&#xFF1A;_179" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_179"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> lowercase<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;SomeEmail@example.COM&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>email<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// someemail@example.com</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_66"><a name="&#x6CE8;&#x610F;&#xFF1A;_66" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_66"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Setters do not run on queries by default. Use the runSettersOnQuery option:</p>
<pre class="language-"><code class="lang-js"> <span class="token comment" spellcheck="true">// Must use `runSettersOnQuery` as shown below, otherwise `email` will</span>
 <span class="token comment" spellcheck="true">// **not** be lowercased.</span>
 M<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;SomeEmail@example.COM&apos;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> runSettersOnQuery<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_lowercase" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_lowercase"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_lowercase"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>lowercase <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>shouldApply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shouldApply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringmatchregexp-message"><a name="schemastringmatchregexp-message" class="anchor-navigation-ex-anchor" href="#schemastringmatchregexp-message"><i class="fa fa-link" aria-hidden="true"></i></a>30.4. SchemaString#match(regExp, [message])</h2>
<p>Sets a regexp validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_234"><a name="&#x53C2;&#x6570;&#xFF1A;_234" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_234"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>regExp</code> <regexp> regular expression to test against</regexp></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_174"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_174" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_174"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_127"><a name="&#x53C2;&#x89C1;&#xFF1A;_127" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_127"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<p>Any value that does not pass regExp.test(val) will fail validation.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_180"><a name="&#x793A;&#x4F8B;&#xFF1A;_180" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_180"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token regex">/^a/</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;I am invalid&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &quot;ValidationError: Path `name` is invalid (I am invalid).&quot;</span>
  m<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&apos;apples&apos;</span>
  m<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// using a custom error message</span>
<span class="token keyword">var</span> match <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token regex">/\.html$/</span><span class="token punctuation">,</span> <span class="token string">&quot;That file doesn&apos;t end in .html ({VALUE})&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> file<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> match<span class="token punctuation">:</span> match <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> file<span class="token punctuation">:</span> <span class="token string">&apos;invalid&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &quot;ValidationError: That file doesn&apos;t end in .html (invalid)&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Empty strings, undefined, and null values always pass the match validator. If you require these values, enable the required validator also.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token regex">/^a/</span><span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_match" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_match"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_match"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>match <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">match</span><span class="token punctuation">(</span>regExp<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// yes, we allow multiple match validators</span>

  <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>String<span class="token punctuation">.</span>match<span class="token punctuation">;</span>

  <span class="token keyword">var</span> matchValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>regExp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> v <span class="token operator">!==</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">)</span>
        <span class="token operator">?</span> regExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    validator<span class="token punctuation">:</span> matchValidator<span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">&apos;regexp&apos;</span><span class="token punctuation">,</span>
    regexp<span class="token punctuation">:</span> regExp
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringmaxlengthvalue-message"><a name="schemastringmaxlengthvalue-message" class="anchor-navigation-ex-anchor" href="#schemastringmaxlengthvalue-message"><i class="fa fa-link" aria-hidden="true"></i></a>30.5. SchemaString#maxlength(value, [message])</h2>
<p>Sets a maximum length validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_235"><a name="&#x53C2;&#x6570;&#xFF1A;_235" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_235"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<pre class="language-"><code>* `value` <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Number</span><span class="token punctuation">&gt;</span></span> maximum string length

* `[message]` <span class="token entity" title="&lt;">&amp;lt;</span>[String][]<span class="token entity" title="&gt;">&amp;gt;</span> optional custom error message
</code></pre><h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_175"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_175" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_175"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<pre class="language-"><code>* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SchemaType</span><span class="token punctuation">&gt;</span></span> this
</code></pre><h5 id="&#x53C2;&#x89C1;&#xFF1A;_128"><a name="&#x53C2;&#x89C1;&#xFF1A;_128" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_128"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<pre class="language-"><code>* [Customized Error Messages]()
</code></pre><h5 id="&#x793A;&#x4F8B;&#xFF1A;_181"><a name="&#x793A;&#x4F8B;&#xFF1A;_181" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_181"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> maxlength<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Address <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Address&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
<span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token string">&apos;9512512345&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
address<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  address<span class="token punctuation">.</span>postalCode <span class="token operator">=</span> <span class="token string">&apos;95125&apos;</span><span class="token punctuation">;</span>
  address<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MAXLENGTH} token which will be replaced with the maximum allowed length</span>
<span class="token keyword">var</span> maxlength <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` (`{VALUE}`) exceeds the maximum allowed length ({MAXLENGTH}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> maxlength<span class="token punctuation">:</span> maxlength <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Address <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Address&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token string">&apos;9512512345&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
address<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `postalCode` (`9512512345`) exceeds the maximum allowed length (9).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_maxlength" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_maxlength"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_maxlength"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>maxlength <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxlengthValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxlengthValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>String<span class="token punctuation">.</span>maxlength<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MAXLENGTH}/</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxlengthValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> v <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> v<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;maxlength&apos;</span><span class="token punctuation">,</span>
      maxlength<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringminlengthvalue-message"><a name="schemastringminlengthvalue-message" class="anchor-navigation-ex-anchor" href="#schemastringminlengthvalue-message"><i class="fa fa-link" aria-hidden="true"></i></a>30.6. SchemaString#minlength(value, [message])</h2>
<p>Sets a minimum length validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_236"><a name="&#x53C2;&#x6570;&#xFF1A;_236" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_236"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> <number> minimum string length</number></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_176"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_176" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_176"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_129"><a name="&#x53C2;&#x89C1;&#xFF1A;_129" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_129"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_182"><a name="&#x793A;&#x4F8B;&#xFF1A;_182" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_182"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> minlength<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Address <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Address&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
<span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token string">&apos;9512&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
address<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  address<span class="token punctuation">.</span>postalCode <span class="token operator">=</span> <span class="token string">&apos;95125&apos;</span><span class="token punctuation">;</span>
  address<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MINLENGTH} token which will be replaced with the minimum allowed length</span>
<span class="token keyword">var</span> minlength <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` (`{VALUE}`) is shorter than the minimum allowed length ({MINLENGTH}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> minlength<span class="token punctuation">:</span> minlength <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> Address <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Address&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token punctuation">{</span> postalCode<span class="token punctuation">:</span> <span class="token string">&apos;9512&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
address<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `postalCode` (`9512`) is shorter than the minimum length (5).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_minlength" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_minlength"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_minlength"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>minlength <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>minlengthValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minlengthValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>String<span class="token punctuation">.</span>minlength<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MINLENGTH}/</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minlengthValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> v <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> v<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;minlength&apos;</span><span class="token punctuation">,</span>
      minlength<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringkey-options"><a name="schemastringkey-options" class="anchor-navigation-ex-anchor" href="#schemastringkey-options"><i class="fa fa-link" aria-hidden="true"></i></a>30.7. SchemaString(key, options)</h2>
<p>String SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_237"><a name="&#x53C2;&#x6570;&#xFF1A;_237" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_237"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_11"><a name="&#x7EE7;&#x627F;&#xFF1A;_11" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_11"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaString</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>enumValues <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>regExp <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;String&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringtrim"><a name="schemastringtrim" class="anchor-navigation-ex-anchor" href="#schemastringtrim"><i class="fa fa-link" aria-hidden="true"></i></a>30.8. SchemaString#trim()</h2>
<p>Adds a trim setter.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_177"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_177" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_177"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<p>The string value will be trimmed when set.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_183"><a name="&#x793A;&#x4F8B;&#xFF1A;_183" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_183"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> trim<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> string <span class="token operator">=</span> <span class="token string">&apos; some name &apos;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 11</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> string <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>name<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 9</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_67"><a name="&#x6CE8;&#x610F;&#xFF1A;_67" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_67"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Setters do not run on queries by default. Use the runSettersOnQuery option:</p>
<pre class="language-"><code class="lang-js"> <span class="token comment" spellcheck="true">// Must use `runSettersOnQuery` as shown below, otherwise `email` will</span>
 <span class="token comment" spellcheck="true">// **not** be lowercased.</span>
 M<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;SomeEmail@example.COM&apos;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> runSettersOnQuery<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_trim" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_trim"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_trim"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>trim <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>shouldTrim<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shouldTrim<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringuppercase"><a name="schemastringuppercase" class="anchor-navigation-ex-anchor" href="#schemastringuppercase"><i class="fa fa-link" aria-hidden="true"></i></a>30.9. SchemaString#uppercase()</h2>
<p>Adds an uppercase setter.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_178"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_178" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_178"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_184"><a name="&#x793A;&#x4F8B;&#xFF1A;_184" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_184"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> caps<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> uppercase<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> caps<span class="token punctuation">:</span> <span class="token string">&apos;an example&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>caps<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// AN EXAMPLE</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_68"><a name="&#x6CE8;&#x610F;&#xFF1A;_68" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_68"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Setters do not run on queries by default. Use the runSettersOnQuery option:</p>
<pre class="language-"><code class="lang-js"> <span class="token comment" spellcheck="true">// Must use `runSettersOnQuery` as shown below, otherwise `email` will</span>
 <span class="token comment" spellcheck="true">// **not** be lowercased.</span>
 M<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;SomeEmail@example.COM&apos;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> runSettersOnQuery<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_uppercase" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_uppercase"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_uppercase"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>uppercase <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>shouldApply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>shouldApply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> self<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> v <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemastringschemaname"><a name="schemastringschemaname" class="anchor-navigation-ex-anchor" href="#schemastringschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>30.10. SchemaString.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaString_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaString_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaString_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaString<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;String&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemadecimal128js"><a name="schemadecimal128js" class="anchor-navigation-ex-anchor" href="#schemadecimal128js"><i class="fa fa-link" aria-hidden="true"></i></a>31. schema/decimal128.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/decimal128.js" target="_blank">schema/decimal128.js</a></p>
</blockquote>
<h2 id="decimal128checkrequiredvalue-doc"><a name="decimal128checkrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#decimal128checkrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>31.1. Decimal128#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies a required validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_238"><a name="&#x53C2;&#x6570;&#xFF1A;_238" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_238"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_179"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_179" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_179"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Decimal128_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Decimal128_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Decimal128_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">Decimal128<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>SchemaType<span class="token punctuation">.</span><span class="token function">_isRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value <span class="token keyword">instanceof</span> <span class="token class-name">Decimal128Type</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="decimal128key-options"><a name="decimal128key-options" class="anchor-navigation-ex-anchor" href="#decimal128key-options"><i class="fa fa-link" aria-hidden="true"></i></a>31.2. Decimal128(key, options)</h2>
<p>Decimal128 SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_239"><a name="&#x53C2;&#x6570;&#xFF1A;_239" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_239"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_12"><a name="&#x7EE7;&#x627F;&#xFF1A;_12" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_12"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Decimal128" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Decimal128"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Decimal128"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Decimal128</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Decimal128&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="decimal128schemaname"><a name="decimal128schemaname" class="anchor-navigation-ex-anchor" href="#decimal128schemaname"><i class="fa fa-link" aria-hidden="true"></i></a>31.3. Decimal128.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Decimal128_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Decimal128_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Decimal128_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">Decimal128<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Decimal128&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemadocumentarrayjs"><a name="schemadocumentarrayjs" class="anchor-navigation-ex-anchor" href="#schemadocumentarrayjs"><i class="fa fa-link" aria-hidden="true"></i></a>32. schema/documentarray.js</h1>
<h2 id="documentarraykey-schema-options"><a name="documentarraykey-schema-options" class="anchor-navigation-ex-anchor" href="#documentarraykey-schema-options"><i class="fa fa-link" aria-hidden="true"></i></a>32.1. DocumentArray(key, schema, options)</h2>
<p>SubdocsArray SchemaType constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_240"><a name="&#x53C2;&#x6570;&#xFF1A;_240" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_240"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>schema</code> <schema></schema></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_13"><a name="&#x7EE7;&#x627F;&#xFF1A;_13" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_13"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaArray</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="DocumentArray" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="DocumentArray"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="DocumentArray"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">DocumentArray</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> EmbeddedDocument <span class="token operator">=</span> <span class="token function">_createConstructor</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  EmbeddedDocument<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$basePath <span class="token operator">=</span> key<span class="token punctuation">;</span>

  ArrayType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> EmbeddedDocument<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>schema <span class="token operator">=</span> schema<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$isMongooseDocumentArray <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&apos;defaultValue&apos;</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">||</span> fn <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> arr <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        arr <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment" spellcheck="true">// Leave it up to `cast()` to convert this to a documentarray</span>
      <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="documentarrayschemaname"><a name="documentarrayschemaname" class="anchor-navigation-ex-anchor" href="#documentarrayschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>32.2. DocumentArray.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="DocumentArray_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="DocumentArray_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="DocumentArray_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">DocumentArray<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;DocumentArray&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h1 id="schemadatejs"><a name="schemadatejs" class="anchor-navigation-ex-anchor" href="#schemadatejs"><i class="fa fa-link" aria-hidden="true"></i></a>33. schema/date.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/date.js" target="_blank">schema/date.js</a></p>
</blockquote>
<h2 id="schemadatecheckrequiredvalue-doc"><a name="schemadatecheckrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#schemadatecheckrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>33.1. SchemaDate#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies a required validator. To satisfy
a required validator, the given value must be an instance of Date.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_241"><a name="&#x53C2;&#x6570;&#xFF1A;_241" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_241"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_180"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_180" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_180"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaDate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> value <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadateexpireswhen"><a name="schemadateexpireswhen" class="anchor-navigation-ex-anchor" href="#schemadateexpireswhen"><i class="fa fa-link" aria-hidden="true"></i></a>33.2. SchemaDate#expires(when)</h2>
<p>Declares a TTL index (rounded to the nearest second) for Date types only.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_242"><a name="&#x53C2;&#x6570;&#xFF1A;_242" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_242"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>when</code> <number, string=""></number,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_181"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_181" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_181"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<p>This sets the expireAfterSeconds index option available in MongoDB &gt;= 2.1.2.
This index type is only compatible with Date types.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_185"><a name="&#x793A;&#x4F8B;&#xFF1A;_185" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_185"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// expire in 24 hours</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> expires<span class="token punctuation">:</span> <span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
expires utilizes the ms module <span class="token keyword">from</span> guille allowing us to use a friendlier syntax<span class="token punctuation">:</span>
</code></pre>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_186"><a name="&#x793A;&#x4F8B;&#xFF1A;_186" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_186"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// expire in 24 hours</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> expires<span class="token punctuation">:</span> <span class="token string">&apos;24h&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// expire in 1.5 hours</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> createdAt<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> expires<span class="token punctuation">:</span> <span class="token string">&apos;1.5h&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// expire in 7 days</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> createdAt<span class="token punctuation">:</span> Date <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;createdAt&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expires</span><span class="token punctuation">(</span><span class="token string">&apos;7d&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate_expires" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate_expires"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate_expires"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaDate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>expires <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>when<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">.</span>expires <span class="token operator">=</span> when<span class="token punctuation">;</span>
  utils<span class="token punctuation">.</span><span class="token function">expires</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadatemaxmaximum-message"><a name="schemadatemaxmaximum-message" class="anchor-navigation-ex-anchor" href="#schemadatemaxmaximum-message"><i class="fa fa-link" aria-hidden="true"></i></a>33.3. SchemaDate#max(maximum, [message])</h2>
<p>Sets a maximum date validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_243"><a name="&#x53C2;&#x6570;&#xFF1A;_243" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_243"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>maximum</code> <date> date</date></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_182"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_182" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_182"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_130"><a name="&#x53C2;&#x89C1;&#xFF1A;_130" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_130"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_187"><a name="&#x793A;&#x4F8B;&#xFF1A;_187" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_187"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-01-01&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-12-08&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  m<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2013-12-31&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MAX} token which will be replaced with the invalid value</span>
<span class="token keyword">var</span> max <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-01-01&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` ({VALUE}) exceeds the limit ({MAX}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> max<span class="token punctuation">:</span> max <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-12-08&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `d` (2014-12-08) exceeds the limit (2014-01-01).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate_max" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate_max"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate_max"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaDate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>max <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>max<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MAX}/</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> Date<span class="token punctuation">.</span>now <span class="token operator">?</span> <span class="token string">&apos;Date.now()&apos;</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> max <span class="token operator">=</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> Date<span class="token punctuation">.</span>now <span class="token operator">?</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> _this<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> val<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> max<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;max&apos;</span><span class="token punctuation">,</span>
      max<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadateminvalue-message"><a name="schemadateminvalue-message" class="anchor-navigation-ex-anchor" href="#schemadateminvalue-message"><i class="fa fa-link" aria-hidden="true"></i></a>33.4. SchemaDate#min(value, [message])</h2>
<p>Sets a minimum date validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_244"><a name="&#x53C2;&#x6570;&#xFF1A;_244" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_244"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> <date> minimum date</date></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_183"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_183" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_183"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_131"><a name="&#x53C2;&#x89C1;&#xFF1A;_131" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_131"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_188"><a name="&#x793A;&#x4F8B;&#xFF1A;_188" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_188"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> min<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1970-01-01&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1969-12-31&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  m<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;2014-12-08&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MIN} token which will be replaced with the invalid value</span>
<span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1970-01-01&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` ({VALUE}) is beneath the limit ({MIN}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> min<span class="token punctuation">:</span> min <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> d<span class="token punctuation">:</span> <span class="token function">Date</span><span class="token punctuation">(</span><span class="token string">&apos;1969-12-31&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `d` (1969-12-31) is before the limit (1970-01-01).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate_min" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate_min"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate_min"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaDate<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>min <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>minValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>min<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MIN}/</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> Date<span class="token punctuation">.</span>now <span class="token operator">?</span> <span class="token string">&apos;Date.now()&apos;</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> Date<span class="token punctuation">.</span>now <span class="token operator">?</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> _this<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> val <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> val<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> min<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;min&apos;</span><span class="token punctuation">,</span>
      min<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadatekey-options"><a name="schemadatekey-options" class="anchor-navigation-ex-anchor" href="#schemadatekey-options"><i class="fa fa-link" aria-hidden="true"></i></a>33.5. SchemaDate(key, options)</h2>
<p>Date SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_245"><a name="&#x53C2;&#x6570;&#xFF1A;_245" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_245"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_14"><a name="&#x7EE7;&#x627F;&#xFF1A;_14" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_14"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaDate</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemadateschemaname"><a name="schemadateschemaname" class="anchor-navigation-ex-anchor" href="#schemadateschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>33.6. SchemaDate.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaDate_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaDate_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaDate_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaDate<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Date&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="schemanumberjs"><a name="schemanumberjs" class="anchor-navigation-ex-anchor" href="#schemanumberjs"><i class="fa fa-link" aria-hidden="true"></i></a>34. schema/number.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schema/number.js" target="_blank">schema/number.js</a></p>
</blockquote>
<h2 id="schemanumbercheckrequiredvalue-doc"><a name="schemanumbercheckrequiredvalue-doc" class="anchor-navigation-ex-anchor" href="#schemanumbercheckrequiredvalue-doc"><i class="fa fa-link" aria-hidden="true"></i></a>34.1. SchemaNumber#checkRequired(value, doc)</h2>
<p>Check if the given value satisfies a required validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_246"><a name="&#x53C2;&#x6570;&#xFF1A;_246" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_246"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> &lt;<a href="#Any">Any</a>&gt;</p>
</li>
<li><p><code>doc</code> <document></document></p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_184"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_184" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_184"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaNumber_checkRequired" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaNumber_checkRequired"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaNumber_checkRequired"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaNumber<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>checkRequired <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>SchemaType<span class="token punctuation">.</span><span class="token function">_isRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> doc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&apos;number&apos;</span> <span class="token operator">||</span> value <span class="token keyword">instanceof</span> <span class="token class-name">Number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemanumbermaxmaximum-message"><a name="schemanumbermaxmaximum-message" class="anchor-navigation-ex-anchor" href="#schemanumbermaxmaximum-message"><i class="fa fa-link" aria-hidden="true"></i></a>34.2. SchemaNumber#max(maximum, [message])</h2>
<p>Sets a maximum number validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_247"><a name="&#x53C2;&#x6570;&#xFF1A;_247" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_247"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>maximum</code> <number> number</number></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_185"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_185" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_185"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_132"><a name="&#x53C2;&#x89C1;&#xFF1A;_132" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_132"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_189"><a name="&#x793A;&#x4F8B;&#xFF1A;_189" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_189"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> max<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  m<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MAX} token which will be replaced with the invalid value</span>
<span class="token keyword">var</span> max <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` ({VALUE}) exceeds the limit ({MAX}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> max<span class="token punctuation">:</span> max <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Measurement&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `n` (4) exceeds the limit (10).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaNumber_max" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaNumber_max"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaNumber_max"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaNumber<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>max <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>Number<span class="token punctuation">.</span>max<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MAX}/</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> v <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> v <span class="token operator">&lt;=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;max&apos;</span><span class="token punctuation">,</span>
      max<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemanumberminvalue-message"><a name="schemanumberminvalue-message" class="anchor-navigation-ex-anchor" href="#schemanumberminvalue-message"><i class="fa fa-link" aria-hidden="true"></i></a>34.3. SchemaNumber#min(value, [message])</h2>
<p>Sets a minimum number validator.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_248"><a name="&#x53C2;&#x6570;&#xFF1A;_248" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_248"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>value</code> <number> minimum number</number></p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_186"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_186" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_186"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_133"><a name="&#x53C2;&#x89C1;&#xFF1A;_133" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_133"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Customized Error Messages</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_190"><a name="&#x793A;&#x4F8B;&#xFF1A;_190" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_190"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> min<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// validator error</span>
  m<span class="token punctuation">.</span>n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  m<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// custom error messages</span>
<span class="token comment" spellcheck="true">// We can also use the special {MIN} token which will be replaced with the invalid value</span>
<span class="token keyword">var</span> min <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&apos;The value of path `{PATH}` ({VALUE}) is beneath the limit ({MIN}).&apos;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> min<span class="token punctuation">:</span> min <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Measurement&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ValidationError: The value of path `n` (4) is beneath the limit (10).</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaNumber_min" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaNumber_min"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaNumber_min"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaNumber<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>min <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>minValidator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> undefined<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>Number<span class="token punctuation">.</span>min<span class="token punctuation">;</span>
    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/{MIN}/</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> v <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> v <span class="token operator">&gt;=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
      type<span class="token punctuation">:</span> <span class="token string">&apos;min&apos;</span><span class="token punctuation">,</span>
      min<span class="token punctuation">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemanumberkey-options"><a name="schemanumberkey-options" class="anchor-navigation-ex-anchor" href="#schemanumberkey-options"><i class="fa fa-link" aria-hidden="true"></i></a>34.4. SchemaNumber(key, options)</h2>
<p>Number SchemaType constructor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_249"><a name="&#x53C2;&#x6570;&#xFF1A;_249" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_249"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>key</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_15"><a name="&#x7EE7;&#x627F;&#xFF1A;_15" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_15"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="">SchemaType</a></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaNumber" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaNumber"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaNumber"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaNumber</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  SchemaType<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">&apos;Number&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schemanumberschemaname"><a name="schemanumberschemaname" class="anchor-navigation-ex-anchor" href="#schemanumberschemaname"><i class="fa fa-link" aria-hidden="true"></i></a>34.5. SchemaNumber.schemaName</h2>
<p>This schema type&apos;s name, to defend against minifiers that mangle
function names.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaNumber_schemaName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaNumber_schemaName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaNumber_schemaName"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaNumber<span class="token punctuation">.</span>schemaName <span class="token operator">=</span> <span class="token string">&apos;Number&apos;</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="cursorquerycursorjs"><a name="cursorquerycursorjs" class="anchor-navigation-ex-anchor" href="#cursorquerycursorjs"><i class="fa fa-link" aria-hidden="true"></i></a>35. cursor/QueryCursor.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/cursor/QueryCursor.js" target="_blank">cursor/QueryCursor.js</a></p>
</blockquote>
<h2 id="querycursoraddcursorflagflag-value"><a name="querycursoraddcursorflagflag-value" class="anchor-navigation-ex-anchor" href="#querycursoraddcursorflagflag-value"><i class="fa fa-link" aria-hidden="true"></i></a>35.1. QueryCursor#addCursorFlag(flag, value)</h2>
<p>Adds a cursor flag.
Useful for setting the noCursorTimeout and tailable flags.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_250"><a name="&#x53C2;&#x6570;&#xFF1A;_250" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_250"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>flag</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_187"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_187" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_187"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregationcursor> this</aggregationcursor></li>
</ul>
<h2 id="querycursorclosecallback"><a name="querycursorclosecallback" class="anchor-navigation-ex-anchor" href="#querycursorclosecallback"><i class="fa fa-link" aria-hidden="true"></i></a>35.2. QueryCursor#close(callback)</h2>
<p>Marks this cursor as closed. Will stop streaming and subsequent calls to
next() will error.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_251"><a name="&#x53C2;&#x6570;&#xFF1A;_251" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_251"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_188"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_188" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_188"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_134"><a name="&#x53C2;&#x89C1;&#xFF1A;_134" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_134"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/driver%20cursor#close http://mongodb.github.io/node-mongodb-native/2.1/api/Cursor.html#close" target="_blank">MongoDB</a></li>
</ul>
<h2 id="querycursoreachasyncfn-options-optionsparallel-callback"><a name="querycursoreachasyncfn-options-optionsparallel-callback" class="anchor-navigation-ex-anchor" href="#querycursoreachasyncfn-options-optionsparallel-callback"><i class="fa fa-link" aria-hidden="true"></i></a>35.3. QueryCursor#eachAsync(fn, [options], [options.parallel], [callback])</h2>
<p>Execute fn for every document in the cursor. If fn returns a promise,
will wait for the promise to resolve before iterating on to the next one.
Returns a promise that resolves when done.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_252"><a name="&#x53C2;&#x6570;&#xFF1A;_252" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_252"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[options.parallel]</code> <number> the number of promises to execute in parallel. Defaults to 1.</number></p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; executed when all docs have been processed</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_189"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_189" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_189"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>



</promise></li>
</ul>
<h2 id="querycursormapfn"><a name="querycursormapfn" class="anchor-navigation-ex-anchor" href="#querycursormapfn"><i class="fa fa-link" aria-hidden="true"></i></a>35.4. QueryCursor#map(fn)</h2>
<p>Registers a transform function which subsequently maps documents retrieved
via the streams interface or .next()</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_253"><a name="&#x53C2;&#x6570;&#xFF1A;_253" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_253"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_190"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_190" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_190"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><querycursor>

</querycursor></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_191"><a name="&#x793A;&#x4F8B;&#xFF1A;_191" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_191"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Map documents returned by `data` events</span>
Thing<span class="token punctuation">.</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> doc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Or map documents returned by `.next()`</span>
<span class="token keyword">var</span> cursor <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> doc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="querycursornextcallback"><a name="querycursornextcallback" class="anchor-navigation-ex-anchor" href="#querycursornextcallback"><i class="fa fa-link" aria-hidden="true"></i></a>35.5. QueryCursor#next(callback)</h2>
<p>Get the next document from this cursor. Will return null when there are
no documents left.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_254"><a name="&#x53C2;&#x6570;&#xFF1A;_254" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_254"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>callback &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_191"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_191" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_191"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>


</promise></li>
</ul>
<h2 id="querycursorquery-options"><a name="querycursorquery-options" class="anchor-navigation-ex-anchor" href="#querycursorquery-options"><i class="fa fa-link" aria-hidden="true"></i></a>35.6. QueryCursor(query, options)</h2>
<p>A QueryCursor is a concurrency primitive for processing query results
one document at a time. A QueryCursor fulfills the Node.js streams3 API,
in addition to several other mechanisms for loading documents from MongoDB
one at a time.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_255"><a name="&#x53C2;&#x6570;&#xFF1A;_255" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_255"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>query</code> <query></query></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; query options passed to .find()</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_16"><a name="&#x7EE7;&#x627F;&#xFF1A;_16" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_16"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/api.html#Readable" target="_blank">Readable</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_4"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_4" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_4"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<p><code>cursor</code>: Emitted when the cursor is created</p>
<p><code>error</code>: Emitted when an error occurred</p>
<p><code>data</code>: Emitted when the stream is flowing and the next doc is ready</p>
<p><code>end</code>: Emitted when the stream is exhausted</p>
<p>QueryCursors execute the model&apos;s pre find hooks, but not the model&apos;s
post find hooks.</p>
<p>Unless you&apos;re an advanced user, do not instantiate this class directly.
Use <a href="">Query#cursor()</a> instead.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="QueryCursor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="QueryCursor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="QueryCursor"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">QueryCursor</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Readable<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> objectMode<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>query <span class="token operator">=</span> query<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_transforms <span class="token operator">=</span> options<span class="token punctuation">.</span>transform <span class="token operator">?</span> <span class="token punctuation">[</span>options<span class="token punctuation">.</span>transform<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> query<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
  model<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">execPre</span><span class="token punctuation">(</span><span class="token string">&apos;find&apos;</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>_conditions<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_this<span class="token punctuation">.</span>_error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _this<span class="token punctuation">.</span><span class="token function">listeners</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> _this<span class="token punctuation">.</span>_error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      _this<span class="token punctuation">.</span>cursor <span class="token operator">=</span> cursor<span class="token punctuation">;</span>
      _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;cursor&apos;</span><span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>QueryCursor<span class="token punctuation">,</span> Readable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h1 id="cursoraggregationcursorjs"><a name="cursoraggregationcursorjs" class="anchor-navigation-ex-anchor" href="#cursoraggregationcursorjs"><i class="fa fa-link" aria-hidden="true"></i></a>36. cursor/AggregationCursor.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/cursor/AggregationCursor.js" target="_blank">cursor/AggregationCursor.js</a></p>
</blockquote>
<h2 id="aggregationcursoraddcursorflagflag-value"><a name="aggregationcursoraddcursorflagflag-value" class="anchor-navigation-ex-anchor" href="#aggregationcursoraddcursorflagflag-value"><i class="fa fa-link" aria-hidden="true"></i></a>36.1. AggregationCursor#addCursorFlag(flag, value)</h2>
<p>Adds a cursor flag.
Useful for setting the noCursorTimeout and tailable flags.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_256"><a name="&#x53C2;&#x6570;&#xFF1A;_256" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_256"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>flag</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>value</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_192"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_192" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_192"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><aggregationcursor> this</aggregationcursor></li>
</ul>
<h2 id="aggregationcursoragg-options"><a name="aggregationcursoragg-options" class="anchor-navigation-ex-anchor" href="#aggregationcursoragg-options"><i class="fa fa-link" aria-hidden="true"></i></a>36.2. AggregationCursor(agg, options)</h2>
<p>An AggregationCursor is a concurrency primitive for processing aggregation
results one document at a time. It is analogous to QueryCursor.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_257"><a name="&#x53C2;&#x6570;&#xFF1A;_257" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_257"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>agg</code> <aggregate></aggregate></p>
</li>
<li><p><code>options</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_17"><a name="&#x7EE7;&#x627F;&#xFF1A;_17" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_17"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/api.html#Readable" target="_blank">Readable</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_5"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_5" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_5"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<p><code>cursor</code>: Emitted when the cursor is created</p>
<p><code>error</code>: Emitted when an error occurred</p>
<p><code>data</code>: Emitted when the stream is flowing and the next doc is ready</p>
<p><code>end</code>: Emitted when the stream is exhausted</p>
<p>An AggregationCursor fulfills the <a href="https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/" target="_blank">Node.js streams3 API</a>,
in addition to several other mechanisms for loading documents from MongoDB
one at a time.</p>
<p>Creating an AggregationCursor executes the model&apos;s pre aggregate hooks,
but not the model&apos;s post aggregate hooks.</p>
<p>Unless you&apos;re an advanced user, do not instantiate this class directly.
Use <a href="http://mongoosejs.com/docs/api.html#aggregate_Aggregate-cursor" target="_blank">Aggregate#cursor()</a> instead.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="AggregationCursor" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="AggregationCursor"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="AggregationCursor"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">AggregationCursor</span><span class="token punctuation">(</span>agg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Readable<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> objectMode<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>agg <span class="token operator">=</span> agg<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_transforms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> model <span class="token operator">=</span> agg<span class="token punctuation">.</span>_model<span class="token punctuation">;</span>
  <span class="token keyword">delete</span> agg<span class="token punctuation">.</span>options<span class="token punctuation">.</span>cursor<span class="token punctuation">.</span>useMongooseAggCursor<span class="token punctuation">;</span>

  <span class="token function">_init</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

util<span class="token punctuation">.</span><span class="token function">inherits</span><span class="token punctuation">(</span>AggregationCursor<span class="token punctuation">,</span> Readable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="aggregationcursorclosecallback"><a name="aggregationcursorclosecallback" class="anchor-navigation-ex-anchor" href="#aggregationcursorclosecallback"><i class="fa fa-link" aria-hidden="true"></i></a>36.3. AggregationCursor#close(callback)</h2>
<p>Marks this cursor as closed. Will stop streaming and subsequent calls to
next() will error.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_258"><a name="&#x53C2;&#x6570;&#xFF1A;_258" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_258"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_193"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_193" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_193"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>

</promise></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_135"><a name="&#x53C2;&#x89C1;&#xFF1A;_135" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_135"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="http://mongoosejs.com/docs/driver%20cursor#close http://mongodb.github.io/node-mongodb-native/2.1/api/Cursor.html#close" target="_blank">MongoDB</a></li>
</ul>
<h2 id="aggregationcursoreachasyncfn-callback"><a name="aggregationcursoreachasyncfn-callback" class="anchor-navigation-ex-anchor" href="#aggregationcursoreachasyncfn-callback"><i class="fa fa-link" aria-hidden="true"></i></a>36.4. AggregationCursor#eachAsync(fn, [callback])</h2>
<p>Execute fn for every document in the cursor. If fn returns a promise,
will wait for the promise to resolve before iterating on to the next one.
Returns a promise that resolves when done.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_259"><a name="&#x53C2;&#x6570;&#xFF1A;_259" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_259"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; executed when all docs have been processed</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_194"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_194" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_194"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>



</promise></li>
</ul>
<h2 id="aggregationcursormapfn"><a name="aggregationcursormapfn" class="anchor-navigation-ex-anchor" href="#aggregationcursormapfn"><i class="fa fa-link" aria-hidden="true"></i></a>36.5. AggregationCursor#map(fn)</h2>
<p>Registers a transform function which subsequently maps documents retrieved
via the streams interface or .next()</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_260"><a name="&#x53C2;&#x6570;&#xFF1A;_260" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_260"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_195"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_195" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_195"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><querycursor>

</querycursor></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_192"><a name="&#x793A;&#x4F8B;&#xFF1A;_192" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_192"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Map documents returned by `data` events</span>
Thing<span class="token punctuation">.</span>
  <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> doc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;data&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Or map documents returned by `.next()`</span>
<span class="token keyword">var</span> cursor <span class="token operator">=</span> Thing<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token regex">/^hello/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    doc<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> doc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="aggregationcursornextcallback"><a name="aggregationcursornextcallback" class="anchor-navigation-ex-anchor" href="#aggregationcursornextcallback"><i class="fa fa-link" aria-hidden="true"></i></a>36.6. AggregationCursor#next(callback)</h2>
<p>Get the next document from this cursor. Will return null when there are
no documents left.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_261"><a name="&#x53C2;&#x6570;&#xFF1A;_261" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_261"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>callback</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_196"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_196" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_196"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><promise>



</promise></li>
</ul>
<hr>
<h1 id="schematypejs"><a name="schematypejs" class="anchor-navigation-ex-anchor" href="#schematypejs"><i class="fa fa-link" aria-hidden="true"></i></a>37. schematype.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/schematype.js" target="_blank">schematype.js</a></p>
</blockquote>
<h2 id="schematypedefaultval"><a name="schematypedefaultval" class="anchor-navigation-ex-anchor" href="#schematypedefaultval"><i class="fa fa-link" aria-hidden="true"></i></a>37.1. SchemaType#default(val)</h2>
<p>Sets a default value for this SchemaType.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_262"><a name="&#x53C2;&#x6570;&#xFF1A;_262" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_262"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> <function, t=""> the default value</function,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_197"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_197" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_197"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><defaultvalue>

</defaultvalue></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_193"><a name="&#x793A;&#x4F8B;&#xFF1A;_193" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_193"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> n<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>n<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 10</span>
</code></pre>
<p>Defaults can be either functions which return the value to use as the default or the literal value itself. Either way, the value will be cast based on its schema type before being set during document creation.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_194"><a name="&#x793A;&#x4F8B;&#xFF1A;_194" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_194"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// values are cast:</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> aNumber<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">4.815162342</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>aNumber<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 4.815162342</span>

<span class="token comment" spellcheck="true">// default unique objects for Mixed types:</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mixed<span class="token punctuation">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Mixed <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;mixed&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// if we don&apos;t use a function to return object literals for Mixed defaults,</span>
<span class="token comment" spellcheck="true">// each document will receive a reference to the same object literal creating</span>
<span class="token comment" spellcheck="true">// a &quot;shared&quot; object instance:</span>
<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mixed<span class="token punctuation">:</span> Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Mixed <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;mixed&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
m1<span class="token punctuation">.</span>mixed<span class="token punctuation">.</span>added <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m1<span class="token punctuation">.</span>mixed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { added: 1 }</span>
<span class="token keyword">var</span> m2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">M</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m2<span class="token punctuation">.</span>mixed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// { added: 1 }</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_default" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_default"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_default"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>defaultValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypegetfn"><a name="schematypegetfn" class="anchor-navigation-ex-anchor" href="#schematypegetfn"><i class="fa fa-link" aria-hidden="true"></i></a>37.2. SchemaType#get(fn)</h2>
<p>Adds a getter to this schematype.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_263"><a name="&#x53C2;&#x6570;&#xFF1A;_263" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_263"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_198"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_198" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_198"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_195"><a name="&#x793A;&#x4F8B;&#xFF1A;_195" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_195"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> dob <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>val<span class="token punctuation">)</span> <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>val<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> val<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> val<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// defining within the schema</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> born<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">:</span> dob <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or by retreiving its SchemaType</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> born<span class="token punctuation">:</span> Date <span class="token punctuation">}</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;born&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>dob<span class="token punctuation">)</span>
</code></pre>
<p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p>
<p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user. You can do so by defining a getter in the following way:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> obfuscate <span class="token punctuation">(</span>cc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&apos;****-****-****-&apos;</span> <span class="token operator">+</span> cc<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>cc<span class="token punctuation">.</span>length<span class="token number">-4</span><span class="token punctuation">,</span> cc<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> AccountSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  creditCardNumber<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">:</span> obfuscate <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Account <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Account&apos;</span><span class="token punctuation">,</span> AccountSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

Account<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> found<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">.</span>creditCardNumber<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;****-****-****-1234&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Getters are also passed a second argument, the schematype on which the getter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> inspector <span class="token punctuation">(</span>val<span class="token punctuation">,</span> schematype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schematype<span class="token punctuation">.</span>options<span class="token punctuation">.</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> schematype<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&apos; is required&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> schematype<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&apos; is not&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> VirusSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">:</span> inspector <span class="token punctuation">}</span><span class="token punctuation">,</span>
  taxonomy<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">get</span><span class="token punctuation">:</span> inspector <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> Virus <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Virus&apos;</span><span class="token punctuation">,</span> VirusSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

Virus<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> virus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>virus<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// name is required</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>virus<span class="token punctuation">.</span>taxonomy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// taxonomy is not</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_get" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_get"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_get"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">get</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&apos;A getter must be a function.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypeindexoptions"><a name="schematypeindexoptions" class="anchor-navigation-ex-anchor" href="#schematypeindexoptions"><i class="fa fa-link" aria-hidden="true"></i></a>37.3. SchemaType#index(options)</h2>
<p>Declares the index options for this schematype.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_264"><a name="&#x53C2;&#x6570;&#xFF1A;_264" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_264"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>options</code> <object, boolean,="" string=""></object,></li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_199"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_199" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_199"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_196"><a name="&#x793A;&#x4F8B;&#xFF1A;_196" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_196"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> loc<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token string">&apos;hashed&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> loc<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token string">&apos;2d&apos;</span><span class="token punctuation">,</span> sparse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> loc<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&apos;2dsphere&apos;</span><span class="token punctuation">,</span> sparse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> date<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token punctuation">{</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> expires<span class="token punctuation">:</span> <span class="token string">&apos;1d&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;my.path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;my.date&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span> expires<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;my.path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> sparse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_69"><a name="&#x6CE8;&#x610F;&#xFF1A;_69" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_69"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>Indexes are created in the background by default. Specify background: false to override.</p>
<p><a href="http://www.mongodb.org/display/DOCS/Indexes#Indexes-CompoundKeysIndexes" target="_blank">Direction doesn&apos;t matter for single key indexes</a></p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_index" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_index"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_index"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> options<span class="token punctuation">;</span>
  utils<span class="token punctuation">.</span><span class="token function">expires</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematyperequiredrequired-optionsisrequired-optionserrorconstructor-message"><a name="schematyperequiredrequired-optionsisrequired-optionserrorconstructor-message" class="anchor-navigation-ex-anchor" href="#schematyperequiredrequired-optionsisrequired-optionserrorconstructor-message"><i class="fa fa-link" aria-hidden="true"></i></a>37.4. SchemaType#required(required, [options.isRequired], [options.ErrorConstructor], [message])</h2>
<p>Adds a required validator to this SchemaType. The validator gets added
to the front of this SchemaType&apos;s validators array using unshift().</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_265"><a name="&#x53C2;&#x6570;&#xFF1A;_265" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_265"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>required</code> <boolean, function,="" object=""> enable/disable the validator, or function that returns required boolean, or options object</boolean,></p>
</li>
<li><p><code>[options.isRequired]</code> <boolean, function=""> enable/disable the validator, or function that returns required boolean</boolean,></p>
</li>
<li><p><code>[options.ErrorConstructor]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; custom error constructor. The constructor receives 1 parameter, an object containing the validator properties.</p>
</li>
<li><p><code>[message]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional custom error message</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_200"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_200" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_200"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_136"><a name="&#x53C2;&#x89C1;&#xFF1A;_136" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_136"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><p><a href="">Customized Error Messages</a></p>
</li>
<li><p><a href="">SchemaArray#checkRequired</a></p>
</li>
<li><p><a href="">SchemaBoolean#checkRequired</a></p>
</li>
<li><p><a href="">SchemaBuffer#checkRequired</a></p>
</li>
<li><p><a href="">SchemaNumber#checkRequired</a></p>
</li>
<li><p><a href="">SchemaObjectId#checkRequired</a></p>
</li>
<li><p><a href="">SchemaString#checkRequired</a></p>
</li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_197"><a name="&#x793A;&#x4F8B;&#xFF1A;_197" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_197"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> born<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or with custom error message</span>

<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> born<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Date<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token string">&apos;{PATH} is required!&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or with a function</span>

<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  userId<span class="token punctuation">:</span> ObjectId<span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or with a function and a custom message</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  userId<span class="token punctuation">:</span> ObjectId<span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    required<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&apos;username is required if id is specified&apos;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or through the path API</span>

Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// with custom error messaging</span>

Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&apos;grrr :( &apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or make a path conditionally required based on a function</span>
<span class="token keyword">var</span> isOver18 <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;voterRegistrationId&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span>isOver18<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The required validator uses the SchemaType&apos;s checkRequired function to
determine whether a given value satisfies the required validator. By default,
a value satisfies the required validator if val != null (that is, if
the value is not null nor undefined). However, most built-in mongoose schema
types override the default checkRequired function:</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_required" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_required"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_required"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>required <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>required<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> customOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> required <span class="token operator">===</span> <span class="token string">&apos;object&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    customOptions <span class="token operator">=</span> required<span class="token punctuation">;</span>
    message <span class="token operator">=</span> customOptions<span class="token punctuation">.</span>message <span class="token operator">||</span> message<span class="token punctuation">;</span>
    required <span class="token operator">=</span> required<span class="token punctuation">.</span>isRequired<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>required <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> v<span class="token punctuation">.</span>validator <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requiredValidator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>isRequired <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>isRequired <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>requiredValidator <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// in here, `this` refers to the validating document.</span>
    <span class="token comment" spellcheck="true">// no validation when this path wasn&apos;t selected in the query.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&apos;isSelected&apos;</span> <span class="token keyword">in</span> <span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isSelected</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isModified</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> required <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>required<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        _this<span class="token punctuation">.</span><span class="token function">checkRequired</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>originalRequiredValue <span class="token operator">=</span> required<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> required <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> required<span class="token punctuation">;</span>
    required <span class="token operator">=</span> undefined<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> msg <span class="token operator">=</span> message <span class="token operator">||</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>general<span class="token punctuation">.</span>required<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> customOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    validator<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requiredValidator<span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> msg<span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">&apos;required&apos;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypepath-options-instance"><a name="schematypepath-options-instance" class="anchor-navigation-ex-anchor" href="#schematypepath-options-instance"><i class="fa fa-link" aria-hidden="true"></i></a>37.5. SchemaType(path, [options], [instance])</h2>
<p>SchemaType constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_266"><a name="&#x53C2;&#x6570;&#xFF1A;_266" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_266"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>path</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt;</p>
</li>
<li><p><code>[instance]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt;</p>
</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="11" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="11"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="11"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">SchemaType</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> options<span class="token punctuation">,</span> instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>validators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>setters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>selected<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// { unique: true, index: true }</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> <span class="token string">&apos;index&apos;</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> val <span class="token operator">=</span> options<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Special case so we don&apos;t screw up array defaults, see gh-5780</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> <span class="token string">&apos;default&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> opts <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">?</span> val <span class="token punctuation">:</span> <span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&apos;$$context&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypeselectval"><a name="schematypeselectval" class="anchor-navigation-ex-anchor" href="#schematypeselectval"><i class="fa fa-link" aria-hidden="true"></i></a>37.6. SchemaType#select(val)</h2>
<p>Sets default select() behavior for this path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_267"><a name="&#x53C2;&#x6570;&#xFF1A;_267" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_267"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>val</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_201"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_201" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_201"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<p>Set to true if this path should always be included in the results, false if it should be excluded by default. This setting can be overridden at the query level.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_198"><a name="&#x793A;&#x4F8B;&#xFF1A;_198" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_198"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">T <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;T&apos;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> select<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
T<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// field x will always be selected ..</span>
<span class="token comment" spellcheck="true">// .. unless overridden;</span>
T<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&apos;-x&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_select" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_select"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_select"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>select <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>selected <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>val<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypesetfn"><a name="schematypesetfn" class="anchor-navigation-ex-anchor" href="#schematypesetfn"><i class="fa fa-link" aria-hidden="true"></i></a>37.7. SchemaType#set(fn)</h2>
<p>Adds a setter to this schematype.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_268"><a name="&#x53C2;&#x6570;&#xFF1A;_268" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_268"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>fn</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_202"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_202" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_202"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_199"><a name="&#x793A;&#x4F8B;&#xFF1A;_199" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_199"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> capitalize <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">!==</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> val <span class="token operator">=</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> val<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// defining within the schema</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">set</span><span class="token punctuation">:</span> capitalize <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// or by retreiving its SchemaType</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>capitalize<span class="token punctuation">)</span>
</code></pre>
<p>Setters allow you to transform the data before it gets to the raw mongodb document and is set as a value on an actual key.</p>
<p>Suppose you are implementing user registration for a website. Users provide an email and password, which gets saved to mongodb. The email is a string that you will want to normalize to lower case, in order to avoid one email having more than one account -- e.g., otherwise, avenue@q.com can be registered for 2 accounts via avenue@q.com and AvEnUe@Q.CoM.</p>
<p>You can set up email lower case normalization easily via a Mongoose setter.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">toLower</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">set</span><span class="token punctuation">:</span> toLower <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> User <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>email<span class="token punctuation">:</span> <span class="token string">&apos;AVENUE@Q.COM&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;avenue@q.com&apos;</span>

<span class="token comment" spellcheck="true">// or</span>
<span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&apos;Avenue@Q.com&apos;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;avenue@q.com&apos;</span>
</code></pre>
<p>As you can see above, setters allow you to transform the data before it stored in MongoDB.</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_70"><a name="&#x6CE8;&#x610F;&#xFF1A;_70" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_70"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>setters by default do not run on queries by default.</p>
<p>// Will <strong>not</strong> run the <code>toLower()</code> setter by default.
User.updateOne({ _id: _id }, { $set: { email: &apos;AVENUE@Q.COM&apos; } });
Use the runSettersOnQuery option to opt-in to running setters on User.update():</p>
<p>// Turn on <code>runSettersOnQuery</code> to run the setters from your schema.
User.updateOne({ _id: _id }, { $set: { email: &apos;AVENUE@Q.COM&apos; } }, {
  runSettersOnQuery: true
});</p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_71"><a name="&#x6CE8;&#x610F;&#xFF1A;_71" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_71"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>we could have also just used the built-in lowercase: true SchemaType option instead of defining our own function.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> lowercase<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Setters are also passed a second argument<span class="token punctuation">,</span> the schematype on which the setter was defined<span class="token punctuation">.</span> This allows <span class="token keyword">for</span> tailored behavior based on options passed <span class="token keyword">in</span> the schema<span class="token punctuation">.</span>

<span class="token keyword">function</span> inspector <span class="token punctuation">(</span>val<span class="token punctuation">,</span> schematype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schematype<span class="token punctuation">.</span>options<span class="token punctuation">.</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> schematype<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&apos; is required&apos;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> VirusSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">set</span><span class="token punctuation">:</span> inspector <span class="token punctuation">}</span><span class="token punctuation">,</span>
  taxonomy<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> <span class="token keyword">set</span><span class="token punctuation">:</span> inspector <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> Virus <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Virus&apos;</span><span class="token punctuation">,</span> VirusSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Virus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Parvoviridae&apos;</span><span class="token punctuation">,</span> taxonomy<span class="token punctuation">:</span> <span class="token string">&apos;Parvovirinae&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">// name is required</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>taxonomy<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Parvovirinae</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_set" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_set"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_set"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&apos;A setter must be a function.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>setters<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypesparsebool"><a name="schematypesparsebool" class="anchor-navigation-ex-anchor" href="#schematypesparsebool"><i class="fa fa-link" aria-hidden="true"></i></a>37.8. SchemaType#sparse(bool)</h2>
<p>Declares a sparse index.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_269"><a name="&#x53C2;&#x6570;&#xFF1A;_269" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_269"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>bool</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_203"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_203" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_203"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_200"><a name="&#x793A;&#x4F8B;&#xFF1A;_200" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_200"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> sparse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sparse<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_sparse" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_sparse"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_sparse"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>sparse <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> undefined <span class="token operator">||</span>
    <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">.</span>sparse <span class="token operator">=</span> bool<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypetextbool"><a name="schematypetextbool" class="anchor-navigation-ex-anchor" href="#schematypetextbool"><i class="fa fa-link" aria-hidden="true"></i></a>37.9. SchemaType#text(bool)</h2>
<p>Declares a full text index.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_270"><a name="&#x53C2;&#x6570;&#xFF1A;_270" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_270"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>bool</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_204"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_204" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_204"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_201"><a name="&#x793A;&#x4F8B;&#xFF1A;_201" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_201"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name <span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> text <span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_text" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_text"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_text"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> undefined <span class="token operator">||</span>
    <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token string">&apos;boolean&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">.</span>text <span class="token operator">=</span> bool<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypeuniquebool"><a name="schematypeuniquebool" class="anchor-navigation-ex-anchor" href="#schematypeuniquebool"><i class="fa fa-link" aria-hidden="true"></i></a>37.10. SchemaType#unique(bool)</h2>
<p>Declares an unique index.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_271"><a name="&#x53C2;&#x6570;&#xFF1A;_271" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_271"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><code>bool</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt;</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_205"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_205" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_205"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_202"><a name="&#x793A;&#x4F8B;&#xFF1A;_202" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_202"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">{</span> unique<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_72"><a name="&#x6CE8;&#x610F;&#xFF1A;_72" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_72"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p>violating the constraint returns an E11000 error from MongoDB when saving, not a Mongoose validation error.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_unique" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_unique"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_unique"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>unique <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Path &quot;&apos;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">&apos;&quot; may not have `index` set to &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;false and `unique` set to true&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token punctuation">.</span>unique <span class="token operator">=</span> bool<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="schematypevalidateobj-errormsg-type"><a name="schematypevalidateobj-errormsg-type" class="anchor-navigation-ex-anchor" href="#schematypevalidateobj-errormsg-type"><i class="fa fa-link" aria-hidden="true"></i></a>37.11. SchemaType#validate(obj, [errorMsg], [type])</h2>
<p>Adds validator(s) for this document path.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_272"><a name="&#x53C2;&#x6570;&#xFF1A;_272" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_272"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>obj</code> <regexp, function,="" object=""> validator</regexp,></p>
</li>
<li><p><code>[errorMsg]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional error message</p>
</li>
<li><p><code>[type]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; optional validator type</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_206"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_206" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_206"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><schematype> this</schematype></li>
</ul>
<p>Validators always receive the value to validate as their first argument and must return Boolean. Returning false means validation failed.</p>
<p>The error message argument is optional. If not passed, the default generic error message template will be used.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_203"><a name="&#x793A;&#x4F8B;&#xFF1A;_203" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_203"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// make sure every value is equal to &quot;something&quot;</span>
<span class="token keyword">function</span> validator <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> val <span class="token operator">==</span> <span class="token string">&apos;something&apos;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> validate<span class="token punctuation">:</span> validator <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// with a custom error message</span>

<span class="token keyword">var</span> custom <span class="token operator">=</span> <span class="token punctuation">[</span>validator<span class="token punctuation">,</span> <span class="token string">&apos;Uh oh, {PATH} does not equal &quot;something&quot;.&apos;</span><span class="token punctuation">]</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> validate<span class="token punctuation">:</span> custom <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// adding many validators at a time</span>

<span class="token keyword">var</span> many <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> validator<span class="token punctuation">:</span> validator<span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token string">&apos;uh oh&apos;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">,</span> <span class="token punctuation">{</span> validator<span class="token punctuation">:</span> anotherValidator<span class="token punctuation">,</span> msg<span class="token punctuation">:</span> <span class="token string">&apos;failed&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> validate<span class="token punctuation">:</span> many <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or utilizing SchemaType methods directly:</span>

<span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;string&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>validator<span class="token punctuation">,</span> <span class="token string">&apos;validation of `{PATH}` failed with value `{VALUE}`&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="error-message-templates"><a name="error-message-templates" class="anchor-navigation-ex-anchor" href="#error-message-templates"><i class="fa fa-link" aria-hidden="true"></i></a><a name="error-message-templates" class="plugin-anchor" href="#error-message-templates"><i class="fa fa-link" aria-hidden="true"></i></a>Error message templates:</h5>
<p>From the examples above, you may have noticed that error messages support basic templating. There are a few other template keywords besides {PATH} and {VALUE} too. To find out more, details are available here</p>
<h5 id="asynchronous-validation"><a name="asynchronous-validation" class="anchor-navigation-ex-anchor" href="#asynchronous-validation"><i class="fa fa-link" aria-hidden="true"></i></a><a name="asynchronous-validation" class="plugin-anchor" href="#asynchronous-validation"><i class="fa fa-link" aria-hidden="true"></i></a>Asynchronous validation:</h5>
<p>Passing a validator function that receives two arguments tells mongoose that the validator is an asynchronous validator. The first argument passed to the validator function is the value being validated. The second argument is a callback function that must called when you finish validating the value and passed either true or false to communicate either success or failure respectively.</p>
<pre class="language-"><code class="lang-js">schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  isAsync<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  validator<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> respond<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doStuff</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
      <span class="token function">respond</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// validation failed</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  message<span class="token punctuation">:</span> <span class="token string">&apos;Custom error message!&apos;</span> <span class="token comment" spellcheck="true">// Optional</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// Can also return a promise</span>
schema<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  validator<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// validation failed</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You might use asynchronous validators to retreive other documents from the database to validate against or to meet other I/O bound validation needs.</p>
<p>Validation occurs pre(&apos;save&apos;) or whenever you manually execute document#validate.</p>
<p>If validation fails during pre(&apos;save&apos;) and no callback was passed to receive the error, an error event will be emitted on your Models associated db connection, passing the validation error object along.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> Product <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Product&apos;</span><span class="token punctuation">,</span> yourSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dvd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dvd<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// emits error on the `conn` above</span>
</code></pre>
<p>If you desire handling these errors at the Model level, attach an error listener to your Model and the event will instead be emitted there.</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// registering an error listener on the Model lets us handle errors more locally</span>
Product<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="SchemaType_validate" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="SchemaType_validate"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="SchemaType_validate"><div class="panel-body">
<pre class="language-"><code class="lang-js">SchemaType<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>validate <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> message<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span> <span class="token operator">||</span> obj <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;RegExp&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> properties<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      properties <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>properties<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        properties<span class="token punctuation">.</span>message <span class="token operator">=</span> properties<span class="token punctuation">.</span>msg<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      properties<span class="token punctuation">.</span>validator <span class="token operator">=</span> obj<span class="token punctuation">;</span>
      properties<span class="token punctuation">.</span>type <span class="token operator">=</span> properties<span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">&apos;user defined&apos;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        message <span class="token operator">=</span> MongooseError<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>general<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        type <span class="token operator">=</span> <span class="token string">&apos;user defined&apos;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      properties <span class="token operator">=</span> <span class="token punctuation">{</span>message<span class="token punctuation">:</span> message<span class="token punctuation">,</span> type<span class="token punctuation">:</span> type<span class="token punctuation">,</span> validator<span class="token punctuation">:</span> obj<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>validators<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> i<span class="token punctuation">,</span>
      length<span class="token punctuation">,</span>
      arg<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> length <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arg <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>arg <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">getFunctionName</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;Object&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token string">&apos;Invalid validator. Received (&apos;</span> <span class="token operator">+</span> <span class="token keyword">typeof</span> arg <span class="token operator">+</span> <span class="token string">&apos;) &apos;</span>
          <span class="token operator">+</span> arg
          <span class="token operator">+</span> <span class="token string">&apos;. See http://mongoosejs.com/docs/api.html#schematype_SchemaType-validate&apos;</span><span class="token punctuation">;</span>

      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span>validator<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="connectionjs"><a name="connectionjs" class="anchor-navigation-ex-anchor" href="#connectionjs"><i class="fa fa-link" aria-hidden="true"></i></a>38. connection.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/connection.js" target="_blank">connection.js</a></p>
</blockquote>
<h2 id="connectioncloseforce-callback"><a name="connectioncloseforce-callback" class="anchor-navigation-ex-anchor" href="#connectioncloseforce-callback"><i class="fa fa-link" aria-hidden="true"></i></a>38.1. Connection#close([force], [callback])</h2>
<p>Closes the connection</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_273"><a name="&#x53C2;&#x6570;&#xFF1A;_273" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_273"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p>[force] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Boolean" target="_blank">Boolean</a>&gt; optional</p>
</li>
<li><p>[callback] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt; optional</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_207"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_207" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_207"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><connection> self</connection></li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_close" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_close"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_close"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>close <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>force<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> force <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> force<span class="token punctuation">;</span>
    force <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>$wasForceClosed <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>force<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this<span class="token punctuation">.</span><span class="token function">_close</span><span class="token punctuation">(</span>force<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectioncollectionname-options"><a name="connectioncollectionname-options" class="anchor-navigation-ex-anchor" href="#connectioncollectionname-options"><i class="fa fa-link" aria-hidden="true"></i></a>38.2. Connection#collection(name, [options])</h2>
<p>Retrieves a collection, creating it if not cached.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_274"><a name="&#x53C2;&#x6570;&#xFF1A;_274" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_274"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; of the collection</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional collection options</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_208"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_208" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_208"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><collection> collection instance</collection></li>
</ul>
<p>Not typically needed by applications. Just talk to your collection through your model.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_collection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_collection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_collection"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collection <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> options <span class="token operator">?</span> utils<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">{</span> retainKeyOrder<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  options<span class="token punctuation">.</span>$wasForceClosed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$wasForceClosed<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collections<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>collections<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Collection</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>collections<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectionbase"><a name="connectionbase" class="anchor-navigation-ex-anchor" href="#connectionbase"><i class="fa fa-link" aria-hidden="true"></i></a>38.3. Connection(base)</h2>
<p>Connection constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_275"><a name="&#x53C2;&#x6570;&#xFF1A;_275" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_275"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li>base &lt;<a href="">Mongoose</a>&gt; a mongoose instance</li>
</ul>
<h5 id="&#x7EE7;&#x627F;&#xFF1A;_18"><a name="&#x7EE7;&#x627F;&#xFF1A;_18" class="anchor-navigation-ex-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;_18"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x7EE7;&#x627F;&#xFF1A;" class="plugin-anchor" href="#&#x7EE7;&#x627F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x7EE7;&#x627F;&#xFF1A;</h5>
<ul>
<li><a href="http://nodejs.org/api/events.html#events_class_events_eventemitter" target="_blank">NodeJS EventEmitter</a></li>
</ul>
<h5 id="&#x4E8B;&#x4EF6;&#xFF1A;_6"><a name="&#x4E8B;&#x4EF6;&#xFF1A;_6" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;_6"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x4E8B;&#x4EF6;&#xFF1A;" class="plugin-anchor" href="#&#x4E8B;&#x4EF6;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4E8B;&#x4EF6;&#xFF1A;</h5>
<ul>
<li><p><code>connecting</code>: Emitted when connection.{open,openSet}() is executed on this connection.</p>
</li>
<li><p><code>connected</code>: Emitted when this connection successfully connects to the db. May be emitted multiple times in reconnected scenarios.</p>
</li>
<li><p><code>open</code>: Emitted after we connected and onOpen is executed on all of this connections models.</p>
</li>
<li><p><code>disconnecting</code>: Emitted when connection.close() was executed.</p>
</li>
<li><p><code>disconnected</code>: Emitted after getting disconnected from the db.</p>
</li>
<li><p><code>close</code>: Emitted after we disconnected and onClose executed on all of this connections models.</p>
</li>
<li><p><code>reconnected</code>: Emitted after we connected and subsequently disconnected, followed by successfully another successfull connection.</p>
</li>
<li><p><code>error</code>: Emitted when an error occurs on this connection.</p>
</li>
<li><p><code>fullsetup</code>: Emitted in a replica-set scenario, when primary and at least one seconaries specified in the connection string are connected.</p>
</li>
<li><p><code>all</code>: Emitted in a replica-set scenario, when all nodes specified in the connection string are connected.</p>
</li>
</ul>
<p>For practical reasons, a Connection equals a Db.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Connection</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>base <span class="token operator">=</span> base<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>collections <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>models <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span>autoIndex<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>replica <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>hosts <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>otherDbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>states <span class="token operator">=</span> STATES<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_readyState <span class="token operator">=</span> STATES<span class="token punctuation">.</span>disconnected<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_closeCalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_hasOpened <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="collection-options-callback"><a name="collection-options-callback" class="anchor-navigation-ex-anchor" href="#collection-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>38.4. (collection, [options], [callback])</h2>
<p>Helper for createCollection(). Will explicitly create the given collection
with specified options. Used to create capped collections
and views from mongoose.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_276"><a name="&#x53C2;&#x6570;&#xFF1A;_276" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_276"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>collection</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; The collection to delete</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; see MongoDB driver docs</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_209"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_209" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_209"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="">Promise</a>&gt;</li>
</ul>
<p>Options are passed down without modification to the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Db.html#createCollection" target="_blank">MongoDB driver&apos;s createCollection() function</a></p>
<sec data-title="&#x6E90;&#x7801;" data-id="12" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="12"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="12"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>createCollection <span class="token operator">=</span> <span class="token function">_wrapConnHelper</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">createCollection</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">&apos;function&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cb <span class="token operator">=</span> options<span class="token punctuation">;</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> options<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collection-callback"><a name="collection-callback" class="anchor-navigation-ex-anchor" href="#collection-callback"><i class="fa fa-link" aria-hidden="true"></i></a>38.5. (collection, [callback])</h2>
<p>Helper for dropCollection(). Will delete the given collection, including
all documents and indexes.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_277"><a name="&#x53C2;&#x6570;&#xFF1A;_277" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_277"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>collection</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; The collection to delete</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_210"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_210" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_210"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li>&lt;<a href="">Promise</a>&gt;</li>
</ul>
<sec data-title="&#x6E90;&#x7801;" data-id="13" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="13"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="13"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>dropCollection <span class="token operator">=</span> <span class="token function">_wrapConnHelper</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">dropCollection</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">dropCollection</span><span class="token punctuation">(</span>collection<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="callback"><a name="callback" class="anchor-navigation-ex-anchor" href="#callback"><i class="fa fa-link" aria-hidden="true"></i></a>38.6. ([callback])</h2>
<p>Helper for dropDatabase(). Deletes the given database, including all
collections, documents, and indexes.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_278"><a name="&#x53C2;&#x6570;&#xFF1A;_278" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_278"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<p>[callback] &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_211"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_211" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_211"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<p><promise>
<sec data-title="&#x6E90;&#x7801;" data-id="14" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="14"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="14"><div class="panel-body"></div></div></div></sec></promise></p>
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>dropDatabase <span class="token operator">=</span> <span class="token function">_wrapConnHelper</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">dropDatabase</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">dropDatabase</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<h2 id="connectionmodelname-schema-collection"><a name="connectionmodelname-schema-collection" class="anchor-navigation-ex-anchor" href="#connectionmodelname-schema-collection"><i class="fa fa-link" aria-hidden="true"></i></a>38.7. Connection#model(name, [schema], collection)</h2>
<p>Defines or retrieves a model.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_279"><a name="&#x53C2;&#x6570;&#xFF1A;_279" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_279"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; the model name</p>
</li>
<li><p><code>[schema]</code> <schema> a schema. necessary when defining a model</schema></p>
</li>
<li><p><code>[collection]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; name of mongodb collection (optional) if not given it will be induced from model name</p>
</li>
</ul>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_212"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_212" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_212"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<ul>
<li><model> The compiled model</model></li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_137"><a name="&#x53C2;&#x89C1;&#xFF1A;_137" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_137"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="">Mongoose#model</a></li>
</ul>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Venue&apos;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Ticket <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Ticket&apos;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Venue <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Venue&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When no collection argument is passed, Mongoose produces a collection name by passing the model name to the <a href="http://mongoosejs.com/docs/api.html#utils_exports.toCollectionName" target="_blank">utils.toCollectionName</a> method. This method pluralizes the name. If you don&apos;t like this behavior, either pass a collection name or set your schemas collection name option.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_204"><a name="&#x793A;&#x4F8B;&#xFF1A;_204" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_204"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> collection<span class="token punctuation">:</span> <span class="token string">&apos;actor&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or</span>

schema<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;collection&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;actor&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// or</span>

<span class="token keyword">var</span> collectionName <span class="token operator">=</span> <span class="token string">&apos;actor&apos;</span>
<span class="token keyword">var</span> M <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Actor&apos;</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collectionName<span class="token punctuation">)</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_model" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_model"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_model"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// collection name discovery</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> schema <span class="token operator">===</span> <span class="token string">&apos;string&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    collection <span class="token operator">=</span> schema<span class="token punctuation">;</span>
    schema <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>utils<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>schema<span class="token punctuation">.</span>instanceOfSchema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span>schema<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>schema<span class="token punctuation">.</span>instanceOfSchema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;The 2nd parameter to `mongoose.model()` should be a &apos;</span> <span class="token operator">+</span>
      <span class="token string">&apos;schema or a POJO&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// model exists but we are not subclassing with custom collection</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> schema<span class="token punctuation">.</span>instanceOfSchema <span class="token operator">&amp;&amp;</span> schema <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>schema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MongooseError<span class="token punctuation">.</span>OverwriteModelError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>cache<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> connection<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> model<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>schema <span class="token operator">&amp;&amp;</span> schema<span class="token punctuation">.</span>instanceOfSchema<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// compile a model</span>
    model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>base<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// only the first model with this name is cached to allow</span>
    <span class="token comment" spellcheck="true">// for one-offs with custom collection names etc.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    model<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> collection<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// subclassing current model with alternate collection</span>
    model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    schema <span class="token operator">=</span> model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>schema<span class="token punctuation">;</span>
    <span class="token keyword">var</span> sub <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">__subclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// do not cache the sub model</span>
    <span class="token keyword">return</span> sub<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">// lookup model in mongoose module</span>
  model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>base<span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MongooseError<span class="token punctuation">.</span>MissingSchemaError</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> model<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>db
      <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>collection <span class="token operator">||</span> collection <span class="token operator">===</span> model<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// model already uses this connection.</span>

    <span class="token comment" spellcheck="true">// only the first model with this name is cached to allow</span>
    <span class="token comment" spellcheck="true">// for one-offs with custom collection names etc.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> model<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">__subclass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> schema<span class="token punctuation">,</span> collection<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>models<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectionmodelnames"><a name="connectionmodelnames" class="anchor-navigation-ex-anchor" href="#connectionmodelnames"><i class="fa fa-link" aria-hidden="true"></i></a>38.8. Connection#modelNames()</h2>
<p>Returns an array of model names created on this connection.</p>
<h5 id="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_213"><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_213" class="anchor-navigation-ex-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;_213"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x8FD4;&#x56DE;&#x503C;&#xFF1A;" class="plugin-anchor" href="#&#x8FD4;&#x56DE;&#x503C;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</h5>
<p>&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" target="_blank">Array</a>&gt;
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_modelNames" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_modelNames"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_modelNames"><div class="panel-body"></div></div></div></sec></p>
<pre class="language-"><code class="lang-js"><span class="token template-string"><span class="token string">``</span></span><span class="token template-string"><span class="token string">`
&lt;!--endsec--&gt;

## (connection_string, [database], [port], [options], [callback])

Opens the connection to MongoDB.

##### &#x53C2;&#x6570;&#xFF1A;

  * `</span></span>connection_string<span class="token template-string"><span class="token string">` &amp;lt;[String][]&amp;gt; mongodb://uri or the host to which you are connecting
  * `</span></span><span class="token punctuation">[</span>database<span class="token punctuation">]</span><span class="token template-string"><span class="token string">` &amp;lt;[String][]&amp;gt; database name
  * `</span></span><span class="token punctuation">[</span>port<span class="token punctuation">]</span><span class="token template-string"><span class="token string">` &lt;Number&gt; database port
  * `</span></span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token template-string"><span class="token string">` &amp;lt;[Object][]&amp;gt; options
  * `</span></span><span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token template-string"><span class="token string">` &amp;lt;[Function][]&amp;gt;


##### &#x53C2;&#x89C1;&#xFF1A;

  * node-mongodb-native
  *
  * http://mongodb.github.com/node-mongodb-native/api-generated/db.html#authenticate


options is a hash with the following possible properties:

&lt;pre&gt;
config  - passed to the connection config instance
db      - passed to the connection db instance
server  - passed to the connection server instance(s)
replset - passed to the connection ReplSet instance
user    - username for authentication
pass    - password for authentication
auth    - options for authentication (see http://mongodb.github.com/node-mongodb-native/api-generated/db.html#authenticate)
&lt;/pre&gt;

##### &#x793A;&#x4F8B;&#xFF1A;

Mongoose forces the db option forceServerObjectId false and cannot be overridden.
Mongoose defaults the server auto_reconnect options to true which can be overridden.
See the node-mongodb-native driver instance for options that it understands.

*Options passed take precedence over options included in connection strings.*

&lt;!--sec data-title=&quot;&#x6E90;&#x7801;&quot; data-id=&quot;14&quot; data-show=true data-collapse=true ces--&gt;
`</span></span><span class="token template-string"><span class="token string">``</span></span>js
Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> callback<span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_handleOpenArgs<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this<span class="token punctuation">.</span><span class="token function">_open</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Error can be on same tick re: christkv/mongodb-core#157</span>
        <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>promise<span class="token punctuation">.</span>$hasHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Monkey-patch `.then()` so if the promise is handled, we don&apos;t emit an</span>
  <span class="token comment" spellcheck="true">// `error` event.</span>
  <span class="token keyword">var</span> _then <span class="token operator">=</span> promise<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span>then <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span>$hasHandler <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> _then<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;`open()` is deprecated in mongoose &gt;= 4.11.0, use `openUri()` instead, or set the `useMongoClient` option if using `connect()` or `createConnection()`. See http://mongoosejs.com/docs/connections.html#use-mongo-client&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>

<h2 id="uris-database-options-callback"><a name="uris-database-options-callback" class="anchor-navigation-ex-anchor" href="#uris-database-options-callback"><i class="fa fa-link" aria-hidden="true"></i></a>38.9. (uris, [database], [options], [callback])</h2>
<p>Opens the connection to a replica set.</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_280"><a name="&#x53C2;&#x6570;&#xFF1A;_280" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_280"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<ul>
<li><p><code>uris</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; MongoDB connection string</p>
</li>
<li><p><code>[database]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; database name if not included in uris</p>
</li>
<li><p><code>[options]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; passed to the internal driver</p>
</li>
<li><p><code>[callback]</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank">Function</a>&gt;</p>
</li>
</ul>
<h5 id="&#x53C2;&#x89C1;&#xFF1A;_138"><a name="&#x53C2;&#x89C1;&#xFF1A;_138" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;_138"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x89C1;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x89C1;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x89C1;&#xFF1A;</h5>
<ul>
<li><a href="https://github.com/mongodb/node-mongodb-native" target="_blank">node-mongodb-native</a></li>
<li><a href="http://mongodb.github.com/node-mongodb-native/api-generated/db.html#authenticate" target="_blank">http://mongodb.github.com/node-mongodb-native/api-generated/db.html#authenticate</a></li>
</ul>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_205"><a name="&#x793A;&#x4F8B;&#xFF1A;_205" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_205"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">openSet</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://user:pwd@localhost:27020,localhost:27021,localhost:27012/mydb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The database name and/or auth need only be included in one URI.
The options is a hash which is passed to the internal driver connection object.</p>
<p>Valid options</p>
<pre class="language-">
db      - passed to the connection db instance
server  - passed to the connection server instance(s)
replset - passed to the connection ReplSetServer instance
user    - username for authentication
pass    - password for authentication
auth    - options for authentication (see http://mongodb.github.com/node-mongodb-native/api-generated/db.html#authenticate)
mongos  - Boolean - if true, enables High Availability support for mongos
</pre>

<p><em>Options passed take precedence over options included in connection strings.</em></p>
<h5 id="&#x6CE8;&#x610F;&#xFF1A;_73"><a name="&#x6CE8;&#x610F;&#xFF1A;_73" class="anchor-navigation-ex-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;_73"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x6CE8;&#x610F;&#xFF1A;" class="plugin-anchor" href="#&#x6CE8;&#x610F;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x6CE8;&#x610F;&#xFF1A;</h5>
<p><em>If connecting to multiple mongos servers, set the mongos option to true.</em></p>
<pre class="language-"><code class="lang-js">conn<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://mongosA:27501,mongosB:27501&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> mongos<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Mongoose forces the db option forceServerObjectId false and cannot be overridden.
Mongoose defaults the server auto_reconnect options to true which can be overridden.
See the node-mongodb-native driver instance for options that it understands.</p>
<p><em>Options passed take precedence over options included in connection strings.</em></p>
<sec data-title="&#x6E90;&#x7801;" data-id="15" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="15"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="15"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>openSet <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>uris<span class="token punctuation">,</span> database<span class="token punctuation">,</span> options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Promise <span class="token operator">=</span> PromiseProvider<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_handleOpenSetArgs<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> emitted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise<span class="token punctuation">.</span>ES6</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _this<span class="token punctuation">.</span><span class="token function">_open</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>callback <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>promise<span class="token punctuation">.</span>$hasHandler <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>emitted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          emitted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          _this<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Monkey-patch `.then()` so if the promise is handled, we don&apos;t emit an</span>
  <span class="token comment" spellcheck="true">// `error` event.</span>
  <span class="token keyword">var</span> _then <span class="token operator">=</span> promise<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
  promise<span class="token punctuation">.</span>then <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    promise<span class="token punctuation">.</span>$hasHandler <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> _then<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&apos;`openSet()` is deprecated in mongoose &gt;= 4.11.0, use `openUri()` instead, or set the `useMongoClient` option if using `connect()` or `createConnection()`. See http://mongoosejs.com/docs/connections.html#use-mongo-client&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectioncollections"><a name="connectioncollections" class="anchor-navigation-ex-anchor" href="#connectioncollections"><i class="fa fa-link" aria-hidden="true"></i></a>38.10. Connection#collections</h2>
<p>A hash of the collections associated with this connection</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_collections" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_collections"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_collections"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collections<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectionconfig"><a name="connectionconfig" class="anchor-navigation-ex-anchor" href="#connectionconfig"><i class="fa fa-link" aria-hidden="true"></i></a>38.11. Connection#config</h2>
<p>A hash of the global options that are associated with this connection</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_config" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_config"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_config"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectiondb"><a name="connectiondb" class="anchor-navigation-ex-anchor" href="#connectiondb"><i class="fa fa-link" aria-hidden="true"></i></a>38.12. Connection#db</h2>
<p>The mongodb.Db instance, set when the connection is opened</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_db" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_db"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_db"><div class="panel-body">
<pre class="language-"><code class="lang-js">Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>db<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="connectionreadystate"><a name="connectionreadystate" class="anchor-navigation-ex-anchor" href="#connectionreadystate"><i class="fa fa-link" aria-hidden="true"></i></a>38.13. Connection#readyState</h2>
<p>Connection ready state</p>
<ul>
<li>0 = disconnected</li>
<li>1 = connected</li>
<li>2 = connecting</li>
<li>3 = disconnecting</li>
</ul>
<p>Each state change emits its associated event name.</p>
<h5 id="&#x793A;&#x4F8B;&#xFF1A;_206"><a name="&#x793A;&#x4F8B;&#xFF1A;_206" class="anchor-navigation-ex-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;_206"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x793A;&#x4F8B;&#xFF1A;" class="plugin-anchor" href="#&#x793A;&#x4F8B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x793A;&#x4F8B;&#xFF1A;</h5>
<pre class="language-"><code class="lang-js">conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;connected&apos;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;disconnected&apos;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<sec data-title="&#x6E90;&#x7801;" data-id="Connection_readyState" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Connection_readyState"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Connection_readyState"><div class="panel-body">
<pre class="language-"><code class="lang-js">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>Connection<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&apos;readyState&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_readyState<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>val <span class="token keyword">in</span> STATES<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Invalid connection state: &apos;</span> <span class="token operator">+</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_readyState <span class="token operator">!==</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_readyState <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// loop over the otherDbs on this connection and change their state</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>otherDbs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>otherDbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>readyState <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>STATES<span class="token punctuation">.</span>connected <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_hasOpened <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>STATES<span class="token punctuation">[</span>val<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<hr>
<h1 id="collectionjs"><a name="collectionjs" class="anchor-navigation-ex-anchor" href="#collectionjs"><i class="fa fa-link" aria-hidden="true"></i></a>39. collection.js</h1>
<blockquote>
<p>&#x6E90;&#x7801;&#xFF1A;<a href="https://github.com/Automattic/mongoose/blob/4.13.7/lib/collection.js" target="_blank">collection.js</a></p>
</blockquote>
<h2 id="collectionname-conn-opts"><a name="collectionname-conn-opts" class="anchor-navigation-ex-anchor" href="#collectionname-conn-opts"><i class="fa fa-link" aria-hidden="true"></i></a>39.1. Collection(name, conn, opts)</h2>
<p>Abstract Collection constructor</p>
<h5 id="&#x53C2;&#x6570;&#xFF1A;_281"><a name="&#x53C2;&#x6570;&#xFF1A;_281" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x6570;&#xFF1A;_281"><i class="fa fa-link" aria-hidden="true"></i></a><a name="&#x53C2;&#x6570;&#xFF1A;" class="plugin-anchor" href="#&#x53C2;&#x6570;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>&#x53C2;&#x6570;&#xFF1A;</h5>
<p>  ** <code>name</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String" target="_blank">String</a>&gt; name of the collection</p>
<p>  ** <code>conn</code> <connection> A MongooseConnection instance</connection></p>
<p>  ** <code>opts</code> &lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank">Object</a>&gt; optional collection options</p>
<p>This is the base class that drivers inherit from and implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="16" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="16"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="16"><div class="panel-body">
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">Collection</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> conn<span class="token punctuation">,</span> opts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>capped <span class="token operator">===</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>capped <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  opts<span class="token punctuation">.</span>bufferCommands <span class="token operator">=</span> undefined <span class="token operator">===</span> opts<span class="token punctuation">.</span>bufferCommands
      <span class="token operator">?</span> <span class="token boolean">true</span>
      <span class="token punctuation">:</span> opts<span class="token punctuation">.</span>bufferCommands<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> opts<span class="token punctuation">.</span>capped <span class="token operator">===</span> <span class="token string">&apos;number&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts<span class="token punctuation">.</span>capped <span class="token operator">=</span> <span class="token punctuation">{</span>size<span class="token punctuation">:</span> opts<span class="token punctuation">.</span>capped<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>opts <span class="token operator">=</span> opts<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>collectionName <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>conn <span class="token operator">=</span> conn<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>buffer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opts<span class="token punctuation">.</span>bufferCommands<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>emitter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>STATES<span class="token punctuation">.</span>connected <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>conn<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectioncreateindex"><a name="collectioncreateindex" class="anchor-navigation-ex-anchor" href="#collectioncreateindex"><i class="fa fa-link" aria-hidden="true"></i></a>39.2. Collection#createIndex()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_createIndex" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_createIndex"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_createIndex"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>createIndex <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#ensureIndex unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionensureindex"><a name="collectionensureindex" class="anchor-navigation-ex-anchor" href="#collectionensureindex"><i class="fa fa-link" aria-hidden="true"></i></a>39.3. Collection#ensureIndex()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_ensureIndex" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_ensureIndex"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_ensureIndex"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>ensureIndex <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#ensureIndex unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionfind"><a name="collectionfind" class="anchor-navigation-ex-anchor" href="#collectionfind"><i class="fa fa-link" aria-hidden="true"></i></a>39.4. Collection#find()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_find" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_find"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_find"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>find <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#find unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionfindandmodify"><a name="collectionfindandmodify" class="anchor-navigation-ex-anchor" href="#collectionfindandmodify"><i class="fa fa-link" aria-hidden="true"></i></a>39.5. Collection#findAndModify()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_findAndModify" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_findAndModify"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_findAndModify"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>findAndModify <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#findAndModify unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionfindone"><a name="collectionfindone" class="anchor-navigation-ex-anchor" href="#collectionfindone"><i class="fa fa-link" aria-hidden="true"></i></a>39.6. Collection#findOne()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_findOne" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_findOne"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_findOne"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>findOne <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#findOne unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectiongetindexes"><a name="collectiongetindexes" class="anchor-navigation-ex-anchor" href="#collectiongetindexes"><i class="fa fa-link" aria-hidden="true"></i></a>39.7. Collection#getIndexes()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_getIndexes" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_getIndexes"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_getIndexes"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getIndexes <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#getIndexes unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectioninsert"><a name="collectioninsert" class="anchor-navigation-ex-anchor" href="#collectioninsert"><i class="fa fa-link" aria-hidden="true"></i></a>39.8. Collection#insert()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_insert" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_insert"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_insert"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>insert <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#insert unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionmapreduce"><a name="collectionmapreduce" class="anchor-navigation-ex-anchor" href="#collectionmapreduce"><i class="fa fa-link" aria-hidden="true"></i></a>39.9. Collection#mapReduce()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_mapReduce" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_mapReduce"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_mapReduce"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>mapReduce <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#mapReduce unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionsave"><a name="collectionsave" class="anchor-navigation-ex-anchor" href="#collectionsave"><i class="fa fa-link" aria-hidden="true"></i></a>39.10. Collection#save()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_save" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_save"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_save"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>save <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#save unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionupdate"><a name="collectionupdate" class="anchor-navigation-ex-anchor" href="#collectionupdate"><i class="fa fa-link" aria-hidden="true"></i></a>39.11. Collection#update()</h2>
<p>Abstract method that drivers must implement.</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_update" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_update"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_update"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>update <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;Collection#update unimplemented by driver&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectioncollectionname"><a name="collectioncollectionname" class="anchor-navigation-ex-anchor" href="#collectioncollectionname"><i class="fa fa-link" aria-hidden="true"></i></a>39.12. Collection#collectionName</h2>
<p>The collection name</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_collectionName" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_collectionName"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_collectionName"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>collectionName<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionconn"><a name="collectionconn" class="anchor-navigation-ex-anchor" href="#collectionconn"><i class="fa fa-link" aria-hidden="true"></i></a>39.13. Collection#conn</h2>
<p>The Connection instance</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_conn" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_conn"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_conn"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>conn<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<h2 id="collectionname"><a name="collectionname" class="anchor-navigation-ex-anchor" href="#collectionname"><i class="fa fa-link" aria-hidden="true"></i></a>39.14. Collection#name</h2>
<p>The collection name</p>
<sec data-title="&#x6E90;&#x7801;" data-id="Collection_name" data-show="true" data-collapse="true"><div class="panel panel-default"><div class="panel-heading"><b>&#x6E90;&#x7801;<a class="pull-right section atTitle btn btn-default" target="Collection_name"><span class="fa fa-angle-up"></span></a></b></div><div class="panel-collapse in" id="Collection_name"><div class="panel-body">
<pre class="language-"><code class="lang-js">Collection<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre>
</div></div></div></sec>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; tuzhu008 2017 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2017-12-26 09:08:54
</span></footer></query></promise>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="faq.html" class="navigation navigation-next navigation-unique" aria-label="Next page: 常见问题">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"API","level":"3.13.1.3","depth":3,"next":{"title":"常见问题","level":"3.13.1.4","depth":3,"path":"Library/mongoose/docs/faq.md","ref":"Library/mongoose/docs/faq.md","articles":[]},"previous":{"title":"4.0 release notes","level":"3.13.1.2.18","depth":4,"url":"https://github.com/Automattic/mongoose/wiki/4.0-Release-Notes","ref":"https://github.com/Automattic/mongoose/wiki/4.0-Release-Notes","articles":[]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-small","anchors","anchor-navigation-ex","favicon","copy-code-button","alerts","splitter","book-summary-scroll-position-saver","include-codeblock","ace","prism","prism-themes","-highlight","tbfed-pagefooter","github","sectionx","livereload"],"root":".","styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy tuzhu008 2017","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"ace":{},"github":{"url":"https://github.com/tuzhu008"},"livereload":{},"book-summary-scroll-position-saver":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"night","family":"serif","size":2},"sectionx":{"tag":"b"},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showLevel":true},"favicon":{"shortcut":"assets/images/favicon.ico","bookmark":"assets/images/favicon.ico","appleTouch":"assets/images/apple-touch-icon.png","appleTouchMore":{"120x120":"assets/images/apple-touch-icon-120x120.png","180x180":"assets/images/apple-touch-icon-180x180.png"}},"prism-themes":{},"alerts":{},"expandable-chapters-small":{},"copy-code-button":{},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"acefull","theme":"tomorrow","unindent":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"tuzhu008","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Node.js","language":"zh-hans","gitbook":"*","description":"Node.js 自我学习"},"file":{"path":"Library/mongoose/docs/API.md","mtime":"2017-12-26T01:08:54.530Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-12-25T15:33:00.187Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-alerts/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

