
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>API · Node.js</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="tuzhu008">
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-prism/prism-atom-dark.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-sectionx/sectionx.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../../styles/website.css">
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="API.html" />
    
    
    <link rel="prev" href="../" />
    

    
        <link rel="shortcut icon" href='../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../../assets/images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../../../assets/images/apple-touch-icon.png'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../../../assets/images/apple-touch-icon-120x120.png">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../../../assets/images/apple-touch-icon-180x180.png">
        
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    关于 Node
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../GLOSSARY.html">
            
                <a href="../../../GLOSSARY.html">
            
                    
                    术语
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">参考文档</li>
        
        
    

    
        
        <li class="header">相关库</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Node 相关库列表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../nvm/">
            
                <a href="../../nvm/">
            
                    
                    node 版本管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../request/">
            
                <a href="../../request/">
            
                    
                    request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../async/">
            
                <a href="../../async/">
            
                    
                    async
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../supervisor/">
            
                <a href="../../supervisor/">
            
                    
                    supervisior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../">
            
                <a href="../">
            
                    
                    Express
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.6.1" data-path="API.html">
            
                <a href="API.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1.1" data-path="API.html">
            
                <a href="API.html#express">
            
                    
                    express()
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.2" data-path="API.html">
            
                <a href="API.html#application">
            
                    
                    Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.3" data-path="API.html">
            
                <a href="API.html#request">
            
                    
                    Request
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.4" data-path="API.html">
            
                <a href="API.html#response">
            
                    
                    Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.1.5" data-path="../../../(Library/express/docs/API.md">
            
                <span>
            
                    
                    Router
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="../middleware/">
            
                <a href="../middleware/">
            
                    
                    中间件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.2.1" data-path="../middleware/method-override/">
            
                <a href="../middleware/method-override/">
            
                    
                    method-override
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.2" data-path="../middleware/session/">
            
                <a href="../middleware/session/">
            
                    
                    express-session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.3" data-path="../middleware/connect-mongo/">
            
                <a href="../middleware/connect-mongo/">
            
                    
                    connect-mongo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.4" data-path="../middleware/connect-flash/">
            
                <a href="../middleware/connect-flash/">
            
                    
                    connect-flash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.5" data-path="../middleware/express-formidable/">
            
                <a href="../middleware/express-formidable/">
            
                    
                    express-formidable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2.6" data-path="../middleware/express-winston/">
            
                <a href="../middleware/express-winston/">
            
                    
                    express-winston
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../../connect/">
            
                <a href="../../connect/">
            
                    
                    connect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../../socket.io/">
            
                <a href="../../socket.io/">
            
                    
                    socket.io
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="../../socket.io/docs/">
            
                <a href="../../socket.io/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1.1" data-path="../../socket.io/docs/API.html">
            
                <a href="../../socket.io/docs/API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8.1.2" data-path="../../socket.io/docs/emit.html">
            
                <a href="../../socket.io/docs/emit.html">
            
                    
                    emit
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.8.2" data-path="../../socket.io/library/REAME.html">
            
                <a href="../../socket.io/library/REAME.html">
            
                    
                    相关库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.2.1" data-path="../../socket.io/library/engine.io/">
            
                <a href="../../socket.io/library/engine.io/">
            
                    
                    engine.io
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="../../socket.io-client/">
            
                <a href="../../socket.io-client/">
            
                    
                    socket.io-client
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.9.1" data-path="../../socket.io-client/docs/">
            
                <a href="../../socket.io-client/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.9.1.1" data-path="../../socket.io-client/docs/API.html">
            
                <a href="../../socket.io-client/docs/API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="../../node_redis/">
            
                <a href="../../node_redis/">
            
                    
                    node_redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="../../node-http-proxy/">
            
                <a href="../../node-http-proxy/">
            
                    
                    node-http-proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="../../mysql/">
            
                <a href="../../mysql/">
            
                    
                    mysql
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="../../mongoose/">
            
                <a href="../../mongoose/">
            
                    
                    mongoose
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1" data-path="../../mongoose/docs/">
            
                <a href="../../mongoose/docs/">
            
                    
                    文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.1" data-path="../../mongoose/docs/quick-start.html">
            
                <a href="../../mongoose/docs/quick-start.html">
            
                    
                    快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2" data-path="../../mongoose/docs/guide.html">
            
                <a href="../../mongoose/docs/guide.html">
            
                    
                    指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.1" data-path="../../mongoose/docs/guide.html">
            
                <a href="../../mongoose/docs/guide.html">
            
                    
                    schemas
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.1.1" data-path="../../mongoose/docs/SchemaTypes.html">
            
                <a href="../../mongoose/docs/SchemaTypes.html">
            
                    
                    types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.1.2" data-path="../../mongoose/docs/customschematypes.html">
            
                <a href="../../mongoose/docs/customschematypes.html">
            
                    
                    custom
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.1.3" data-path="../../mongoose/docs/advanced_schemas.html">
            
                <a href="../../mongoose/docs/advanced_schemas.html">
            
                    
                    advanced usage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.2" data-path="../../mongoose/docs/models.html">
            
                <a href="../../mongoose/docs/models.html">
            
                    
                    models
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.3" data-path="../../mongoose/docs/documents.html">
            
                <a href="../../mongoose/docs/documents.html">
            
                    
                    documents
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1.2.3.1" data-path="../../mongoose/docs/subdocs.html">
            
                <a href="../../mongoose/docs/subdocs.html">
            
                    
                    sub docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.3.2" data-path="../../mongoose/docs/defaults.html">
            
                <a href="../../mongoose/docs/defaults.html">
            
                    
                    defaults
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.4" data-path="../../mongoose/docs/queries.html">
            
                <a href="../../mongoose/docs/queries.html">
            
                    
                    queries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.5" data-path="../../mongoose/docs/validation.html">
            
                <a href="../../mongoose/docs/validation.html">
            
                    
                    validation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.6" data-path="../../mongoose/docs/middleware.html">
            
                <a href="../../mongoose/docs/middleware.html">
            
                    
                    middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.7" data-path="../../mongoose/docs/populate.html">
            
                <a href="../../mongoose/docs/populate.html">
            
                    
                    population
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.8" data-path="../../mongoose/docs/connections.html">
            
                <a href="../../mongoose/docs/connections.html">
            
                    
                    connections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.9" data-path="../../mongoose/docs/plugins.html">
            
                <a href="../../mongoose/docs/plugins.html">
            
                    
                    plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.10" data-path="../../mongoose/docs/promises.html">
            
                <a href="../../mongoose/docs/promises.html">
            
                    
                    promises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.11" data-path="../../mongoose/docs/discriminators.html">
            
                <a href="../../mongoose/docs/discriminators.html">
            
                    
                    discriminators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.12" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/blob/master/CONTRIBUTING.md">
            
                    
                    contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.13" data-path="../../mongoose/docs/harmony.html">
            
                <a href="../../mongoose/docs/harmony.html">
            
                    
                    ES2015 integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.14" data-path="../../mongoose/docs/browser.html">
            
                <a href="../../mongoose/docs/browser.html">
            
                    
                    schemas in the browser
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.15" data-path="../../mongoose/docs/compatibility.html">
            
                <a href="../../mongoose/docs/compatibility.html">
            
                    
                    MongoDB Version Compatibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.16" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/3.6-Release-Notes">
            
                    
                    3.6 release notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.17" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/3.8-Release-Notes">
            
                    
                    3.8 release notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.2.18" >
            
                <a target="_blank" href="https://github.com/Automattic/mongoose/wiki/4.0-Release-Notes">
            
                    
                    4.0 release notes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13.1.3" data-path="../../mongoose/docs/API.html">
            
                <a href="../../mongoose/docs/API.html">
            
                    
                    API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.4" data-path="../../mongoose/docs/faq.html">
            
                <a href="../../mongoose/docs/faq.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13.1.5" data-path="../../mongoose/docs/prior.html">
            
                <a href="../../mongoose/docs/prior.html">
            
                    
                    之前的版本
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="../../passport/">
            
                <a href="../../passport/">
            
                    
                    passport
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15" data-path="../../node-formidable/">
            
                <a href="../../node-formidable/">
            
                    
                    node-formidable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.16" data-path="../../pm2/">
            
                <a href="../../pm2/">
            
                    
                    pm2
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-anchor"></i><ul><li><span class="title-icon "></span><a href="#express"><b>1. </b>express() </a></li><ul><li><span class="title-icon "></span><a href="#&#x5185;&#x7F6E;&#x65B9;&#x6CD5;"><b>1.1. </b>&#x5185;&#x7F6E;&#x65B9;&#x6CD5;</a></li><ul><li><span class="title-icon "></span><a href="#expressstaticroot-options"><b>1.1.1. </b>express.static(root, [options])</a></li></ul></ul><li><span class="title-icon "></span><a href="#application"><b>2. </b>Application </a></li><ul><li><span class="title-icon "></span><a href="#&#x5C5E;&#x6027;"><b>2.1. </b>&#x5C5E;&#x6027;</a></li><ul><li><span class="title-icon "></span><a href="#app_locals"><b>2.1.1. </b>app.locals </a></li><li><span class="title-icon "></span><a href="#appmountpath"><b>2.1.2. </b>app.mountpath</a></li></ul><li><span class="title-icon "></span><a href="#&#x4E8B;&#x4EF6;"><b>2.2. </b>&#x4E8B;&#x4EF6;</a></li><ul><li><span class="title-icon "></span><a href="#app_mount-event"><b>2.2.1. </b>app.on(&apos;mount&apos;, callback(parent)) </a></li></ul><li><span class="title-icon "></span><a href="#&#x65B9;&#x6CD5;"><b>2.3. </b>&#x65B9;&#x6CD5;</a></li><ul><li><span class="title-icon "></span><a href="#app_all"><b>2.3.1. </b>app.all(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_delete"><b>2.3.2. </b>app.delete(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_disable"><b>2.3.3. </b>app.disable(name) </a></li><li><span class="title-icon "></span><a href="#app_disabled"><b>2.3.4. </b>app.disabled(name) </a></li><li><span class="title-icon "></span><a href="#app_enable"><b>2.3.5. </b>app.enable(name) </a></li><li><span class="title-icon "></span><a href="#app_enabled"><b>2.3.6. </b>app.enabled(name) </a></li><li><span class="title-icon "></span><a href="#app_engine"><b>2.3.7. </b>app.engine(ext, callback) </a></li><li><span class="title-icon "></span><a href="#app_get"><b>2.3.8. </b>app.get(name) </a></li><li><span class="title-icon "></span><a href="#app_get_req"><b>2.3.9. </b>app.get(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_listen"><b>2.3.10. </b>app.listen(port, [hostname], [backlog], [callback]) </a></li><li><span class="title-icon "></span><a href="#app_METHOD"><b>2.3.11. </b>app.METHOD(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_param"><b>2.3.12. </b>app.param([name], callback) </a></li><li><span class="title-icon "></span><a href="#app_path"><b>2.3.13. </b>app.path() </a></li><li><span class="title-icon "></span><a href="#app_post"><b>2.3.14. </b>app.post(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_put"><b>2.3.15. </b>app.put(path, callback [, callback ...]) </a></li><li><span class="title-icon "></span><a href="#app_render"><b>2.3.16. </b>app.render(view, [locals], callback) </a></li><li><span class="title-icon "></span><a href="#approutepath"><b>2.3.17. </b>app.route(path)</a></li><li><span class="title-icon "></span><a href="#app_set"><b>2.3.18. </b>app.set(name, value) </a></li><li><span class="title-icon "></span><a href="#app_use"><b>2.3.19. </b>app.use([path,] function [, function...]) </a></li></ul></ul><li><span class="title-icon "></span><a href="#request"><b>3. </b>Request </a></li><ul><li><span class="title-icon "></span><a href="#&#x5C5E;&#x6027;_1"><b>3.1. </b>&#x5C5E;&#x6027;</a></li><ul><li><span class="title-icon "></span><a href="#req_app"><b>3.1.1. </b>req.app </a></li><li><span class="title-icon "></span><a href="#req_baseUrl"><b>3.1.2. </b>req.baseUrl </a></li><li><span class="title-icon "></span><a href="#req_body"><b>3.1.3. </b>req.body </a></li><li><span class="title-icon "></span><a href="#req_cookies"><b>3.1.4. </b>req.cookies </a></li><li><span class="title-icon "></span><a href="#req_fresh"><b>3.1.5. </b>req.fresh </a></li><li><span class="title-icon "></span><a href="#req_hostname"><b>3.1.6. </b>req.hostname </a></li><li><span class="title-icon "></span><a href="#req_ip"><b>3.1.7. </b>req.ip </a></li><li><span class="title-icon "></span><a href="#req_ips"><b>3.1.8. </b>req.ips </a></li><li><span class="title-icon "></span><a href="#req_originalUrl"><b>3.1.9. </b>req.originalUrl </a></li><li><span class="title-icon "></span><a href="#req_params"><b>3.1.10. </b>req.params </a></li><li><span class="title-icon "></span><a href="#req_path"><b>3.1.11. </b>req.path </a></li><li><span class="title-icon "></span><a href="#req_protocol"><b>3.1.12. </b>req.protocol </a></li><li><span class="title-icon "></span><a href="#req_query"><b>3.1.13. </b>req.query </a></li><li><span class="title-icon "></span><a href="#req_route"><b>3.1.14. </b>req.route </a></li><li><span class="title-icon "></span><a href="#req_secure"><b>3.1.15. </b>req.secure </a></li><li><span class="title-icon "></span><a href="#req_signedCookies"><b>3.1.16. </b>req.signedCookies </a></li><li><span class="title-icon "></span><a href="#req_stale"><b>3.1.17. </b>req.stale </a></li><li><span class="title-icon "></span><a href="#req_subdomains"><b>3.1.18. </b>req.subdomains </a></li><li><span class="title-icon "></span><a href="#req_xhr"><b>3.1.19. </b>req.xhr </a></li></ul><li><span class="title-icon "></span><a href="#&#x65B9;&#x6CD5;_1"><b>3.2. </b>&#x65B9;&#x6CD5;</a></li><ul><li><span class="title-icon "></span><a href="#req_accepts"><b>3.2.1. </b>req.accepts(types) </a></li><li><span class="title-icon "></span><a href="#req_acceptsCharsets"><b>3.2.2. </b>req.acceptsCharsets(charset [, ...]) </a></li><li><span class="title-icon "></span><a href="#req_acceptsEncodings"><b>3.2.3. </b>req.acceptsEncodings(encoding [, ...]) </a></li><li><span class="title-icon "></span><a href="#req_acceptsLanguages"><b>3.2.4. </b>req.acceptsLanguages(lang [, ...]) </a></li><li><span class="title-icon "></span><a href="#req_get"><b>3.2.5. </b>req.get(field) </a></li><li><span class="title-icon "></span><a href="#req_is"><b>3.2.6. </b>req.is(type) </a></li><li><span class="title-icon "></span><a href="#req_param"><b>3.2.7. </b>req.param(name [, defaultValue]) </a></li></ul></ul><li><span class="title-icon "></span><a href="#response"><b>4. </b>Response  </a></li><ul><li><span class="title-icon "></span><a href="#&#x5C5E;&#x6027;_2"><b>4.1. </b>&#x5C5E;&#x6027;</a></li><ul><li><span class="title-icon "></span><a href="#req_app_1"><b>4.1.1. </b>res.app </a></li><li><span class="title-icon "></span><a href="#res_headersSent"><b>4.1.2. </b>res.headersSent </a></li><li><span class="title-icon "></span><a href="#res_locals"><b>4.1.3. </b>res.locals </a></li></ul><li><span class="title-icon "></span><a href="#&#x65B9;&#x6CD5;_2"><b>4.2. </b>&#x65B9;&#x6CD5;</a></li><ul><li><span class="title-icon "></span><a href="#res_append"><b>4.2.1. </b>res.append(field [, value]) </a></li><li><span class="title-icon "></span><a href="#res_attachment"><b>4.2.2. </b>res.attachment([filename]) </a></li><li><span class="title-icon "></span><a href="#res_cookie"><b>4.2.3. </b>res.cookie(name, value [, options]) </a></li><li><span class="title-icon "></span><a href="#res_clearCookie"><b>4.2.4. </b>res.clearCookie(name [, options]) </a></li><li><span class="title-icon "></span><a href="#res_download"><b>4.2.5. </b>res.download(path [, filename] [, fn]) </a></li><li><span class="title-icon "></span><a href="#res_end"><b>4.2.6. </b>res.end([data] [, encoding]) </a></li><li><span class="title-icon "></span><a href="#res_format"><b>4.2.7. </b>res.format(object) </a></li><li><span class="title-icon "></span><a href="#res_get"><b>4.2.8. </b>res.get(field) </a></li><li><span class="title-icon "></span><a href="#res_json"><b>4.2.9. </b>res.json([body]) </a></li><li><span class="title-icon "></span><a href="#res_jsonp"><b>4.2.10. </b>res.jsonp([body]) </a></li><li><span class="title-icon "></span><a href="#res_links"><b>4.2.11. </b>res.links(links) </a></li><li><span class="title-icon "></span><a href="#res_location"><b>4.2.12. </b>res.location(path) </a></li><li><span class="title-icon "></span><a href="#res_redirect"><b>4.2.13. </b>res.redirect([status,] path) </a></li><li><span class="title-icon "></span><a href="#res_render"><b>4.2.14. </b>res.render(view [, locals] [, callback]) </a></li><li><span class="title-icon "></span><a href="#res_send"><b>4.2.15. </b>res.send([body]) </a></li><li><span class="title-icon "></span><a href="#ressendfilepath--options--fn"><b>4.2.16. </b>res.sendFile(path [, options] [, fn])</a></li><li><span class="title-icon "></span><a href="#res_sendStatus"><b>4.2.17. </b>res.sendStatus(statusCode) </a></li><li><span class="title-icon "></span><a href="#res_set"><b>4.2.18. </b>res.set(field [, value]) </a></li><li><span class="title-icon "></span><a href="#res_status"><b>4.2.19. </b>res.status(code) </a></li><li><span class="title-icon "></span><a href="#res_type"><b>4.2.20. </b>res.type(type) </a></li><li><span class="title-icon "></span><a href="#res_vary"><b>4.2.21. </b>res.vary(field) </a></li></ul></ul><li><span class="title-icon "></span><a href="#router"><b>5. </b>Router </a></li><ul><li><span class="title-icon "></span><a href="#routeroptions"><b>5.1. </b>Router([options])</a></li><li><span class="title-icon "></span><a href="#&#x65B9;&#x6CD5;_3"><b>5.2. </b>&#x65B9;&#x6CD5;</a></li><ul><li><span class="title-icon "></span><a href="#router_all"><b>5.2.1. </b>router.all(path, [callback, ...] callback) </a></li><li><span class="title-icon "></span><a href="#router_METHOD"><b>5.2.2. </b>router.METHOD(path, [callback, ...] callback) </a></li><li><span class="title-icon "></span><a href="#router_param"><b>5.2.3. </b>router.param([name,] callback) </a></li><li><span class="title-icon "></span><a href="#router_route"><b>5.2.4. </b>router.route(path) </a></li><li><span class="title-icon "></span><a href="#router_use"><b>5.2.5. </b>router.use([path], [function, ...] function) </a></li></ul></ul></ul></div><a href="#express" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><p style="font-size=35px;font-weight=700"> Express 4.x API &#x4E2D;&#x6587;&#x624B;&#x518C; </p>

<h1 id="express"><a name="express" class="anchor-navigation-ex-anchor" href="#express"><i class="fa fa-link" aria-hidden="true"></i></a>1. express() </h1>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Express &#x5E94;&#x7528;&#x3002;<code>express()</code> &#x662F;&#x4E00;&#x4E2A;&#x7531; <strong>express</strong> &#x6A21;&#x5757;&#x5BFC;&#x51FA;&#x7684;&#x5165;&#x53E3;&#xFF08;top-level&#xFF09;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x5185;&#x7F6E;&#x65B9;&#x6CD5;"><a name="&#x5185;&#x7F6E;&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x7F6E;&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1. &#x5185;&#x7F6E;&#x65B9;&#x6CD5;</h2>
<h3 id="expressstaticroot-options"><a name="expressstaticroot-options" class="anchor-navigation-ex-anchor" href="#expressstaticroot-options"><i class="fa fa-link" aria-hidden="true"></i></a>1.1.1. express.static(root, [options])</h3>
<p><code>express.static</code> &#x662F; Express &#x5185;&#x7F6E;&#x7684;<strong>&#x552F;&#x4E00;</strong>&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;&#x662F;&#x57FA;&#x4E8E; <a href="https://github.com/expressjs/serve-static" target="_blank">serve-static</a> &#x5F00;&#x53D1;&#x7684;&#xFF0C;&#x8D1F;&#x8D23;&#x6258;&#x7BA1; Express &#x5E94;&#x7528;&#x5185;&#x7684;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x3002;</p>
<ul>
<li><code>root</code> &#x53C2;&#x6570;&#x6307;&#x7684;&#x662F;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x6240;&#x5728;&#x7684;&#x6839;&#x76EE;&#x5F55;&#x3002;</li>
<li><code>options</code> &#x5BF9;&#x8C61;&#x662F;&#x53EF;&#x9009;&#x7684;&#xFF0C;&#x652F;&#x6301;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;&#xFF1A;</li>
</ul>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>&#x7C7B;&#x578B;</th>
<th>&#x9ED8;&#x8BA4;&#x503C;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dotfiles</code></td>
<td>&#x7528;&#x4E8E; serving dotfiles&#x7684;&#x9009;&#x9879;&#x3002;&#x53EF;&#x9009;&#x503C;&#x6709;&#xFF1A;&#x201C;allow&#x201D;&#x3001;&#x201C;deny&#x201D; &#x548C; &#x201C;ignore&#x201D;</td>
<td>String</td>
<td>&quot;ignore&quot;</td>
</tr>
<tr>
<td><code>etag</code></td>
<td>&#x542F;&#x7528;&#x6216;&#x7981;&#x7528; etag &#x751F;&#x6210;</td>
<td>Boolean</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>extensions</code></td>
<td>&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D;&#x56DE;&#x9000;&#x3002;</td>
<td>Boolean</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>index</code></td>
<td>&#x53D1;&#x9001;&#x76EE;&#x5F55;&#x7D22;&#x5F15;&#x6587;&#x4EF6;&#x3002;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code> &#x6765;&#x7981;&#x7528;&#x76EE;&#x5F55;&#x7D22;&#x5F15;</td>
<td>Mixed</td>
<td>&quot;index.html&quot;</td>
</tr>
<tr>
<td><code>lastModified</code></td>
<td>&#x5C06; <code>Last-Modified</code> &#x5934;&#x8BBE;&#x7F6E;&#x4E3A;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x65E5;&#x671F;&#x3002;</td>
<td>Boolean</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>maxAge</code></td>
<td>&#x8BBE;&#x7F6E; Cache-Control &#x5934;&#x7684; max-age &#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x6216;&#x4E00;&#x4E2A; <a href="https://www.npmjs.org/package/ms" target="_blank">ms <code>format</code></a> &#x7684;&#x5B57;&#x7B26;&#x4E32;</td>
<td>Number</td>
<td>0</td>
</tr>
<tr>
<td><code>redirect</code></td>
<td>&#x5F53;&#x8DEF;&#x5F84;&#x540D;&#x662F;&#x4E00;&#x4E2A;&#x76EE;&#x5F55;&#x65F6;&#xFF0C;&#x91CD;&#x5B9A;&#x5411;&#x5230; &#x201C;/&#x201D;&#x3002;</td>
<td>Boolean</td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>setHeaders</code></td>
<td>&#x7528;&#x4E8E;&#x8BBE;&#x7F6E; HTTP &#x5934;&#x6587;&#x4EF6;&#x7684;&#x51FD;&#x6570;&#x3002;</td>
<td>Function</td>
<td>-</td>
</tr>
</tbody>
</table>
<h1 id="application"><a name="application" class="anchor-navigation-ex-anchor" href="#application"><i class="fa fa-link" aria-hidden="true"></i></a>2. Application </h1>
<p><code>app</code> &#x5BF9;&#x8C61;&#x901A;&#x5E38;&#x8868;&#x793A; Express &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x7531; Express &#x6A21;&#x5757;&#x5BFC;&#x51FA;&#x7684;&#x9876;&#x7EA7; <code>express()</code> &#x51FD;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x5B83;:</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;hello world&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>app</code> &#x5BF9;&#x8C61;&#x6709;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#xFF1A;</p>
<ul>
<li>&#x8DEF;&#x7531; HTTP &#x8BF7;&#x6C42;&#xFF1B; &#x67E5;&#x770B;&#x793A;&#x4F8B;&#xFF0C; <a href="#app.METHOD">app.METHOD</a> &#x548C; <a href="#app.param">app.param</a>.</li>
<li>&#x914D;&#x7F6E;&#x4E2D;&#x95F4;&#x4EF6;&#xFF1B;&#x53C2;&#x89C1; <a href="#app.route">app.route</a>.</li>
<li>&#x6E32;&#x67D3; HTML &#x89C6;&#x56FE;&#xFF1B;&#x53C2;&#x89C1; <a href="#app.render">app.render</a>.</li>
<li>&#x6CE8;&#x518C;&#x6A21;&#x677F;&#x5F15;&#x64CE;&#xFF1B;&#x53C2;&#x89C1; <a href="#app.engine">app.engine</a>.</li>
</ul>
<p>&#x5B83;&#x8FD8;&#x5177;&#x6709;&#x5F71;&#x54CD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x884C;&#x4E3A;&#x7684;&#x8BBE;&#x7F6E;(&#x5C5E;&#x6027;)&#xFF1B;&#x8981;&#x83B7;&#x5F97;&#x5F88;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x53C2;&#x89C1; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a>.</p>
<h2 id="&#x5C5E;&#x6027;"><a name="&#x5C5E;&#x6027;" class="anchor-navigation-ex-anchor" href="#&#x5C5E;&#x6027;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x5C5E;&#x6027;</h2>
<h3 id="app_locals"><a name="app_locals" class="anchor-navigation-ex-anchor" href="#app_locals"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1. app.locals </h3>
<p><code>app.locals</code> &#x662F;&#x4E00;&#x4E2A; JavaScript &#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x7684;&#x5C5E;&#x6027;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5185;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>title
<span class="token comment" spellcheck="true">// =&gt; &apos;My App&apos;</span>

app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>email
<span class="token comment" spellcheck="true">// =&gt; &apos;me@myapp.com&apos;</span>
</code></pre>
<p>&#x4E00;&#x65E6;&#x8BBE;&#x7F6E;&#xFF0C;<code>app.locals</code> &#x5C5E;&#x6027;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E2D;&#x90FD;&#x5B58;&#x5728;&#xFF0C;&#x800C; <a href="#res.locals">res.locals</a> &#x5C5E;&#x6027;&#x53EA;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x6709;&#x6548;&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x6E32;&#x67D3;&#x7684;&#x6A21;&#x677F;&#x4E2D;&#x8BBF;&#x95EE; <code>local</code> &#x53D8;&#x91CF;&#x3002;&#x8FD9;&#x5BF9;&#x4E8E;&#x4E3A;&#x6A21;&#x677F;&#x63D0;&#x4F9B;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x4EE5;&#x53CA;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7EA7;&#x7684;&#x6570;&#x636E;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x4F46;&#x662F;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x60A8;<strong>&#x4E0D;&#x80FD;</strong>&#x5728;&#x4E2D;&#x95F4;&#x4EF6;&#x4E2D;&#x8BBF;&#x95EE;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&apos;My App&apos;</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>strftime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;strftime&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token string">&apos;me@myapp.com&apos;</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="appmountpath"><a name="appmountpath" class="anchor-navigation-ex-anchor" href="#appmountpath"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2. app.mountpath</h3>
<p><code>app.mountpath</code> &#x5C5E;&#x6027;&#x662F;&#x6302;&#x8F7D;&#x5B50;&#x5E94;&#x7528;&#x7684;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;(s)&#x3002;</p>
<blockquote>
<p><strong>[info]</strong> &#x5B50;&#x5E94;&#x7528;&#x662F; <code>express</code> &#x7684;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x5230;&#x8DEF;&#x7531;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
</blockquote>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x4E3B; app</span>
<span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x5B50; app</span>

admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /admin</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Admin Homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/admin&apos;</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x6302;&#x8F7D;&#x5B50; app</span>
</code></pre>
<p>&#x5B83;&#x7C7B;&#x4F3C;&#x4E8E; <code>req</code> &#x5BF9;&#x8C61;&#x7684; <a href="#req.baseUrl">baseUrl</a> &#x5C5E;&#x6027;&#xFF0C;&#x9664;&#x4E86; <code>req.baseUrl</code> &#x8FD4;&#x56DE;&#x5339;&#x914D;&#x7684; URL &#x8DEF;&#x5F84;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5339;&#x914D;&#x7684;&#x6A21;&#x5F0F;(s)&#x3002;</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5B50;&#x5E94;&#x7528;&#x88AB;&#x6302;&#x8F7D;&#x5728;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x4E0A;&#xFF0C;<code>app.mountpath</code> &#x8FD4;&#x56DE;&#x6240;&#x6302;&#x8F7D;&#x7684;&#x6A21;&#x5F0F;&#x5217;&#x8868;&#x3002;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6240;&#x793A;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [ &apos;/adm*n&apos;, &apos;/manager&apos; ]</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Admin Homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> secret <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
secret<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span>mountpath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /secr*t</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Admin Secret&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

admin<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/secr*t&apos;</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the &apos;secret&apos; router on &apos;/secr*t&apos;, on the &apos;admin&apos; sub app</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;/adm*n&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/manager&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// load the &apos;admin&apos; router on &apos;/adm*n&apos; and &apos;/manager&apos;, on the parent app</span>
</code></pre>
<h2 id="&#x4E8B;&#x4EF6;"><a name="&#x4E8B;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#&#x4E8B;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x4E8B;&#x4EF6;</h2>
<h3 id="app_mount-event"><a name="app_mount-event" class="anchor-navigation-ex-anchor" href="#app_mount-event"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. app.on(&apos;mount&apos;, callback(parent)) </h3>
<p>&#x5F53;&#x5B50;&#x5E94;&#x7528;&#x88AB;&#x6302;&#x8F7D;&#x5230;&#x7236;&#x5E94;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;<code>mount</code> &#x4E8B;&#x4EF6;&#x5728;&#x5B50;&#x5E94;&#x7528;&#x4E0A;&#x88AB;&#x89E6;&#x53D1;&#x3002;&#x7236;&#x5E94;&#x7528;&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x8BE5;&#x4E8B;&#x4EF6;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> admin <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

admin<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&apos;mount&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Admin Mounted&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x6307;&#x7684;&#x662F;&#x7236;&#x5E94;&#x7528;&#xFF08;app&#xFF09;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

admin<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Admin Homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/admin&apos;</span><span class="token punctuation">,</span> admin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x65B9;&#x6CD5;"><a name="&#x65B9;&#x6CD5;" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x65B9;&#x6CD5;</h2>
<h3 id="app_all"><a name="app_all" class="anchor-navigation-ex-anchor" href="#app_all"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.1. app.all(path, callback [, callback ...]) </h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x76F8;&#x4F3C;&#x4E8E;&#x6807;&#x51C6;&#x7684; <a href="#app.METHOD">app.METHOD()</a> &#x65B9;&#x6CD5;&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x5339;&#x914D;&#x7684;&#x662F;&#x6240;&#x6709;&#x7684; HTTP &#x52A8;&#x8BCD;&#x3002;</p>
<p>&#x5B83;&#x5BF9;&#x4E8E;&#x6620;&#x5C04;&#x7279;&#x5B9A;&#x8DEF;&#x5F84;&#x524D;&#x7F00;&#x6216;&#x4EFB;&#x610F;&#x5339;&#x914D;&#x7684; &#x201C;&#x5168;&#x5C40;&#x201D; &#x903B;&#x8F91;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5C06;&#x4E0B;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x653E;&#x5728;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x8DEF;&#x7531;&#x5B9A;&#x4E49;&#x7684;&#x9876;&#x90E8;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x8981;&#x6C42;&#x4ECE;&#x8BE5;&#x70B9;&#x5F00;&#x59CB;&#x7684;&#x6240;&#x6709;&#x8DEF;&#x7531;&#x90FD;&#x9700;&#x8981;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x81EA;&#x52A8;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x3002;&#x8BB0;&#x4F4F;&#xFF0C;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x4E0D;&#x9700;&#x8981;&#x4F5C;&#x4E3A;&#x7AEF;&#x70B9;: <code>loadUser</code> &#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; <code>next()</code> &#x7EE7;&#x7EED;&#x5339;&#x914D;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6216;&#x76F8;&#x5F53;&#x4E8E;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x767D;&#x540D;&#x5355;&#x4E0A;&#x7684;&#x201C;&#x5168;&#x5C40;&#x201D;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x548C;&#x4E4B;&#x524D;&#x7684;&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x53EA;&#x9650;&#x5236;&#x4E86;&#x4EE5; &#x201C;/api&#x201D; &#x5F00;&#x5934;&#x7684;&#x8DEF;&#x5F84;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;/api/*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_delete"><a name="app_delete" class="anchor-navigation-ex-anchor" href="#app_delete"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.2. app.delete(path, callback [, callback ...]) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8DEF;&#x7531; HTTP DELETE &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x8981;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank">&#x8DEF;&#x7531;&#x6307;&#x5357;</a>&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E0E;&#x4E2D;&#x95F4;&#x4EF6;&#x7C7B;&#x4F3C;&#x7684;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x6765;&#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x8BBE;&#x7F6E;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;DELETE request to homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_disable"><a name="app_disable" class="anchor-navigation-ex-anchor" href="#app_disable"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.3. app.disable(name) </h3>
<p>&#x5C06;&#x5E03;&#x5C14;&#x5C5E;&#x6027; <code>name</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x503C;&#x5C5E;&#x6027;&#x6765;&#x8BF4;&#xFF0C;&#x8C03;&#x7528; <code>app.set(&apos;foo&apos;, false)</code> &#x548C;&#x8C03;&#x7528; <code>app.disable(&apos;foo&apos;)</code> &#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; false</span>
</code></pre>
<h3 id="app_disabled"><a name="app_disabled" class="anchor-navigation-ex-anchor" href="#app_disabled"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.4. app.disabled(name) </h3>
<p>&#x5982;&#x679C;&#x5E03;&#x5C14;&#x503C;&#x5C5E;&#x6027; <code>name</code> &#x73B0;&#x5728;&#x662F;&#x7981;&#x7528;&#x7684; (<code>false</code>)&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>true</code>&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; true</span>

app<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">disabled</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; false</span>
</code></pre>
<h3 id="app_enable"><a name="app_enable" class="anchor-navigation-ex-anchor" href="#app_enable"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.5. app.enable(name) </h3>
<p>&#x5C06;&#x5E03;&#x5C14;&#x5C5E;&#x6027; <code>name</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>true</code>&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5C5E;&#x6027;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x503C;&#x5C5E;&#x6027;&#x6765;&#x8BF4;&#xFF0C;&#x8C03;&#x7528; <code>app.set(&apos;foo&apos;, true)</code> &#x548C;&#x8C03;&#x7528; <code>app.enable(&apos;foo&apos;)</code> &#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; true</span>
</code></pre>
<h3 id="app_enabled"><a name="app_enabled" class="anchor-navigation-ex-anchor" href="#app_enabled"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.6. app.enabled(name) </h3>
<p>&#x5982;&#x679C;&#x5E03;&#x5C14;&#x503C;&#x5C5E;&#x6027; <code>name</code> &#x73B0;&#x5728;&#x662F;&#x542F;&#x7528;&#x7684; (<code>true</code>)&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>true</code>&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">enabled</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; false</span>

app<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">enabled</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; true</span>
</code></pre>
<h3 id="app_engine"><a name="app_engine" class="anchor-navigation-ex-anchor" href="#app_engine"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.7. app.engine(ext, callback) </h3>
<p>&#x5C06;&#x7ED9;&#x5B9A;&#x7684;&#x6A21;&#x677F;&#x5F15;&#x64CE; <code>callback</code> &#x6CE8;&#x518C;&#x4E3A; <code>ext</code>&#x3002;</p>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;Express &#x5C06;&#x57FA;&#x4E8E;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#x540D; <code>require()</code> &#x5F15;&#x64CE;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x8BD5;&#x56FE;&#x6E32;&#x67D3;&#x4E00;&#x4E2A; &#x201C;foo.jade&#x201D; &#x6587;&#x4EF6;&#xFF0C;Express &#x5728;&#x5185;&#x90E8;&#x8C03;&#x7528;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x5728;&#x540E;&#x7EED;&#x8C03;&#x7528;&#x4E2D;&#x7F13;&#x5B58; <code>require()</code> &#x4EE5;&#x63D0;&#x9AD8;&#x6027;&#x80FD;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&apos;jade&apos;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;jade&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__express<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5BF9;&#x4E0D;&#x63D0;&#x4F9B;&#x7684;&#x5F00;&#x7BB1;&#x5373;&#x7528;&#x7684; <code>.__express</code> &#x7684;&#x5F15;&#x64CE;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x8005;&#x5982;&#x679C;&#x60A8;&#x60F3;&#x8981;&#x201C;&#x6620;&#x5C04;&#x201D;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6269;&#x5C55;&#x5230;&#x6A21;&#x677F;&#x5F15;&#x64CE;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5C06; EJS &#x6A21;&#x677F;&#x5F15;&#x64CE;&#x6620;&#x5C04;&#x5230; &#x201C;.html&#x201D; &#x6587;&#x4EF6;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;ejs&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>renderFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;EJS &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A; <code>.renderFile()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x5B83;&#x5177;&#x6709;&#x4E0E; Express &#x6240;&#x671F;&#x671B;&#x7684;&#x76F8;&#x540C;&#x7684;&#x7B7E;&#x540D;&#xFF1A;<code>(path, options, callback)</code>&#xFF0C;&#x4F46;&#x662F;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x5185;&#x90E8;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x522B;&#x540D;&#x4E3A; <code>ejs.__express</code>&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F7F;&#x7528; &#x201C;.ejs&#x201D; &#x6269;&#x5C55;&#x540D;&#xFF0C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x60C5;&#x3002;</p>
<p>&#x4E00;&#x4E9B;&#x6A21;&#x677F;&#x5F15;&#x64CE;&#x4E0D;&#x9075;&#x5FAA;&#x8FD9;&#x4E2A;&#x7EA6;&#x5B9A;&#x3002;<a href="https://github.com/tj/consolidate.js" target="_blank">consolidate.js</a> &#x5E93;&#x5C06; Node &#x6A21;&#x677F;&#x5F15;&#x64CE;&#x6620;&#x5C04;&#x4E3A;&#x9075;&#x5FAA;&#x8FD9;&#x4E2A;&#x7EA6;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x4E0E; Express &#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x5F97;&#x5F88;&#x597D;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> engines <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;consolidate&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&apos;haml&apos;</span><span class="token punctuation">,</span> engines<span class="token punctuation">.</span>haml<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">,</span> engines<span class="token punctuation">.</span>hogan<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_get"><a name="app_get" class="anchor-navigation-ex-anchor" href="#app_get"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.8. app.get(name) </h3>
<p>&#x8FD4;&#x56DE;&#x5E94;&#x7528;&#x8BBE;&#x7F6E; <code>name</code> &#x7684;&#x503C;&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</p>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; undefined</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;My Site&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;My Site&quot;</span>
</code></pre>
<h3 id="app_get_req"><a name="app_get_req" class="anchor-navigation-ex-anchor" href="#app_get_req"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.9. app.get(path, callback [, callback ...]) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8DEF;&#x7531; HTTP GET &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x8981;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank">&#x8DEF;&#x7531;&#x6307;&#x5357;</a>&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E0E;&#x4E2D;&#x95F4;&#x4EF6;&#x7C7B;&#x4F3C;&#x7684;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x6765;&#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x8BBE;&#x7F6E;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;GET request to homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_listen"><a name="app_listen" class="anchor-navigation-ex-anchor" href="#app_listen"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.10. app.listen(port, [hostname], [backlog], [callback]) </h3>
<p>&#x5728;&#x6307;&#x5B9A;&#x7684;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#x4E0A;&#x7ED1;&#x5B9A;&#x548C;&#x76D1;&#x542C;&#x8FDE;&#x63A5;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x548C; Node &#x7684; <a href="http://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback" target="_blank">http.Server.listen()</a> &#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>express()</code> &#x8FD4;&#x56DE;&#x7684; <code>app</code> &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A; JavaScript <code>Function</code>&#xFF0C;&#x88AB;&#x8BBE;&#x8BA1;&#x6765;&#x4F5C;&#x4E3A;&#x56DE;&#x8C03;&#x4F20;&#x9012;&#x7ED9; Node &#x7684; HTTP &#x670D;&#x52A1;&#x5668;&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x4F7F;&#x5F97;&#x63D0;&#x4F9B;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x4EE3;&#x7801;&#x7684; app &#x7684; HTTP &#x548C; HTTPS &#x7248;&#x672C;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#xFF0C;&#x56E0;&#x4E3A; app &#x4E0D;&#x4F1A;&#x4ECE;&#x5B83;&#x4EEC;&#x90A3;&#x7EE7;&#x627F;&#xFF08;&#x5B83;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#xFF09;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> https <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;https&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;http&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>app.listen()</code> &#x65B9;&#x6CD5;&#x662F;&#x4E00;&#x4E2A;&#x4FBF;&#x6377;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A; (&#x4EC5;&#x7528;&#x4E8E; HTTP):</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span>listen <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> server<span class="token punctuation">.</span>listen<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_METHOD"><a name="app_METHOD" class="anchor-navigation-ex-anchor" href="#app_METHOD"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.11. app.METHOD(path, callback [, callback ...]) </h3>
<p>&#x8DEF;&#x7531; HTTP &#x8BF7;&#x6C42;&#xFF0C;METHOD &#x662F;&#x8BF7;&#x6C42;&#x7684; HTTP &#x65B9;&#x6CD5;&#xFF0C;&#x5982; GET&#x3001;PUT&#x3001;POST &#x7B49;&#x7B49;&#xFF0C;&#x4EE5;&#x5C0F;&#x5199;&#x5F62;&#x5F0F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x65B9;&#x6CD5;&#x662F; <code>app.get()</code>&#x3001; <code>app.post()</code>&#x3001;<code>app.put()</code> &#x7B49;&#x7B49;&#x3002;&#x8BF7;&#x53C2;&#x9605;&#x4E0B;&#x9762;&#x7684;&#x5B8C;&#x6574;&#x5217;&#x8868;&#x3002;</p>
<p>&#x8981;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank">&#x8DEF;&#x7531;&#x6307;&#x5357;</a>&#x3002;</p>
<p>Express &#x652F;&#x6301;&#x4E0B;&#x9762;&#x7684;&#x8DEF;&#x7531;&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x5E94; HTTP &#x76F8;&#x540C;&#x540D;&#x5B57;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre class="language-"><code>* checkout
* connect
* copy
* delete
* get
* head
* lock
* merge
* mkactivity
* mkcol
* move
* m-search
* notify
* options
* patch
* post
* propfind
* proppatch
* purge
* put
* report
* search
* subscribe
* trace
* unlock
* unsubscribe
</code></pre><blockquote>
<p><strong>[info]</strong> &#x8981;&#x8DEF;&#x7531;&#x90A3;&#x4E9B;&#x8F6C;&#x6362;&#x4E3A;&#x65E0;&#x6548; JavaScript &#x53D8;&#x91CF;&#x540D;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x62EC;&#x53F7;&#x8868;&#x793A;&#x6CD5;&#x3002; &#x4F8B;&#x5982;,  <code>app[&apos;m-search&apos;](&apos;/&apos;, function ...</code>.</p>
</blockquote>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E0E;&#x4E2D;&#x95F4;&#x4EF6;&#x7C7B;&#x4F3C;&#x7684;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x6765;&#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x8BBE;&#x7F6E;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<blockquote>
<p><strong>[info]</strong>  API &#x6587;&#x6863;&#x53EA;&#x5BF9;&#x6D41;&#x884C;&#x7684; HTTP &#x65B9;&#x6CD5;&#x6709;&#x663E;&#x5F0F;&#x7684;&#x6761;&#x76EE;&#xFF0C;&#x5982; <code>app.get()</code>&#x3001; <code>app.post()</code>&#x3001; <code>app.put()</code> &#x548C; <code>app.delete()</code>&#x3002;&#x7136;&#x800C;&#xFF0C;&#x4E0A;&#x9762;&#x5217;&#x51FA;&#x7684;&#x5176;&#x4ED6;&#x65B9;&#x6CD5;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</p>
</blockquote>
<p>&#x6709;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x8DEF;&#x7531;&#x65B9;&#x6CD5;&#xFF0C;<code>app.all()</code>&#xFF0C;&#x8FD9;&#x5E76;&#x4E0D;&#x6D3E;&#x751F;&#x81EA;&#x4EFB;&#x4F55; HTTP &#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x5728;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x7684;&#x8DEF;&#x5F84;&#x4E0A;&#x88C5;&#x8F7D;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;</p>
<p>&#x5728;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x7528;&#x4E8E; &#x201C;/secret&#x201D; &#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x88AB;&#x6267;&#x884C;&#xFF0C;&#x5B83;&#x4F7F;&#x7528; GET&#x3001;POST&#x3001;PUT&#x3001;DELETE &#x6216;&#x4EFB;&#x4F55;&#x5176;&#x4ED6; HTTP &#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;/secret&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Accessing the secret section ...&apos;</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// pass control to the next handler</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="app_param"><a name="app_param" class="anchor-navigation-ex-anchor" href="#app_param"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.12. app.param([name], callback) </h3>
<p>&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x89E6;&#x53D1;&#x5668;&#x5230;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F;&#x53C2;&#x6570;&#x7684;&#x540D;&#x79F0;&#x6216;&#x53C2;&#x6570;&#x540D;&#x79F0;&#x6570;&#x7EC4;&#xFF0C;<code>callback</code> &#x662F;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002; &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x4F9D;&#x6B21;&#x662F;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#xFF0C;&#x54CD;&#x5E94;&#x5BF9;&#x8C61;&#xFF0C;&#x4E0B;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x548C;&#x53C2;&#x6570;&#x7684;&#x503C;&#x4E5F;&#x662F;&#x8FD9;&#x4E2A;&#x987A;&#x5E8F;&#x3002;<code>function(req, res, next)</code>&#x3002;</p>
<p>&#x5982;&#x679C; <code>name</code> &#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;<code>callback</code> &#x89E6;&#x53D1;&#x5668;&#x5C31;&#x4F1A;&#x6309;&#x7167;&#x58F0;&#x660E;&#x7684;&#x987A;&#x5E8F;&#x4E3A;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x6CE8;&#x518C;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x9664;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x7684;&#x53C2;&#x6570;&#x5916;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5185;&#x8C03;&#x7528; <code>next</code> &#x5C06;&#x8C03;&#x7528;&#x4E0B;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x53C2;&#x6570;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5BF9;&#x4E8E;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8C03;&#x7528; <code>next</code> &#x5C06;&#x8C03;&#x7528;&#x6B63;&#x5728;&#x5904;&#x7406;&#x7684;&#x8DEF;&#x7531;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x5C31;&#x50CF; <code>name</code> &#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5F53; <code>:user</code> &#x5B58;&#x5728;&#x4E8E;&#x8DEF;&#x7531;&#x8DEF;&#x5F84;&#x4E2D;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x6620;&#x5C04;&#x7528;&#x6237;&#x52A0;&#x8F7D;&#x903B;&#x8F91;&#x4EE5;&#x81EA;&#x52A8;&#x5411;&#x8DEF;&#x7531;&#x63D0;&#x4F9B; <code>req.user</code>&#xFF0C;&#x6216;&#x5BF9;&#x53C2;&#x6570;&#x8F93;&#x5165;&#x6267;&#x884C;&#x9A8C;&#x8BC1;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;user&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// &#x5C1D;&#x8BD5;&#x4ECE; User &#x6A21;&#x5757;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x7EC6;&#x8282;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x9644;&#x52A0;&#x5230;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;</span>
  User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;failed to load user&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5728;&#x5B83;&#x4EEC;&#x88AB;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x4E0A;&#x662F;&#x672C;&#x5730;&#x7684;&#x3002;&#x5B83;&#x4EEC;&#x4E0D;&#x4F1A;&#x88AB;&#x6302;&#x8F7D;&#x7684;&#x5E94;&#x7528;&#x6216;&#x8DEF;&#x7531;&#x5668;&#x7EE7;&#x627F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;<code>app</code> &#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x5C06;&#x4EC5;&#x7531; <code>app</code> &#x8DEF;&#x7531;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x89E6;&#x53D1;&#x3002;</p>
<p>&#x6240;&#x6709;&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x5C06;&#x5728;&#x53C2;&#x6570;&#x53D1;&#x751F;&#x7684;&#x4EFB;&#x4F55;&#x8DEF;&#x7531;&#x7684;&#x4EFB;&#x4F55;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E4B;&#x524D;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x8BF7;&#x6C42; - &#x54CD;&#x5E94;&#x5468;&#x671F;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x90FD;&#x4EC5;&#x88AB;&#x8C03;&#x7528;<strong>&#x4E00;&#x6B21;</strong>&#xFF0C;&#x5373;&#x4F7F;&#x53C2;&#x6570;&#x5728;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#x4E2D;&#x5339;&#x914D;&#xFF0C;&#x5982;&#x4EE5;&#x4E0B;&#x793A;&#x4F8B;&#x6240;&#x793A;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;CALLED ONLY ONCE&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;although this matches&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;and this matches too&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>GET /user/42</code> &#x65F6;&#xFF0C;&#x6253;&#x5370;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code>CALLED ONLY ONCE
although this matches
and this matches too
</code></pre><pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;page&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;CALLED ONLY ONCE with&apos;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id/:page&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;although this matches&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id/:page&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;and this matches too&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>GET /user/42/3</code> &#x65F6;&#xFF0C;&#x6253;&#x5370;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code>CALLED ONLY ONCE with 42
CALLED ONLY ONCE with 3
although this matches
and this matches too
</code></pre><blockquote>
<p><strong>[danger]</strong> &#x4EE5;&#x4E0B;&#x90E8;&#x5206;&#x63CF;&#x8FF0;&#x7684; app.param(callback)&#xFF0C;&#x4ECE; v4.11.0 &#x5F00;&#x59CB;&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x3002;</p>
</blockquote>
<p><code>app.param(name, callback)</code> &#x65B9;&#x6CD5;&#x7684;&#x884C;&#x4E3A;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x53EA;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5230; <code>app.param()</code> &#x6765;&#x6539;&#x53D8;&#x3002; &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x662F; <code>app.param(name, callback)</code> &#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x8868;&#x73B0;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0; - &#x5B83;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5E76;&#x4E14;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5E94;&#x8BE5;&#x88AB;&#x6355;&#x83B7;&#x7684; URL &#x53C2;&#x6570;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x53EF;&#x7528;&#x4E8E;&#x8FD4;&#x56DE;&#x4E2D;&#x95F4;&#x4EF6;&#x5B9E;&#x73B0;&#x7684; JavaScript &#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x8BE5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x51B3;&#x5B9A;&#x4E86;&#x6355;&#x83B7; URL &#x53C2;&#x6570;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>app.param(name, callback)</code> &#x7B7E;&#x540D;&#x88AB;&#x4FEE;&#x6539;&#x4E3A; <code>app.param(name, accessId)</code>&#x3002; <code>app.param()</code> &#x73B0;&#x5728;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x548C;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#x548C;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#xFF0C;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// customizing the behavior of app.param()</span>
app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// using the customized app.param()</span>
app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// route to trigger the capture</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;OK&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Ready&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;<code>app.param(name, callback)</code> &#x7B7E;&#x540D;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#xFF0C;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x68C0;&#x67E5;&#x51FD;&#x6570;&#x6765;&#x9A8C;&#x8BC1;&#x7528;&#x6237; id &#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E2D;&#x95F4;&#x4EF6;&#x56DE;&#x8C03;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validator</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFinite</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p><strong>[success]</strong></p>
<p>&#x5728;&#x4F60;&#x7684;&#x6355;&#x83B7;&#x6B63;&#x5219;&#x79CD;&#xFF0C;&#x2018;.&#x2019; &#x5B57;&#x7B26;&#x4E0D;&#x80FD;&#x88AB;&#x7528;&#x6765;&#x6355;&#x83B7;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4F60;&#x4E0D;&#x80FD;&#x4F7F;&#x7528; &apos;/user-.+/&apos; &#x6765;&#x6355;&#x83B7; &apos;users-gami&apos;&#xFF0C;&#x4F7F;&#x7528; [\s\S] &#x6216; [\w\W] &#x4EE3;&#x66FF; (&apos;/user-[\s\S]+/&apos;&#xFF09;.</p>
<p>Examples:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">//&#x6355;&#x83B7; &apos;1-a_6&apos; &#x4F46;&#x4E0D;&#x6355;&#x83B7; &apos;543-azser-sder&apos;</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/[0-9]+-[[\\w]]*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//&#x6355;&#x83B7; &apos;1-a_6&apos; &#x548C; &apos;543-az(ser&quot;-sder&apos; but not &apos;5-a s&apos;</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/[0-9]+-[[\\S]]*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//&#x6355;&#x83B7;&#x6240;&#x6709; (equivalent to &apos;.*&apos;)</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;[[\\s\\S]]*&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</blockquote>
<h3 id="app_path"><a name="app_path" class="anchor-navigation-ex-anchor" href="#app_path"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.13. app.path() </h3>
<p>&#x8FD4;&#x56DE;&#x5E94;&#x7528;&#x7684;&#x89C4;&#x8303;&#x8DEF;&#x5F84;&#xFF0C;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> blog <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> blogAdmin <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/blog&apos;</span><span class="token punctuation">,</span> blog<span class="token punctuation">)</span><span class="token punctuation">;</span>
blog<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/admin&apos;</span><span class="token punctuation">,</span> blogAdmin<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;&apos;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blog<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;/blog&apos;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blogAdmin<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;/blog/admin&apos;</span>
</code></pre>
<p>&#x5728;&#x590D;&#x6742;&#x7684;&#x6302;&#x8F7D;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x884C;&#x4E3A;&#x4F1A;&#x53D8;&#x5F97;&#x975E;&#x5E38;&#x590D;&#x6742;:&#x4F7F;&#x7528; <a href="#req.baseUrl">req.baseUrl</a> &#x6765;&#x83B7;&#x5F97;&#x5E94;&#x7528;&#x7684;&#x89C4;&#x8303;&#x8DEF;&#x5F84;&#x901A;&#x5E38;&#x4F1A;&#x66F4;&#x597D;&#x3002;</p>
<h3 id="app_post"><a name="app_post" class="anchor-navigation-ex-anchor" href="#app_post"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.14. app.post(path, callback [, callback ...]) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6765;&#x8DEF;&#x7531; HTTP POST &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x3002;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8DEF;&#x7531; HTTP DELETE &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x8981;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank">&#x8DEF;&#x7531;&#x6307;&#x5357;</a>&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E0E;&#x4E2D;&#x95F4;&#x4EF6;&#x7C7B;&#x4F3C;&#x7684;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x6765;&#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x8BBE;&#x7F6E;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;POST request to homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_put"><a name="app_put" class="anchor-navigation-ex-anchor" href="#app_put"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.15. app.put(path, callback [, callback ...]) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x6765;&#x8DEF;&#x7531; HTTP PUT &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x3002;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x8DEF;&#x7531; HTTP DELETE &#x8BF7;&#x6C42;&#x5230;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x5F84;&#x3002;&#x8981;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1;<a href="http://www.expressjs.com.cn/guide/routing.html" target="_blank">&#x8DEF;&#x7531;&#x6307;&#x5357;</a>&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x4E0E;&#x4E2D;&#x95F4;&#x4EF6;&#x7C7B;&#x4F3C;&#x7684;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x6765;&#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BE5;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x8BBE;&#x7F6E;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;PUT request to homepage&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="app_render"><a name="app_render" class="anchor-navigation-ex-anchor" href="#app_render"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.16. app.render(view, [locals], callback) </h3>
<p>&#x901A;&#x8FC7; <code>callback</code> &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x89C6;&#x56FE;&#x7684;&#x5DF2;&#x6E32;&#x67D3;&#x7684;HTML&#x3002;&#x5B83;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x53C2;&#x6570;&#xFF0C;&#x8BE5;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x8BE5;&#x89C6;&#x56FE;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x300E;&#x5BF9;&#x8C61;&#x300F;&#x3002;&#x5B83;&#x5C31;&#x50CF; <a href="#res.render">res.render()</a>&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x4E0D;&#x80FD;&#x81EA;&#x5DF1;&#x628A;&#x6E32;&#x67D3;&#x7684;&#x89C6;&#x56FE;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
<blockquote>
<p><strong>[info]</strong> &#x53EF;&#x4EE5;&#x5C06; <code>app.render()</code> &#x770B;&#x4F5C;&#x662F;&#x7528;&#x6765;&#x751F;&#x6210;&#x5DF2;&#x6E32;&#x67D3;&#x89C6;&#x56FE;&#x5B57;&#x7B26;&#x4E32;&#x7684;&#x5DE5;&#x5177;&#x51FD;&#x6570;&#x3002;<code>res.render()</code> &#x5728;&#x5185;&#x90E8;&#x4F7F;&#x7528; <code>app.render()</code> &#x6765;&#x6E32;&#x67D3;&#x89C6;&#x56FE;&#x3002;</p>
</blockquote>
<p>-</p>
<blockquote>
<p><strong>[info]</strong> &#x672C;&#x5730;&#x53D8;&#x91CF; <code>cache</code> &#x7528;&#x4E8E;&#x542F;&#x7528;&#x89C6;&#x56FE;&#x7F13;&#x5B58;&#x3002;&#x5982;&#x679C;&#x60A8;&#x5E0C;&#x671B;&#x5728;&#x5F00;&#x53D1;&#x671F;&#x95F4;&#x7F13;&#x5B58;&#x89C6;&#x56FE;&#xFF0C;&#x5219;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code>;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#x542F;&#x7528;&#x4E86;&#x89C6;&#x56FE;&#x7F13;&#x5B58;&#x3002;</p>
</blockquote>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;email&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;email&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="approutepath"><a name="approutepath" class="anchor-navigation-ex-anchor" href="#approutepath"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.17. app.route(path)</h3>
<p>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x8DEF;&#x7531;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5904;&#x7406;&#x5E26;&#x6709;&#x53EF;&#x9009;&#x4E2D;&#x95F4;&#x4EF6;&#x7684; HTTP &#x52A8;&#x8BCD;&#x3002;&#x4F7F;&#x7528; <code>app.route()</code> &#x6765;&#x907F;&#x514D;&#x91CD;&#x590D;&#x7684;&#x8DEF;&#x7531;&#x540D;&#x79F0;(&#x4EE5;&#x53CA;&#x62FC;&#x5199;&#x9519;&#x8BEF;)&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&apos;/events&apos;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// runs for all HTTP verbs first</span>
    <span class="token comment" spellcheck="true">// think of it as route specific middleware!</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// maybe add a new event...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="app_set"><a name="app_set" class="anchor-navigation-ex-anchor" href="#app_set"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.18. app.set(name, value) </h3>
<p>&#x5C06; <code>name</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>value</code>&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F;&#x6765;&#x81EA; <a href="#app_settings-table">app &#x8BBE;&#x7F6E;&#x8868;</a> &#x7684;&#x5C5E;&#x6027;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;</p>
<p>Calling <code>app.set(&apos;foo&apos;, true)</code> for a Boolean property is the same as calling <code>app.enable(&apos;foo&apos;)</code>. Similarly, calling <code>app.set(&apos;foo&apos;, false)</code> for a Boolean property is the same as calling <code>app.disable(&apos;foo&apos;)</code>.</p>
<p>Retrieve the value of a setting with <code>app.get()</code>.</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;My Site&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;title&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &quot;My Site&quot;</span>
</code></pre>
<h4 id="app_settings-table"><a name="app_settings-table" class="anchor-navigation-ex-anchor" href="#app_settings-table"><i class="fa fa-link" aria-hidden="true"></i></a><a name="app_settings-table" class="plugin-anchor" href="#app_settings-table"><i class="fa fa-link" aria-hidden="true"></i></a>&#x5E94;&#x7528;&#x8BBE;&#x7F6E; </h4>
<p>&#x5982;&#x679C; <code>name</code> &#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8BBE;&#x7F6E;&#x4E4B;&#x4E00;&#xFF0C;&#x5219;&#x4F1A;&#x5F71;&#x54CD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x4E0B;&#x8868;&#x5217;&#x51FA;&#x4E86;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;</th>
<th>&#x7C7B;&#x578B;</th>
<th>&#x53D6;&#x503C;</th>
<th>&#x9ED8;&#x8BA4;&#x503C;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>case sensitive routing</code></td>
<td>Boolean</td>
<td>&#x542F;&#x7528;&#x5927;&#x5C0F;&#x5199;&#x533A;&#x5206;</td>
<td><code>false</code>&#xFF0C;&#x8868;&#x793A;&#x7981;&#x7528;&#x3002;&quot;/Foo&quot; &#x7B49;&#x540C;&#x4E8E; &quot;/foo&quot;&#x3002;</td>
</tr>
<tr>
<td><code>env</code></td>
<td>String</td>
<td>&#x73AF;&#x5883;&#x6A21;&#x5F0F;</td>
<td><code>process.env.NODE_ENV</code> (<code>NODE_ENV</code> &#x73AF;&#x5883;&#x53D8;&#x9EC4;) &#x6216;&#x8005; &#x201C;development&#x201D;.</td>
</tr>
<tr>
<td><code>etag</code></td>
<td>Varied</td>
<td>&#x8BBE;&#x7F6E; ETag &#x54CD;&#x5E94;&#x5934;&#x3002;&#x53EF;&#x80FD;&#x7684;&#x503C;&#x8BF7;&#x53C2;&#x89C1; <code>etag</code> <a href="#etag-options">options table</a>.<a href="http://en.wikipedia.org/wiki/HTTP_ETag" target="_blank">&#x66F4;&#x591A;&#x5173;&#x4E8E; HTTP ETag &#x5934;&#x7684;&#x4FE1;&#x606F;</a>.</td>
<td></td>
</tr>
<tr>
<td><code>jsonp callback name</code></td>
<td>String</td>
<td>&#x6307;&#x5B9A;&#x9ED8;&#x8BA4;&#x7684; JSONP &#x56DE;&#x8C03;&#x540D;&#x79F0;&#x3002;</td>
<td><code>?callback=</code></td>
</tr>
<tr>
<td><code>json replacer</code></td>
<td>String</td>
<td>JSON replacer callback.</td>
<td><code>null</code></td>
</tr>
<tr>
<td><code>json spaces</code></td>
<td>Number</td>
<td>&#x5F53;&#x88AB;&#x8BBE;&#x7F6E;&#x65F6;&#xFF0C;&#x53D1;&#x9001;&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x7A7A;&#x683C;&#x7F29;&#x8FDB;&#x7F8E;&#x5316;&#x7684;&#x5B57;&#x7B26;&#x4E32;</td>
<td>&#x7981;&#x7528;</td>
</tr>
<tr>
<td><code>query parser</code></td>
<td>String</td>
<td>&#x4F7F;&#x7528;&#x7684;&#x67E5;&#x8BE2;&#x89E3;&#x6790;&#x5668;&#xFF0C;&#x201C;simple&#x201D; or &#x201C;extended&#x201D;&#x3002;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x8BE2;&#x89E3;&#x6790;&#x5668;&#x57FA;&#x4E8E; Node &#x539F;&#x751F;&#x7684;&#x67E5;&#x8BE2;&#x89E3;&#x6790;&#x5668;&#xFF0C;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x3002;&#x6269;&#x5C55;&#x7684;&#x5DEE;&#x5E8F;&#x89E3;&#x6790;&#x5668;&#x57FA;&#x4E8E; <a href="https://github.com/ljharb/qs" target="_blank">qs</a></td>
<td>&quot;extended&quot;</td>
</tr>
<tr>
<td><code>strict routing</code></td>
<td>Boolean</td>
<td>&#x542F;&#x7528;&#x4E25;&#x683C;&#x7684;&#x8DEF;&#x7531;&#x3002;</td>
<td><code>false</code>&#xFF0C;&#x7981;&#x7528;&#x3002;&quot;/foo&quot; &#x548C; &quot;/foo/&quot; &#x662F;&#x7B49;&#x4EF7;&#x7684;&#x3002;</td>
</tr>
<tr>
<td><code>subdomain offset</code></td>
<td>Number</td>
<td>&#x4E3B;&#x673A;&#x7684;&#x70B9;&#x5206;&#x9694;&#x7684;&#x6570;&#x5B57;&#x90E8;&#x5206;&#xFF0C;&#x7528;&#x6765;&#x5220;&#x9664;&#x8BBF;&#x95EE;&#x5B50;&#x57DF;&#x3002;</td>
<td>2</td>
</tr>
<tr>
<td><code>trust proxy</code></td>
<td>Varied</td>
<td>&#x8868;&#x793A; app &#x4F4D;&#x4E8E;&#x524D;&#x7F6E;&#x4EE3;&#x7406;(proxy)&#x4E4B;&#x540E;&#xFF0C;&#x5E76;&#x4F7F;&#x7528; <code>X-Forwarded-*</code> &#x5934;&#x6765;&#x786E;&#x5B9A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x548C; IP &#x5730;&#x5740;&#x3002; &#x6CE8;&#x610F;&#xFF1A;<code>X-Forwarded-*</code> &#x5934;&#x5BB9;&#x6613;&#x88AB;&#x6B3A;&#x9A97;&#xFF0C;&#x68C0;&#x6D4B;&#x5230;&#x7684; IP &#x5730;&#x5740;&#x4E0D;&#x53EF;&#x9760;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>trust proxy</code> &#x88AB;&#x7981;&#x7528;&#x3002; &#x542F;&#x7528;&#x540E;&#xFF0C;Express &#x4F1A;&#x5C1D;&#x8BD5;&#x901A;&#x8FC7;&#x524D;&#x7F6E;&#x4EE3;&#x7406;&#x6216;&#x4E00;&#x7CFB;&#x5217;&#x4EE3;&#x7406;&#x6765;&#x786E;&#x5B9A;&#x8FDE;&#x63A5;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x7684; IP &#x5730;&#x5740;&#x3002; &#x7136;&#x540E;&#xFF0C;<code>req.ips</code> &#x5C5E;&#x6027;&#x5305;&#x542B;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x7684; IP &#x5730;&#x5740;&#x6570;&#x7EC4;&#x3002;&#x8981;&#x542F;&#x7528;&#x5B83;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528; <code>trust proxy</code> <a href="#trust_proxy-options-table">&#x9009;&#x9879;&#x5217;&#x8868;</a>&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x503C;&#x3002;<code>trust proxy</code>&#x8BBE;&#x7F6E;&#x662F;&#x901A;&#x8FC7; <a href="https://www.npmjs.org/package/proxy-addr" target="_blank">proxy-addr</a> &#x5305;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#x3002; &#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x5176;&#x6587;&#x6863;&#x3002;</td>
<td>Disabled.</td>
</tr>
<tr>
<td><code>views</code></td>
<td>String &#x6216; Array</td>
<td>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x89C6;&#x56FE;&#x7684;&#x76EE;&#x5F55;&#x6216;&#x76EE;&#x5F55;&#x6570;&#x7EC4;&#x3002;&#x5982;&#x679C;&#x4E3A;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x89C6;&#x56FE;&#x4F1A;&#x6309;&#x7167;&#x6570;&#x7EC4;&#x4E2D;&#x51FA;&#x73B0;&#x7684;&#x987A;&#x5E8F;&#x67E5;&#x627E;&#x3002;</td>
<td><code>process.cwd() + &apos;/views&apos;</code></td>
</tr>
<tr>
<td><code>view cache</code></td>
<td>Boolean</td>
<td>&#x542F;&#x7528;&#x89C6;&#x56FE;&#x6A21;&#x677F;&#x7F16;&#x8BD1;&#x7F13;&#x5B58;</td>
<td>&#x751F;&#x4EA7;&#x4E2D;&#x4E3A; <code>true</code></td>
</tr>
<tr>
<td><code>view engine</code></td>
<td>String</td>
<td>&#x5F53;&#x7701;&#x7565;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x9ED8;&#x8BA4;&#x5F15;&#x64CE;&#x6269;&#x5C55;&#x540D;&#x3002;</td>
<td>-</td>
</tr>
<tr>
<td><code>x-powered-by</code></td>
<td>Boolean</td>
<td>&#x542F;&#x7528; &quot;X-Powered-By: Express&quot; HTTP &#x5934;</td>
<td><code>true</code></td>
</tr>
</tbody>
</table>
<h4 id="trust_proxy-options-table"><a name="trust_proxy-options-table" class="anchor-navigation-ex-anchor" href="#trust_proxy-options-table"><i class="fa fa-link" aria-hidden="true"></i></a><a name="trust_proxy-options-table" class="plugin-anchor" href="#trust_proxy-options-table"><i class="fa fa-link" aria-hidden="true"></i></a><code>trust proxy</code> &#x8BBE;&#x7F6E; </h4>
<ul>
<li><p>Boolean</p>
<ul>
<li>&#x5982;&#x679C;&#x4E3A; <code>true</code>&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684; IP &#x5730;&#x5740;&#x88AB;&#x7406;&#x89E3;&#x4E3A; <code>X-Forwarded-*</code> &#x5934;&#x4E2D;&#x6700;&#x5DE6;&#x8FB9;&#x7684;&#x6761;&#x76EE;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4E3A; <code>false</code>&#xFF0C;&#x8BE5;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x88AB;&#x7406;&#x89E3;&#x4E3A;&#x76F4;&#x63A5;&#x9762;&#x5411;&#x4E92;&#x8054;&#x7F51;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684; IP &#x5730;&#x5740;&#x662F;&#x4ECE; <code>req.connection.remoteAddress</code> &#x6D3E;&#x751F;&#x7684;&#x3002;&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x3002;</li>
</ul>
</li>
<li><p>IP &#x5730;&#x5740;</p>
<p>&#x4E00;&#x4E2A;IP&#x5730;&#x5740;&#xFF0C;&#x5B50;&#x7F51;&#x6216;IP &#x5730;&#x5740;&#x6570;&#x7EC4;&#x4EE5;&#x53CA;&#x8981;&#x4FE1;&#x4EFB;&#x7684;&#x5B50;&#x7F51;&#x3002; &#x4EE5;&#x4E0B;&#x662F;&#x9884;&#x914D;&#x7F6E;&#x7684;&#x5B50;&#x7F51;&#x540D;&#x79F0;&#x5217;&#x8868;&#x3002;</p>
<ul>
<li>loopback - <code>127.0.0.1/8</code>, <code>::1/128</code></li>
<li>linklocal - <code>169.254.0.0/16</code>, <code>fe80::/10</code></li>
<li>uniquelocal - <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>, <code>fc00::/7</code></li>
</ul>
<p>&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x4EFB;&#x4F55;&#x65B9;&#x5F0F;&#x8BBE;&#x7F6E; IP &#x5730;&#x5740;&#xFF1A;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;loopback&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;&#x5B50;&#x7F51;</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;loopback, 123.123.123.123&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5B50;&#x7F51;&#x548C;&#x4E00;&#x4E2A;&#x5730;&#x5740;</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;loopback, linklocal, uniquelocal&apos;</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x5B50;&#x7F51;&#x4E3A; CSV</span>
app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;loopback&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;linklocal&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;uniquelocal&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// &#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x5B50;&#x7F51;&#x4F5C;&#x4E3A;&#x6570;&#x7EC4;</span>
</code></pre>
<p>&#x5F53;&#x88AB;&#x6307;&#x5B9A;&#x65F6;&#xFF0C;&#x5C06;&#x4ECE;&#x5730;&#x5740;&#x786E;&#x5B9A;&#x8FC7;&#x7A0B;&#x4E2D;&#x6392;&#x9664; IP &#x5730;&#x5740;&#x6216;&#x5B50;&#x7F51;&#xFF0C;&#x5E76;&#x5C06;&#x79BB;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x670D;&#x52A1;&#x5668;&#x6700;&#x8FD1;&#x7684;&#x4E0D;&#x53EF;&#x4FE1; IP &#x5730;&#x5740;&#x786E;&#x5B9A;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x7684; IP &#x5730;&#x5740;&#x3002;</p>
</li>
<li><p>Number</p>
<p>&#x4FE1;&#x4EFB;&#x6765;&#x81EA;&#x524D;&#x7F6E;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;&#x7B2C; n &#x4E2A;&#x8DF3;&#x8F6C;&#x4F5C;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</p>
</li>
<li><p>Function</p>
<p>&#x81EA;&#x5B9A;&#x4E49;&#x4FE1;&#x4EFB;&#x5B9E;&#x73B0;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x4F60;&#x77E5;&#x9053;&#x4F60;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x65F6;&#x624D;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;trust proxy&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ip <span class="token operator">===</span> <span class="token string">&apos;127.0.0.1&apos;</span> <span class="token operator">||</span> ip <span class="token operator">===</span> <span class="token string">&apos;123.123.123.123&apos;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// trusted IPs</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<h4 id="etag-options"><a name="etag-options" class="anchor-navigation-ex-anchor" href="#etag-options"><i class="fa fa-link" aria-hidden="true"></i></a><a name="etag-options" class="plugin-anchor" href="#etag-options"><i class="fa fa-link" aria-hidden="true"></i></a><code>etag</code> &#x8BBE;&#x7F6E;&#x7684;&#x9009;&#x9879; </h4>
<ul>
<li>Boolean<ul>
<li><code>true</code> &#x542F;&#x7528;&#x5F31; ETag&#x3002;&#x8FD9;&#x662F;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x3002;</li>
<li><code>false</code> &#x5B8C;&#x5168;&#x7981;&#x7528; ETag&#x3002;</li>
</ul>
</li>
<li><p>String</p>
<p>&#x5982;&#x679C;&#x4E3A; &quot;strong&quot;&#xFF0C;&#x542F;&#x7528;&#x5F3A; ETag&#x3002;&#x5982;&#x679C;&#x4E3A; &quot;weak&quot;&#xFF0C;&#x5219;&#x542F;&#x7528;&#x5F31; ETag&#x3002;</p>
</li>
<li><p>Function</p>
<p>&#x81EA;&#x5B9A;&#x4E49; ETag &#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x4F60;&#x77E5;&#x9053;&#x4F60;&#x5728;&#x505A;&#x4EC0;&#x4E48;&#x65F6;&#x624D;&#x4F7F;&#x7528;&#x5B83;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;etag&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">generateHash</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// consider the function is defined</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<h3 id="app_use"><a name="app_use" class="anchor-navigation-ex-anchor" href="#app_use"><i class="fa fa-link" aria-hidden="true"></i></a>2.3.19. app.use([path,] function [, function...]) </h3>
<p>&#x5728; <code>path</code> &#x4E0A;&#x6302;&#x8F7D; <a href="http://www.expressjs.com.cn/guide/using-middleware.html" target="_blank">middleware</a> <code>function(s)</code>
&#x3002;&#x5982;&#x679C; <code>path</code> &#x672A;&#x88AB;&#x6307;&#x5B9A;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; &#x201C;/&#x201D;&#x3002;</p>
<blockquote>
<p><strong>[info]</strong> &#x8DEF;&#x7531;&#x5C06;&#x4E0E;&#x4EFB;&#x4F55;&#x8DEF;&#x5F84;&#x5339;&#x914D;&#xFF0C;&#x8FD9;&#x6761;&#x8DEF;&#x5F84;&#x5C06;&#x7ACB;&#x5373;&#x8DDF;&#x968F;&#x4E00;&#x4E2A; &#x201C;/&#x201D; &#x3002;&#x4F8B;&#x5982;: <code>app.use(&apos;/apple&apos;, ...)</code> &#x5C06;&#x5339;&#x914D; &#x201C;/apple&#x201D;, &#x201C;/apple/images&#x201D;, &#x201C;/apple/images/news&#x201D;, &#x7B49;&#x7B49;.</p>
</blockquote>
<p>-</p>
<blockquote>
<p><strong>[info]</strong></p>
<p>&#x4E2D;&#x95F4;&#x4EF6;&#x79CD;&#x7684; <code>req.originalUrl</code> &#x662F; <code>req.baseUrl</code> &#x548C; <code>req.path</code> &#x7684;&#x7ED3;&#x5408;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6240;&#x793A;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/admin&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// GET &apos;http://www.example.com/admin/new&apos;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>originalUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;/admin/new&apos;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;/admin&apos;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;/new&apos;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</blockquote>
<p>&#x5728; <code>path</code> &#x4E0A;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x5C06;&#x4F1A;&#x5BFC;&#x81F4;&#x5728;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x7684;&#x57FA;&#x7840;&#x4E0E; <code>path</code> &#x5339;&#x914D;&#x65F6;&#x6267;&#x884C;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x7531;&#x4E8E; <code>path</code> &#x9ED8;&#x8BA4;&#x4E3A; &#x201C;/&#x201D;&#xFF0C;&#x6CA1;&#x6709;&#x8DEF;&#x5F84;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x5C06;&#x4F1A;&#x5728;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x4E2D;&#x6267;&#x884C;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x8BE5;&#x4E2D;&#x95F4;&#x4EF6;&#x5C06;&#x9488;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x3002;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Time: %d&apos;</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x662F;&#x6309;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x56E0;&#x6B64;<strong>&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x987A;&#x5E8F;&#x662F;&#x5F88;&#x91CD;&#x8981;&#x7684;</strong>&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x4E0D;&#x5141;&#x8BB8;&#x8BF7;&#x6C42;&#x8D85;&#x51FA;&#x5B83;&#x7684;&#x8981;&#x6C42;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// &#x8BF7;&#x6C42;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x5230;&#x8FBE;&#x8FD9;&#x6761;&#x8DEF;&#x7EBF;</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Welcome&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><code>path</code> &#x53EF;&#x4EE5;&#x662F;&#x8868;&#x793A;&#x8DEF;&#x5F84;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x3001;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x3001;&#x5339;&#x914D;&#x8DEF;&#x5F84;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x6216;&#x5176;&#x7EC4;&#x5408;&#x7684;&#x6570;&#x7EC4;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x662F;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x3002;</p>
<ul>
<li><p>&#x8DEF;&#x5F84;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x5C06;&#x5339;&#x914D;&#x4EE5; /abcd &#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/abcd&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><p>&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x5C06;&#x5339;&#x914D;&#x4EE5; /abcd &#x548C; /abd &#x5F00;&#x5934;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/abc?d&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// &#x5339;&#x914D;&#x4EE5; /abcd&#xFF0C;/abbcd&#xFF0C;/abbbbbcd &#x7B49;&#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/ab+cd&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// &#x5339;&#x914D;&#x4EE5; /abcd, /abxcd, /abFOOcd, /abbArcd &#x7B49;&#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/ab\*cd&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// &#x5339;&#x914D;&#x4EE5; /ad &#x548C; /abcd &#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/a(bc)?d&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><p>&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x5339;&#x914D;&#x4EE5;  /abc &#x548C; /xyz &#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token regex">/\/abc|\/xyz/</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
<li><p>Array</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x5339;&#x914D;&#x4EE5; /abcd, /xyza, /lmn, &#x548C; /pqr &#x5F00;&#x59CB;&#x7684;&#x8DEF;&#x5F84;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;/abcd&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/xyza&apos;</span><span class="token punctuation">,</span> <span class="token operator">/</span>\<span class="token operator">/</span>lmn<span class="token operator">|</span>\<span class="token operator">/</span>pqr<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
</li>
</ul>
<p><code>function</code> &#x53EF;&#x4EE5;&#x662F;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x3001;&#x4E00;&#x7CFB;&#x5217;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x3001;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x6570;&#x7EC4;&#xFF0C;&#x6216;&#x8005;&#x662F;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x7684;&#x7EC4;&#x5408;&#x3002;&#x7531;&#x4E8E;<a href="#router">route</a> &#x548C; <a href="#app">app</a> &#x5B9E;&#x73B0;&#x4E86;&#x4E2D;&#x95F4;&#x4EF6;&#x63A5;&#x53E3;&#xFF0C;&#x6240;&#x4EE5;&#x60A8;&#x53EF;&#x4EE5;&#x50CF;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x4E2D;&#x95F4;&#x4EF6;&#x529F;&#x80FD;&#x4E00;&#x6837;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x7528;&#x6CD5;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x793A;&#x4F8B;&#xFF1A;</p>
<ul>
<li><p>&#x5355;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x672C;&#x5730;&#x5B9A;&#x4E49;&#x548C;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x8DEF;&#x7531;&#x5668;&#x662F;&#x6709;&#x6548;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Express app &#x662F;&#x6709;&#x6548;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>subApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5728;&#x76F8;&#x540C;&#x7684;&#x6302;&#x8F7D;&#x8DEF;&#x5F84;&#x4E2D;&#x6307;&#x5B9A;&#x591A;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>&#x6570;&#x7EC4;</p>
<p>&#x4F7F;&#x7528;&#x6570;&#x7EC4;&#x903B;&#x8F91;&#x5730;&#x5BF9;&#x4E2D;&#x95F4;&#x4EF6;&#x8FDB;&#x884C;&#x5206;&#x7EC4;&#x3002;&#x5982;&#x679C;&#x60A8;&#x5C06;&#x4E2D;&#x95F4;&#x4EF6;&#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x6216;&#x552F;&#x4E00;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x90A3;&#x4E48;&#x60A8;<em>&#x5FC5;&#x987B;</em>&#x6307;&#x5B9A;&#x6302;&#x8F7D;&#x8DEF;&#x5F84;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
<li><p>&#x7EC4;&#x5408;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x6240;&#x6709;&#x4EE5;&#x4E0A;&#x7684;&#x6302;&#x8F7D;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x7EC4;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">function</span> <span class="token function">mw1</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">mw2</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> r1 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r1<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> r2 <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
r2<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> subApp <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
subApp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mw1<span class="token punctuation">,</span> <span class="token punctuation">[</span>mw2<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">]</span><span class="token punctuation">,</span> subApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x4E9B;&#x5728; Express app &#x4E2D;&#x4F7F;&#x7528;  <a href="http://www.expressjs.com.cn/guide/using-middleware.html#middleware.built-in" target="_blank">express.static</a> &#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x4F8B;&#x5B50;&#x3002;</p>
<p>&#x4ECE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x76EE;&#x5F55;&#x4E2D;&#x7684;&#x201C;public&#x201D;&#x76EE;&#x5F55;&#x4E2D;&#x4E3A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x63D0;&#x4F9B;&#x9759;&#x6001;&#x5185;&#x5BB9;:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// GET /style.css etc</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53EA;&#x6709;&#x5F53;&#x5B83;&#x4EEC;&#x7684;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x5E26;&#x6709; &quot;/static&quot; &#x524D;&#x7F00;&#x65F6;&#xFF0C;&#x624D;&#x4F1A;&#x5728; &#x201C;/static&#x201D; &#x4E2D;&#x52A0;&#x8F7D;&#x4E2D;&#x95F4;&#x4EF6;&#x6765;&#x63D0;&#x4F9B;&#x9759;&#x6001;&#x5185;&#x5BB9;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// GET /static/style.css etc.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/static&apos;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x901A;&#x8FC7;&#x5728;&#x9759;&#x6001;&#x4E2D;&#x95F4;&#x4EF6;&#x4E4B;&#x540E;&#x52A0;&#x8F7D;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x5668;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4E3A;&#x9759;&#x6001;&#x5185;&#x5BB9;&#x8BF7;&#x6C42;&#x7981;&#x7528;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4ECE;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#x63D0;&#x4F9B;&#x9759;&#x6001;&#x6587;&#x4EF6;&#xFF0C;&#x4F46;&#x4F18;&#x5148;&#x8003;&#x8651; &#x201C;./public&#x201D;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/files&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/uploads&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h1 id="request"><a name="request" class="anchor-navigation-ex-anchor" href="#request"><i class="fa fa-link" aria-hidden="true"></i></a>3. Request </h1>
<p><code>req</code> &#x5BF9;&#x8C61;&#x8868;&#x793A; HTTP &#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5177;&#x6709;&#x8BF7;&#x6C42;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x3001;&#x53C2;&#x6570;&#x3001;&#x4E3B;&#x4F53;&#x3001;HTTP &#x5934;&#x7B49;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x548C;&#x7EA6;&#x5B9A;&#x4E2D;&#xFF0C;&#x5BF9;&#x8C61;&#x603B;&#x662F;&#x88AB;&#x79F0;&#x4E3A; <code>req</code> (HTTP &#x54CD;&#x5E94;&#x662F; <code>res</code>)&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x5B9E;&#x9645;&#x540D;&#x79F0;&#x662F;&#x7531;&#x60A8;&#x5DE5;&#x4F5C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;user &apos;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4F46;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;user &apos;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x5C5E;&#x6027;_1"><a name="&#x5C5E;&#x6027;_1" class="anchor-navigation-ex-anchor" href="#&#x5C5E;&#x6027;_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. &#x5C5E;&#x6027;</h2>
<blockquote>
<p><strong>[warning]</strong> &#x5728; Express 4 &#x4E2D;&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;<code>req</code> &#x5BF9;&#x8C61;&#x4E0A;&#x7684; req.files &#x4E0D;&#x518D;&#x53EF;&#x7528;&#x3002;&#x8981;&#x5728; req.files &#x5BF9;&#x8C61;&#x4E0A;&#x8BBF;&#x95EE;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x300C;&#x591A;&#x6587;&#x4EF6;&#x5904;&#x7406;&#x300D;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4F8B;&#x5982; busboy&#x3001;multer&#x3001;<a href="">formidable</a>&#x3001;multipart&#x3001;connect-multiparty&#x3001;&#x6216;&#x8005; pez.</p>
</blockquote>
<h3 id="req_app"><a name="req_app" class="anchor-navigation-ex-anchor" href="#req_app"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.1. req.app </h3>
<p>&#x8BE5;&#x5C5E;&#x6027;&#x5BF9;&#x4F7F;&#x7528;&#x8BE5;&#x4E2D;&#x95F4;&#x4EF6;&#x7684; express &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5B9E;&#x4F8B;&#x8FDB;&#x884C;&#x4E86;&#x5F15;&#x7528;&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x9075;&#x5FAA;&#x521B;&#x5EFA;&#x6A21;&#x5757;&#x7684;&#x6A21;&#x5F0F;&#xFF0C;&#x53EA;&#x9700;&#x5BFC;&#x51FA;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x60A8;&#x7684;&#x4E3B;&#x6587;&#x4EF6;&#x4E2D; require &#x5B83;&#xFF0C;&#x90A3;&#x4E48;&#x4E2D;&#x95F4;&#x4EF6;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>req.app</code> &#x8BBF;&#x95EE; express &#x5B9E;&#x4F8B;&#x3002;</p>
<p>&#x793A;&#x4F8B;:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">//index.js</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/viewdirectory&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./mymiddleware.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">//mymiddleware.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;The views directory is &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;views&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="req_baseUrl"><a name="req_baseUrl" class="anchor-navigation-ex-anchor" href="#req_baseUrl"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.2. req.baseUrl </h3>
<p>&#x8DEF;&#x7531;&#x5668;&#x5B9E;&#x4F8B;&#x88AB;&#x6302;&#x8F7D;&#x7684; URL &#x8DEF;&#x5F84;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> greet <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

greet<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/jp&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// /greet</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Konichiwa!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/greet&apos;</span><span class="token punctuation">,</span> greet<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x5728; &apos;/greet&apos; &#x4E0A;&#x52A0;&#x8F7D;&#x8DEF;&#x7531;&#x5668;</span>
</code></pre>
<p>&#x5373;&#x4F7F;&#x60A8;&#x4F7F;&#x7528;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x6216;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x96C6;&#x5408;&#x6765;&#x52A0;&#x8F7D;&#x8DEF;&#x7531;&#x5668;&#xFF0C;<code>baseUrl</code> &#x5C5E;&#x6027;&#x5C06;&#x8FD4;&#x56DE;&#x5339;&#x914D;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x6A21;&#x5F0F;(s)&#x3002;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x4E2D;&#xFF0C;<code>greet</code> &#x8DEF;&#x7531;&#x5668;&#x88AB;&#x52A0;&#x8F7D;&#x5230;&#x4E24;&#x4E2A;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x4E2D;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;/gre+t&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;/hel{2}o&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> greet<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x5728; &apos;/gre+t&apos; &#x548C; &apos;/hel{2}o&apos; &#x4E0A;&#x52A0;&#x8F7D;&#x8DEF;&#x7531;&#x5668;</span>
</code></pre>
<p>&#x5F53;&#x8BF7;&#x6C42;&#x4E3A; <code>/greet/jp</code>, <code>req.baseUrl</code> &#x662F; &#x201C;/greet&#x201D;&#x3002;&#x5F53;&#x8BF7;&#x6C42;&#x4E3A; <code>/hello/jp</code>, <code>req.baseUrl</code> &#x662F; &#x201C;/hello&#x201D;.</p>
<p><code>req.baseUrl</code> &#x7C7B;&#x4F3C;&#x4E8E; <code>app</code> &#x5BF9;&#x8C61;&#x4E0A;&#x7684; <a href="#app_mountpath"><code>mountpath</code></a> &#x5C5E;&#x6027;&#xFF0C;&#x9664;&#x4E86; <code>app.mountpath</code> &#x8FD4;&#x56DE;&#x7684;&#x662F;&#x5339;&#x914D;&#x7684;&#x8DEF;&#x5F84;&#x6A21;&#x5F0F;&#x3002;</p>
<h3 id="req_body"><a name="req_body" class="anchor-navigation-ex-anchor" href="#req_body"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.3. req.body </h3>
<p>&#x5305;&#x542B;&#x5728;&#x8BF7;&#x6C42;&#x4E3B;&#x4F53;&#x4E2D;&#x63D0;&#x4EA4;&#x7684;&#x6570;&#x636E;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x662F; <code>undefined</code>&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x4F7F;&#x7528; <a href="https://www.npmjs.org/package/body-parser" target="_blank">body-parsing</a> &#x548C; <a href="https://www.npmjs.org/package/multer" target="_blank">multer</a> &#x8FD9;&#x6837;&#x7684;&#x8BF7;&#x6C42;&#x4F53;&#x89E3;&#x6790;&#x4E2D;&#x95F4;&#x4EF6;&#x65F6;&#x88AB;&#x586B;&#x5145;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5C55;&#x793A;&#x4E86;&#x5982;&#x4F55;&#x4F7F;&#x7528; body-parsin &#x4E2D;&#x95F4;&#x4EF6;&#x6765;&#x586B;&#x5145; <code>req.body</code>&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;body-parser&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;multer&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing application/json</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing application/x-www-form-urlencoded</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// for parsing multipart/form-data</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="req_cookies"><a name="req_cookies" class="anchor-navigation-ex-anchor" href="#req_cookies"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.4. req.cookies </h3>
<p>&#x5F53;&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/cookie-parser" target="_blank">cookie-parser</a> &#x4E2D;&#x95F4;&#x4EF6;&#x65F6;&#xFF0C;&#x8BBE;&#x4E2A;&#x5C5E;&#x6027;&#x5C06;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E86;&#x7531;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7684; cookie&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x6CA1;&#x5305;&#x542B; cookie&#xFF0C;&#x90A3;&#x5B83;&#x9ED8;&#x8BA4;&#x4E3A; {}&#x3002;</p>
<pre class="language-"><code>// Cookie: name=tj
req.cookies.name
// =&gt; &quot;tj&quot;
</code></pre><p>&#x8981;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3001;&#x95EE;&#x9898;&#x6216;&#x5173;&#x6CE8;&#xFF0C;&#x8BF7;&#x53C2;&#x9605; <a href="https://www.npmjs.com/package/cookie-parser" target="_blank">cookie-parser</a>.</p>
<h3 id="req_fresh"><a name="req_fresh" class="anchor-navigation-ex-anchor" href="#req_fresh"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.5. req.fresh </h3>
<p>&#x8868;&#x793A;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x201C;&#x65B0;&#x9C9C;&#x201D;&#x3002;&#x8FD9;&#x4E0E; <code>req.stale</code> &#x76F8;&#x53CD;&#x3002;</p>
<p>&#x5982;&#x679C; <code>cache-control</code> &#x8BF7;&#x6C42;&#x5934;&#x6CA1;&#x6709;&#x4E00;&#x4E2A; <code>no-cache</code> &#x6307;&#x4EE4;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4EFB;&#x4F55;&#x4E00;&#x6761;&#x90FD;&#x662F; true &#x7684;:</p>
<ul>
<li>if-modified-since &#x7684;&#x8BF7;&#x6C42;&#x5934;&#x88AB;&#x6307;&#x5B9A;&#xFF0C;&#x800C; last-modified &#x8BF7;&#x6C42;&#x5934;&#x7B49;&#x4E8E;&#x6216;&#x65E9;&#x4E8E; modified &#x54CD;&#x5E94;&#x5934;&#x3002;</li>
<li>if-none-match &#x8BF7;&#x6C42;&#x5934;&#x4E3A; *.</li>
<li>if-none-match &#x8BF7;&#x6C42;&#x5934;&#xFF0C;&#x5728;&#x88AB;&#x89E3;&#x6790;&#x5230;&#x5B83;&#x7684;&#x6307;&#x4EE4;&#x4E4B;&#x540E;&#xFF0C;&#x4E0D;&#x5339;&#x914D; etag &#x54CD;&#x5E94;&#x5934;&#x3002;</li>
</ul>
<pre class="language-"><code class="lang-js">req<span class="token punctuation">.</span>fresh
<span class="token comment" spellcheck="true">// =&gt; true</span>
</code></pre>
<p>&#x8981;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3001;&#x95EE;&#x9898;&#x6216;&#x5173;&#x6CE8;&#xFF0C;&#x8BF7;&#x53C2;&#x9605; <a href="https://github.com/jshttp/fresh" target="_blank">fresh</a>.</p>
<h3 id="req_hostname"><a name="req_hostname" class="anchor-navigation-ex-anchor" href="#req_hostname"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.6. req.hostname </h3>
<p>&#x5305;&#x542B;&#x6765;&#x81EA; &#x201C;Host&#x201D; HTTP &#x5934;&#x7684;&#x4E3B;&#x673A;&#x540D;&#x3002;</p>
<pre class="language-"><code>// Host: &quot;example.com:3000&quot;
req.hostname
// =&gt; &quot;example.com&quot;
</code></pre><h3 id="req_ip"><a name="req_ip" class="anchor-navigation-ex-anchor" href="#req_ip"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.7. req.ip </h3>
<p>&#x8BF7;&#x6C42;&#x7684;&#x8FDC;&#x7A0B; IP &#x5730;&#x5740;&#x3002;</p>
<p>&#x5982;&#x679C; <code>trust proxy</code> &#x88AB;&#x8BBE;&#x7F6E;&#x4E3A;&#x542F;&#x7528;&#xFF0C;&#x5B83;&#x5C06;&#x662F;&#x4E0A;&#x6E38;&#x5730;&#x5740;&#xFF1B;&#x53C2;&#x89C1; <a href="http://www.expressjs.com.cn/guide/behind-proxies.html" target="_blank">Express behind proxies</a> &#x83B7;&#x5F97;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</p>
<pre class="language-"><code>req.ip
// =&gt; &quot;127.0.0.1&quot;
</code></pre><h3 id="req_ips"><a name="req_ips" class="anchor-navigation-ex-anchor" href="#req_ips"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.8. req.ips </h3>
<p>&#x5F53; <code>trust proxy</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>true</code> &#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;&#x5728; &#x201C;X-Forwarded-For&#x201D; &#x8BF7;&#x6C42;&#x5934;&#x79CD;&#x6307;&#x5B9A;&#x7684; IP &#x5730;&#x5740;&#x6570;&#x7EC4;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x5B83;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x7A7A;&#x6570;&#x7EC4;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C; &#x201C;X-Forwarded-For&#x201D; &#x662F; &#x201C;client, proxy1, proxy2&#x201D;&#xFF0C;<code>req.ips</code> &#x5C06;&#x4F1A;&#x662F; <code>[&quot;client&quot;, &quot;proxy1&quot;, &quot;proxy2&quot;]</code>&#xFF0C;&#x5176;&#x4E2D; &#x201C;proxy2&#x201D; &#x662F;&#x6700;&#x9065;&#x8FDC;&#x7684;&#x4E0B;&#x6E38;&#x3002;</p>
<p>&#x8981;&#x83B7;&#x5F97;&#x66F4;&#x591A;&#x5173;&#x4E8E; <code>trust proxy</code> &#x8BBE;&#x7F6E;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1; <a href="#app_set">app.set</a>.</p>
<h3 id="req_originalUrl"><a name="req_originalUrl" class="anchor-navigation-ex-anchor" href="#req_originalUrl"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.9. req.originalUrl </h3>
<blockquote>
<p><strong>[warning]</strong> <code>req.url</code> &#x4E0D;&#x662F;&#x539F;&#x751F;&#x7684; Express &#x5C5E;&#x6027;&#xFF0C;&#x5B83;&#x7EE7;&#x627F;&#x81EA; Node &#x7684; <a href="https://nodejs.org/api/http.html#http_message_url" target="_blank">http &#x6A21;&#x5757;</a>.</p>
</blockquote>
<p>&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5F88;&#x50CF; <code>req.url</code>&#xFF1B;&#x4F46;&#x662F;&#xFF0C;&#x5B83;&#x4FDD;&#x7559;&#x4E86;&#x539F;&#x59CB;&#x7684;&#x8BF7;&#x6C42; URL&#xFF0C;&#x5141;&#x8BB8;&#x60A8;&#x81EA;&#x7531;&#x5730;&#x91CD;&#x5199; <code>req.url</code> &#x7528;&#x4E8E;&#x5185;&#x90E8;&#x8DEF;&#x7531;&#x76EE;&#x7684;&#x3002;&#x4F8B;&#x5982;&#xFF0C;<a href="#app_use">app.use()</a>&#x7684; &#x201C;mounting&#x201D; &#x7279;&#x6027;&#x5C06;&#x4F1A;&#x91CD;&#x5199; <code>req.url</code> &#x6765;&#x53BB;&#x6389;&#x6302;&#x8F7D;&#x70B9;&#x7684;&#x3002;</p>
<pre class="language-"><code>// GET /search?q=something
req.originalUrl
// =&gt; &quot;/search?q=something&quot;
</code></pre><h3 id="req_params"><a name="req_params" class="anchor-navigation-ex-anchor" href="#req_params"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.10. req.params </h3>
<p>&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x542B;&#x4E86;&#x88AB;&#x6620;&#x5C04;&#x5230;&#x547D;&#x540D;&#x8DEF;&#x7531;&#x201C;&#x53C2;&#x6570;&#x201D;&#x7684;&#x5C5E;&#x6027;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x6709;&#x8DEF;&#x7531; <code>/user/:name</code>&#xFF0C;&#x90A3;&#x4E48; &#x201C;name&#x201D; &#x5C5E;&#x6027;&#x5C31;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;  <code>req.params.name</code> &#x63D0;&#x4F9B;&#x3002;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x9ED8;&#x8BA4;&#x4E3A; <code>{}</code>&#x3002;</p>
<pre class="language-"><code>// GET /user/tj
req.params.name
// =&gt; &quot;tj&quot;
</code></pre><p>&#x5F53;&#x60A8;&#x5728;&#x8DEF;&#x7531;&#x5B9A;&#x4E49;&#x4E2D;&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x65F6;&#xFF0C;&#x5C06;&#x4F7F;&#x7528; <code>req.params[n]</code> &#x5728;&#x6570;&#x7EC4;&#x4E2D;&#x63D0;&#x4F9B;&#x6355;&#x6349;&#x7EC4;&#x3002;&#x5176;&#x4E2D; <code>n</code> &#x662F;&#x7B2C; n &#x4E2A;&#x6355;&#x6349;&#x7EC4;&#x3002;&#x6B64;&#x89C4;&#x5219;&#x9002;&#x7528;&#x4E8E;&#x672A;&#x547D;&#x540D;&#x7684;&#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;&#x5B57;&#x7B26;&#x4E32;&#x8DEF;&#x7531;&#xFF0C;&#x5982;  <code>/file/*</code>&#xFF1A;</p>
<pre class="language-"><code>// GET /file/javascripts/jquery.js
req.params[0]
// =&gt; &quot;javascripts/jquery.js&quot;
</code></pre><h3 id="req_path"><a name="req_path" class="anchor-navigation-ex-anchor" href="#req_path"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.11. req.path </h3>
<p>&#x5305;&#x542B;&#x8BF7;&#x6C42; URL &#x7684;&#x8DEF;&#x5F84;&#x90E8;&#x5206;&#x3002;</p>
<pre class="language-"><code>// example.com/users?sort=desc
req.path
// =&gt; &quot;/users&quot;
</code></pre><blockquote>
<p>&#x5F53;&#x4ECE;&#x4E2D;&#x95F4;&#x4EF6;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x6302;&#x8F7D;&#x70B9;&#x88AB;&#x5305;&#x542B;&#x5728; <code>req.path</code> &#x4E2D;&#x3002;&#x67E5;&#x627E; <a href="#app_use">app.use()</a> &#x83B7;&#x5F97;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;&#x3002;</p>
</blockquote>
<h3 id="req_protocol"><a name="req_protocol" class="anchor-navigation-ex-anchor" href="#req_protocol"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.12. req.protocol </h3>
<p>&#x8BF7;&#x6C42;&#x7684;&#x534F;&#x8BAE;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&quot;http&quot; &#x6216; &#x5F53;&#x8BF7;&#x6C42;&#x4F7F;&#x7528; TLS &#x65F6;&#x4E3A; &#x201C;https&#x3002;&#x5F53; &#x201C;trust proxy&#x201D; <a href="#trust_proxy-options-table">&#x8BBE;&#x7F6E;</a> &#x4FE1;&#x4EFB; socket &#x5730;&#x5740;&#x65F6;&#xFF0C;&#x201C;X-Forwarded-Proto&#x201D; &#x5934;&#xFF08;&#x201C;http&#x201D; &#x6216; &#x201C;https&#x201D;&#xFF09;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x5C06;&#x4F1A;&#x88AB;&#x4FE1;&#x4EFB;&#x5E76;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x3002;</p>
<pre class="language-"><code>req.protocol
// =&gt; &quot;http&quot;
</code></pre><h3 id="req_query"><a name="req_query" class="anchor-navigation-ex-anchor" href="#req_query"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.13. req.query </h3>
<p>&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x542B;&#x8DEF;&#x7531;&#x4E2D;&#x7684;&#x6BCF;&#x4E2A;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#x53C2;&#x6570;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5C06;&#x4F1A;&#x662F;&#x4E00;&#x4E2A;&#x7A7A;&#x5BF9;&#x8C61;&#xFF0C;<code>{}</code>&#x3002;</p>
<pre class="language-"><code>// GET /search?q=tobi+ferret
req.query.q
// =&gt; &quot;tobi ferret&quot;

// GET /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse
req.query.order
// =&gt; &quot;desc&quot;

req.query.shoe.color
// =&gt; &quot;blue&quot;

req.query.shoe.type
// =&gt; &quot;converse&quot;
</code></pre><h3 id="req_route"><a name="req_route" class="anchor-navigation-ex-anchor" href="#req_route"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.14. req.route </h3>
<p>&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8868;&#x793A;&#x5F53;&#x524D;&#x5339;&#x914D;&#x7684;&#x8DEF;&#x7531;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id?&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">userIdHandler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;GET&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x7684;&#x793A;&#x4F8B;&#x8F93;&#x51FA;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;/user/:id?&apos;</span><span class="token punctuation">,</span>
  stack<span class="token punctuation">:</span>
   <span class="token punctuation">[</span> <span class="token punctuation">{</span> handle<span class="token punctuation">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">:</span> userIdHandler<span class="token punctuation">]</span><span class="token punctuation">,</span>
       name<span class="token punctuation">:</span> <span class="token string">&apos;userIdHandler&apos;</span><span class="token punctuation">,</span>
       params<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
       path<span class="token punctuation">:</span> undefined<span class="token punctuation">,</span>
       keys<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       regexp<span class="token punctuation">:</span> <span class="token regex">/^\/?$/i</span><span class="token punctuation">,</span>
       method<span class="token punctuation">:</span> <span class="token string">&apos;get&apos;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre>
<h3 id="req_secure"><a name="req_secure" class="anchor-navigation-ex-anchor" href="#req_secure"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.15. req.secure </h3>
<p>&#x4E00;&#x4E2A;&#x5E03;&#x5C14;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A; TLS &#x8FDE;&#x63A5;&#x5EFA;&#x7ACB;&#x8D77;&#x6765;&#xFF0C;&#x5B83;&#x5C06;&#x4E3A; <code>true</code>&#x3002;&#x7B49;&#x4EF7;&#x4E8E;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token string">&apos;https&apos;</span> <span class="token operator">==</span> req<span class="token punctuation">.</span>protocol<span class="token punctuation">;</span>
</code></pre>
<h3 id="req_signedCookies"><a name="req_signedCookies" class="anchor-navigation-ex-anchor" href="#req_signedCookies"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.16. req.signedCookies </h3>
<p>&#x5F53;&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/cookie-parser" target="_blank">cookie-parser</a> &#x4E2D;&#x95F4;&#x4EF6;&#x65F6;,&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5305;&#x542B;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7684;&#x7B7E;&#x540D; cookie&#xFF0C;unsigned and ready for use&#x3002;&#x7B7E;&#x540D; cookie &#x9A7B;&#x7559;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5BF9;&#x8C61;&#x4E2D;&#xFF0C;&#x4EE5;&#x663E;&#x793A;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x610F;&#x56FE;&#xFF1B;&#x5426;&#x5219;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5728; <code>req.cookie</code> (&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x6B3A;&#x9A97;)&#x503C;&#x4E0A;&#x653E;&#x7F6E;&#x6076;&#x610F;&#x653B;&#x51FB;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x7B7E;&#x540D;&#x4E00;&#x4E2A; cookie &#x5E76;&#x4E0D;&#x80FD;&#x4F7F;&#x5176;&#x201C;&#x9690;&#x85CF;&#x201D;&#x6216;&#x52A0;&#x5BC6;&#xFF1B;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x5730;&#x9632;&#x6B62;&#x7BE1;&#x6539;(&#x56E0;&#x4E3A;&#x7528;&#x4E8E;&#x7B7E;&#x540D;&#x7684;&#x79D8;&#x5BC6;&#x662F;&#x79C1;&#x6709;&#x7684;)&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D1;&#x9001;&#x7B7E;&#x540D;&#x7684; cookie&#xFF0C;&#x5219;&#x8BE5;&#x5C5E;&#x6027;&#x5C06;&#x662F;&#x9ED8;&#x8BA4;&#x503C; {}&#x3002;</p>
<pre class="language-"><code>// Cookie: user=tobi.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3
req.signedCookies.user
// =&gt; &quot;tobi&quot;
</code></pre><p>&#x8981;&#x4E86;&#x89E3;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3001;&#x95EE;&#x9898;&#x6216;&#x5173;&#x6CE8;&#xFF0C;&#x8BF7;&#x53C2;&#x9605; <a href="https://www.npmjs.com/package/cookie-parser" target="_blank">cookie-parser</a>.</p>
<h3 id="req_stale"><a name="req_stale" class="anchor-navigation-ex-anchor" href="#req_stale"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.17. req.stale </h3>
<p>&#x8868;&#x793A;&#x8BE5;&#x8BF7;&#x6C42;&#x662F;&#x5426; &#x201C;stale&#x201D;(&#x8FC7;&#x65F6;)&#xFF0C;&#x5E76; <code>req.fresh</code> &#x76F8;&#x53CD;&#x3002;&#x6709;&#x5173;&#x66F4;&#x591A;&#x4FE1;&#x606F;,&#x8BF7;&#x53C2;&#x89C1; <a href="#req_fresh">req.fresh</a>.</p>
<pre class="language-"><code>req.stale
// =&gt; true
</code></pre><h3 id="req_subdomains"><a name="req_subdomains" class="anchor-navigation-ex-anchor" href="#req_subdomains"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.18. req.subdomains </h3>
<p>&#x8BF7;&#x6C42;&#x7684;&#x57DF;&#x540D;&#x7684;&#x4E00;&#x7EC4;&#x5B50;&#x57DF;&#x540D;&#x3002;</p>
<pre class="language-"><code>// Host: &quot;tobi.ferrets.example.com&quot;
req.subdomains
// =&gt; [&quot;ferrets&quot;, &quot;tobi&quot;]
</code></pre><h3 id="req_xhr"><a name="req_xhr" class="anchor-navigation-ex-anchor" href="#req_xhr"><i class="fa fa-link" aria-hidden="true"></i></a>3.1.19. req.xhr </h3>
<p>&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x7684; &#x201C;X-Requested-With&#x201D; &#x5934;&#x5B57;&#x6BB5;&#x662F; &#x201C;XMLHttpRequest&#x201D;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x5E03;&#x5C14;&#x503C;&#x662F; <code>true</code>&#xFF0C;&#x8868;&#x793A;&#x8BF7;&#x6C42;&#x662F;&#x7531;&#x8BF8;&#x5982; jQuery &#x8FD9;&#x6837;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5E93;&#x53D1;&#x51FA;&#x7684;&#x3002;</p>
<pre class="language-"><code>req.xhr
// =&gt; true
</code></pre><h2 id="&#x65B9;&#x6CD5;_1"><a name="&#x65B9;&#x6CD5;_1" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;_1"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. &#x65B9;&#x6CD5;</h2>
<h3 id="req_accepts"><a name="req_accepts" class="anchor-navigation-ex-anchor" href="#req_accepts"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.1. req.accepts(types) </h3>
<p>&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684; <code>Accept</code> HTTP &#x5934;&#x5B57;&#x6BB5;&#x68C0;&#x67E5;&#x6307;&#x5B9A;&#x7684;&#x5185;&#x5BB9;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x53EF;&#x63A5;&#x53D7;&#x3002;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x6700;&#x4F73;&#x5339;&#x914D;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x7684;&#x5185;&#x5BB9;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>undefined</code>(&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5E94;&#x8BE5;&#x54CD;&#x5E94; 406 &quot;Not Acceptable&quot;)&#x3002;</p>
<p><code>type</code> &#x503C;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A; MIME &#x7C7B;&#x578B;&#x5B57;&#x7B26;&#x4E32;(&#x4F8B;&#x5982; &#x201C;application/json&#x201D;)&#xFF0C;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x540D;&#xFF0C;&#x4F8B;&#x5982;&#x201C;json&#x201D;&#xFF0C;&#x4E00;&#x4E2A;&#x9017;&#x53F7;&#x5206;&#x9694;&#x7684;&#x5217;&#x8868;&#xFF0C;&#x6216;&#x8005;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x3002;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#x6216;&#x6570;&#x7EC4;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x6700;&#x4F73;&#x5339;&#x914D;(&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;)&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// Accept: text/html</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;html&quot;</span>

<span class="token comment" spellcheck="true">// Accept: text/*, application/json</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;html&quot;</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;text/html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;text/html&quot;</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;json&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;json&quot;</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;application/json&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;application/json&quot;</span>

<span class="token comment" spellcheck="true">// Accept: text/*, application/json</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;image/png&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token string">&apos;png&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; undefined</span>

<span class="token comment" spellcheck="true">// Accept: text/*;q=.5, application/json</span>
req<span class="token punctuation">.</span><span class="token function">accepts</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;json&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;json&quot;</span>
</code></pre>
<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FE7;&#xFF0C;&#x53C2;&#x89C1; <a href="https://github.com/expressjs/accepts" target="_blank">accepts</a>&#x3002;</p>
<h3 id="req_acceptsCharsets"><a name="req_acceptsCharsets" class="anchor-navigation-ex-anchor" href="#req_acceptsCharsets"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.2. req.acceptsCharsets(charset [, ...]) </h3>
<p>&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684; <code>Accept-Charset</code>  HTTP &#x5934;&#x5B57;&#x6BB5;&#xFF0C;&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x5B57;&#x7B26;&#x96C6;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x88AB;&#x63A5;&#x53D7;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7684;&#x5B57;&#x7B26;&#x96C6;&#x88AB;&#x63A5;&#x53D7;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>false</code>&#x3002;</p>
<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FE7;&#xFF0C;&#x53C2;&#x89C1; <a href="https://github.com/expressjs/accepts" target="_blank">accepts</a>&#x3002;</p>
<h3 id="req_acceptsEncodings"><a name="req_acceptsEncodings" class="anchor-navigation-ex-anchor" href="#req_acceptsEncodings"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.3. req.acceptsEncodings(encoding [, ...]) </h3>
<p>&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684; <code>Accept-Encoding</code> HTTP &#x5934;&#x5B57;&#x6BB5;&#xFF0C;&#x8FD4;&#x56DE;&#x7B2C;&#x4E00;&#x4E2A;&#x6307;&#x5B9A;&#x7F16;&#x7801;&#x7684;&#x88AB;&#x63A5;&#x53D7;&#x7684;&#x7F16;&#x7801;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x63A5;&#x53D7;&#x6307;&#x5B9A;&#x7684;&#x7F16;&#x7801;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>false</code>&#x3002;</p>
<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FE7;&#xFF0C;&#x53C2;&#x89C1; <a href="https://github.com/expressjs/accepts" target="_blank">accepts</a>&#x3002;</p>
<h3 id="req_acceptsLanguages"><a name="req_acceptsLanguages" class="anchor-navigation-ex-anchor" href="#req_acceptsLanguages"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.4. req.acceptsLanguages(lang [, ...]) </h3>
<p>&#x6839;&#x636E;&#x8BF7;&#x6C42;&#x7684; <code>Accept-Language</code> HTTP &#x5934;&#x5B57;&#x6BB5;&#xFF0C;&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x8BED;&#x8A00;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x88AB;&#x63A5;&#x53D7;&#x7684;&#x8BED;&#x8A00;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x7684;&#x8BED;&#x8A00;&#x88AB;&#x63A5;&#x53D7;&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>false</code>&#x3002;</p>
<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FE7;&#xFF0C;&#x53C2;&#x89C1; <a href="https://github.com/expressjs/accepts" target="_blank">accepts</a>&#x3002;</p>
<h3 id="req_get"><a name="req_get" class="anchor-navigation-ex-anchor" href="#req_get"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.5. req.get(field) </h3>
<p>&#x8FD4;&#x56DE;&#x6307;&#x5B9A;&#x7684; HTTP &#x8BF7;&#x6C42;&#x5934;&#x5B57;&#x6BB5;(&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x5339;&#x914D;)&#x3002;<code>Referrer</code> &#x548C; <code>Referer</code> &#x5B57;&#x6BB5;&#x662F;&#x53EF;&#x4E92;&#x6362;&#x7684;&#x3002;</p>
<pre class="language-"><code class="lang-js">req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;text/plain&quot;</span>

req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;content-type&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;text/plain&quot;</span>

req<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;Something&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; undefined</span>
</code></pre>
<p>&#x522B;&#x540D;&#x4E3A; <code>req.header(field)</code>&#x3002;</p>
<h3 id="req_is"><a name="req_is" class="anchor-navigation-ex-anchor" href="#req_is"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.6. req.is(type) </h3>
<p>&#x5982;&#x679C;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#x7684; &#x201C;Content-Type&#x201D; HTTP &#x5934;&#x5B57;&#x6BB5;&#x4E0E;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684;MIME <code>type</code> &#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x8FD4;&#x56DE; <code>true</code>&#x3002;&#x5426;&#x5219;&#x8FD4;&#x56DE; <code>false</code>&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// With Content-Type: text/html; charset=utf-8</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;text/html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;text/*&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; true</span>

<span class="token comment" spellcheck="true">// When Content-Type is application/json</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;json&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;application/json&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;application/*&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; true</span>

req<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; false</span>
</code></pre>
<p>&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FE7;&#xFF0C;<a href="https://github.com/expressjs/type-is" target="_blank">type-is</a>.</p>
<h3 id="req_param"><a name="req_param" class="anchor-navigation-ex-anchor" href="#req_param"><i class="fa fa-link" aria-hidden="true"></i></a>3.2.7. req.param(name [, defaultValue]) </h3>
<blockquote>
<p><strong>[danger] &#x5DF2;&#x5F03;&#x7528;</strong>&#x3002; &#x8BF7;&#x4F7F;&#x7528; <code>req.params</code>, <code>req.body</code> &#x6216; <code>req.query</code>&#x3002;</p>
</blockquote>
<p>&#x5F53;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x53C2;&#x6570; <code>name</code> &#x7684;&#x503C;&#x3002;</p>
<pre class="language-"><code class="lang-js">
<span class="token comment" spellcheck="true">// ?name=tobi</span>
req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;tobi&quot;</span>

<span class="token comment" spellcheck="true">// POST name=tobi</span>
req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;tobi&quot;</span>

<span class="token comment" spellcheck="true">// /user/tobi for /user/:name</span>
req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;tobi&quot;</span>
</code></pre>
<p>Lookup is performed in the following order:</p>
<ul>
<li>req.params</li>
<li>req.body</li>
<li>req.query</li>
</ul>
<p>Optionally, you can specify <code>defaultValue</code> to set a default value if the parameter is not found in any of the request objects.</p>
<blockquote>
<p><strong>[danger]</strong></p>
<p>&#x76F4;&#x63A5;&#x8BBF;&#x95EE; <code>req.body</code>, <code>req.params</code>, &#x548C; <code>req.query</code> &#x5E94;&#x8BE5;&#x5F97;&#x5230;&#x660E;&#x786E;&#x7684;&#x652F;&#x6301; - &#x9664;&#x975E;&#x4F60; &gt; &#x771F;&#x6B63;&#x63A5;&#x53D7;&#x6765;&#x81EA;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x8F93;&#x5165;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x9884;&#x89C1;&#x7684;&#x662F;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x4E3A; <code>req.param()</code> &#x52A0;&#x8F7D; Body-parsing &#x4E2D;&#x95F4;&#x4EF6;&#x6765;&#x5DE5;&#x4F5C;&#x3002; &#x53C2;&#x8003; <a href="#req_body">req.body</a> &#x83B7;&#x5F97;&#x66F4;&#x591A;&#x7EC6;&#x8282;&#x3002;</p>
</blockquote>
<h1 id="response"><a name="response" class="anchor-navigation-ex-anchor" href="#response"><i class="fa fa-link" aria-hidden="true"></i></a>4. Response  </h1>
<p><code>res</code> &#x5BF9;&#x8C61;&#x8868;&#x793A;&#x4E00;&#x4E2A; Express &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6536;&#x5230; HTTP &#x8BF7;&#x6C42;&#x65F6;&#x53D1;&#x9001;&#x7684; HTTP &#x54CD;&#x5E94;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x6587;&#x6863;&#x548C;&#x7EA6;&#x5B9A;&#x4E2D;&#xFF0C;&#x54CD;&#x5E94;&#x5BF9;&#x8C61;&#x603B;&#x662F;&#x88AB;&#x79F0;&#x4E3A; <code>res</code> (HTTP &#x8BF7;&#x6C42;&#x662F; <code>req</code>)&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x7684;&#x5B9E;&#x9645;&#x540D;&#x79F0;&#x662F;&#x7531;&#x60A8;&#x5DE5;&#x4F5C;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x51B3;&#x5B9A;&#x7684;&#x3002;</p>
<p>&#x4F8B;&#x5982;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;user &apos;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4F46;&#x4F60;&#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;:</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">{</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;user &apos;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x5C5E;&#x6027;_2"><a name="&#x5C5E;&#x6027;_2" class="anchor-navigation-ex-anchor" href="#&#x5C5E;&#x6027;_2"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. &#x5C5E;&#x6027;</h2>
<h3 id="req_app_1"><a name="req_app_1" class="anchor-navigation-ex-anchor" href="#req_app_1"><i class="fa fa-link" aria-hidden="true"></i></a>4.1.1. res.app </h3>
<p>&#x8BE5;&#x5C5E;&#x6027;&#x5BF9;&#x4F7F;&#x7528;&#x4E2D;&#x95F4;&#x4EF6;&#x7684; express &#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x5B9E;&#x4F8B;&#x8FDB;&#x884C;&#x4E86;&#x5F15;&#x7528;&#x3002;</p>
<p><code>res.app</code> &#x7B49;&#x540C;&#x4E8E;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x4E2D;&#x7684; <a href="#req_app">req.app</a> &#x5C5E;&#x6027;&#x3002;</p>
<h3 id="res_headersSent"><a name="res_headersSent" class="anchor-navigation-ex-anchor" href="#res_headersSent"><i class="fa fa-link" aria-hidden="true"></i></a>4.1.2. res.headersSent </h3>
<p>&#x5E03;&#x5C14;&#x503C;&#x5C5E;&#x6027;&#xFF0C;&#x8868;&#x793A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x4E3A;&#x54CD;&#x5E94;&#x53D1;&#x9001;&#x4E86; HTTP &#x5934;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headersSent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// false</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;OK&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headersSent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="res_locals"><a name="res_locals" class="anchor-navigation-ex-anchor" href="#res_locals"><i class="fa fa-link" aria-hidden="true"></i></a>4.1.3. res.locals </h3>
<p>&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x54CD;&#x5E94;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4F5C;&#x7528;&#x4E8E;&#x8BF7;&#x6C42;&#x7684;&#x8303;&#x56F4;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x6709;&#x5728;&#x8BF7;&#x6C42;/&#x54CD;&#x5E94;&#x5468;&#x671F;(&#x5982;&#x679C;&#x6709;)&#x65F6;&#x6E32;&#x67D3;&#x7684;&#x89C6;&#x56FE;(s)&#x624D;&#x53EF;&#x7528;&#x3002;&#x5426;&#x5219;&#xFF0C;&#x8BE5;&#x5C5E;&#x6027;&#x4E0E; <a href="#app_locals">app.locals</a> &#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</p>
<p>&#x6B64;&#x5C5E;&#x6027;&#x5BF9;&#x4E8E;&#x66B4;&#x9732;&#x8BF7;&#x6C42;&#x7EA7;&#x522B;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x540D;&#x3001;&#x7ECF;&#x8FC7;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7528;&#x6237;&#x3001;&#x7528;&#x6237;&#x8BBE;&#x7F6E;&#x7B49;&#xFF0C;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>authenticated <span class="token operator">=</span> <span class="token operator">!</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>anonymous<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x65B9;&#x6CD5;_2"><a name="&#x65B9;&#x6CD5;_2" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;_2"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. &#x65B9;&#x6CD5;</h2>
<h3 id="res_append"><a name="res_append" class="anchor-navigation-ex-anchor" href="#res_append"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.1. res.append(field [, value]) </h3>
<blockquote>
<p><strong>[success]</strong> <code>res.append()</code> &#x88AB; Express v4.11.0+ &#x652F;&#x6301;&#x3002;</p>
</blockquote>
<p>&#x5C06;&#x6307;&#x5B9A;&#x7684; <code>value</code> &#x9644;&#x52A0;&#x5230; HTTP &#x54CD;&#x5E94;&#x5934; <code>field</code>&#x3002;&#x5982;&#x679C;&#x5934;&#x8FD8;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x5B83;&#x5C06;&#x521B;&#x5EFA;&#x5E26;&#x6709;&#x6307;&#x5B9A; <code>value</code> &#x7684;&#x5934;&#x3002;<code>value</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x6570;&#x7EC4;&#x3002;</p>
<p>&#x6CE8;&#x610F;: &#x5728; <code>res.append()</code> &#x4E4B;&#x540E;&#x8C03;&#x7528; <code>res.set()</code> &#x5C06;&#x91CD;&#x7F6E;&#x5148;&#x524D;&#x8BBE;&#x7F6E;&#x7684;&#x5934;&#x7684;&#x503C;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&apos;Link&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;&lt;http://localhost/&gt;&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;&lt;http://localhost:3000/&gt;&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&apos;Set-Cookie&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;foo=bar; Path=/; HttpOnly&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&apos;Warning&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;199 Miscellaneous warning&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_attachment"><a name="res_attachment" class="anchor-navigation-ex-anchor" href="#res_attachment"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.2. res.attachment([filename]) </h3>
<p>&#x5C06; HTTP &#x54CD;&#x5E94; <code>Content-Disposition</code> &#x5934;&#x5B57;&#x6BB5;&#x8BBE;&#x7F6E;&#x4E3A; &#x201C;attachment&#x201D;&#x3002;&#x5982;&#x679C;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A; <code>filename</code>&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x901A;&#x8FC7; <code>res.type()</code> &#x6765;&#x57FA;&#x4E8E;&#x6269;&#x5C55;&#x540D;&#x8BBE;&#x7F6E; Content-Type&#x3002;&#x5E76;&#x8BBE;&#x7F6E; <code>Content-Disposition</code> &#x201C;filename=&#x201D; &#x53C2;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Content-Disposition: attachment</span>

res<span class="token punctuation">.</span><span class="token function">attachment</span><span class="token punctuation">(</span><span class="token string">&apos;path/to/logo.png&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Content-Disposition: attachment; filename=&quot;logo.png&quot;</span>
<span class="token comment" spellcheck="true">// Content-Type: image/png</span>
</code></pre>
<h3 id="res_cookie"><a name="res_cookie" class="anchor-navigation-ex-anchor" href="#res_cookie"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.3. res.cookie(name, value [, options]) </h3>
<p>&#x8BBE;&#x7F6E; cookie <code>name</code> &#x4E3A; <code>value</code>&#x3002; <code>value</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005;&#x8F6C;&#x6362;&#x4E3A; JSON &#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<p><code>options</code> &#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E0B;&#x9762;&#x7684;&#x5C5E;&#x6027;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;</th>
<th>&#x7C7B;&#x578B;</th>
<th>&#x63CF;&#x8FF0;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>domain</code></td>
<td>String</td>
<td>cookie &#x7684;&#x57DF;&#x540D;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; app &#x7684;&#x57DF;&#x540D;&#x3002;</td>
</tr>
<tr>
<td><code>expires</code></td>
<td>Date</td>
<td>GMT &#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x6216;&#x8BBE;&#x7F6E;&#x4E3A; 0&#xFF0C;&#x5219;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4F1A;&#x8BDD; cookie&#x3002;</td>
</tr>
<tr>
<td><code>httpOnly</code></td>
<td>Boolean</td>
<td>&#x5C06; cookie &#x6807;&#x8BB0;&#x4E3A;&#x53EA;&#x80FD;&#x901A;&#x8FC7; web &#x670D;&#x52A1;&#x5668;&#x8BBF;&#x95EE;&#x3002;</td>
</tr>
<tr>
<td><code>maxAge</code></td>
<td>String</td>
<td>&#x5728;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x8BBE;&#x7F6E;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x7684;&#x65B9;&#x4FBF;&#x9009;&#x9879;&#x3002;</td>
</tr>
<tr>
<td><code>path</code></td>
<td>String</td>
<td>cookie &#x7684;&#x8DEF;&#x5F84;&#x3002;&#x9ED8;&#x8BA4;&#x4E3A; &#x201C;/&#x201D;&#x3002;</td>
</tr>
<tr>
<td><code>secure</code></td>
<td>Boolean</td>
<td>&#x6807;&#x8BB0; cookie &#x4E3A;&#x53EA;&#x7528; HTTPS &#x4F7F;&#x7528; &#x3002;</td>
</tr>
<tr>
<td><code>signed</code></td>
<td>Boolean</td>
<td>&#x8868;&#x793A; cookie &#x662F;&#x5426;&#x5E94;&#x8BE5;&#x88AB;&#x7B7E;&#x540D;&#x3002;</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>[warning]</strong> &#x6240;&#x6709;&#x7684; <code>res.cookie()</code> &#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x63D0;&#x4F9B;&#x7684;&#x9009;&#x9879;&#x8BBE;&#x7F6E; HTTP <code>Set-Cookie</code> &#x5934;&#x3002; &#x4EFB;&#x4F55;&#x672A;&#x6307;&#x5B9A;&#x7684;&#x9009;&#x9879;&#x90FD;&#x9ED8;&#x8BA4;&#x4E3A; RFC 6265 &#x4E2D;&#x6240;&#x8FF0;&#x7684;&#x503C;&#x3002;</p>
</blockquote>
<p>&#x793A;&#x4F8B;:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;tobi&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> domain<span class="token punctuation">:</span> <span class="token string">&apos;.example.com&apos;</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">&apos;/admin&apos;</span><span class="token punctuation">,</span> secure<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;rememberme&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;1&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">900000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> httpOnly<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>maxAge</code> &#x9009;&#x9879;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#x8BBE;&#x7F6E; &#x201C;expires&#x201D; &#x7684;&#x4E00;&#x4E2A;&#x65B9;&#x4FBF;&#x9009;&#x9879;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E0A;&#x9762;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;rememberme&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;1&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token number">900000</span><span class="token punctuation">,</span> httpOnly<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A; <code>value</code> &#x53C2;&#x6570;&#xFF1B;&#x7136;&#x540E;&#x5C06;&#x5B83;&#x5E8F;&#x5217;&#x5316;&#x4E3A; JSON&#xFF0C;&#x5E76;&#x7531; <code>bodyParser()</code> &#x4E2D;&#x95F4;&#x4EF6;&#x89E3;&#x6790;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;cart&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;cart&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> maxAge<span class="token punctuation">:</span> <span class="token number">900000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5F53;&#x4F7F;&#x7528; <a href="https://www.npmjs.com/package/cookie-parser" target="_blank">cookie-parser</a> &#x4E2D;&#x95F4;&#x4EF6;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8FD8;&#x652F;&#x6301;&#x7B7E;&#x540D; cookies&#x3002;&#x7B80;&#x5355;&#x5730;&#x5C06; <code>signed</code> &#x9009;&#x9879;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code>&#x3002;&#x7136;&#x540E; <code>res.cookie()</code> &#x5C06;&#x4F7F;&#x7528;&#x88AB;&#x4F20;&#x9012;&#x7ED9; <code>cookieParser(secret)</code> &#x7684;&#x79D8;&#x5BC6;&#x7B7E;&#x7F72;&#x8FD9;&#x4E2A;&#x503C;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;tobi&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> signed<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x7A0D;&#x540E;&#x60A8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>req.signedCookie</code>&#x5BF9;&#x8C61; &#x8BBF;&#x95EE;&#x8BE5;&#x503C;&#x3002;</p>
<h3 id="res_clearCookie"><a name="res_clearCookie" class="anchor-navigation-ex-anchor" href="#res_clearCookie"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.4. res.clearCookie(name [, options]) </h3>
<p>&#x6E05;&#x7A7A;&#x4F9D;&#x9760; <code>name</code> &#x6307;&#x5B9A;&#x7684; cookie&#x3002;&#x8981;&#x83B7;&#x53D6;&#x5173;&#x4E8E; <code>options</code> &#x5BF9;&#x8C61;&#x7684;&#x7EC6;&#x8282;&#xFF0C;&#x8BF7;&#x53C2;&#x89C1; <a href="l#res_cookie">res.cookie()</a>.</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;tobi&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;/admin&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">clearCookie</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">&apos;/admin&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_download"><a name="res_download" class="anchor-navigation-ex-anchor" href="#res_download"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.5. res.download(path [, filename] [, fn]) </h3>
<p>&#x5C06;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x5230; <code>path</code> &#x4F5C;&#x4E3A; &#x201C;attachment&#x201D;&#x3002;&#x901A;&#x5E38;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x63D0;&#x793A;&#x7528;&#x6237;&#x4E0B;&#x8F7D;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C; <code>Content-Disposition</code> &#x5934; &#x201C;filename=&#x201D; &#x53C2;&#x6570;&#x662F; <code>path</code>(&#x8FD9;&#x901A;&#x5E38;&#x51FA;&#x73B0;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x5BF9;&#x8BDD;&#x6846;&#x4E2D;)&#x3002;&#x7528; <code>filename</code> &#x53C2;&#x6570;&#x8986;&#x76D6;&#x8FD9;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;&#x3002;</p>
<p>&#x5F53;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x6216;&#x4F20;&#x8F93;&#x5B8C;&#x6210;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x53EF;&#x9009;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570; <code>fn</code>&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F7F;&#x7528; <a href="#res_sendFile">res.sendFile()</a> &#x6765;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">&apos;/report-12345.pdf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">&apos;/report-12345.pdf&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;report.pdf&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">&apos;/report-12345.pdf&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;report.pdf&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// &#x5904;&#x7406;&#x9519;&#x8BEF;&#xFF0C;&#x4F46;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x54CD;&#x5E94;&#x53EF;&#x4EE5;&#x88AB;&#x90E8;&#x5206;&#x53D1;&#x9001;&#xFF0C;&#x56E0;&#x6B64;&#x8BF7;&#x68C0;&#x67E5;  res.headersSent</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// decrement a download credit, etc.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_end"><a name="res_end" class="anchor-navigation-ex-anchor" href="#res_end"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.6. res.end([data] [, encoding]) </h3>
<p>&#x7ED3;&#x675F;&#x54CD;&#x5E94;&#x8FC7;&#x7A0B;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x5B9E;&#x9645;&#x4E0A;&#x6765;&#x81EA; Node &#x6838;&#x5FC3;,&#x7279;&#x522B;&#x662F;<a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback" target="_blank">http.ServerResponse &#x7684; response.end()&#x65B9;&#x6CD5;</a>&#x3002;</p>
<p>&#x7528;&#x6765;&#x5FEB;&#x901F;&#x7ED3;&#x675F;&#x54CD;&#x5E94;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x54CD;&#x5E94;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x8BF8;&#x5982; <a href="#res_send">res.send()</a>&#x548C; <a href="#res_json">res.json()</a> &#x8FD9;&#x6837;&#x7684;&#x65B9;&#x6CD5;&#x66FF;&#x4EE3;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_format"><a name="res_format" class="anchor-navigation-ex-anchor" href="#res_format"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.7. res.format(object) </h3>
<p>&#x5728;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x7684; <code>Accept</code> HTTP &#x5934;&#x4E0A;&#x6267;&#x884C; content-negotiation&#xFF0C;&#x5F53;&#x5B58;&#x5728;&#x65F6;&#x3002;&#x5B83;&#x4F7F;&#x7528; <code>req.accepts()</code> &#x6765;&#x4E3A;&#x8BF7;&#x6C42;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x6839;&#x636E;&#x5176; quality &#x503C;&#x6392;&#x5E8F;&#x7684;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A;&#x5934;&#xFF0C;&#x90A3;&#x4E48;&#x5C06;&#x8C03;&#x7528;&#x7B2C;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x3002;&#x5F53;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x54CD;&#x5E94;&#x4E3A; 406 &#x201C;Not Acceptable&#x201D;&#xFF0C;&#x6216;&#x8005;&#x8C03;&#x7528; <code>default</code> &#x56DE;&#x8C03;&#x3002;</p>
<p><code>Content-Type</code> &#x54CD;&#x5E94;&#x5934;&#x662F;&#x5728;&#x9009;&#x62E9;&#x56DE;&#x8C03;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BF8;&#x5982; <code>res.set()</code> &#x6216; <code>res.type()</code> &#x4E4B;&#x7C7B;&#x7684;&#x65B9;&#x6CD5;&#x5728;&#x56DE;&#x8C03;&#x4E2D;&#x4FEE;&#x6539;&#x5B83;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#xFF0C;&#x5F53; <code>Accept</code> &#x5934;&#x5B57;&#x6BB5;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; &#x201C;application/json&#x201D; &#x6216; &#x201C;<em>/json&#x201D; &#x65F6;&#xFF0C;&#x5C06;&#x4F7F;&#x7528; <code>{ &quot;message&quot;: &quot;hey&quot; }</code> &#x8FDB;&#x884C;&#x54CD;&#x5E94;&#xFF0C;(&#x7136;&#x800C;&#x5982;&#x679C;&#x5B83;&#x662F; &#x201C;</em>/*&#x201D;&#xFF0C;&#x54CD;&#x5E94;&#x5C06;&#x662F; &#x201C;hey&#x201D;&#xFF09;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&apos;text/plain&apos;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;hey&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token string">&apos;text/html&apos;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;&lt;p&gt;hey&lt;/p&gt;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token string">&apos;application/json&apos;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">&apos;hey&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token string">&apos;default&apos;</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// log the request and respond with 406</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">406</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Not Acceptable&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x9664;&#x4E86;&#x89C4;&#x8303;&#x5316;&#x7684; MIME &#x7C7B;&#x578B;&#x4E4B;&#x5916;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6620;&#x5C04;&#x5230;&#x8FD9;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x6269;&#x5C55;&#x540D;&#x6765;&#x5B9E;&#x73B0;&#x7A0D;&#x5FAE;&#x4E0D;&#x90A3;&#x4E48;&#x8BE6;&#x7EC6;&#x7684;&#x5B9E;&#x73B0;:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;hey&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  html<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;&lt;p&gt;hey&lt;/p&gt;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  json<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">&apos;hey&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_get"><a name="res_get" class="anchor-navigation-ex-anchor" href="#res_get"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.8. res.get(field) </h3>
<p>&#x8FD4;&#x56DE;&#x9760; <code>field</code> &#x6307;&#x5B9A;&#x7684; HTTP &#x54CD;&#x5E94;&#x5934;&#x3002;&#x5339;&#x914D;&#x4E0D;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// =&gt; &quot;text/plain&quot;</span>
</code></pre>
<h3 id="res_json"><a name="res_json" class="anchor-navigation-ex-anchor" href="#res_json"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.9. res.json([body]) </h3>
<p>&#x53D1;&#x9001;&#x4E00;&#x4E2A; JSON &#x54CD;&#x5E94;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0E;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x6216;&#x6570;&#x7EC4;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684; <code>res.send()</code> &#x76F8;&#x540C;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x5C06;&#x5176;&#x4ED6;&#x503C;&#x8F6C;&#x6362;&#x4E3A; JSON&#xFF0C;&#x4F8B;&#x5982; <code>null</code> &#x548C; <code>undefined</code>&#x3002;(&#x5C3D;&#x7BA1;&#x4ECE;&#x6280;&#x672F;&#x4E0A;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x4E0D;&#x662F;&#x6709;&#x6548;&#x7684;JSON)&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">&apos;tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&apos;message&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="res_jsonp"><a name="res_jsonp" class="anchor-navigation-ex-anchor" href="#res_jsonp"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.10. res.jsonp([body]) </h3>
<p>&#x4F7F;&#x7528; JSONP &#x652F;&#x6301;&#x53D1;&#x9001;&#x4E00;&#x4E2A; JSON &#x54CD;&#x5E94;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4E0E; <code>res.json()</code> &#x76F8;&#x540C;&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x652F;&#x6301; JSONP &#x56DE;&#x8C03;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; null</span>

res<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">&apos;tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; { &quot;user&quot;: &quot;tobi&quot; }</span>

res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&apos;message&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; { &quot;error&quot;: &quot;message&quot; }</span>
</code></pre>
<p>&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;JSONP &#x56DE;&#x8C03;&#x540D;&#x662F;&#x7B80;&#x5355;&#x7684; <code>callback</code>&#x3002;&#x4F7F;&#x7528; <a href="#app_settings-table">jsonp callback</a> &#x540D;&#x8BBE;&#x7F6E;&#x6765;&#x8986;&#x76D6;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x4EE3;&#x7801;&#x7684; JSONP &#x54CD;&#x5E94;&#x7684;&#x4E00;&#x4E9B;&#x793A;&#x4F8B;:</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// ?callback=foo</span>
res<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">&apos;tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; foo({ &quot;user&quot;: &quot;tobi&quot; })</span>

app<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;jsonp callback name&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;cb&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ?cb=foo</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&apos;message&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// =&gt; foo({ &quot;error&quot;: &quot;message&quot; })</span>
</code></pre>
<h3 id="res_links"><a name="res_links" class="anchor-navigation-ex-anchor" href="#res_links"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.11. res.links(links) </h3>
<p>&#x8FDE;&#x63A5;&#x63D0;&#x4F9B;&#x7684; <code>links</code> &#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4EE5;&#x586B;&#x5145;&#x54CD;&#x5E94;&#x7684; <code>Link</code> HTTP &#x5934;&#x5B57;&#x6BB5;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">links</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  next<span class="token punctuation">:</span> <span class="token string">&apos;http://api.example.com/users?page=2&apos;</span><span class="token punctuation">,</span>
  last<span class="token punctuation">:</span> <span class="token string">&apos;http://api.example.com/users?page=5&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>yields:</p>
<pre class="language-"><code>Link: &lt;http://api.example.com/users?page=2&gt;; rel=&quot;next&quot;,
      &lt;http://api.example.com/users?page=5&gt;; rel=&quot;last&quot;
</code></pre><h3 id="res_location"><a name="res_location" class="anchor-navigation-ex-anchor" href="#res_location"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.12. res.location(path) </h3>
<p>&#x5C06;&#x54CD;&#x5E94;&#x7684; <code>Location</code> HTTP &#x5934;&#x8BBE;&#x7F6E;&#x4E3A;&#x6307;&#x5B9A;&#x7684; <code>path</code> &#x53C2;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token string">&apos;/foo/bar&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token string">&apos;http://example.com&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">location</span><span class="token punctuation">(</span><span class="token string">&apos;back&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x201C;back&#x201D; &#x7684; <code>path</code> &#x503C;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x542B;&#x4E49;&#xFF0C;&#x5B83;&#x6307;&#x7684;&#x662F;&#x5728;&#x8BF7;&#x6C42;&#x7684; <code>Referer</code> &#x5934;&#x90E8;&#x4E2D;&#x6307;&#x5B9A;&#x7684; URL&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6307;&#x5B9A; <code>Referer</code> &#x5934;&#xFF0C;&#x5B83;&#x662F;&#x6307; &#x201C;/&#x201D;&#x3002;</p>
<blockquote>
<p><strong>[danger]</strong></p>
<p>Express &#x5C06;&#x6307;&#x5B9A;&#x7684; URL &#x5B57;&#x7B26;&#x4E32;&#x6309;&#x539F;&#x6837;&#x4F20;&#x9012;&#x7ED9; <code>Location</code> &#x5934;&#x4E2D;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x800C;&#x4E0D;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x9A8C;&#x8BC1;&#x6216;&#x64CD;&#x4F5C;&#xFF0C;&#x9664;&#x4E86; <code>back</code> &#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x6D4F;&#x89C8;&#x5668;&#x8D1F;&#x8D23;&#x4ECE;&#x5F53;&#x524D; URL &#x6216;&#x5F15;&#x7528; URL &#x4E2D;&#x6D3E;&#x751F;&#x51FA;&#x9884;&#x671F;&#x7684; URL&#xFF0C;&#x4EE5;&#x53CA;&#x5728; <code>Location</code> &#x5934;&#x4E2D;&#x6307;&#x5B9A;&#x7684; URL&#xFF1B;&#x7136;&#x540E;&#x76F8;&#x5E94;&#x5730;&#x91CD;&#x5B9A;&#x5411;&#x7528;&#x6237;&#x3002;</p>
</blockquote>
<h3 id="res_redirect"><a name="res_redirect" class="anchor-navigation-ex-anchor" href="#res_redirect"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.13. res.redirect([status,] path) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684; <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP &#x72B6;&#x6001;&#x7801;</a> <code>status</code>&#xFF0C;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x6D3E;&#x751F;&#x81EA;&#x6307;&#x5B9A;&#x7684; <code>path</code> &#x7684; URL&#x3002; &#x5982;&#x679C;&#x60A8;&#x4E0D;&#x6307;&#x5B9A; <code>status</code>&#xFF0C;&#x5219;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x9ED8;&#x8BA4;&#x4E3A; &#x201C;302 &#x201C;Found&#x201D;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/foo/bar&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;http://example.com&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span> <span class="token string">&apos;http://example.com&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;../login&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x91CD;&#x5B9A;&#x5411;&#x53EF;&#x4EE5;&#x662F;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5176;&#x4ED6;&#x7F51;&#x7AD9;&#x7684;&#x5B8C;&#x5168;&#x9650;&#x5B9A;&#x7684; URL&#xFF1A;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;http://google.com&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x91CD;&#x5B9A;&#x5411;&#x53EF;&#x4EE5;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x4E3B;&#x673A;&#x540D;&#x7684;&#x6839;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F4D;&#x4E8E; <code>http://example.com/admin/post/new</code>&#xFF0C;&#x5219;&#x4EE5;&#x4E0B;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x5230; URL <code>http://example.com/admin</code>&#xFF1A;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;/admin&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x91CD;&#x5B9A;&#x5411;&#x53EF;&#x4EE5;&#x76F8;&#x5BF9;&#x4E8E;&#x5F53;&#x524D; URL &#x3002;&#x4F8B;&#x5982;,&#x4ECE; <code>http://example.com/blog/admin/</code>(&#x6CE8;&#x610F;&#x5C3E;&#x90E8;&#x7684;&#x659C;&#x6760;),&#x4EE5;&#x4E0B;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x8BE5; URL <code>http://example.com/blog/admin/post/new</code>&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;post/new&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4ECE; <code>http://example.com/blog/admin</code> &#x91CD;&#x5B9A;&#x5411;&#x5230; <code>post/new</code>&#xFF08;&#x6CA1;&#x6709;&#x4F7F;&#x7528;&#x659C;&#x6760;&#xFF09;&#xFF0C;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x5230; <code>http://example.com/blog/post/new</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x60A8;&#x53D1;&#x73B0;&#x4E0A;&#x9762;&#x7684;&#x884C;&#x4E3A;&#x4EE4;&#x4EBA;&#x56F0;&#x60D1;&#xFF0C;&#x8BF7;&#x5C06;&#x8DEF;&#x5F84;&#x6BB5;&#x770B;&#x4F5C;&#x76EE;&#x5F55;(&#x5E26;&#x6709;&#x659C;&#x6760;)&#x548C;&#x6587;&#x4EF6;&#xFF0C;&#x5B83;&#x5C06;&#x5F00;&#x59CB;&#x6709;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x91CD;&#x5B9A;&#x5411;&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5728; <code>http://example.com/admin/post/new</code> &#x4E0A;&#xFF0C;&#x4E0B;&#x9762;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x5230; <code>http://example.com/admin/post</code>:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;..&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>back</code> &#x91CD;&#x5B9A;&#x5411;&#x5C06;&#x91CD;&#x5B9A;&#x5411;&#x8BF7;&#x6C42;&#x56DE;&#x9000;&#x5230; <a href="http://en.wikipedia.org/wiki/HTTP_referer" target="_blank">referer</a>&#xFF0C; &#x5F53; referer &#x7F3A;&#x5931;&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; <code>/</code>&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&apos;back&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_render"><a name="res_render" class="anchor-navigation-ex-anchor" href="#res_render"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.14. res.render(view [, locals] [, callback]) </h3>
<p>&#x6E32;&#x67D3;&#x4E00;&#x4E2A; <code>view</code> &#x5E76;&#x53D1;&#x9001;&#x9009;&#x7136;&#x540E;&#x7684; HTML &#x5B57;&#x7B26;&#x4E32;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x53EF;&#x9009;&#x7684;&#x53C2;&#x6570;&#x6709;&#xFF1A;</p>
<ul>
<li><code>locals</code>&#xFF0C; &#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x7684;&#x5C5E;&#x6027;&#x4E3A;&#x89C6;&#x56FE;&#x5B9A;&#x4E49;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x3002;</li>
<li><code>callback</code>&#xFF0C;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x8FD4;&#x56DE;&#x53EF;&#x80FD;&#x7684;&#x9519;&#x8BEF;&#x548C;&#x6E32;&#x67D3;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F46;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x81EA;&#x52A8;&#x54CD;&#x5E94;&#x3002;&#x5F53;&#x51FA;&#x73B0;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x5728;&#x5185;&#x90E8;&#x8C03;&#x7528; next(err)&#x3002;</li>
</ul>
<blockquote>
<p><strong>[warning]</strong> &#x672C;&#x5730;&#x53D8;&#x91CF; <code>cache</code> &#x5C06;&#x542F;&#x7528;&#x89C6;&#x56FE;&#x7F13;&#x5B58;&#x3002;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code>&#xFF0C;&#x4EE5;&#x5728;&#x5F00;&#x53D1;&#x4E2D;&#x7F13;&#x5B58;&#x89C6;&#x56FE;&#xFF1B;&#x5728;&#x751F;&#x4EA7;&#x4E2D;&#xFF0C;&#x89C6;&#x56FE;&#x7F13;&#x5B58;&#x662F;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x7684;&#x3002;</p>
</blockquote>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x53D1;&#x9001;&#x6E32;&#x67D3;&#x597D;&#x7684;&#x89C6;&#x56FE;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;</span>
res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x6E32;&#x67D3;&#x7684; HTML &#x5B57;&#x7B26;&#x4E32;&#x88AB;&#x663E;&#x793A;&#x5730;&#x53D1;&#x9001;</span>
res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x5C06;&#x4E00;&#x4E2A;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x4F20;&#x9012;&#x7ED9;&#x89C6;&#x56FE;</span>
res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;user&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_send"><a name="res_send" class="anchor-navigation-ex-anchor" href="#res_send"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.15. res.send([body]) </h3>
<p>&#x53D1;&#x9001; HTTP &#x54CD;&#x5E94;&#x3002;</p>
<p><code>body</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x4E00;&#x4E2A; <code>Buffer</code> &#x5BF9;&#x8C61;&#xFF0C;<code>String</code>&#xFF0C;Object&#xFF0C;&#x6216;&#x8005;&#x4E00;&#x4E2A; <code>Array</code>&#x3002;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">&apos;whoop&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> some<span class="token punctuation">:</span> <span class="token string">&apos;json&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;&lt;p&gt;some html&lt;/p&gt;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Sorry, we cannot find that!&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&apos;something blew up&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6B64;&#x65B9;&#x6CD5;&#x4E3A;&#x7B80;&#x5355;&#x7684;&#x975E;&#x6D41;&#x54CD;&#x5E94;&#x6267;&#x884C;&#x8BB8;&#x591A;&#x6709;&#x7528;&#x7684;&#x4EFB;&#x52A1;: &#x4F8B;&#x5982;&#xFF0C;&#x5B83;&#x81EA;&#x52A8;&#x5206;&#x914D; <code>Content-Length</code> HTTP &#x54CD;&#x5E94;&#x5934;&#x5B57;&#x6BB5;(&#x9664;&#x975E;&#x9884;&#x5148;&#x5B9A;&#x4E49;)&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x81EA;&#x52A8;&#x7684; HEAD &#x548C; HTTP &#x7F13;&#x5B58;&#x7684;&#x65B0;&#x9C9C;&#xFF08;freshness&#xFF09;&#x652F;&#x6301;&#x3002;</p>
<p>&#x5F53;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A; <code>Buffer</code> &#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06; <code>Content-Type</code> &#x7684;&#x54CD;&#x5E94;&#x5934;&#x5B57;&#x6BB5;&#x8BBE;&#x7F6E;&#x4E3A; &#x201C;application/octet-stream&#x201D;&#xFF0C;&#x9664;&#x975E;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">&apos;&lt;p&gt;some html&lt;/p&gt;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5F53;&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E2A; <code>String</code>&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;&#x8BBE;&#x7F6E; <code>Content-Type</code> &#x4E3A; &#x201C;text/html&#x201D;:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;&lt;p&gt;some html&lt;/p&gt;&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When the parameter is an <code>Array</code> or <code>Object</code>, Express responds with the JSON representation:</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">:</span> <span class="token string">&apos;tobi&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="ressendfilepath--options--fn"><a name="ressendfilepath--options--fn" class="anchor-navigation-ex-anchor" href="#ressendfilepath--options--fn"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.16. res.sendFile(path [, options] [, fn])</h3>
<blockquote>
<p><strong>[success]</strong> <code>res.sendFile()</code> &#x4ECE; Express v4.8.0 &#x5F00;&#x59CB;&#x88AB;&#x652F;&#x6301;&#x3002;</p>
</blockquote>
<p>&#x5728;&#x7ED9;&#x5B9A;&#x7684; <code>path</code> &#x4E0A;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x3002;&#x6839;&#x636E;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x6269;&#x5C55;&#x8BBE;&#x7F6E; <code>Content-Type</code> &#x54CD;&#x5E94; HTTP &#x5934;&#x5B57;&#x6BB5;&#x3002;&#x9664;&#x975E;&#x5728;options&#x5BF9;&#x8C61;&#x4E2D;&#x8BBE;&#x7F6E; <code>root</code> &#x9009;&#x9879;&#xFF0C;&#x5426;&#x5219;  <code>path</code> &#x5FC5;&#x987B;&#x662F;&#x6587;&#x4EF6;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</p>
<p><code>options</code> &#x5BF9;&#x8C61;&#x7684;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x5217;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x8868;&#x4E2D;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>&#x9ED8;&#x8BA4;&#x503C;</th>
<th>&#x53EF;&#x7528;&#x6027;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>maxAge</code></td>
<td>&#x4EE5;<a href="https://www.npmjs.org/package/ms" target="_blank">&#x6BEB;&#x79D2;</a>&#x6216;&#x5B57;&#x7B26;&#x4E32;&#x683C;&#x5F0F;&#x8BBE;&#x7F6E; <code>Cache-Control</code> &#x5934;&#x7684; max-age &#x5C5E;&#x6027;</td>
<td>0</td>
<td>-</td>
</tr>
<tr>
<td><code>root</code></td>
<td>&#x76F8;&#x5BF9;&#x6587;&#x4EF6;&#x540D;&#x7684;&#x6839;&#x76EE;&#x5F55;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><code>lastModified</code></td>
<td>&#x5C06; <code>Last-Modified</code> &#x5934;&#x8BBE;&#x7F6E;&#x4E3A; OS &#x4E0A;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x540E;&#x4FEE;&#x6539;&#x65E5;&#x671F;&#x3002; &#x8BBE;&#x7F6E; <code>false</code> &#x6765;&#x7981;&#x7528;&#x5B83;&#x3002;</td>
<td><code>true</code>&#xFF0C;&#x542F;&#x7528;</td>
<td>4.9.0+</td>
</tr>
<tr>
<td><code>headers</code></td>
<td>Object</td>
<td>&#x5305;&#x542B; HTTP &#x5934;&#x6587;&#x4EF6;&#x4EE5;&#x670D;&#x52A1;&#x4E8E;&#x6587;&#x4EF6;&#x3002;containing HTTP headers to serve with the file.</td>
<td>-</td>
</tr>
<tr>
<td><code>dotfiles</code></td>
<td>&#x7528;&#x4E8E;serving dotfiles &#x7684;&#x9009;&#x9879;&#x3002;&#x53EF;&#x80FD;&#x7684;&#x503C;&#x6709; &#x201C;allow&#x201D;, &#x201C;deny&#x201D;, &#x201C;ignore&#x201D;.</td>
<td>&#x201C;ignore&#x201D;</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>&#x5F53;&#x4F20;&#x8F93;&#x5B8C;&#x6210;&#x6216;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x56DE;&#x8C03;&#x51FD;&#x6570; <code>fn(err)</code>&#x3002;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5E76;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x7ED3;&#x675F;&#x8BF7;&#x6C42;-&#x54CD;&#x5E94;&#x5FAA;&#x73AF;&#xFF0C;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x4E0B;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#xFF0C;&#x6765;&#x663E;&#x5F0F;&#x5730;&#x5904;&#x7406;&#x54CD;&#x5E94;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x4F7F;&#x7528;&#x5E26;&#x6240;&#x6709;&#x53C2;&#x6570;&#x7684; <code>res.sendFile</code> &#x4F8B;&#x5B50;&#xFF1A;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/file/:name&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">&apos;/public/&apos;</span><span class="token punctuation">,</span>
    dotfiles<span class="token punctuation">:</span> <span class="token string">&apos;deny&apos;</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&apos;x-timestamp&apos;</span><span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&apos;x-sent&apos;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Sent:&apos;</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><code>res.sendFile</code> &#x63D0;&#x4F9B;&#x4E86;&#x5BF9;&#x6587;&#x4EF6;&#x670D;&#x52A1;&#x7684;&#x7EC6;&#x7C92;&#x5EA6;&#x652F;&#x6301;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x6240;&#x793A;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:uid/photos/:file&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> uid <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>uid
    <span class="token punctuation">,</span> file <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>file<span class="token punctuation">;</span>

  req<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">mayViewFilesFrom</span><span class="token punctuation">(</span>uid<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>yes<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>yes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&apos;/uploads/&apos;</span> <span class="token operator">+</span> uid <span class="token operator">+</span> <span class="token string">&apos;/&apos;</span> <span class="token operator">+</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Sorry! you cant see that.&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x66F4;&#x591A;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x6709;&#x95EE;&#x9898;&#x6216;&#x62C5;&#x5FC3;&#xFF0C;&#x8BF7;&#x53C2;&#x9605; send&#x3002;</p>
<h3 id="res_sendStatus"><a name="res_sendStatus" class="anchor-navigation-ex-anchor" href="#res_sendStatus"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.17. res.sendStatus(statusCode) </h3>
<p>&#x8BBE;&#x7F6E;&#x54CD;&#x5E94; HTTP &#x72B6;&#x6001;&#x7801;&#x4E3A; <code>statusCode</code> &#x5E76;&#x53D1;&#x9001;&#x5B83;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x8868;&#x793A;&#x4F5C;&#x4E3A;&#x54CD;&#x5E94;&#x4E3B;&#x4F53;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x7B49;&#x4EF7;&#x4E8E; res.status(200).send(&apos;OK&apos;)</span>
res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x7B49;&#x4EF7;&#x4E8E; res.status(403).send(&apos;Forbidden&apos;)</span>
res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x7B49;&#x4EF7;&#x4E8E; res.status(404).send(&apos;Not Found&apos;)</span>
res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x7B49;&#x4EF7;&#x4E8E; res.status(500).send(&apos;Internal Server Error&apos;)</span>
</code></pre>
<p>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;&#x4E0D;&#x53D7;&#x652F;&#x6301;&#x7684;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#xFF0C;&#x90A3;&#x4E48; HTTP &#x72B6;&#x6001;&#x4ECD;&#x7136;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>statusCode</code>&#xFF0C;&#x800C;&#x4EE3;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x7248;&#x672C;&#x4F1A;&#x4F5C;&#x4E3A;&#x54CD;&#x5E94;&#x4F53;&#x53D1;&#x9001;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &#x7B49;&#x4EF7;&#x4E8E; res.status(2000).send(&apos;2000&apos;)</span>
</code></pre>
<p><a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes" target="_blank">&#x66F4;&#x591A;&#x5173;&#x4E8E; HTTP &#x72B6;&#x6001;&#x7801;</a></p>
<h3 id="res_set"><a name="res_set" class="anchor-navigation-ex-anchor" href="#res_set"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.18. res.set(field [, value]) </h3>
<p>&#x8BBE;&#x7F6E;&#x60F3;&#x7528;&#x7684; HTTP &#x5934; <code>field</code> &#x4E3A; `value&#x3002;&#x4E3A;&#x4E86;&#x4E00;&#x6B21;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;text/plain&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&apos;Content-Type&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;text/plain&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;Content-Length&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;123&apos;</span><span class="token punctuation">,</span>
  <span class="token string">&apos;ETag&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;12345&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x7B49;&#x4EF7;&#x4E8E; <code>res.header(field [, value])</code>.</p>
<h3 id="res_status"><a name="res_status" class="anchor-navigation-ex-anchor" href="#res_status"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.19. res.status(code) </h3>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6765;&#x4E3A;&#x54CD;&#x5E94;&#x8BBE;&#x7F6E; HTTP &#x72B6;&#x6001;&#x3002;&#x5B83;&#x662F; Node &#x7684; <a href="http://nodejs.org/api/http.html#http_response_statuscode" target="_blank">response.statusCode</a> &#x7684;&#x4E00;&#x4E2A;&#x53EF;&#x94FE;&#x63A5;&#x7684;&#x522B;&#x540D;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Bad Request&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span><span class="token string">&apos;/absolute/path/to/404.png&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="res_type"><a name="res_type" class="anchor-navigation-ex-anchor" href="#res_type"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.20. res.type(type) </h3>
<p>&#x6839;&#x636E; <a href="https://github.com/broofa/node-mime#mimelookuppath" target="_blank"> mime.lookup()</a> &#x4E3A;&#x6307;&#x5B9A;&#x7684; <code>type</code> &#x786E;&#x5B9A; MIME &#x7C7B;&#x578B;&#xFF0C;&#x8BE5; MIME &#x7C7B;&#x578B;&#x88AB;&#x7528;&#x6765;&#x8BBE;&#x7F6E; <code>Content-Type</code> HTTP &#x5934;&#x3002;&#x5982;&#x679C; <code>type</code> &#x5305;&#x542B; &#x201C;/&#x201D; &#x5B57;&#x7B26;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x8BBE;&#x7F6E; <code>Content-Type</code> &#x4E3A; <code>type</code>&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&apos;.html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment" spellcheck="true">// =&gt; &apos;text/html&apos;</span>
res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&apos;html&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// =&gt; &apos;text/html&apos;</span>
res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&apos;json&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment" spellcheck="true">// =&gt; &apos;application/json&apos;</span>
res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&apos;application/json&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// =&gt; &apos;application/json&apos;</span>
res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">&apos;png&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// =&gt; image/png:</span>
</code></pre>
<h3 id="res_vary"><a name="res_vary" class="anchor-navigation-ex-anchor" href="#res_vary"><i class="fa fa-link" aria-hidden="true"></i></a>4.2.21. res.vary(field) </h3>
<p>&#x6DFB;&#x52A0;&#x8FD9;&#x4E2A; <code>field</code> &#x5230; <code>Vary</code> &#x54CD;&#x5E94;&#x5934;,&#x5982;&#x679C;&#x5B83;&#x4E0D;&#x5728;&#x90A3;&#x91CC;&#x3002;</p>
<pre class="language-"><code class="lang-js">res<span class="token punctuation">.</span><span class="token function">vary</span><span class="token punctuation">(</span><span class="token string">&apos;User-Agent&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&apos;docs&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h1 id="router"><a name="router" class="anchor-navigation-ex-anchor" href="#router"><i class="fa fa-link" aria-hidden="true"></i></a>5. Router </h1>
<p><code>router</code> &#x5BF9;&#x8C61;&#x662F;&#x4E2D;&#x95F4;&#x4EF6;&#x548C;&#x8DEF;&#x7531;&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x5B9E;&#x4F8B;&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x628A;&#x5B83;&#x770B;&#x4F5C;&#x662F;&#x4E00;&#x4E2A;&#x201C;&#x8FF7;&#x4F60;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x201D;&#xFF0C;&#x5B83;&#x53EA;&#x80FD;&#x591F;&#x6267;&#x884C;&#x4E2D;&#x95F4;&#x4EF6;&#x548C;&#x8DEF;&#x7531;&#x51FD;&#x6570;&#x3002;&#x6BCF;&#x4E00;&#x4E2A; Express &#x5E94;&#x7528;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x5185;&#x7F6E;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8DEF;&#x7531;&#x5668;&#x3002;</p>
<p>&#x8DEF;&#x7531;&#x5668;&#x7684;&#x884C;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E2D;&#x95F4;&#x4EF6;&#x672C;&#x8EAB;&#xFF0C;&#x56E0;&#x6B64;&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x4F5C;&#x4E3A; <a href="#app_use">app.use()</a> &#x7684;&#x53C2;&#x6570;&#x4F7F;&#x7528;&#x6216;&#x4F5C;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x7684; <a href="#router_use">use()</a> &#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x3002;</p>
<p>&#x9876;&#x7EA7; <code>express</code> &#x5BF9;&#x8C61;&#x6709;&#x4E00;&#x4E2A; <code>Router()</code> &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; <code>router</code> &#x5BF9;&#x8C61;&#x3002;</p>
<h2 id="routeroptions"><a name="routeroptions" class="anchor-navigation-ex-anchor" href="#routeroptions"><i class="fa fa-link" aria-hidden="true"></i></a>5.1. Router([options])</h2>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53EF;&#x9009;&#x7684; <code>options</code> &#x53C2;&#x6570;&#x6307;&#x5B9A;&#x4E86;&#x8DEF;&#x7531;&#x5668;&#x7684;&#x884C;&#x4E3A;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x5C5E;&#x6027;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>&#x9ED8;&#x8BA4;&#x503C;</th>
<th>&#x6709;&#x6548;&#x6027;</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>caseSensitive</code></td>
<td>&#x542F;&#x7528;&#x533A;&#x5206;&#x5927;&#x5C0F;&#x5199;</td>
<td>&#x9ED8;&#x8BA4;&#x662F;&#x7981;&#x7528;&#x7684;&#xFF0C;&#x540C;&#x7B49;&#x5BF9;&#x5F85; &#x201C;/Foo&#x201D; &#x548C; &#x201C;/foo&#x201D;&#x3002;</td>
<td></td>
</tr>
<tr>
<td><code>mergeParams</code></td>
<td>&#x4FDD;&#x7559;&#x6765;&#x81EA;&#x7236;&#x8DEF;&#x7531;&#x5668;&#x7684; <code>req.params</code> &#x503C;&#x3002;&#x5982;&#x679C;&#x7236;&#x8DEF;&#x7531;&#x5668;&#x548C;&#x5B50;&#x8DEF;&#x7531;&#x5668;&#x7684; params &#x540D;&#x5B57;&#x6709;&#x51B2;&#x7A81;&#xFF0C;&#x5B50;&#x8DEF;&#x7531;&#x7684;&#x5C31;&#x4F1A;&#x4F18;&#x5148;&#x8003;&#x8651;&#x3002;</td>
<td><code>false</code></td>
<td>4.5.0+</td>
</tr>
<tr>
<td><code>strict</code></td>
<td>&#x4F7F;&#x7528;&#x4E25;&#x683C;&#x8DEF;&#x7531;</td>
<td>&#x9ED8;&#x8BA4;&#x662F;&#x7981;&#x7528;&#x7684;&#xFF0C;&#x8DEF;&#x7531;&#x5668;&#x540C;&#x7B49;&#x5BF9;&#x5F85; &#x201C;/foo&#x201D; &#x548C; &#x201C;/foo/&#x201D;&#x3002;</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x5C06;&#x4E2D;&#x95F4;&#x4EF6;&#x548C; HTTP &#x65B9;&#x6CD5;&#x8DEF;&#x7531;(&#x4F8B;&#x5982; <code>get</code>&#x3001;<code>put</code>&#x3001;<code>post</code>&#x7B49;&#x7B49;)&#x6DFB;&#x52A0;&#x5230; <code>router</code>&#xFF0C;&#x5C31;&#x50CF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x6837;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x4E3A;&#x4EFB;&#x4F55;&#x8BF7;&#x6C42;&#x88AB;&#x4F20;&#x9012;&#x5230;&#x8FD9;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x8C03;&#x7528;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// .. some logic here .. like any other middleware</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x5C06;&#x5904;&#x7406;&#x4EFB;&#x4F55;&#x4EE5; /events &#x7ED3;&#x675F;&#x7684;&#x8BF7;&#x6C42;</span>
<span class="token comment" spellcheck="true">// &#x53D6;&#x51B3;&#x4E8E;&#x8DEF;&#x7531;&#x5668;&#x5728;&#x54EA;&#x91CC;&#x88AB; &#x201C;use()&#x201D;</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/events&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x7136;&#x540E;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x4E3A;&#x7279;&#x5B9A;&#x7684;&#x6839; URL &#x4F7F;&#x7528;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x4F60;&#x7684;&#x8DEF;&#x7531;&#x5206;&#x6210;&#x6587;&#x4EF6;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x8FF7;&#x4F60;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token comment" spellcheck="true">// &#x53EA;&#x6709; /calendar/* &#x7684;&#x8BF7;&#x6C42;&#x5C06;&#x53D1;&#x9001;&#x8FD9;&#x4E2A;&#x201C;router&#x201D;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/calendar&apos;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="&#x65B9;&#x6CD5;_3"><a name="&#x65B9;&#x6CD5;_3" class="anchor-navigation-ex-anchor" href="#&#x65B9;&#x6CD5;_3"><i class="fa fa-link" aria-hidden="true"></i></a>5.2. &#x65B9;&#x6CD5;</h2>
<h3 id="router_all"><a name="router_all" class="anchor-navigation-ex-anchor" href="#router_all"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.1. router.all(path, [callback, ...] callback) </h3>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x51FD;&#x6570;&#x5C31;&#x50CF; <code>router.METHOD()</code> &#x65B9;&#x6CD5;&#xFF0C;&#x9664;&#x4E86;&#x5B83;&#x5339;&#x914D;&#x6240;&#x6709;&#x7684; HTTP &#x52A8;&#x8BCD;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5BF9;&#x4E8E;&#x6620;&#x5C04;&#x7279;&#x5B9A;&#x8DEF;&#x5F84;&#x524D;&#x7F00;&#x6216;&#x4EFB;&#x610F;&#x5339;&#x914D;&#x7684;&#x201C;&#x5168;&#x5C40;&#x201D;&#x903B;&#x8F91;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x60A8;&#x5C06;&#x4EE5;&#x4E0B;&#x8DEF;&#x7531;&#x653E;&#x7F6E;&#x5728;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x8DEF;&#x7531;&#x5B9A;&#x4E49;&#x7684;&#x9876;&#x90E8;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x8981;&#x6C42;&#x4ECE;&#x8BE5;&#x70B9;&#x5F00;&#x59CB;&#x7684;&#x6240;&#x6709;&#x8DEF;&#x7531;&#x90FD;&#x9700;&#x8981;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x5E76;&#x81EA;&#x52A8;&#x52A0;&#x8F7D;&#x7528;&#x6237;&#x3002;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x4E0D;&#x9700;&#x8981;&#x4F5C;&#x4E3A;&#x7AEF;&#x70B9;; <code>loadUser</code> &#x53EF;&#x4EE5;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; <code>next()</code> &#x7EE7;&#x7EED;&#x5339;&#x914D;&#x540E;&#x7EED;&#x8DEF;&#x7EBF;&#x3002;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6216;&#x76F8;&#x5F53;&#x4E8E;:</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;*&apos;</span><span class="token punctuation">,</span> loadUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x662F;&#x767D;&#x8272;&#x5217;&#x51FA;&#x7684;&#x201C;&#x5168;&#x5C40;&#x201D;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x4F8B;&#x5B50;&#x4E0E;&#x4E4B;&#x524D;&#x7684;&#x5F88;&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x5B83;&#x53EA;&#x9650;&#x5236;&#x4E86;&#x524D;&#x7F00;&#x4E3A;&#x201C;/api&#x201D;&#x7684;&#x8DEF;&#x5F84;:</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&apos;/api/*&apos;</span><span class="token punctuation">,</span> requireAuthentication<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="router_METHOD"><a name="router_METHOD" class="anchor-navigation-ex-anchor" href="#router_METHOD"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.2. router.METHOD(path, [callback, ...] callback) </h3>
<p>&#x5728; Express &#x79CD;&#xFF0C;<code>router.METHOD()</code> &#x65B9;&#x6CD5;&#x63D0;&#x4F9B;&#x8DEF;&#x7531;&#x529F;&#x80FD;&#xFF0C;&#x5176;&#x4E2D; METHOD &#x662F; HTTP &#x65B9;&#x6CD5;&#x4E4B;&#x4E00;&#xFF0C;&#x5982; GET&#x3001;PUT&#x3001;POST&#x7B49;&#xFF0C;&#x4EE5;&#x5C0F;&#x5199;&#x5F62;&#x5F0F;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x65B9;&#x6CD5;&#x662F;<code>router.get()</code>&#x3001;<code>router.post()</code>&#x3001;<code>router.put()</code> &#x7B49;&#x7B49;&#x3002;</p>
<p>&#x60A8;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x591A;&#x4E2A;&#x56DE;&#x8C03;&#xFF0C;&#x5E76;&#x4E14;&#x6240;&#x6709;&#x7684;&#x56DE;&#x8C03;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x884C;&#x4E3A;&#x5C31;&#x50CF;&#x4E2D;&#x95F4;&#x4EF6;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <code>next(&apos;route&apos;)</code> &#x7ED5;&#x8FC7;&#x4F59;&#x4E0B;&#x7684;&#x8DEF;&#x7531;&#x56DE;&#x8C03;(s)&#x3002;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6B64;&#x673A;&#x5236;&#x5728;&#x8DEF;&#x7531;&#x4E0A;&#x6267;&#x884C;&#x524D;&#x7F6E;&#x6761;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x7EE7;&#x7EED;&#x5339;&#x914D;&#x8DEF;&#x7531;&#x65F6;&#x5C06;&#x63A7;&#x5236;&#x6743;&#x4F20;&#x9012;&#x7ED9;&#x540E;&#x7EED;&#x8DEF;&#x7531;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x7247;&#x6BB5;&#x8BF4;&#x660E;&#x4E86;&#x53EF;&#x80FD;&#x7684;&#x6700;&#x7B80;&#x5355;&#x7684;&#x8DEF;&#x7531;&#x5B9A;&#x4E49;&#x3002;Express &#x5C06;&#x8DEF;&#x5F84;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x4E3A;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x7528;&#x4E8E;&#x5185;&#x90E8;&#x5339;&#x914D;&#x4F20;&#x5165;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x5728;&#x6267;&#x884C;&#x8FD9;&#x4E9B;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4F8B;&#x5982; &#x201C;GET/&#x201D; &#x4F1A;&#x5339;&#x914D;&#x4EE5;&#x4E0B;&#x8DEF;&#x7EBF;&#xFF0C;&#x201C;GET/?name=tobi&#x201D;&#x3002;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;hello world&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x4F60;&#x6709;&#x975E;&#x5E38;&#x5177;&#x4F53;&#x7684;&#x7EA6;&#x675F;&#xFF0C;&#x60A8;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x6709;&#x7528;&#x7684;&#x8868;&#x8FBE;&#xFF0C;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x5C06;&#x5339;&#x914D; &#x201C;GET /commits/71dbb9c&#x201D; &#x4EE5;&#x53CA; &#x201C;GET /commits/71dbb9c..4c084f9&#x201D;&#x3002;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token regex">/^\/commits\/(\w+)(?:\.\.(\w+))?$/</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token keyword">from</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> to <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&apos;HEAD&apos;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;commit range &apos;</span> <span class="token operator">+</span> <span class="token keyword">from</span> <span class="token operator">+</span> <span class="token string">&apos;..&apos;</span> <span class="token operator">+</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="router_param"><a name="router_param" class="anchor-navigation-ex-anchor" href="#router_param"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.3. router.param([name,] callback) </h3>
<p>&#x4E3A;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x5176;&#x4E2D; <code>name</code> &#x662F;&#x53C2;&#x6570;&#x7684;&#x540D;&#x79F0;&#x6216;&#x5B83;&#x4EEC;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x800C; <code>callback</code> &#x662F;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x662F;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;&#x3001;&#x54CD;&#x5E94;&#x5BF9;&#x8C61;&#x3001;&#x4E0B;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x7684;&#x503C;&#x90FD;&#x662F;&#x8FD9;&#x4E2A;&#x987A;&#x5E8F;&#x3002;&#x300E;&#x8BD1;&#x8005;&#x6CE8;&#xFF1A;&#x300F;<code>callback(req, res, next)</code>&#x3002;</p>
<p>&#x5982;&#x679C;&#x540D;&#x79F0;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x56DE;&#x8C03;&#x89E6;&#x53D1;&#x5668;&#x5C06;&#x5728;&#x58F0;&#x660E;&#x7684;&#x6BCF;&#x4E2A;&#x53C2;&#x6570;&#x4E2D;&#x6CE8;&#x518C;&#xFF0C;&#x4EE5;&#x58F0;&#x660E;&#x5B83;&#x4EEC;&#x7684;&#x987A;&#x5E8F;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x58F0;&#x660E;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x9664;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4E4B;&#x5916;&#xFF0C;&#x56DE;&#x8C03;&#x4E2D;&#x7684; <code>next</code> &#x8C03;&#x7528;&#x5C06;&#x8C03;&#x7528;&#x4E0B;&#x4E00;&#x4E2A;&#x58F0;&#x660E;&#x53C2;&#x6570;&#x7684;&#x56DE;&#x8C03;&#x3002;&#x5BF9;&#x4E8E;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5BF9; <code>next</code> &#x7684;&#x8C03;&#x7528;&#x5C06;&#x8C03;&#x7528;&#x5F53;&#x524D;&#x6B63;&#x5728;&#x5904;&#x7406;&#x7684;&#x8DEF;&#x7531;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x5C31;&#x50CF;&#x5982;&#x679C;&#x540D;&#x79F0;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#x4E00;&#x6837;&#x3002;</p>
<blockquote>
<p><strong>[info] &#x8DEF;&#x7531;&#x53C2;&#x6570;&#xFF08;route parameters&#xFF09;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</strong></p>
<p>app.get(&apos;/user/:id&apos;) &#x4E2D;&#xFF0C;&#x5339;&#x914D;&#x5230;&#x7684; <code>id</code> &#x5C31;&#x662F;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x3002;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x4E2D;&#x6709;&#x591A;&#x4E2A;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#xFF0C;&#x5982; app.get(&apos;/user/:id/:user&apos;)&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x4E3A;&#x8FD9;&#x4E9B;&#x5728; <code>name</code> &#x6216;&#x8005; <code>[name]</code> &#x6570;&#x7EC4;&#x4E2D;&#x5339;&#x914D;&#x5230;&#x7684;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x56DE;&#x8C03;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x4E00;&#x65E6;&#x5339;&#x914D;&#x5230;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#xFF0C;&#x5219;&#x4E3A;&#x8FD9;&#x4E9B;&#x5339;&#x914D;&#x5230;&#x7684;&#x6BCF;&#x4E2A;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x3002;</p>
</blockquote>
<p>&#x4F8B;&#x5982;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x51FA;&#x73B0;&#x5728;&#x8DEF;&#x7531;&#x8DEF;&#x5F84;&#x65F6;&#xFF0C;&#x60A8;&#x53EF;&#x80FD;&#x4F1A;&#x6620;&#x5C04;&#x7528;&#x6237;&#x52A0;&#x8F7D;&#x903B;&#x8F91;&#xFF0C;&#x4EE5;&#x81EA;&#x52A8;&#x63D0;&#x4F9B; <code>req.user</code> &#x5230;&#x8DEF;&#x7531;&#xFF0C;&#x6216;&#x8005;&#x5728;&#x53C2;&#x6570;&#x8F93;&#x5165;&#x4E0A;&#x6267;&#x884C;&#x9A8C;&#x8BC1;&#x3002;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;user&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">// &#x5C1D;&#x8BD5;&#x4ECE; User &#x6A21;&#x5757;&#x83B7;&#x53D6; user &#x7EC6;&#x8282;&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x9644;&#x52A0;&#x5230;&#x8BF7;&#x6C42;&#x5BF9;&#x8C61;</span>
  User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span>user <span class="token operator">=</span> user<span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;failed to load user&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x5728;&#x5B9A;&#x4E49;&#x5B83;&#x4EEC;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x4E0A;&#x662F;&#x672C;&#x5730;&#x7684;&#x3002;&#x5B83;&#x4EEC;&#x4E0D;&#x662F;&#x7531;&#x5B89;&#x88C5;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6216;&#x8DEF;&#x7531;&#x5668;&#x7EE7;&#x627F;&#x7684;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5728;&#x8DEF;&#x7531;&#x5668;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x53EA;&#x80FD;&#x7531;&#x8DEF;&#x7531;&#x5668;&#x8DEF;&#x7531;&#x4E0A;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x53C2;&#x6570;&#x89E6;&#x53D1;&#x3002;</p>
<p>&#x5728;&#x8BF7;&#x6C42;-&#x54CD;&#x5E94;&#x5FAA;&#x73AF;&#x4E2D;&#xFF0C;&#x53C2;&#x6570;&#x56DE;&#x8C03;&#x53EA;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#xFF0C;&#x5373;&#x4F7F;&#x53C2;&#x6570;&#x5728;&#x591A;&#x4E2A;&#x8DEF;&#x5F84;&#x4E2D;&#x5339;&#x914D;&#xFF0C;&#x5982;&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6240;&#x793A;&#x3002;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;CALLED ONLY ONCE&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;although this matches&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;and this matches too&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5F53; <code>GET /user/42</code>&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code>CALLED ONLY ONCE
although this matches
and this matches too
</code></pre><pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;page&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;CALLED ONLY ONCE with&apos;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id/:page&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;although this matches&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id/:page&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;and this matches too&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x5728; <code>GET /user/42/3</code>&#xFF0C;&#x4E0A;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x8F93;&#x51FA;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code>CALLED ONLY ONCE with 42
CALLED ONLY ONCE with 3
although this matches
and this matches too
</code></pre><blockquote>
<p><strong>[danger]</strong> The following section describes <code>router.param(callback)</code>, which is deprecated as of v4.11.0.</p>
</blockquote>
<p>The behavior of the <code>router.param(name, callback)</code> method can be altered entirely by passing only a function to <code>router.param()</code>. This function is a custom implementation of how <code>router.param(name, callback)</code> should behave - it accepts two parameters and must return a middleware.</p>
<p>The first parameter of this function is the name of the URL parameter that should be captured, the second parameter can be any JavaScript object which might be used for returning the middleware implementation.</p>
<p>The middleware returned by the function decides the behavior of what happens when a URL parameter is captured.</p>
<p>In this example, the <code>router.param(name, callback)</code> signature is modified to <code>router.param(name, accessId)</code>. Instead of accepting a name and a callback, <code>router.param()</code> will now accept a name and a number.</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// customizing the behavior of router.param()</span>
router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> option<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// using the customized router.param()</span>
router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// route to trigger the capture</span>
router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/user/:id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;OK&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;Ready&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>In this example, the <code>router.param(name, callback)</code> signature remains the same, but instead of a middleware callback, a custom data type checking function has been defined to validate the data type of the user id.</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validator</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">sendStatus</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFinite</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="router_route"><a name="router_route" class="anchor-navigation-ex-anchor" href="#router_route"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.4. router.route(path) </h3>
<p>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x8DEF;&#x7531;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x7136;&#x540E;&#x60A8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B83;&#x6765;&#x5904;&#x7406;&#x5E26;&#x6709;&#x53EF;&#x9009;&#x4E2D;&#x95F4;&#x4EF6;&#x7684; HTTP &#x52A8;&#x8BCD;&#x3002;&#x4F7F;&#x7528; <code>router.route()</code> &#x6765;&#x907F;&#x514D;&#x91CD;&#x590D;&#x7684;&#x8DEF;&#x7531;&#x540D;&#x79F0;(&#x4EE5;&#x53CA;&#x62FC;&#x5199;&#x9519;&#x8BEF;)&#x3002;</p>
<p>&#x5728;&#x4E0A;&#x9762;&#x7684; <code>router.param()</code> &#x793A;&#x4F8B;&#x4E2D;&#x7ED1;&#x5B9A;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x663E;&#x793A;&#x5982;&#x4F55;&#x4F7F;&#x7528; <code>router.route()</code> &#x6765;&#x6307;&#x5B9A;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684; HTTP &#x65B9;&#x6CD5;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&apos;user_id&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x6837;&#x672C;&#x7528;&#x6237;&#xFF0C;&#x5B9E;&#x9645;&#x4ECE; DB &#x53D6;&#x56DE;&#xFF0C;&#x7B49;&#x7B49;&#x3002;</span>
  req<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">&apos;TJ&apos;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&apos;/users/:user_id&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x9996;&#x5148;&#x8FD0;&#x884C; all HTT P&#x52A8;&#x8BCD;</span>
  <span class="token comment" spellcheck="true">// &#x53EF;&#x4EE5;&#x5C06;&#x5176;&#x89C6;&#x4E3A;&#x8DEF;&#x7531;&#x7279;&#x5B9A;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#xFF01;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// &#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x66F4;&#x65B0;&#x7528;&#x6237;&#x7684;&#x4F8B;&#x5B50;</span>
  req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// &#x4FDD;&#x5B58; user ... etc</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;not implemented&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;not implemented&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x91CD;&#x7528;&#x5355;&#x4E00;&#x7684; &#x2018;/users/:user_id&#x2019; &#x8DEF;&#x5F84;&#xFF0C;&#x5E76;&#x4E3A;&#x5404;&#x79CD; HTTP &#x65B9;&#x6CD5;&#x6DFB;&#x52A0;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</p>
<h3 id="router_use"><a name="router_use" class="anchor-navigation-ex-anchor" href="#router_use"><i class="fa fa-link" aria-hidden="true"></i></a>5.2.5. router.use([path], [function, ...] function) </h3>
<p>&#x4F7F;&#x7528;&#x6307;&#x5B9A;&#x7684;&#x4E2D;&#x95F4;&#x4EF6; <code>function</code>&#xFF0C;&#x5E26;&#x6709;&#x53EF;&#x9009;&#x7684;&#x6302;&#x8F7D;&#x8DEF;&#x5F84; <code>path</code>&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A; &#x201C;/&#x201D;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7C7B;&#x4F3C;&#x4E8E; <a href="#app_use">app.use()</a>&#x3002;&#x4E0B;&#x9762;&#x5C06;&#x4ECB;&#x7ECD;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x793A;&#x4F8B;&#x548C;&#x7528;&#x4F8B;&#x3002;&#x53C2;&#x89C1; <a href="#app_use">app.use()</a> &#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x4E2D;&#x95F4;&#x4EF6;&#x5C31;&#x50CF;&#x4E00;&#x4E2A;&#x6C34;&#x7BA1;&#x7BA1;&#x9053;&#xFF0C;&#x8BF7;&#x6C42;&#x4ECE;&#x60A8;&#x5B9A;&#x4E49;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x5F00;&#x59CB;&#xFF0C;&#x6309;&#x7167;&#x5B83;&#x4EEC;&#x5339;&#x914D;&#x7684;&#x6BCF;&#x6761;&#x8DEF;&#x5F84;&#x201C;&#x5411;&#x4E0B;&#x201D;&#x4E2D;&#x95F4;&#x4EF6;&#x5806;&#x6808;&#x5904;&#x7406;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x7B80;&#x5355;&#x7684;&#x8BB0;&#x5F55;&#x8FD9;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x7684;&#x8BF7;&#x6C42;</span>
<span class="token comment" spellcheck="true">// &#x6240;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x5230;&#x8FD9;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x5C06;&#x9996;&#x5148;&#x89E6;&#x53D1;&#x8FD9;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&apos;%s %s %s&apos;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>method<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x8FD9;&#x53EA;&#x4F1A;&#x5728;&#x8DEF;&#x5F84;&#x4ECE;&#x6302;&#x8F7D;&#x70B9;&#x7684;&#x4EE5; &apos;/bar&apos; &#x5F00;&#x59CB;&#x65F6;&#x88AB;&#x8C03;&#x7528;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/bar&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// ... maybe some additional /bar logging ...</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// &#x59CB;&#x7EC8;&#x8C03;&#x7528;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&apos;/foo&apos;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The &#x201C;mount&#x201D; path is stripped and is not visible to the middleware <code>function</code>. The main effect of this feature is that mounted middleware may operate without code changes regardless of its &#x201C;prefix&#x201D; pathname.
&#x201C;&#x6302;&#x8F7D;&#x201D; &#x8DEF;&#x5F84;&#x88AB;&#x5265;&#x79BB;&#xFF0C;&#x5BF9;&#x4E2D;&#x95F4;&#x4EF6; <code>function</code> &#x662F;&#x4E0D;&#x53EF;&#x89C1;&#x3002;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x7684;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x6302;&#x8F7D;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x4E0D;&#x7BA1;&#x4EE3;&#x7801;&#x7684;&#x201C;&#x524D;&#x7F00;&#x201D;&#x8DEF;&#x5F84;&#x540D;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x4EE3;&#x7801;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x7528; <code>router.use()</code> &#x5B9A;&#x4E49;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x987A;&#x5E8F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x3002;&#x5B83;&#x4EEC;&#x662F;&#x6309;&#x987A;&#x5E8F;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x987A;&#x5E8F;&#x5B9A;&#x4E49;&#x4E86;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x901A;&#x5E38;&#x8BB0;&#x5F55;&#x5668;&#x662F;&#x60A8;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E2A;&#x8BF7;&#x6C42;&#x90FD;&#x88AB;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;</p>
<pre class="language-"><code class="lang-js"><span class="token keyword">var</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;morgan&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x73B0;&#x5728;&#x5047;&#x8BBE;&#x4F60;&#x60F3;&#x5FFD;&#x7565;&#x5BF9;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x8BB0;&#x5F55;&#x8BF7;&#x6C42;&#xFF0C;&#x4F46;&#x662F;&#x8981;&#x7EE7;&#x7EED;&#x8BB0;&#x5F55;&#x5728; logger() &#x4E4B;&#x540E;&#x5B9A;&#x4E49;&#x7684;&#x8DEF;&#x7531;&#x548C;&#x4E2D;&#x95F4;&#x4EF6;&#x3002; &#x4F60;&#x53EA;&#x9700;&#x8981;&#x79FB;&#x52A8;&#x4E0A;&#x9762;&#x7684;static()&#xFF1A;</p>
<pre class="language-"><code class="lang-js">router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x4F8B;&#x5B50;&#x662F;&#x4ECE;&#x591A;&#x4E2A;&#x76EE;&#x5F55;&#x63D0;&#x4F9B;&#x6587;&#x4EF6;&#xFF0C;&#x4F18;&#x5148;&#x201C;./public&#x201D;&#x800C;&#x4E0D;&#x662F;&#x5176;&#x4ED6;&#x76EE;&#x5F55;&#xFF1A;</p>
<pre class="language-"><code class="lang-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/public&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/files&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token keyword">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&apos;/uploads&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>router.use()</code> &#x65B9;&#x6CD5;&#x8FD8;&#x652F;&#x6301;&#x547D;&#x540D;&#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x4FBF;&#x5176;&#x4ED6;&#x8DEF;&#x7531;&#x5668;&#x7684;&#x6302;&#x8F7D;&#x70B9;&#x53EF;&#x4EE5;&#x4ECE;&#x4F7F;&#x7528;&#x547D;&#x540D;&#x53C2;&#x6570;&#x7684;&#x9884;&#x52A0;&#x8F7D;&#x4E2D;&#x83B7;&#x76CA;&#x3002;</p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; tuzhu008 2017 all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x8BE5;&#x6587;&#x4EF6;&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2018-01-05 00:33:59
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../" class="navigation navigation-prev " aria-label="Previous page: Express">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="API.html#express" class="navigation navigation-next " aria-label="Next page: express()">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"API","level":"3.6.1","depth":2,"next":{"title":"express()","level":"3.6.1.1","depth":3,"anchor":"#express","path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md#express","articles":[]},"previous":{"title":"Express","level":"3.6","depth":1,"path":"Library/express/README.md","ref":"Library/express/README.md","articles":[{"title":"API","level":"3.6.1","depth":2,"path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md","articles":[{"title":"express()","level":"3.6.1.1","depth":3,"anchor":"#express","path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md#express","articles":[]},{"title":"Application","level":"3.6.1.2","depth":3,"anchor":"#application","path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md#application","articles":[]},{"title":"Request","level":"3.6.1.3","depth":3,"anchor":"#request","path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md#request","articles":[]},{"title":"Response","level":"3.6.1.4","depth":3,"anchor":"#response","path":"Library/express/docs/API.md","ref":"Library/express/docs/API.md#response","articles":[]},{"title":"Router","level":"3.6.1.5","depth":3,"anchor":"#router","path":"(Library/express/docs/API.md","ref":"(Library/express/docs/API.md#router","articles":[]}]},{"title":"中间件","level":"3.6.2","depth":2,"path":"Library/express/middleware/README.md","ref":"Library/express/middleware/README.md","articles":[{"title":"method-override","level":"3.6.2.1","depth":3,"path":"Library/express/middleware/method-override/README.md","ref":"Library/express/middleware/method-override/README.md","articles":[]},{"title":"express-session","level":"3.6.2.2","depth":3,"path":"Library/express/middleware/session/README.md","ref":"Library/express/middleware/session/README.md","articles":[]},{"title":"connect-mongo","level":"3.6.2.3","depth":3,"path":"Library/express/middleware/connect-mongo/README.md","ref":"Library/express/middleware/connect-mongo/README.md","articles":[]},{"title":"connect-flash","level":"3.6.2.4","depth":3,"path":"Library/express/middleware/connect-flash/README.md","ref":"Library/express/middleware/connect-flash/README.md","articles":[]},{"title":"express-formidable","level":"3.6.2.5","depth":3,"path":"Library/express/middleware/express-formidable/README.md","ref":"Library/express/middleware/express-formidable/README.md","articles":[]},{"title":"express-winston","level":"3.6.2.6","depth":3,"path":"Library/express/middleware/express-winston/README.md","ref":"Library/express/middleware/express-winston/README.md","articles":[]}]}]},"dir":"ltr"},"config":{"plugins":["expandable-chapters-small","anchors","anchor-navigation-ex","favicon","copy-code-button","alerts","splitter","book-summary-scroll-position-saver","include-codeblock","ace","prism","prism-themes","-highlight","tbfed-pagefooter","github","sectionx","livereload"],"root":".","styles":{"website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy tuzhu008 2017","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-atom-dark.css"]},"ace":{},"github":{"url":"https://github.com/tuzhu008"},"livereload":{},"book-summary-scroll-position-saver":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"night","family":"serif","size":2},"sectionx":{"tag":"b"},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showLevel":true},"favicon":{"shortcut":"assets/images/favicon.ico","bookmark":"assets/images/favicon.ico","appleTouch":"assets/images/apple-touch-icon.png","appleTouchMore":{"120x120":"assets/images/apple-touch-icon-120x120.png","180x180":"assets/images/apple-touch-icon-180x180.png"}},"prism-themes":{},"alerts":{},"expandable-chapters-small":{},"copy-code-button":{},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"acefull","theme":"tomorrow","unindent":true},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"tuzhu008","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Node.js","language":"zh-hans","gitbook":"*","description":"Node.js 自我学习"},"file":{"path":"Library/express/docs/API.md","mtime":"2018-01-04T16:33:59.334Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-01-04T16:34:21.590Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-alerts/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-book-summary-scroll-position-saver/book-summary-scroll-position-saver.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sectionx/sectionx.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

